/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-logger",function(d){var b=[],a=null;
var c=d.Base.create("logger",d.Base,[],{initializer:function(e){d.one(window).on("beforeunload",this.flush,this)
},enqueue:function(e){b.push(e);
this.wait()
},flush:function(f){try{clearTimeout(a)
}catch(e){}a=null;
if(b.length>0){d.Data.post({url:"/api/events/Trace",data:{data:JSON.stringify(b)}})
}b=[]
},wait:function(){if(a===null){a=setTimeout(d.bind(this.flush,this),this.get("timerLength"))
}},log:function(e,f){if(d.Lang.isValue(e)){this.enqueue({sessionKey:this.get("sessionKey"),pageUrl:document.location.href,type:e,data:JSON.stringify(d.Lang.isValue(f)?f:{})})
}}},{ATTRS:{timerLength:{value:30*1000},sessionKey:{value:d.Cookie.get("JSESSIONID")}}});
d.namespace("Squarespace").Logger=new c()
},"1.0",{requires:["node","io-base","cookie","event","base"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-base-get-property",function(b){var a=function(){};
a.prototype={getProperty:function(c){var d=this.constructor,e=this.constructor[c];
while(b.Lang.isUndefined(e)){if(d.superclass){d=d.superclass.constructor
}else{break
}if(b.Lang.isUndefined(d)){break
}e=d[c]
}return e
}};
a.NAME="baseGetProperty";
b.namespace("Squarespace").BaseGetProperty=a
},"1.0");/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-anims",function(b){function a(c){a.superclass.constructor.apply(this,arguments)
}b.namespace("Squarespace").Anims=b.extend(a,b.Base,{initializer:function(){this._items=[]
},destructor:function(){var c=[];
this.each(function(d){c.push(d)
});
b.Array.each(c,function(d){if(d.get("running")){d.stop(false)
}d.destroy()
});
b.detach(this.get("id")+"|*")
},add:function(c){if(!c.get("node")){throw this.name+": Animation doesn't specify a node"
}if(!c.get("node").ancestor("body")){console.warn(this.name+": Animation with a YUI node not in the DOM added")
}else{if(!c.get("node")._node){console.warn(this.name+": Animation with a _node = null added")
}}c.on(this.get("id")+"|end",function(d){this.remove(c)
},this);
this._items.push(c)
},remove:function(d){if(b.Lang.isNumber(d)){return this._items.splice(d,1)
}else{var c=this._items.indexOf(d);
if(c!==-1){return this._items.splice(this._items.indexOf(d),1)
}}}},{NAME:"anims"});
b.augment(a,b.ArrayList)
},"1.0",{requires:["base","base-build","arraylist"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-zen",function(e){var d=/(?:\s*([-+ ,<>]))?\s*(\.|!|#)?([-\w$]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,b=/[\-+,> ]/,c=e.config.doc;
function a(g,h){g.appendChild(c.createTextNode(h))
}function f(k){var l;
var h;
if(typeof("ieCreateElement")=="undefined"){try{l=1;
f("i",{name:"a"})
}catch(s){l=0
}}var t,g,q,o,n,r,u=arguments;
if(k._node){k=k._node
}function j(){if(r&&n&&r!==n){var i=n;
if(n===k){t=t||(b.test(h)&&c.createDocumentFragment());
if(t){i=t
}}i.insertBefore(r,o||null)
}}for(var p=0;
p<u.length;
p++){h=u[p];
if(typeof h=="object"){if(h._node){r=h._node
}if(h.nodeType){r=h;
j();
n=h._node||h;
o=0
}else{for(var v in h){r[v]=h[v]
}}}else{if(q===p-1){a(r,h)
}else{if(p<1){k=null
}q=p;
var m=h.replace(d,function(D,i,y,B,A,x){if(i){j();
if(i=="-"||i=="+"){n=(o=(r||n)).parentNode;
if(n==null){n=t=t||c.createDocumentFragment();
t.appendChild(r);
o=r
}r=null;
if(i=="+"){o=o.nextSibling
}}else{if(i=="<"){n=(r||n).parentNode;
if(n==null){n=t=t||c.createDocumentFragment();
t.appendChild(r);
r=t
}else{r=n
}}else{if(i==","){n=k
}else{if(r){n=r
}}r=null
}o=0
}if(r){n=r
}}var E=!y&&B;
if(E||(!r&&(y||A))){if(E=="$"){a(n,u[++p])
}else{E=E||f.defaultTag;
var C=l&&u[p+1]&&u[p+1].name;
if(C){E="<"+E+' name="'+C+'">'
}r=c.createElement(E)
}}if(y){if(B=="$"){B=u[++p]
}if(y=="#"){r.id=B
}else{var w=r.className;
var z=w&&(" "+w+" ").replace(" "+B+" "," ");
if(y=="."){r.className=w?(z+B).substring(1):B
}else{if(h=="!"){e.one(r).destroy(true).remove()
}else{z=z.substring(1,z.length-1);
if(z!=w){r.className=z
}}}}}if(A){if(x=="$"){x=u[++p]
}if(A=="style"){r.style.cssText=x
}else{r[A.charAt(0)=="!"?(A=A.substring(1))&&"removeAttribute":"setAttribute"](A,x===""?A:x)
}}return""
});
if(m){throw new SyntaxError("Unexpected char "+m+" in "+h)
}j();
n=g=r||n
}}}if(k&&t){k.appendChild(t)
}return e.one(g)
}f.defaultTag="div";
f.setDocument=function(g,h){c=g;
b=h||b
};
e.zen=f;
if(e.Node){e.Node.addMethod("zen",function(){return f.apply(null,arguments)
});
e.NodeList.importMethod(e.Node.prototype,"zen")
}},"1.0",{requires:["node"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-commerce-utils",function(a){a.namespace("Squarespace.Commerce");
a.Squarespace.Commerce={USPSServiceTypes:{FIRST_CLASS:1,PRIORITY:2,EXPRESS:3,PARCEL:4},priceString:function(c){switch(c.productType){case a.Squarespace.ProductTypes.PHYSICAL:var b=this.normalPrice(c);
if(this.onSale(c)){return"$"+a.Squarespace.Utils.moneyFormat(this.salePrice(c))+' <span class="strikeout">$'+a.Squarespace.Utils.moneyFormat(b)+"</span>"
}else{if(this.variedPrices(c)){return"from $"+a.Squarespace.Utils.moneyFormat(this.fromPrice(c))
}}return"$"+a.Squarespace.Utils.moneyFormat(b);
case a.Squarespace.ProductTypes.DIGITAL:if(c.payWhatYouWant){return"$"+a.Squarespace.Utils.moneyFormat(c.minimumPriceCents)+" or more"
}else{if(c.onSale){return"$"+a.Squarespace.Utils.moneyFormat(c.salePriceCents)+' <span class="strikeout">$'+a.Squarespace.Utils.moneyFormat(c.priceCents)+"</span>"
}}return"$"+a.Squarespace.Utils.moneyFormat(c.priceCents)
}},hasVariants:function(b){return(b.productType==a.Squarespace.ProductTypes.DIGITAL)?false:(b.variants.length>1)
},variedPrices:function(f){switch(f.productType){case a.Squarespace.ProductTypes.PHYSICAL:var b=f.variants;
if(b.length<=1){return false
}var e=b[0];
for(var d=1;
d<b.length;
d++){var c=b[d];
if((c.onSale!=e.onSale)||(e.onSale&&(c.salePrice!=e.salePrice))||(c.price!=e.price)){return true
}}return false;
case a.Squarespace.ProductTypes.DIGITAL:return false
}},onSale:function(f){switch(f.productType){case a.Squarespace.ProductTypes.PHYSICAL:var b=f.variants;
var e=false;
for(var d=0;
d<b.length;
d++){var c=b[d];
if(c.onSale&&(c.unlimited||c.qtyInStock>0)){e=true;
break
}}return e;
case a.Squarespace.ProductTypes.DIGITAL:return f.payWhatYouWant?false:f.onSale
}},normalPrice:function(f){switch(f.productType){case a.Squarespace.ProductTypes.PHYSICAL:var d=f.variants;
if(d.length===0){return 0
}var b=d[0].price;
for(var e=1;
e<d.length;
e++){var c=d[e].price;
if(c>b){b=c
}}return b;
case a.Squarespace.ProductTypes.DIGITAL:return a.Lang.isUndefined(f.priceCents)?0:f.priceCents
}},salePrice:function(g){switch(g.productType){case a.Squarespace.ProductTypes.PHYSICAL:var b=g.variants;
if(b.length===0){return 0
}var d=null;
for(var f=0;
f<b.length;
f++){var e=b[f];
var c=e.salePrice;
if(e.onSale&&(d===null||(e.salePrice<d))){d=c
}}return d;
case a.Squarespace.ProductTypes.DIGITAL:return a.Lang.isUndefined(g.salePriceCents)?0:g.salePriceCents
}},fromPrice:function(e){switch(e.productType){case a.Squarespace.ProductTypes.PHYSICAL:var c=e.variants;
if(c.length===0){return 0
}var f=c[0].price;
for(var d=1;
d<c.length;
d++){var b=c[d].price;
if(b<f){f=b
}}return f;
case a.Squarespace.ProductTypes.DIGITAL:return a.Lang.isUndefined(e.priceCents)?0:e.priceCents
}},couponDescriptor:function(d){var f;
var c;
var e=this._clone(d,{});
e=this.normalizeAndCleanCouponData(e);
var b={minPrice:"$"+a.Squarespace.Utils.moneyFormat(e.minPrice),productTitle:e.productTitle||"?",discountAmt:e.discountAmt||"?"};
switch(e.type){case a.Squarespace.CommerceCouponTypes.ALL_ORDERS:f=function(g){return"Save "+g.discountAmt+" on any order."
};
c=function(){return"Free shipping on any order."
};
break;
case a.Squarespace.CommerceCouponTypes.ORDERS_OVER:f=function(g){return"Save "+g.discountAmt+" on any order over "+g.minPrice+"."
};
c=function(g){return"Free shipping on any order over "+g.minPrice+"."
};
break;
case a.Squarespace.CommerceCouponTypes.CATEGORIES:f=function(g){return"Save "+g.discountAmt+" on select products."
};
break;
case a.Squarespace.CommerceCouponTypes.SINGLE_PRODUCT:f=function(g){return"Save "+g.discountAmt+" on  "+g.productTitle+" ."
};
break;
default:throw"Unsupported coupon type"
}switch(e.discountType){case a.Squarespace.CommerceDiscountTypes.FLAT:b.discountAmt="$"+a.Squarespace.Utils.moneyFormat(e.discountAmt);
break;
case a.Squarespace.CommerceDiscountTypes.PERCENTAGE:b.discountAmt=b.discountAmt+"%";
break;
case a.Squarespace.CommerceDiscountTypes.FREE_SHIPPING:return c(b)
}return f(b)
},normalizeAndCleanCouponData:function(c,b){if(c.discountType===a.Squarespace.CommerceDiscountTypes.FLAT){c.flatDiscount=c.discountAmt
}else{if(c.discountType===a.Squarespace.CommerceDiscountTypes.PERCENTAGE){c.percentDiscount=c.discountAmt
}}return c
},isValidUSZip:function(b){return(/^\d{5}(-\d{4})?$/).test(b)
},_clone:function(c,d){var b,e;
for(b in c){if(c.hasOwnProperty(b)){e=c[b];
if(e&&typeof e==="object"&&!e.node){switch(Object.prototype.toString.call(e)){case"[object Object]":d[b]=this._clone(e,(typeof d[b]!=="undefined"&&Object.prototype.toString.call(d[b])==="[object Object]")?d[b]:{});
break;
case"[object Array]":d[b]=this._clone(e,(typeof d[b]!=="undefined"&&Object.prototype.toString.call(d[b])==="[object Array]")?d[b]:[]);
break;
default:d[b]=e;
break
}}else{d[b]=e
}}}return d
}}
},"1.0",{requires:["squarespace-util"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-template-helpers",function(L){var B={get:function(b,a){if(typeof(b.get)==="function"){return b.get(a)
}else{return b[a]
}}};
var N={html:L.Squarespace.Escaping.escapeForHtml,htmltag:L.Squarespace.Escaping.escapeForHtmlTag,htmlattr:L.Squarespace.Escaping.escapeForHtmlTag,str:function(b){if(b===null||typeof(b)==="undefined"){return""
}try{return b.toString()
}catch(a){return"[JSONT: Can't format variable as string (typeof: "+typeof(b)+").]"
}},raw:function(a){return a
},safe:function(a){if(!a){return""
}return a.replace(/<.*?>/g,"")
},json:function(a){return L.JSON.stringify(a).replace(/<\/script>/g,'</scr"+"ipt>')
},"json-pretty":function(a){return L.JSON.stringify(a,null,2).replace(/<\/script>/g,'</scr"+"ipt>')
},smartypants:function(a){a=a.replace(/(^|[-\u2014\s(\["])'/g,"$1\u2018");
a=a.replace(/'/g,"\u2019");
a=a.replace(/(^|[-\u2014/\[(\u2018\s])"/g,"$1\u201c");
a=a.replace(/"/g,"\u201d");
a=a.replace(/--/g,"\u2014");
return a
},slugify:function(a){return(!a?"":a.replace(/[^\-a-zA-Z0-9\s]+/ig,"").replace(/\s/g,"-").toLowerCase())
},"url-encode":function(a){return encodeURIComponent(a)
},"activate-twitter-links":function(a){var c=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
var d=/(^| )@([a-zA-Z0-9_]+)/ig;
var b=/(^| )#([a-zA-Z0-9_]+)/ig;
return a.replace(c,'<a target="new" href="$1">$1</a>').replace(d,'$1<a target="new" href="http://www.twitter.com/$2/">@$2</a>').replace(b,function(e){return'<a target="new" href="http://www.twitter.com/search/'+encodeURIComponent(e)+'">'+e+"</a>"
})
},count:function F(b){var a=b.length;
if(a==null&&typeof b==="object"){a=0;
for(C in b){if(Object.prototype.hasOwnProperty.call(b,C)){a++
}}}return a||0
},"audio-player":function(a){return'<script>Y.use(\'squarespace-audio-player-frontend\');<\/script><div class="squarespace-audio-player" data-audio-asset-url="'+a.audioAssetUrl+'" data-item-id="'+a.id+'" id="audio-player-'+a.id+'"></div>'
},"social-button":function(a,b){var c=b._LookUpStack("website");
if(c&&c.shareButtonOptions&&Object.keys(c.shareButtonOptions).length!==0){return'<script>Y.use(\'squarespace-social-buttons\');<\/script><div class="squarespace-social-buttons button-style" data-system-data-id="'+(a.systemDataId?a.systemDataId:"")+'" data-asset-url="'+a.assetUrl+'" data-record-type="'+a.recordType+'" data-full-url="'+a.fullUrl+'" data-title="'+L.Squarespace.Escaping.escapeForHtmlTag(a.title)+'"></div>'
}},"social-button-inline":function(a,b){var c=b._LookUpStack("website");
if(c&&c.shareButtonOptions&&Object.keys(c.shareButtonOptions).length!==0){return'<script>Y.use(\'squarespace-social-buttons\');<\/script><span class="squarespace-social-buttons inline-style" data-system-data-id="'+(a.systemDataId?a.systemDataId:"")+'" data-asset-url="'+a.assetUrl+'" data-record-type="'+a.recordType+'" data-full-url="'+a.fullUrl+'" data-title="'+L.Squarespace.Escaping.escapeForHtmlTag(a.title)+'"></span>'
}},"twitter-follow-button":function(b){var a=b.userName||b.profileUrl.split("/").pop();
return"<script>Y.use('squarespace-follow-buttons', function(Y) { Y.on('domready', function() { Y.Squarespace.FollowButtonUtils.renderAll(); }); });<\/script><div class=\"squarespace-follow-button\" data-username=\""+a+'"></div>'
},comments:function(a){return'<div class="squarespace-comments" id="comments-'+a.id+'"></div>'
},"comment-link":function(a,c){var b=c._LookUpStack("websiteSettings");
if(b&&b.disqusShortname){return'<script>Y.use("squarespace-comment-links");<\/script><a href="'+a.fullUrl+'" class="sqs-comment-link" data-id="'+a.id+'"></a>'
}return'<a href="'+a.fullUrl+"#comments-"+a.id+'" class="sqs-comment-link" data-id="'+a.id+'">'+(a.publicCommentCount===0?"No":a.publicCommentCount)+" Comment"+(a.publicCommentCount===1?"":"s")+"</a>"
},"like-button":function(a,c){var b=c._LookUpStack("websiteSettings");
if(b&&b.simpleLikingEnabled){return'<span class="sqs-simple-like" data-item-id="'+a.id+'" data-like-count="'+a.likeCount+'"><span class="like-icon"></span><span class="like-count"></span></span>'
}},"comment-count":function(a){return(a.publicCommentCount===0?"No":a.publicCommentCount)+" Comment"+(a.publicCommentCount===1?"":"s")
},"image-meta":function(c){var b="0.5,0.5";
if(c.mediaFocalPoint){b=c.mediaFocalPoint.x+","+c.mediaFocalPoint.y
}var a;
if(c.title&&c.title.length>0){a=c.title
}if(!a&&c.body&&c.body.length>0){a=c.body.replace(/<(?:.|\n)*?>/gm,"")
}if(!a&&c.filename&&c.filename.length>0){a=c.filename
}if(a){a=L.Squarespace.Escaping.escapeForHtmlTag(a)
}return'data-image="'+c.assetUrl+'" data-src="'+c.assetUrl+'" data-image-dimensions="'+(c.originalSize||"")+'" data-image-focal-point="'+b+'" alt="'+a+'" '
},height:function(b){var a=b.split("x");
if(a.length!=2){return"Invalid source parameter.  Pass in 'originalSize'."
}var d=parseInt(a[0],10);
var c=parseInt(a[1],10);
return c
},width:function(b){var a=b.split("x");
if(a.length!=2){return"Invalid source parameter.  Pass in 'originalSize'."
}var d=parseInt(a[0],10);
var c=parseInt(a[1],10);
return d
},moneyFormat:function(a){return L.Squarespace.Utils.moneyFormat(a)
},"months-options":function(){var c=["","January","February","March","April","May","June","July","August","September","October","November","December"];
var a="";
for(var b=1;
b<c.length;
b++){a+="<option value='"+b+"'>"+N["zero-pad"](b,2)+" - "+c[b]+"</option>"
}return a
},"months-options-short":function(){var a="";
for(var b=1;
b<=12;
b++){a+="<option value='"+b+"'>"+N["zero-pad"](b,2)+"</option>"
}return a
},"zero-pad":function(a,b){b-=a.toString().length;
if(b>0){return new Array(b+(/\./.test(a)?2:1)).join("0")+a
}return a
},"years-options":function(){var c="";
var a=new Date().getFullYear();
for(var b=a;
b<=a+10;
b++){c+="<option value='"+b+"'>"+b+"</option>"
}return c
},"google-calendar-url":function(c){var f="%Y%m%dT%H%M%SZ";
var d=new Date(c.startDate);
d.setHours(d.getHours()+d.getTimezoneOffset()/60);
var a=L.DataType.Date.format(d,{format:f});
var e=new Date(c.endDate);
e.setHours(e.getHours()+e.getTimezoneOffset()/60);
var b=L.DataType.Date.format(e,{format:f});
return"http://www.google.com/calendar/event?action=TEMPLATE&text="+c.title+"&dates="+a+"/"+b+""
},AbsUrl:function(a,b){return B.get("base-url")+"/"+a
},"item-classes":function(b,j){if(j.hash){j=this
}var h=["hentry"];
var c=B.get(j,"promotedBlockType");
if(!!c){h.push("promoted");
h.push(N.slugify("promoted-block-"+c))
}var d=B.get(j,"categories");
if(!!d){for(var e=0;
e<d.length;
e++){h.push(N.slugify("category-"+d[e]))
}}var a=B.get(j,"tags");
if(!!a){for(var f=0;
f<a.length;
f++){h.push(N.slugify("tag-"+a[f]))
}}var g=B.get(j,"author");
if(!!g&&!!g.displayName){h.push(N.slugify("author-"+g.displayName))
}h.push("post-type-"+B.get(j,"recordTypeLabel"));
h.push("article-index-"+B.get(j,"@index"));
if(B.get(j,"starred")){h.push("featured")
}return h.join(" ")
},round:function(a,b,c){return Math.round(parseFloat(a))
},iter:function(a){return B.get(a,"@index")
},"from-price":function(a){return L.Squarespace.Commerce.fromPrice(a)
},"normal-price":function(a){return L.Squarespace.Commerce.normalPrice(a)
},"sale-price":function(a){return L.Squarespace.Commerce.salePrice(a)
},"coupon-descriptor":function(a){return L.Squarespace.Commerce.couponDescriptor(a)
},"variant-descriptor":function(a){return L.Squarespace.Utils.variantFormat(a)
},"variants-attributes":function(a){if(a.variants===undefined||a.variants.length<=1){return""
}return L.Squarespace.Utils.variantFormatAttributes(a.variants[0])
},"variants-select":function(d){var h=d.variants;
var b=d.variantOptionOrdering;
if(L.Lang.isUndefined(h)||h.length<=1){return""
}var l=[];
for(var k=0;
k<b.length;
k++){var r=b[k];
l.push({name:r,values:[]})
}for(var k=0;
k<h.length;
k++){var j=h[k];
for(var a in j){if(!L.Squarespace.Utils.isSystemVariantOption(a)){var q=j[a];
var e;
for(var o=0;
o<l.length;
o++){var s=l[o];
if(s.name==a){e=s
}}var f=e.values;
var g=false;
for(var p=0;
p<f.length;
p++){var t=f[p];
if(t==q){g=true
}}if(!g){f.push(q)
}}}}var c="";
for(var k=0;
k<l.length;
k++){var a=l[k].name;
var n=l[k].values;
var m='<div class="variant-option"><div class="variant-option-title">'+a+': </div><select data-variant-option-name="'+a+'"><option value="none" >Select '+a+"</option>";
for(var o=0;
o<n.length;
o++){var q=n[o];
m+='<option value="'+L.Squarespace.Escaping.escapeForHtmlTag(q)+'">'+q+"</option>"
}m+="</select></div>";
c+=m
}return'<div class="product-variants" data-item-id="'+d.id+'" data-variants="'+L.Squarespace.Escaping.escapeForHtmlTag(JSON.stringify(h))+'">'+c+"</div>"
},"quantity-select":function(a){if(a.productType!==L.Squarespace.ProductTypes.PHYSICAL){return""
}var d="";
for(var b=1;
b<10;
b++){d+='<option value="'+b+'" >'+b+"</option>"
}var c='<div class="quantity-label">Quantity:</div>';
return'<div class="product-quantity-select" data-item-id="'+a.id+'" >'+c+"<select>"+d+"</select></div>"
},"add-to-cart-btn":function(a){return'<div data-item-id="'+a.id+'" class="sqs-add-to-cart-button sqs-suppress-edit-mode">Add to Cart</div>'
},"color-weight":function(a){if(a&&a.length>0&&a.length<=7){a=a.replace("#","");
return((parseInt(a,16)>16777215/2)?"light":"dark")
}else{return""
}}};
var A=[{name:"collectionTypeNameEquals?",func:function(a,b,c){return b.get("typeName")==c[0]
}}];
var I={"main-image?":function(a){return !!a.mainImageId||!!a.systemDataId
},"location?":function(a){return(a.location&&a.location.mapLat&&a.location.mapLng&&a.location.mapZoom)
},"excerpt?":function(b){var a=/(?:^$)|(?:^\s*<p[^>]*>(?:\s*<br\s*\/?>\s*)(?:[\u200b\s]*)<\/p\s*>\s*)/;
return(!!b.excerpt&&!(a.test(b.excerpt.html||b.excerpt)))
},"comments?":function(c,b){var a=b._LookUpStack("websiteSettings");
var d=c.commentState===1;
if(!d&&c.publicCommentCount>0){d=true
}if(a&&!a.commentsEnabled){d=false
}return d
},"collection?":function(a){return a.collection
},"collection-page?":function(a){return(a.collection&&a.collection.type==L.Squarespace.CollectionTypes.PAGE)
},"passthrough?":function(a){return a.passthrough&&a.sourceUrl&&a.sourceUrl!==""
},"event?":function(a){return a.recordType==L.Squarespace.ContentConstants.EVENT
},"same-day?":function(c){var b=new Date(c.startDate);
var a=new Date(c.endDate);
return(b.getYear()==a.getYear())&&(b.getMonth()==a.getMonth())&&(b.getDate()==a.getDate())
},"external-link?":function(a){return !!a.externalLink
},"folder?":function(a){return a.collection&&a.collection.folder
},"singular?":function(a){return a===1
},"plural?":function(a){return a!==1
},"disqus?":function(c,b){var a=b._LookUpStack("websiteSettings");
return a&&a.disqusShortname
},"serviceNameEmail?":function(b,a){return b.serviceName==="email"
},"debug?":function(c,b){try{return b.get("debug")
}catch(a){if(a.name=="UndefinedVariable"){return false
}else{throw a
}}},"has-variants?":function(a){return L.Squarespace.Commerce.hasVariants(a)
},"varied-prices?":function(a){return L.Squarespace.Commerce.variedPrices(a)
},"on-sale?":function(a){return L.Squarespace.Commerce.onSale(a)
},"sold-out?":function(b){if(b.productType==L.Squarespace.ProductTypes.DIGITAL){return false
}var a=true;
if(b.variants===undefined){return false
}for(var c=0;
c<b.variants.length;
c++){if(b.variants[c].unlimited||b.variants[c].qtyInStock>0){a=false
}}return a
}};
var H=[{name:"output",func:function(a,b,c){return c.join(" ")
}},{name:"video",func:function(k,e,c){var b=k.oembed||{};
var h=k.overlay;
var j=k.assetUrl;
var d="0.5,0.5";
if(k.mediaFocalPoint){d=k.mediaFocalPoint.x+","+k.mediaFocalPoint.y
}var g=false;
if(c&&c[0]==="load-false"){g=true
}var a='<div class="sqs-video-wrapper" '+(g?'data-load="false" ':"")+'data-html="'+L.Squarespace.Escaping.escapeForHtmlTag(b.html)+'" data-provider-name="'+b.providerName+'">';
if(h){var f='<div class="sqs-video-overlay';
if(!!k.mainImageId||!!k.systemDataId){f+='" style="opacity: 0;">';
f+='<img data-load="false" data-image="'+j+'" data-src="'+j+'" data-image-dimensions="'+(k.originalSize||"")+'" data-image-focal-point="'+d+'" />'
}else{f+=' no-thumb" style="opacity: 0;">'
}f+='<div class="sqs-video-opaque"> </div><div class="sqs-video-icon"></div>';
f+="</div>";
a+=f
}a+="</div>";
return a
}},{name:"image-color",func:function(b,d,e){var c="";
if(b.colorData){if(e.length>0){var a=b.colorData[e[0]+"Average"];
if(a){if(e.length==2){c=e[1]+": #"+a
}else{c="#"+a
}}else{c=e[0]+" not found: valid position-- topLeft, topRight, bottomLeft, bottomRight, center"
}}else{c='data-color-topleft="#'+b.colorData.topLeftAverage+'" data-color-topright="#'+b.colorData.topRightAverage+'" data-color-bottomleft="#'+b.colorData.bottomLeftAverage+'" data-color-bottomright="#'+b.colorData.bottomRightAverage+'" data-color-center="#'+b.colorData.centerAverage+'" '
}}return c
}}];
function v(a,b){if(!!b){return function(c){return(c.recordType==a)||(c.promotedBlockType==b)
}
}else{return function(c){return(c.recordType==a)
}
}}for(var K in L.Squarespace.ContentStringConstants){I[K+"?"]=v(L.Squarespace.ContentStringConstants[K])
}I["external-video?"]=v(L.Squarespace.ContentConstants.VIDEO,"video");
I["video?"]=v(L.Squarespace.ContentConstants.VIDEO,"video");
I["image?"]=v(L.Squarespace.ContentConstants.IMAGE,"image");
I["quote?"]=v(L.Squarespace.ContentConstants.QUOTE,"quote");
I["link?"]=v(L.Squarespace.ContentConstants.LINK,"link");
I["quote?"]=v(L.Squarespace.ContentConstants.QUOTE,"quote");
I["gallery?"]=v(L.Squarespace.ContentConstants.GALLERY,"gallery");
function G(a){return function(b){return(b.promotedBlockType==a)
}
}var z=["map","embed","image","code","quote","twitter","link","video","foursquare","instagram","form"];
for(var C=0;
C<z.length;
C++){var y=z[C];
var w=y.charAt(0).toUpperCase()+y.slice(1);
I["promoted"+w+"?"]=G(y)
}I["index?"]=function(a){return a.folderBehavior==L.Squarespace.FolderBehavior.INDEX
};
I["redirect?"]=function(a){return a.folderBehavior==L.Squarespace.FolderBehavior.REDIRECT
};
I["clickable?"]=function(d,a,c){var b=a._LookUpStack("folderBehavior");
if(typeof(b)==="undefined"){return true
}return b==L.Squarespace.FolderBehavior.INDEX||b==L.Squarespace.FolderBehavior.REDIRECT
};
function J(b,a){return function(d,e,c){return e._LookUpStack("options")[b]==a
}
}for(var M in L.Squarespace.GalleryOptions){var x=L.Squarespace.GalleryOptions[M];
switch(x.type){case"select":for(var i in x.options){var E=x.options[i];
I["gallery-"+M+"-"+i+"?"]=J(M,i)
}break;
case"boolean":I["gallery-"+M+"?"]=J(M,true);
break;
case"slider":break;
default:console.log("Unknown type: "+K+", (opt: "+M+")");
break
}}I["gallery-meta?"]=function(c,a,b){return a._LookUpStack("options")["controls"]||a._LookUpStack("options")["indicators"]
};
var D={debug:function(){return function(a){var b="DEBUG:\n========================\n";
b+=JSON.stringify(this||a,null,2);
b+="END DEBUG:\n========================\n";
return b
}
},moneyFormat:function(a){return L.Squarespace.Utils.moneyFormat(a)
}};
L.namespace("Squarespace");
L.Squarespace.HANDLEBARS_HELPERS=D;
L.Squarespace.TEMPLATE_PREDICATES=I;
L.Squarespace.TEMPLATE_PARAMETRIC_PREDICATES=A;
L.Squarespace.TEMPLATE_FORMATTERS=N;
L.Squarespace.TEMPLATE_PREFIX_FORMATTERS=H
},"1.0",{requires:["squarespace-common","squarespace-util","squarespace-commerce-utils","substitute","json"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-ui-templates",function(e){var d=e.Base.create("UITemplates",e.Base,[],{render:function(f,g){var h=this.getCompiledTemplate(f);
if(!h){throw Error(this.name+": Could not find UITemplate by the name of: "+f+". Recompile templates?")
}return h(g||{})
},renderAsNodeOrDocFrag:function(f,g){return e.Node.create(this.render(f,g))
},getCompiledTemplate:function(f){var g=this.get("compiledTemplates")[f];
if(!g){throw this.name+": A template by the name "+f+" does not exist."
}return g
}},{ATTRS:{compiledTemplates:{readOnly:true,getter:function(){var f=e.Handlebars.templates;
if(!e.Lang.isObject(f)){throw this.name+": No templates are available. Have you loaded your template module?"
}return f
}}}});
e.namespace("Squarespace").UITemplates=new d();
e.Squarespace.TEMPLATE_FORMATTERS.date=function(f,g,h){if(!e.Lang.isNumber(g)){return"Invalid date."
}return e.DataType.Date.format(new Date(g),{format:h})
};
for(var b in e.Squarespace.TEMPLATE_FORMATTERS){(function(f){e.Handlebars.registerHelper(f,function(g){return e.Squarespace.TEMPLATE_FORMATTERS[f].apply(this,[this].concat(Array.prototype.slice.call(arguments)))
})
})(b)
}for(var a in e.Squarespace.TEMPLATE_PREDICATES){(function(f){e.Handlebars.registerHelper("if-"+f.replace("?",""),function(g){return e.Handlebars.helpers["if"].call(this,function(){return e.Squarespace.TEMPLATE_PREDICATES[f](this)
},g)
})
})(a)
}for(var c in e.Squarespace.HANDLEBARS_HELPERS){(function(f){e.Handlebars.registerHelper(f,e.Squarespace.HANDLEBARS_HELPERS[f])
})(c)
}},"1.0",{requires:["base-build","handlebars-base","squarespace-template-helpers"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-ss-widget",function(c){c.namespace("Squarespace.Widgets");
var d=c.Squarespace.Widgets.SSWidget=c.Squarespace.SSWidget=c.Base.create("ssWidget",c.Widget,[c.Squarespace.BaseGetProperty],{initializer:function(e){this._anims=new c.Squarespace.Anims();
this.on(this.get("id")+"|classNameChange",function(g){var f=this.get("boundingBox");
if(f){f.removeClass(g.prevVal).addClass(g.newVal)
}},this)
},destructor:function(){this._anims.destroy();
c.detach(this.get("id")+"|*");
this.detach(this.get("id")+"|*")
},renderUI:function(){var e=this.get("className"),f=this.get("boundingBox");
if(e){f.addClass(e)
}this.get("contentBox").prepend(this.renderTemplate())
},bindUI:function(){this.after(this.get("id")+"|stringsChange",function(f){if(!f.noSyncUI){this.syncUI()
}},this)
},syncUI:function(){},_getTemplateInfo:function(){var h=d.TEMPLATE_TYPES;
var e=false;
var g=false;
var f=this.constructor;
var j,l,i;
var m=function(){l=f.HANDLEBARS_TEMPLATE;
if(c.Lang.isUndefined(l)){j=f.PUT_TEMPLATE||f.TEMPLATE
}e=!!f.PUT_TEMPLATE;
g=!!f.HANDLEBARS_TEMPLATE;
if(g){i=h.HANDLEBARS
}else{if(e){i=h.PUT
}else{i=h.HTML
}}};
m();
while(c.Lang.isUndefined(l)&&c.Lang.isUndefined(j)){f=f.superclass.constructor;
if(c.Lang.isUndefined(f)){throw this.name+": Reached topmost class in heirarchy w/o finding a template."
}m()
}var k;
if(g){k=c.Squarespace.UITemplates.getCompiledTemplate(l)
}else{if(e){k=function(){return c.zen(j)
}
}else{k=function(){return c.Node.create(j)
}
}}return{type:i,template:k}
},renderTemplate:function(){var g=d.TEMPLATE_TYPES;
var e=this._getTemplateInfo();
if(e.type===g.HANDLEBARS){var f=this._getHBTemplateContext();
return e.template(f)
}else{return e.template()
}},_getHBTemplateContext:function(){return this.getAttrs()
}},{CSS_PREFIX:"sqs-widget",HANDLEBARS_TEMPLATE:"",PUT_TEMPLATE:"",TEMPLATE:"",TEMPLATE_TYPES:{HANDLEBARS:"handlebars",PUT:"put",HTML:"html"},ATTRS:{className:{value:null}}});
var a="data-state-";
var b=c.Squarespace.Widgets.DataWidget=c.Base.create("dataWidget",c.Squarespace.SSWidget,[],{initializer:function(e){if(!e.dataState){if(this.getProperty("ASYNC_DATA")){this.set("dataState",this.getProperty("DATA_STATES").INITIALIZED)
}else{this.set("dataState",this.getProperty("DATA_STATES").LOADED)
}}},renderUI:function(){b.superclass.renderUI.call(this);
this._updateDataStateClassName()
},bindUI:function(){b.superclass.bindUI.call(this);
var e=this.get("id");
this.after(e+"|dataChange",function(f){if(!f.noSyncUI){this.syncUI()
}},this);
this.after(e+"|dataStateChange",this._updateDataStateClassName,this)
},_updateDataStateClassName:function(){var e=this.get("boundingBox"),f=this.get("dataState");
c.Object.each(this.getProperty("DATA_STATES"),function(g){e.removeClass(a+g)
},this);
e.addClass(a+f)
},setLoadingState:function(){return this.set("dataState",this.getProperty("DATA_STATES").LOADING)
},setLoadedState:function(){return this.set("dataState",this.getProperty("DATA_STATES").LOADED)
},setLoadFailedState:function(){return this.set("dataState",this.getProperty("DATA_STATES").LOAD_FAILED)
},loadedSuccessfully:function(){return this.get("dataState")===this.getProperty("DATA_STATES").LOADED
},isLoading:function(){return this.get("dataState")===this.getProperty("DATA_STATES").LOADING
},loadFailed:function(){return this.get("dataState")===this.getProperty("DATA_STATES").LOAD_FAILED
}},{CSS_PREFIX:"sqs-data-widget",ASYNC_DATA:false,DATA_STATES:{INITIALIZED:"initialized",LOADING:"loading",LOADED:"loaded",LOAD_FAILED:"load-failed"},ATTRS:{data:{value:null,validator:function(e){if(c.Lang.isUndefined(e)){console.warn(this.name+": Will not set data to undefined.");
return false
}else{return true
}}},dataState:{valueFn:function(){return this.getProperty("DATA_STATES").INITIALIZED
}}}})
},"1.0",{requires:["base","base-build","widget","squarespace-base-get-property","squarespace-anims","squarespace-zen","squarespace-ui-templates"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-SearchContainerFullScreen-template",function(c){var b=c.Handlebars;
(function(){var e=b.template,d=b.templates=b.templates||{};
d["SearchContainerFullScreen.html"]=e(function(h,t,r,m,z){r=r||h.helpers;
var s="",j,g="function",f=this.escapeExpression,q=this;
function p(E,D){var B="",C;
B+='\n	<div class="sqs-search-ui-list">\n    <div class="search-results">\n      ';
C=E.items;
C=r.each.call(E,C,{hash:{},inverse:q.noop,fn:q.program(2,o,D)});
if(C||C===0){B+=C
}B+="\n    </div>\n    ";
C=E.facets;
C=r["if"].call(E,C,{hash:{},inverse:q.noop,fn:q.program(14,x,D)});
if(C||C===0){B+=C
}B+="\n  </div>\n  ";
return B
}function o(F,E){var C="",D,B;
C+='\n      <div class="search-result" itemid="';
B=r.id;
if(B){D=B.call(F,{hash:{}})
}else{D=F.id;
D=typeof D===g?D():D
}C+=f(D)+'">\n        <div class="sqs-search-ui-item sqs-post ';
D=F.recordTypeName;
D=r["if"].call(F,D,{hash:{},inverse:q.noop,fn:q.program(3,n,E)});
if(D||D===0){C+=D
}C+=" ";
B=r.documentType;
if(B){D=B.call(F,{hash:{}})
}else{D=F.documentType;
D=typeof D===g?D():D
}C+=f(D)+'">\n          ';
D=F.imageUrl;
D=r["if"].call(F,D,{hash:{},inverse:q.noop,fn:q.program(5,l,E)});
if(D||D===0){C+=D
}C+='\n          <div class="sqs-title">';
B=r.title;
if(B){D=B.call(F,{hash:{}})
}else{D=F.title;
D=typeof D===g?D():D
}if(D||D===0){C+=D
}C+=" \n            ";
D=F.recordTypeName;
D=r["if"].call(F,D,{hash:{},inverse:q.noop,fn:q.program(8,i,E)});
if(D||D===0){C+=D
}C+="\n            ";
D=F.editable;
D=r["if"].call(F,D,{hash:{},inverse:q.noop,fn:q.program(10,A,E)});
if(D||D===0){C+=D
}C+='\n          </div>\n          <div class="sqs-content">\n            ';
D=F.highlight;
D=r.each.call(F,D,{hash:{},inverse:q.noop,fn:q.program(12,y,E)});
if(D||D===0){C+=D
}C+="\n          </div>\n        </div>\n      </div>  \n      ";
return C
}function n(F,E){var C="",D,B;
C+="sqs-post-type-";
B=r.recordTypeName;
if(B){D=B.call(F,{hash:{}})
}else{D=F.recordTypeName;
D=typeof D===g?D():D
}C+=f(D);
return C
}function l(E,D){var B="",C;
B+='\n          <div class="sqs-main-image">\n            ';
C=E.imageUrl;
C=r.each.call(E,C,{hash:{},inverse:q.noop,fn:q.program(6,k,D)});
if(C||C===0){B+=C
}B+="\n          </div>\n          ";
return B
}function k(D,C){var B="";
B+='\n            <img src="';
D=typeof D===g?D():D;
B+=f(D)+'?format=150w"> \n            ';
return B
}function i(F,E){var C="",D,B;
C+='\n            <span class="record-type">';
B=r.recordTypeName;
if(B){D=B.call(F,{hash:{}})
}else{D=F.recordTypeName;
D=typeof D===g?D():D
}C+=f(D)+"</span>\n            ";
return C
}function A(C,B){return'\n            <span class="edit">Edit</span>\n            '
}function y(D,C){var B="";
B+="\n            <span>&hellip;</span>\n            <span>";
D=typeof D===g?D():D;
if(D||D===0){B+=D
}B+="</span>\n            ";
return B
}function x(E,D){var B="",C;
B+='\n    <div class="sqs-search-ui-filters">\n      <ul>\n        ';
C=E.facets;
C=r.each.call(E,C,{hash:{},inverse:q.noop,fn:q.program(15,w,D)});
if(C||C===0){B+=C
}B+="\n      </ul>\n    </div>\n    ";
return B
}function w(F,E){var C="",D,B;
C+='\n        <li class="sqs-search-ui-filters-group" name="';
B=r.name;
if(B){D=B.call(F,{hash:{}})
}else{D=F.name;
D=typeof D===g?D():D
}C+=f(D)+'">\n          <strong>';
B=r.displayName;
if(B){D=B.call(F,{hash:{}})
}else{D=F.displayName;
D=typeof D===g?D():D
}C+=f(D)+"</strong>\n          <ul>\n            ";
D=F.values;
D=r.each.call(F,D,{hash:{},inverse:q.noop,fn:q.program(16,v,E)});
if(D||D===0){C+=D
}C+="\n          </ul>\n        </li>\n        ";
return C
}function v(F,E){var C="",D,B;
C+='\n            <li displayname="';
B=r.displayName;
if(B){D=B.call(F,{hash:{}})
}else{D=F.displayName;
D=typeof D===g?D():D
}C+=f(D)+'" class="';
D=F.active;
D=r["if"].call(F,D,{hash:{},inverse:q.noop,fn:q.program(17,u,E)});
if(D||D===0){C+=D
}C+='" filter="';
B=r.value;
if(B){D=B.call(F,{hash:{}})
}else{D=F.value;
D=typeof D===g?D():D
}C+=f(D)+'">\n              <a>';
B=r.displayName;
if(B){D=B.call(F,{hash:{}})
}else{D=F.displayName;
D=typeof D===g?D():D
}C+=f(D)+' <span class="count">';
B=r.hits;
if(B){D=B.call(F,{hash:{}})
}else{D=F.hits;
D=typeof D===g?D():D
}C+=f(D)+"</span></a>\n            </li>\n            ";
return C
}function u(C,B){return"active"
}s+='<div class="sqs-search-ui-close"></div>\n<div id="searchInputBox"></div>\n<div class="sqs-search-ui-result">\n	';
j=t.items;
j=r["if"].call(t,j,{hash:{},inverse:q.noop,fn:q.program(1,p,z)});
if(j||j===0){s+=j
}s+="\n</div>\n";
return s
})
})();
var a="SearchContainerFullScreen.html";
c.Handlebars.registerPartial(a.replace("/","."),b.templates[a])
},"1.0",{requires:["handlebars-base",]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-search",function(d){d.namespace("Squarespace");
var b=d.Base.create("searchContainer",d.Squarespace.SSWidget,[],{initializer:function(e){},renderUI:function(){b.superclass.renderUI.call(this)
},bindUI:function(){var e=this.get("searchInputBox");
e.after(this.get("id")+"|queryStringChange",this._onSearchInputBoxChange,this);
this.after(this.get("id")+"|searchFilterChange",this._onSearchFilterChange,this);
this.after(this.get("id")+"|searchQueryChange",this._onSearchQueryChange,this);
this.after(this.get("id")+"|searchResultChange",this._onSearchResultChange,this);
this.get("contentBox").on(this.get("id")+"|keyup",this._onKeyup,this);
this.scrollTimer=d.later(250,this,this._infiniteScroll,{},true)
},removeFilter:function(e){var f=this.get("searchFilter");
f=d.Array.filter(f,function(g){if(g.name===e){return false
}return true
});
this.set("searchFilter",f)
},addFilter:function(f){var e=this.get("searchFilter");
e.push(f);
this.set("searchFilter",e)
},destructor:function(){if(this.scrollTimer){this.scrollTimer.cancel()
}},_onSearchQueryChange:function(f){this._clearResult();
this._search()
},_onSearchFilterChange:function(f){this._clearResult();
this._search()
},_onSearchResultChange:function(f){this.syncUI()
},_clearResult:function(){this.set("searchResult",null);
this.set("page",0)
},_onSearchInputBoxChange:function(g){var f=g.newVal;
this.set("searchQuery",g.newVal)
},_onKeyup:function(f){if(f.keyCode===38&&!this.get("searchInputBox").isAutocompleteEnabled()){this._moveSelectedResultItem(-1)
}else{if(f.keyCode===40&&!this.get("searchInputBox").isAutocompleteEnabled()){this._moveSelectedResultItem(1)
}else{if(f.keyCode===13){this._onEnter()
}}}},_moveSelectedResultItem:function(j){var h=this.get("contentBox").one(".active");
if(h){h.removeClass("active");
var f=this.get("contentBox").all(".sqs-search-ui-item");
var g=f.indexOf(h);
var e=f.item(g+j);
if(e){e.addClass("active");
e.scrollIntoView()
}}else{if(j>0){var i=this.get("contentBox").one(".sqs-search-ui-item");
if(i){i.addClass("active");
i.scrollIntoView()
}}}},_onEnter:function(){var e=this.get("contentBox").one(".active");
if(e&&!this.get("searchInputBox").isAutocompleteEnabled()){e.simulate("click")
}},_search:function(){var g=this.get("searchQuery");
var f=this.get("page");
if(g.length===0){return
}var e={q:g,p:f};
d.Array.each(this.get("searchFilter"),function(h){e["f_"+h.name]=h.value
});
d.Data.get({url:"/api/search/GeneralSearch",data:e,success:this._searchResultCallback,error:this._searchResultCallbackError},this)
},_searchResultCallback:function(f){var g=this.get("searchResult"),e=this.get("page");
if(e>0&&g){g.items=g.items.concat(f.items);
this.set("searchResult",g)
}else{this.set("searchResult",f)
}},_searchResultCallbackError:function(){console.log("error data",data)
},_getSearchResultObject:function(f){var e=this.get("searchResult");
return d.Array.find(e.items,function(g){if(g.id===f){return true
}return false
})
},_nextPage:function(){var e=this.get("page")+1;
this.set("page",e);
this._search()
},_infiniteScroll:function(){var g=this.get("contentBox").one(".sqs-search-ui-list");
if(g){var f=g.get("scrollHeight"),j=g.get("scrollTop"),i=g.get("offsetHeight"),h=f-i-j,e=this.get("searchResult");
if(!e||!e.items){return
}if(h<100&&e.totalCount>e.items.length){this._nextPage()
}}}},{ATTRS:{searchInputBox:{value:null},searchFilter:{value:[]},page:{value:0},searchQuery:{value:null},searchResult:{value:null}}});
var c=d.Base.create("searchContainerFullScreen",b,[],{initializer:function(e){},renderUI:function(){c.superclass.renderUI.call(this);
this._open=true;
var e=this.get("contentBox");
e.addClass("sqs-search-ui");
var h=this.get("searchQuery");
e.plug(d.Squarespace.Animations.Fadeable,{duration:0.2,opacity:0.99});
var f=d.Squarespace.UITemplates.render(c.TEMPLATE_NAME,{});
e.prepend(f);
var g=new a({queryString:h,srcNode:this.get("contentBox").one("#searchInputBox"),inputType:"text",withSearchSuggest:true});
this.set("searchInputBox",g);
g.render();
g.focus();
d.one("body").addClass("no-scroll");
d.one("body").addClass("sqs-search-ui-fullscreen");
e.hide(true);
e.show();
d.Squarespace.EscManager.addTarget(this)
},bindUI:function(){var e=this.get("contentBox");
c.superclass.bindUI.call(this);
e.one(".sqs-search-ui-close").on(this.get("id")+"|click",this._closeClick,this);
e.delegate(this.get("id")+"|click",this._toggleFilter,".sqs-search-ui-filters-group li",this);
e.delegate(this.get("id")+"|click",this._clickResult,".sqs-search-ui-list .search-result",this);
this.get("boundingBox").on(this.get("id")+"|click",this._onClick,this)
},syncUI:function(){var e=this.get("searchResult"),f=this.get("contentBox"),j=this.get("page");
if(!e){f.one(".sqs-search-ui-result").setContent(d.DB.DIV("search-result-notice",{html:"Begin typing your search above and press return to search.  Press Esc to cancel."}));
return
}if(e.serviceError){f.one(".sqs-search-ui-result").setContent(d.DB.DIV("search-result-notice error",{html:e.serviceError}));
return
}else{if(e.items.length===0){f.one(".sqs-search-ui-result").setContent(d.DB.DIV("search-result-notice",{html:"Your search did not match any documents."}));
return
}else{var i=f.one(".search-result-notice");
if(i){return
}}}var g=d.Node.create(d.Squarespace.UITemplates.render(c.TEMPLATE_NAME,e));
if(j===0){f.one(".sqs-search-ui-result").prepend(g.one(".sqs-search-ui-result").get("children"))
}else{var h=f.one(".sqs-search-ui-list");
currentListLength=h.get("children").size();
newList=g.one(".sqs-search-ui-list").get("children");
newList=newList.splice(currentListLength);
h.append(newList)
}},_closeClick:function(f){f.stopPropagation();
this._close()
},isOpen:function(){return this._open
},close:function(){this._close()
},_close:function(f){this._open=false;
d.one("body").removeClass("no-scroll");
d.one("body").removeClass("sqs-search-ui-fullscreen");
if(f){this.destroy()
}else{var e=this.get("contentBox");
e.once("hidden",function(){this.destroy()
},this);
e.hide()
}},destructor:function(){this.get("boundingBox").remove();
this.get("searchInputBox").destroy();
d.Squarespace.EscManager.removeTarget(this)
},_clearResult:function(){c.superclass._clearResult.call(this);
this.get("contentBox").one(".sqs-search-ui-result").empty()
},_toggleFilter:function(k){k.preventDefault();
var j=k.target.ancestor("li",true);
if(!j){return
}var h=j.getAttribute("filter");
var f=j.getAttribute("displayname");
var g=j.ancestor(".sqs-search-ui-filters-group").getAttribute("name");
var i=j.hasClass("active");
if(i){this.removeFilter(g)
}else{this.addFilter({displayName:f,value:h,name:g})
}},_onClick:function(f){f.stopPropagation();
this.get("searchInputBox").focus()
},_clickResult:function(h){h.halt();
var g=h.target.ancestor(".search-result",true);
if(!g){return
}var i=g.getAttribute("itemid");
if(!i){return
}var f=this._getSearchResultObject(i);
this._close(true);
if(h.target.ancestor(".edit",true)){if(f.recordType){d.Data.get({url:"/api/commondata/GetItem",data:{itemId:f.id},success:function(e){var j=new d.Squarespace.PostTypes[e.item.recordType](d.Squarespace.Library.getCollection(f.collectionId),e.item);
j.edit()
}})
}else{if(d.Squarespace.ACTIVE_MANAGER){d.Squarespace.ACTIVE_MANAGER.getHistory().replace({module:"content",collectionId:f.collectionId})
}else{if(d.Squarespace.Management){d.Squarespace.Management.manageSite({module:"content",collectionId:f.collectionId})
}}}}else{document.location.href=f.itemUrl
}}},{TEMPLATE_NAME:"SearchContainerFullScreen.html",ATTRS:{}});
var a=d.Base.create("searchInputBox",d.Widget,[],{initializer:function(e){},renderUI:function(){var e=this._createSearchNode();
this.get("contentBox").append(e)
},bindUI:function(){this._enableAutoComplete();
this.get("boundingBox").one("form").on(this.get("id")+"|submit",this._onSubmit,this);
this.get("boundingBox").one("form").on(this.get("id")+"|keydown",this._onKeyDown,this);
this.after(this.get("id")+"|queryStringChange",this._resetAutoComplete,this)
},_onKeyDown:function(f){if(f.keyCode!==27){f.stopPropagation()
}},_autocompleteSelected:function(f){d.later(1,this,function(g){this.set("queryString",g.result.text)
},f)
},_onSubmit:function(g){g.preventDefault();
var f=this.get("contentBox").one("input").get("value");
this.set("queryString",f)
},_enableAutoComplete:function(){var f=this.get("contentBox").one("input");
if(this.get("withSearchSuggest")&&!f.ac){f.plug(d.Plugin.AutoComplete,{source:"/api/search/SearchSuggest?q={query}",resultTextLocator:"suggestion"});
var e=this.get("boundingBox").one("input").ac;
e.on("select",this._autocompleteSelected,this)
}},isAutocompleteEnabled:function(){var e=this.get("contentBox").all(".yui3-aclist-item");
if(e.size()>0){return true
}return false
},_resetAutoComplete:function(){var e=this.get("boundingBox").one("input");
if(e.ac){e.unplug("ac")
}this._enableAutoComplete()
},focus:function(){var e=this.get("contentBox").one("input");
e.focus();
e.set("value",this.get("queryString"));
if(this.get("queryString")!==""){e.select()
}},blur:function(){var e=this.get("contentBox").one("input");
e.blur()
},_createSearchNode:function(){var e=d.Node.create("<form/>");
e.append(d.DB.INPUT("field-input",{placeholder:"Type to search...",type:this.get("inputType"),spellcheck:false,value:this.get("queryString")}));
if(this.get("queryString")){this._lastQuery=this.get("queryString")
}return e
}},{ATTRS:{queryString:{value:""},inputType:{value:"search"},withSearchSuggest:{value:false}}});
d.Squarespace.Search=new (d.Base.create("searchSingleton",d.Base,[],{initializer:function(){this.attached=false
},onButtonClick:function(f){f.halt();
d.use("widget","autocomplete","squarespace-search-ui-css","squarespace-ui-templates","squarespace-animations",d.bind(function(e){this.show()
},this))
},show:function(){if(this.containerWidget&&this.containerWidget.isOpen()){return
}var f=this.get("lastState"),e;
if(f){e=f
}else{e={searchQuery:""}
}this.containerWidget=new c(e);
this.containerWidget.on(this.get("id")+"|destroy",function(g){this.set("lastState",{searchFilter:g.target.get("searchFilter"),searchQuery:g.target.get("searchQuery"),searchResult:g.target.get("searchResult")})
},this);
this.containerWidget.render()
},attach:function(){if(this.attached){return
}d.delegate("click",this.onButtonClick,"body",".sqs-search-ui-button",this);
d.one(document.body).on("keydown",function(f){if(f.ctrlKey&&f.keyCode==83){d.use("widget","autocomplete","squarespace-search-ui-css","squarespace-ui-templates","squarespace-animations",function(e){e.Squarespace.Search.show()
})
}},this);
this.attached=true
}},{ATTRS:{lastState:{value:null}}}))()
},"1.0",{requires:["base","squarespace-ss-widget","squarespace-SearchContainerFullScreen-template"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-image-loader",function(a){if(!window.ImageLoader){console.warn("Image Loader is not available. Automatically including ImageLoader.js.");
a.use("get",function(){a.Get.js("/universal/scripts-v6/ImageLoader.js")
})
}a.namespace("Squarespace").Loader=a.Base.create("Loader",a.Base,[],{initializer:function(){if(this.get("frames")){this._processFrames()
}if(this.get("img")){this._processImages()
}},_processFrames:function(){this._getNodeList("frames").each(function(b){if(b.getAttribute("data-embed")){b.resizeToParent({scale:"contain",sizeOnly:true})
}})
},_processImages:function(){this._getNodeList("img").each(function(b){var c=false;
if(b.loader){c=true
}b.plug(a.Squarespace.Loader2,this.get("loaderOptions")||{});
if(c){b.fire("refresh")
}},this)
},_getNodeList:function(b){var c=this.get(b);
if(a.Lang.isString(c)){return a.all(c)
}else{if(!c.size){return new a.NodeList(c)
}else{return c
}}}},{ATTRS:{frames:{},img:{},loaderOptions:{}}});
a.namespace("Squarespace").Loader2=a.Base.create("Loader2",a.Plugin.Base,[],{initializer:function(){var d=this.get("host");
var b=100;
var c=0;
function e(){if(!d.inDoc()&&(++c<b)){a.later(10,this,e)
}else{this.load()
}}e.call(this);
this.on("refresh",this.load,this);
d.on("refresh",this.load,this)
},load:function(){var b=this.get("host");
if(!!b.getAttribute("src")&&b.get("complete")){b.fire("loaded")
}b.on("load",function(){if(b.getDOMNode()===null||!b.inDoc()){console.warn("Invalid host. Bailing.");
return
}b.removeClass("loading").addClass("loaded");
b.fire("loaded")
},this);
if(b.getDOMNode()===null||!b.inDoc()){console.warn("Invalid host. Bailing.");
return
}ImageLoader.load(b.getDOMNode(),a.merge(this.getAttrs(),{load:this.get("load")}))
},getDimensionForValue:function(c,b){return ImageLoader.getDimensionForValue(c,b,ImageLoader._getDataFromNode(this.get("host").getDOMNode()))
},getBareElement:function(){var b=this.get("host");
var c=a.Node.create("<img />");
c.setAttribute("data-src",b.getAttribute("data-src"));
c.setAttribute("data-image-dimensions",b.getAttribute("data-image-dimensions"));
c.setAttribute("data-image-focal-point",b.getAttribute("data-image-focal-point"));
return c
},destructor:function(){}},{NS:"loader",ATTRS:{stretch:{value:true},load:{value:true},source:{},fitAlignment:{},fit:{value:false,setter:function(b){if(b){this.set("mode","fit")
}}},fill:{value:false,setter:function(b){if(b){this.set("mode","fill")
}}},focalPoint:{setter:function(b){ImageLoader.load(this.get("host").getDOMNode(),{focalPoint:b.x+","+b.y});
return b
}},mode:{validator:function(b){return["fit","fill","none",null].indexOf(b)!==-1
}},refreshOnResize:{value:false}}});
a.namespace("Squarespace").ImageLoadManager=new (a.Base.create("ImageLoadManager",a.Base,[],{refreshAll:function(){a.all("img[data-src]").each(function(b){b.fire("refresh")
})
}}))();
a.augment(a.Node,Class.create({refresh:function(){this.fire("refresh")
}}))
},"1.0",{requires:["base","plugin","node"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-video-loader",function(a){a.namespace("Squarespace");
a.Squarespace.VideoLoader=a.Base.create("VideoLoader",a.Plugin.Base,[],{initializer:function(){var b=this.get("host");
b.plug(a.Squarespace.NodeDestroyNotifier,{onDestroy:function(){this.destroy()
},context:this});
this._setVariables();
this._resizeEmitter=new a.Squarespace.ResizeEmitter({timeout:100});
this._modeClass="video-"+this.get("mode");
b.addClass(this._modeClass);
if(this.get("load")){this.load()
}},load:function(){if(this._loaded){return
}if(this.get("type")=="invalid"&&this.get("overlay")){this.get("overlay").remove();
this._set("overlay",null)
}var n=this.get("host");
var e=this.get("mode");
n.removeClass(this._modeClass);
this._modeClass="video-"+e;
n.addClass(this._modeClass);
var m;
var c;
if(this._intrinsic){var j=this.getWidth();
var g=this.getHeight();
var b;
if(j&&g){b=(g/j)*100
}else{b=56.3
}m=a.Node.create('<div class="intrinsic"></div>');
c=a.Node.create('<div class="intrinsic-inner" style="padding-bottom: '+b+'%;"></div>');
var k=n.get("parentNode");
var i=k.getComputedStyle("position");
if(e=="fit"){var l=k.get("offsetWidth");
var f=k.get("offsetHeight");
var d=Math.round((l*b)/100);
n.setStyle("top",(f-d)/2+"px");
if(i=="static"){k.setStyle("position","relative")
}}else{if(e=="fill"){if(i=="static"){k.setStyle("position","relative")
}}}if(this.get("overlay")){this.get("overlay").wrap(c);
c.wrap(m)
}else{m.appendChild(c);
n.appendChild(m)
}}if(this.get("overlay")){this.get("overlay").setStyle("opacity",1);
var h=this.get("overlay").one("img");
if(h){h.fire("refresh");
this.get("overlay").one("img").plug(a.Squarespace.Loader2,{load:true,mode:"fill"});
this.get("overlay").one("img").fire("refresh")
}}else{if(m){c.appendChild(this.get("video"))
}else{n.appendChild(this.get("video"))
}this._set("showingVideo",true)
}this._loaded=true;
this.bindUI()
},unload:function(){var b=this.get("host");
b.setStyles({top:null});
this.showOverlay();
if(this.get("overlay")){this.get("overlay").remove()
}this.get("video").remove();
if(this._intrinsic){b.one(".intrinsic").remove(true)
}if(this.get("overlay")){this.get("overlay").setStyle("opacity",0);
b.appendChild(this.get("overlay"))
}this._setIntrinsic();
this._loaded=false
},reload:function(){this.unload();
this.load()
},bindUI:function(){if(!Static.IN_BACKEND){if(this.get("overlay")){this.get("overlay").on("click",function(b){if(!this.get("inactive")){this.showVideo()
}},this)
}}this.after("modeChange",this.reload,this);
this._resizeEmitter.on("resize",function(){if(this.get("mode")=="fit"){this._resetFitTop()
}if(this.get("overlay")){this.get("overlay").one("img").fire("refresh")
}},this);
a.Global.on("tweak:aftershow",function(){if(this.get("mode")=="fit"){this._resetFitTop()
}},this);
a.Global.after("tweak:afterclose",function(){if(this.get("mode")=="fit"){setTimeout(a.bind(function(){this._resetFitTop()
},this),1000)
}},this)
},showVideo:function(){if(this.get("showingVideo")||!this.get("overlay")){return
}this._set("showingVideo",true);
this._showOverlayOnOthers();
var c=this.get("video");
c.setStyle("opacity",0);
if(this._intrinsic){this.get("host").one(".intrinsic-inner").appendChild(c)
}else{this.get("host").appendChild(c)
}var b=this.get("overlay");
b.one(".sqs-video-opaque").anim({opacity:1},{duration:1,start:function(){b.one(".sqs-video-icon").setStyle("visibility","hidden")
},end:function(){this.get("video").setStyle("opacity",1);
if(this.get("showingVideo")){b.setStyle("visibility","hidden")
}if(b.hasClass("no-thumb")){b.one(".sqs-video-opaque").setStyle("opacity",1)
}else{b.one(".sqs-video-opaque").setStyle("opacity",0)
}b.one(".sqs-video-icon").setStyle("visibility",null)
},context:this}).run()
},showOverlay:function(){if(!this.get("showingVideo")||!this.get("overlay")){return
}this._set("showingVideo",false);
this.get("overlay").setStyle("opacity",0);
this.get("overlay").setStyle("visibility",null);
var b=this.get("video");
b.anim({opacity:0},{duration:0.3,start:function(){this.get("overlay").anim({opacity:1},{duration:0.3}).run()
},end:function(){b.remove()
},context:this}).run()
},refreshVideo:function(){if(!this.get("showingVideo")){return
}var c=this.get("video");
if(this.get("type")=="object"){c.remove();
var b=this.get("host");
if(this._intrinsic){b.one(".intrinsic-inner").appendChild(c)
}else{b.appendChild(c)
}}else{if(this.get("type")=="iframe"){c.setAttribute("src",c.getAttribute("src"))
}}},play:function(){if(!this.get("apiFriendly")){return
}var b=this.get("video").getDOMNode().contentWindow;
switch(this._providerName){case"Vimeo":b.postMessage('{"method": "play", "value": "true"}',"*");
break;
case"YouTube":b.postMessage('{"event":"command","func":"playVideo","args":""}',"*");
break
}},pause:function(){if(!this.get("apiFriendly")){return
}var b=this.get("video").getDOMNode().contentWindow;
switch(this._providerName){case"Vimeo":b.postMessage('{"method": "pause", "value": "true"}',"*");
break;
case"YouTube":b.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");
break
}},getWidth:function(){return this.get("video").getAttribute("width")
},getHeight:function(){return this.get("video").getAttribute("height")
},_setVariables:function(){var f=this.get("host");
this._setIntrinsic();
this._set("overlay",f.one(".sqs-video-overlay"));
var e=a.Node.create(f.getAttribute("data-html"));
var b=a.Node.create('<div class="sqs-video-invalid-wrapper"><div class="state-message">Invalid video embed.</div></div>');
var d;
if(!e){d=b;
this._set("type","invalid")
}else{if(e.test("iframe")){d=e;
this._set("type","iframe")
}else{if(e.test("object")){d=e;
this._set("type","object")
}else{if(e.one("iframe")){d=e.one("iframe");
this._set("type","iframe")
}else{if(e.one("object")){d=e.one("object");
this._set("type","object")
}else{d=b;
this._set("type","invalid")
}}}}}this._set("video",d);
var c=f.getAttribute("data-provider-name");
if((!c||c==="")&&this.get("type")!="invalid"){var g=this.get("video").getAttribute("src");
if(g.match("player.vimeo.com")){c="Vimeo"
}else{if(g.match("www.youtube.com")){c="YouTube"
}}}this._providerName=c;
if(this.get("type")!="invalid"){this._augmentVideoSrc()
}},_setIntrinsic:function(){this._intrinsic=(this.get("mode")=="none"||this.get("mode")=="fit")
},_resetFitTop:function(){var d=this.get("host");
var c=d.get("parentNode").get("offsetHeight");
var e=d.one(".intrinsic");
e.setStyle("top",null);
var b=e.get("offsetHeight");
d.setStyle("top",(c-b)/2+"px")
},_augmentVideoSrc:function(){var b=(this.get("type")=="iframe")?this.get("video"):this.get("video").one("embed");
var f=b.getAttribute("src");
var c=f.split("?");
var e=c[0];
var g=c[1]||"";
var d=a.QueryString.parse(g);
if(this.get("overlay")){if(this._providerName=="Wistia, Inc."){d.autoPlay="true"
}else{d.autoplay=1
}}if(this.get("type")=="object"||this._providerName=="Vimeo"){if(window.location.protocol.startsWith("https")){e=e.replace("http://","https://")
}}if(this.get("type")=="iframe"){switch(this._providerName){case"Vimeo":d.api=1;
this._set("apiFriendly",true);
break;
case"YouTube":d.enablejsapi=1;
this._set("apiFriendly",true);
break
}}f=e+"?"+a.QueryString.stringify(d);
b.setAttribute("src",f)
},_showOverlayOnOthers:function(){a.all(".sqs-video-wrapper").each(function(b){if(b==this.get("host")){return
}b.videoloader.showOverlay()
},this)
}},{NS:"videoloader",ATTRS:{apiFriendly:{value:false,readOnly:true},inactive:{value:false},load:{value:true},mode:{value:"none",validator:function(b){return["none","fit","fill",null].indexOf(b)!=-1
}},overlay:{value:null,readOnly:true},showingVideo:{value:false,readOnly:true},type:{value:null,readOnly:true},video:{value:null,readOnly:true}}})
},"1.0",{requires:["base","plugin","node","querystring","squarespace-image-loader","squarespace-video-css"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-dombuilder",function(a){a.DB={unpackData:function(c,b){if(c._node){c=c._node
}if(b){while(c){if(c.data&&c.className.indexOf(b)!=-1){return c.data
}c=c.parentNode
}}else{while(c){if(c.data){return c.data
}c=c.parentNode
}}return(null)
},DIV:function(){return(a.DB._gen("DIV",Array.prototype.slice.call(arguments)))
},PARAGRAPH:function(){return(a.DB._gen("P",Array.prototype.slice.call(arguments)))
},LI:function(){return(a.DB._gen("LI",Array.prototype.slice.call(arguments)))
},SPAN:function(){return(a.DB._gen("SPAN",Array.prototype.slice.call(arguments)))
},A:function(){return(a.DB._gen("A",Array.prototype.slice.call(arguments)))
},UL:function(){return(a.DB._gen("UL",Array.prototype.slice.call(arguments)))
},LABEL:function(){return(a.DB._gen("LABEL",Array.prototype.slice.call(arguments)))
},INPUT:function(){return(a.DB._gen("INPUT",Array.prototype.slice.call(arguments)))
},TEXTAREA:function(){return(a.DB._gen("TEXTAREA",Array.prototype.slice.call(arguments)))
},SELECT:function(){return(a.DB._gen("SELECT",Array.prototype.slice.call(arguments)))
},OPTION:function(){return(a.DB._gen("OPTION",Array.prototype.slice.call(arguments)))
},IMG:function(){return(a.DB._gen("IMG",Array.prototype.slice.call(arguments)))
},TABLE:function(){return(a.DB._gen("TABLE",Array.prototype.slice.call(arguments)))
},TBODY:function(){return(a.DB._gen("TBODY",Array.prototype.slice.call(arguments)))
},THEAD:function(){return(a.DB._gen("THEAD",Array.prototype.slice.call(arguments)))
},TH:function(){return(a.DB._gen("TH",Array.prototype.slice.call(arguments)))
},TR:function(){return(a.DB._gen("TR",Array.prototype.slice.call(arguments)))
},TD:function(){return(a.DB._gen("TD",Array.prototype.slice.call(arguments)))
},VIDEO:function(){return(a.DB._gen("VIDEO",Array.prototype.slice.call(arguments)))
},PARAM:function(){return(a.DB._gen("PARAM",Array.prototype.slice.call(arguments)))
},OBJECT:function(){return(a.DB._gen("OBJECT",Array.prototype.slice.call(arguments)))
},SOURCE:function(){return(a.DB._gen("SOURCE",Array.prototype.slice.call(arguments)))
},SUP:function(){return(a.DB._gen("SUP",Array.prototype.slice.call(arguments)))
},BUTTON:function(){return(a.DB._gen("BUTTON",Array.prototype.slice.call(arguments)))
},_gen:function(o,l){var d=document.createElement(o);
var c=0;
if(l.length>c&&typeof(l[c])=="string"){d.className=l[c];
++c
}if(l.length>c&&l[c]!=null&&typeof(l[c])=="object"&&!(l[c] instanceof Array)&&(l[c].getAttribute==null)&&(l[c]._node==null)){var m=l[c];
++c;
for(var e in m){if(e=="html"){d.innerHTML=m[e]
}else{if(e=="data"){d.data=m[e]
}else{if(e=="style"&&typeof(m[e])=="object"){for(var g in m[e]){d.style[g]=m[e][g]
}}else{d.setAttribute(e,m[e])
}}}}if(o=="A"){if(!m.href){d.href="javascript:noop();"
}}}d=a.one(d);
if(d.data&&d.data()){d._data=d.data()
}for(var h=c;
h<l.length;
++h){if(l[h] instanceof Array){for(var f=0;
f<l[h].length;
++f){var b=l[h][f];
d.append(b)
}}else{var b=l[h];
d.append(b)
}}return d
}}
},"1.0",{requires:["node"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-audio-player",function(c){var b=function(){};
var a=c.namespace("Squarespace.Widgets").AudioPlayer=c.Base.create("audioPlayer",c.Squarespace.Widgets.SSWidget,[],{initializer:function(d){var e=this.get("render");
if(c.Lang.isBoolean(e)){e=null
}else{if(c.Lang.isString(e)){e=c.one(e)
}}if(e){if(e._audioPlayer){e._audioPlayer.destroy()
}e._audioPlayer=this;
c.Object.each(e.getData(),function(g,f){if(g){this.set(f,g)
}},this)
}c.use("thirdparty-sound-manager-2",b)
},destructor:function(){if(this._sound){this.stop();
this._sound.destruct()
}},render:function(){var d=arguments;
c.use("thirdparty-sound-manager-2",c.bind(function(e){this._soundManager=soundManager;
a.superclass.render.apply(this,d)
},this))
},renderUI:function(){a.superclass.renderUI.apply(this,arguments);
var f=this.get("boundingBox");
var l=f.one(".placeholder");
var k=this.get("title"),h=this.get("author");
if(k&&h){l.setContent(c.Node.create('<div class="audio-author">'+h+'</div><div class="audio-title">'+k+"</div>"))
}else{if(k){l.setContent(c.Node.create('<div class="audio-title">'+k+"</div>"))
}else{l.setContent(this.get("strings.placeholder"))
}}f.one(".progress-inner").setStyle("width","0px");
this._volumeNode=f.one(".volume");
if(!this._volumeNode){throw this.name+": No div.volume in template."
}var e=this.get("volumeLevels"),j=this.get("volume"),d=Math.round(j/100*e);
for(var g=e;
g>0;
g--){this._volumeNode.prepend(c.zen("div.bar.level-"+g+'[data-volume-level="'+g+'"]'))
}f.one(".duration").setContent(this.get("strings.durationPlaceHolder"))
},bindUI:function(){var d=this.get("id");
this.get("boundingBox").on(d+"|click",this._onClick,this);
this.after(d+"|volumeChange",function(f){this._setVolume(f.newVal)
},this);
this.after(d+"|playStateChange",this._uiUpdateWrapperClass,this);
this.after(d+"|readyStateChange",this._afterReadyStateChange,this);
this.after(d+"|disabledChange",function(g){var f=g.newVal;
if(f){this.stop()
}},this);
c.on(d+"|audioPlayer:stopAll",function(g){var f=g?g.container:null;
if(f&&c.Lang.isString(f)){f=c.one(f)
}if(!g||!g.hasOwnProperty("container")||((f instanceof c.Node)&&f.contains(this.get("boundingBox")))){this.stop()
}},this)
},syncUI:function(){this._uiUpdateWrapperClass();
this._uiUpdateVolumeLevel()
},play:function(){if(!this._sound){this._initSoundManagerSound()
}if(this._sound){if(this._sound.paused){this._sound.resume()
}else{this._sound.play()
}}},pause:function(){if(this._sound){this._sound.pause()
}},stop:function(){var e=this.get("playState"),d=this.getProperty("PLAY_STATES");
if(e===d.PLAYING&&this._sound){this._sound.stop()
}},seek:function(d){if(d>100||d<0){console.warn(this.name+": seek() - Percentage between 0-100 required.");
return
}if(!this._sound){this._initSoundManagerSound()
}this.pause();
this._sound.setPosition(this._sound.duration*(d/100));
this.play()
},setVolume:function(d){this.set("volume",d)
},_checkSoundManagerStatus:function(){var d=this._soundManager,e=this.getProperty("READY_STATES");
if(d.enabled){this._set("readyState",e.INITIALIZED);
return true
}else{if(d.didFlashBlock){this._set("readyState",e.FLASH_BLOCKED)
}else{this._set("readyState",e.SECURITY_ERROR)
}return false
}},_setVolume:function(d){if(this._sound){this._sound.setVolume(d)
}this._set("volume",d);
this._uiUpdateVolumeLevel()
},_setVolumeLevel:function(d){this._setVolume(Math.round(d/this.get("volumeLevels")*100))
},_initSoundManagerSound:function(){if(this._checkSoundManagerStatus()===false){return false
}if(!this._sound){var e=this.get("boundingBox"),d=this.get("url");
e.addClass("loading");
if(!d){this._showError("No URL provided.");
return
}if(d.indexOf("//")===0){d=window.location.protocol+d
}this._sound=this._soundManager.createSound({id:"squarespaceTrack-"+this.get("id"),url:d,volume:this.get("volume"),autoPlay:false,onplay:c.bind(this._onPlay,this),onpause:c.bind(this._onPause,this),onresume:c.bind(this._onPlay,this),onstop:c.bind(this._onStop,this),onfinish:c.bind(this._onStop,this),whileplaying:c.bind(this._onWhilePlaying,this),onload:c.bind(this._onLoad,this),ondataerror:c.bind(this._onDataError,this)});
return !!this._sound
}return false
},_uiUpdateVolumeLevel:function(){var f=this._volumeNode.get("children"),d=this.get("volumeLevels"),e=this.get("volume"),g=Math.round(e/100*d);
f.each(function(h){var i=parseInt(h.getAttribute("data-volume-level"),10);
if(i<=g){h.addClass("active")
}else{h.removeClass("active")
}},this)
},_uiUpdateWrapperClass:function(){var i=this.getProperty("READY_STATES"),g=this.getProperty("PLAY_STATES"),f=this.get("boundingBox"),e=f.getAttribute("class").split(" ");
var d=function(k){var j=c.Array.indexOf(e,k);
if(j!==-1){e.splice(j)
}};
var h;
for(h in g){e.remove("play-state-"+g[h])
}for(h in i){e.remove("ready-state-"+i[h])
}f.addClass("ready-state-"+this.get("readyState"));
f.setAttribute("class",e.join(" ")).addClass("play-state-"+this.get("playState")).addClass("ready-state-"+this.get("readyState"))
},_onClick:function(h){h.halt();
h.stopImmediatePropagation();
if(this.get("disabled")){return
}if(h.target.hasClass("duration")){return
}if(h.target.ancestor(".volume")){this._setVolumeLevel(parseInt(h.target.getAttribute("data-volume-level"),10));
return
}if(h.target.ancestor(".placeholder",true)){this.play();
return
}if(h.target.ancestor(".controls",true)){var g=this.get("playState"),f=this.getProperty("PLAY_STATES");
switch(g){case f.PLAYING:this.pause();
return;
case f.PAUSED:case f.STOPPED:this.play();
return;
default:console.warn(this.name+": Wait, what? How did you get here? Case was ",g);
return
}}var d=this.get("boundingBox").one(".progress").get("region");
if(h.pageX>=d.left&&h.pageX<=d.right){this.seek((h.pageX-d.left)/d.width*100)
}},_afterReadyStateChange:function(i){var h=this.getProperty("READY_STATES"),g=this.get("readyState"),d=this.get("strings"),f=false;
switch(g){case h.INITIALIZED:this.enable();
break;
case h.FLASH_BLOCKED:f=d.soundManagerFlashFail;
break;
case h.SECURITY_ERROR:f=d.soundManagerSecurityFail;
break;
case h.SOUND_LOAD_FAILED:f=d.soundManagerURLFail;
break;
case h.SOUND_LOADED:break;
default:console.warn(this.name+": Invalid ready state ("+g+").");
break
}if(f){console.warn("AUDIO ERROR: "+f);
this._showError(f);
this.disable()
}this._uiUpdateWrapperClass()
},_getPlaytimeString:function(){if(!this._sound){return this.get("strings.durationPlaceHolder")
}var e="0:00";
var d="0:00";
if(this._sound.duration&&this._sound.loaded){e=this._getMinSecString(this._sound.duration)
}if(this._sound.position){d=this._getMinSecString(this._sound.position)
}return d+" / "+e
},_getMinSecString:function(h){var d=Math.round(h/1000);
var e=Math.floor(d/60);
var f=d-e*60;
var g=(f<10?"0":"")+f;
return e+":"+g
},_showError:function(d){this.get("boundingBox").addClass("error");
this.get("boundingBox").one(".placeholder").setContent("Error: "+d)
},_onWhilePlaying:function(){if(this.get("destroyed")){return
}var d=this.get("boundingBox");
d.one(".duration").setContent(this._getPlaytimeString());
if(!(this._sound.loaded&&this._sound.duration)){return
}var f=this.getProperty("READY_STATES");
if(this.get("readyState")!==f.SOUND_LOADED){this._set("readyState",f.SOUND_LOADED)
}var e=d.one(".progress-inner");
var g=this._sound.position/this._sound.duration*100;
d.removeClass("loading");
if(e){e.setStyle("width",g+"%")
}},_onPlay:function(){if(this._loadFailTimer){this._loadFailTimer.cancel()
}var d=c.Squarespace.Widgets.AudioPlayer.PLAY_STATES;
this._set("playState",d.PLAYING)
},_onStop:function(){this._set("playState",this.getProperty("PLAY_STATES").STOPPED)
},_onPause:function(){this._set("playState",this.getProperty("PLAY_STATES").PAUSED)
},_onDataError:function(){this.stop();
this._set("playState",this.getProperty("PLAY_STATES").STOPPED)
},_onLoad:function(d){if(!d){this._loadFailTimer=c.later(1000,this,function(){this.stop();
this._set("readyState",this.getProperty("READY_STATES").SOUND_LOAD_FAILED)
})
}}},{CSS_PREFIX:"sqs-audio-player",PLAY_STATES:{PLAYING:"playing",PAUSED:"paused",STOPPED:"stopped"},READY_STATES:{INITIALIZED:"initialized",FLASH_BLOCKED:"flash-blocked",SECURITY_ERROR:"security-error",SOUND_LOAD_FAILED:"sound-load-failed",SOUND_LOADED:"sound-loaded"},PUT_TEMPLATE:"div.controls+div.placeholder+div.progress>div.progress-inner>div.scrubber<<<div.duration+div.volume<",ATTRS:{strings:{value:{placeholder:"Click to play...",durationPlaceHolder:"0:00 / 0:00",loadFail:"Unable to load sound at the URL",soundManagerFlashFail:"Sorry, could not load because flash is blocked.",soundManagerSecurityFail:"Sorry, there was a JavaScript security error.",soundManagerURLFail:"Unable to access audio stream."}},playState:{lazyAdd:false,valueFn:function(){return this.getProperty("PLAY_STATES").STOPPED
},readOnly:true},readyState:{lazyAdd:false,valueFn:function(){return this.getProperty("READY_STATES").INITIALIZED
},readOnly:true},url:{value:null},volume:{validator:function(d){if(d<0||d>100){console.warn(this.name+": Volume must be between 0 and 100, volume remains unchanged.")
}return true
},value:66},volumeLevels:{value:6,writeOnce:"initOnly"},stopOthersOnPlay:{value:true},render:{value:true}}})
},"1.0",{requires:["node","event","squarespace-dombuilder","squarespace-ss-widget","squarespace-audio-player-css"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-gismo",function(a){a.Squarespace.GismoBase=function(){this._events={};
this._timers={};
this._anims=this._anims||new a.Squarespace.Anims()
};
a.Squarespace.GismoBase.prototype={destructor:function(){for(var b in this._events){while(this._events[b].length!==0){this._events[b].shift().detach()
}}for(var c in this.timers){while(this._timer[c].length!==0){this._timer[c].shift().cancel()
}}this._anims.destroy()
},_anim:function(b,e,c){var d=b.anim(e,c||{});
d.on("end",function(){this._anims.remove(d)
},this);
this._anims.add(d);
return d
},_event:function(c,b){b=b||"generic";
this._events[b]=this._events[b]||[];
this._events[b].push(c)
},_getEvents:function(b){return this._events[b||"generic"]
},_flushEvents:function(b){b=b||"generic";
if(!!this._events[b]){while(this._events[b].length!==0){this._events[b].shift().detach()
}}},_timer:function(c,b){b=b||"generic";
this._timers[b]=this._timers[b]||[];
this._timers[b].push(c)
}}
},"1.0",{requires:["squarespace-anims","squarespace-util"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-animations",function(e){e.namespace("Squarespace.Animations");
var d="display-status-",c="-plugged",b="shown",a="hidden";
e.Squarespace.Animations.Expandable=e.Base.create("expandable",e.Plugin.Base,[],{initializer:function(f){this.doBefore("show",this.open);
this.doBefore("hide",this.close);
this._running=false
},close:function(k){var f=this.get("host"),j=this.get("easing"),h=this.get("duration"),g,i;
k=(f.inDoc()?k:true);
f.fire("close");
if(k){this._hardClose()
}else{if(!this._running){this._running=true;
f.wrap('<div class="expandable-plugin-wrapper"></div>');
i=f.ancestor(".expandable-plugin-wrapper");
i.setStyles({overflow:"hidden",height:f.get("offsetHeight")});
this._closeWrapper=i;
g=new e.Anim({node:i,to:{height:0},easing:j,duration:h});
g.on("end",function(){if(f.inDoc()){f.setStyles({height:0,overflow:"hidden",display:"none"});
f.unwrap();
f.addClass("expandable-hidden")
}this._running=false;
f.fire("closed")
},this);
this._closeAnim=g;
g.run()
}}return new e.Do.Prevent("Expandable prevented default hide.")
},_hardClose:function(){var f=this.get("host");
f.setStyles({height:0,overflow:"hidden",display:"none"});
f.addClass("expandable-hidden");
f.fire("closed")
},_hardOpen:function(){var f=this.get("host");
f.setStyles({height:null,display:null});
f.removeClass("expandable-hidden");
f.fire("opened")
},open:function(m){var h=this.get("host"),l=this.get("easing"),j=this.get("duration"),i,g,f,k;
m=(h.inDoc()?m:true);
h.fire("open");
if(m){this._hardOpen()
}else{if(!this._running){this._running=true;
if(h.getComputedStyle("display")==="none"){h.setStyle("display",null)
}f=h.cloneNode(true);
f.setStyles({height:"auto",visibility:"hidden",display:null,position:"absolute",width:h.get("offsetWidth")});
h.insert(f,"before");
g=f.get("offsetHeight")+parseInt(f.getComputedStyle("marginTop"),10)+parseInt(f.getComputedStyle("marginBottom"),10);
f.remove(true);
h.wrap('<div class="expandable-plugin-wrapper"></div>');
k=h.ancestor(".expandable-plugin-wrapper");
k.setStyles({overflow:"hidden",height:0});
h.setStyles({height:null,overflow:null});
this._openWrapper=k;
i=new e.Anim({node:k,to:{height:g},easing:l,duration:j});
i.on("end",function(){var n=this.get("host");
if(n){this._running=false;
n.unwrap();
n.removeClass("expandable-hidden");
n.fire("opened")
}},this);
this._openAnim=i;
i.run()
}}return new e.Do.Prevent("Expandable prevented default show.")
},destructor:function(){if(this._closeWrapper){this._closeWrapper.remove(true)
}if(this._openWrapper){this._openWrapper.remove(true)
}if(this._openAnim){this._openAnim.stop().destroy()
}if(this._closeAnim){this._closeAnim.stop().destroy()
}}},{NS:"expandablePlugin",ATTRS:{duration:{value:0.3,validator:e.Lang.isNumber},easing:{value:e.Easing.easeOutStrong}}});
e.Squarespace.Animations.Fadeable=e.Base.create("fadeable",e.Plugin.Base,[],{initializer:function(f){this.beforeHostMethod("show",this.show);
this.beforeHostMethod("hide",this.hide);
this.get("host").addClass(this.name+c);
this._onlyUseOpacity=(f.onlyUseOpacity===undefined)?false:f.onlyUseOpacity;
this._running=false
},destructor:function(){if(this._anim){this._anim.stop().destroy()
}this.get("host").removeClass(this.name+c)
},show:function(f){return this._changeVisibility(true,f)
},hide:function(f){return this._changeVisibility(false,f)
},_changeVisibility:function(g,h){var f=this.get("host");
h=(f.inDoc()?h:true);
if(g){f.removeClass(d+"hidden")
}if(h){this._hardChangeVisibility(g)
}else{if(this._anim){this._anim.stop().destroy();
this._anim=null
}if(g&&f.getComputedStyle("display")==="none"){f.setStyle("display",null)
}this._anim=new e.Anim({node:f,to:{opacity:(g?this.get("opacity"):0)},easing:this.get("easing"),duration:this.get("duration")});
this._anim.onceAfter("end",function(){this._hardChangeVisibility(g);
this._running=false;
if(!g&&!this._onlyUseOpacity&&f.getDOMNode()){f.setStyle("display","none")
}f.fire(g?"shown":"hidden");
delete this._anim
},this);
this._anim.run()
}return new e.Do.Prevent("Fadeable prevented default "+(g?"show":"hide")+" and used its own.")
},_hardChangeVisibility:function(g){var f=this.get("host");
if(!g){f.addClass(d+"hidden")
}f.setStyles({opacity:(g?1:0)});
this._anim=null;
f.fire(g?b:a)
}},{NS:"fadeablePlugin",ATTRS:{duration:{value:0.3,validator:e.Lang.isNumber},easing:{value:e.Easing.easeOutStrong},opacity:{value:1}}});
e.Squarespace.Animations.Scalable=e.Base.create("scalable",e.Plugin.Base,[],{initializer:function(f){this.doBefore("show",this.show);
this.doBefore("hide",this.hide);
this._running=false
},destructor:function(){},show:function(f){return this._changeVisibility(true,f)
},hide:function(f){return this._changeVisibility(false,f)
},_changeVisibility:function(h,k){var l=this.get("host"),j=this.get("easing"),f=this.get("duration"),m=!!(this.get("host").getDOMNode().style.transitionDuration||e.DOM.CUSTOM_STYLES.transitionDuration);
l.fire(h?"show":"hide");
k=(l.inDoc()?k:true);
if(k){this._hardChangeVisibility(h)
}else{if(!this._running){this._running=true;
if(h){l.setStyles({visibility:"visible"})
}var n=this;
var g=false;
var i=function(){if(g){return
}g=true;
if(!l.getDOMNode()){return
}if(!h){l.setStyles({visibility:"hidden"})
}n._running=false;
n.fire(h?b:a);
l.fire(h?b:a)
};
if(m){l.transition({opacity:(h?1:0),transform:"scale("+(h?"1":"0.94")+")"},i)
}else{l.transition({opacity:(h?1:0)},i)
}if(e.UA.webkit||e.UA.gecko){setTimeout(i,300)
}}}return new e.Do.Prevent("Scalable prevented default "+(h?"show":"hide")+" and used its own.")
},_hardChangeVisibility:function(h){var g=this.get("host");
var f=!!(this.get("host").getDOMNode().style.transitionDuration||e.DOM.CUSTOM_STYLES.transitionDuration);
if(f){g.setStyles({visibility:(h?"visible":"hidden"),opacity:(h?1:0),transform:"scale("+(h?"1":"0.94")+")"})
}else{g.setStyles({visibility:(h?"visible":"hidden"),opacity:(h?1:0)})
}g.fire(h?b:a)
}},{NS:"scalablePlugin",ATTRS:{duration:{value:0.3,validator:e.Lang.isNumber},easing:{value:e.Easing.easeOutStrong},opacity:{value:1}}});
e.Squarespace.Animations.Slideable=e.Base.create("slideable",e.Plugin.Base,[],{initializer:function(f){this.doBefore("show",this.show);
this.doBefore("hide",this.hide);
this._running=false
},show:function(f){return this._changeVisibility(true,f)
},hide:function(f){return this._changeVisibility(false,f)
},_changeVisibility:function(i,m){var n=this.get("host"),j=this.get("easing"),f=this.get("duration"),l=this.get("direction");
n.fire(i?"show":"hide");
m=(n.inDoc()?m:true);
if(m){this._hardChangeVisibility(i)
}else{var g;
if(i){n.setStyles({display:"block",visibility:"hidden"});
var k=(l=="left"?1:-1)*n.get("offsetWidth");
n.setStyles({visibility:null});
console.log("showing node (fromLeft: "+k+", toLeft: 0)");
n.anim({left:0},{from:{left:k},duration:f,easing:j}).run()
}else{if(n.activeAnim){n.activeAnim.stop(true)
}n.setStyles({display:"block",left:0});
var h=(l=="left"?-1:1)*n.get("offsetWidth");
console.log("hiding node (fromLeft: 0, toLeft: "+h+")");
n.anim({left:h},{from:{left:0},duration:f,easing:j,end:function(){n.setStyles({display:"none",left:0})
}}).run()
}}return new e.Do.Prevent("Slideable prevented default "+(i?"show":"hide")+" and used its own.")
},_hardChangeVisibility:function(g){var f=this.get("host");
f.setStyles({display:g?"block":"none"});
f.fire(g?b:a)
}},{NS:"slideablePlugin",ATTRS:{duration:{value:0.2,validator:e.Lang.isNumber},easing:{value:e.Easing.easeOutStrong},opacity:{value:1}}})
},"1.0",{requires:["base","plugin","anim","anim-easing","animations-css","transition"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-debugger",function(a){a.namespace("Squarespace");
a.Squarespace.Debugger=Class.create({defaultOpts:{output:true,ignore:[],name:"GenericComponent"},initialize:function(c){this.params=a.merge(this.defaultOpts,c);
if(a.Cookie.get("SQUARESPACE_DEBUG_"+this.params.name.toUpperCase())){this.params.output=true
}if(this.params.uid){this.params.name+=" #"+this.getUID()
}if(this.params.logEvents){var b=this;
this.params.logEvents.fire=function(d){b.log("Firing",d);
a.EventTarget.prototype.fire.apply(b.params.logEvents,arguments)
}
}this.logEnabled=this.params.output
},log:function(){if(!this.params.output){return
}if(this.params.ignore.indexOf(arguments[0])>=0){return
}var b=Array.prototype.slice.call(arguments);
b.unshift("["+this.params.name+"]");
if(console.log){if(a.UA.ios){console.log(b.join(" "))
}else{if(console.log.apply){console.log.apply(console,b)
}else{console.log(b)
}}}},error:function(){var b=Array.prototype.slice.call(arguments);
b.unshift(this.params.name);
if(a.UA.ios){b=[b.join(" ")]
}if(console.error){if(a.UA.ios){console.error(b.join(" "))
}else{if(console.error.apply){console.error.apply(console,b)
}else{console.error(b)
}}}if(console.trace){console.trace()
}},warn:function(){var b=Array.prototype.slice.call(arguments);
b.unshift("["+this.params.name+"]");
if(console.warn){if(a.UA.ios){console.warn(b.join(" "))
}else{if(console.warn.apply){console.warn.apply(console,b)
}else{console.warn(b)
}}}},getUID:function(){if(a.Squarespace.Debugger.lastUID[this.params.name]===undefined){a.Squarespace.Debugger.lastUID[this.params.name]=0
}return a.Squarespace.Debugger.lastUID[this.params.name]++
},time:function(b){if(!this.params.output){return
}if(console.time){console.time("["+this.params.name+"] "+b)
}},timeEnd:function(b){if(!this.params.output){return
}if(console.timeEnd){console.timeEnd("["+this.params.name+"] "+b)
}}});
a.Squarespace.Debugger.lastUID={}
},"1.0",{requires:["squarespace-common"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-touch-event-listener",function(a){a.Squarespace.TouchEventListener=Class.create({el:null,captureSettings:null,touchStartPoint:null,touchEndPoint:null,touchStartTime:null,touchStartHandler:null,touchMoveHandler:null,touchEndHandler:null,swipeThreshold:null,swipeTimeThreshold:null,initialize:function(b,c){this.el=b;
this.captureSettings={swipe:false,move:false,preventDefaultTouchEvents:true};
this.captureSettings=a.merge(this.captureSettings,c);
this.swipeThreshold=50;
this.swipeTimeThreshold=250;
this.touchStartPoint={x:0,y:0};
this.touchEndPoint={x:0,y:0};
this.addEventHandlers()
},addEventHandlers:function(){this.touchStartHandler=a.bind(this.onTouchStart,this);
this.touchMoveHandler=a.bind(this.onTouchMove,this);
this.touchEndHandler=a.bind(this.onTouchEnd,this);
this.el.on("touchstart",this.touchStartHandler);
if(this.captureSettings.move){this.el.on("touchmove",this.touchMoveHandler)
}this.el.on("touchend",this.touchEndHandler)
},removeEventHandlers:function(){this.el.detachAll()
},getTouchPoint:function(b){return{x:b[0].pageX,y:b[0].pageY}
},fireTouchEvent:function(i){var h,c=0,b=0,j=0,f,d,g;
c=this.touchEndPoint.x-this.touchStartPoint.x;
b=this.touchEndPoint.y-this.touchStartPoint.y;
j=Math.sqrt((c*c)+(b*b));
if(this.captureSettings.swipe){d=new Date();
g=d-this.touchStartTime;
if(g<=this.swipeTimeThreshold){if(window.Math.abs(c)>=this.swipeThreshold){a.fire("squarespace:ontouch",{type:a.Squarespace.TouchEventListener.Types.onTouch,target:this,point:this.touchEndPoint,action:(c<0)?a.Squarespace.TouchEventListener.ActionTypes.swipeLeft:a.Squarespace.TouchEventListener.ActionTypes.swipeRight,targetEl:i.target,currentTargetEl:i.currentTarget,touchEvent:i});
return
}if(window.Math.abs(b)>=this.swipeThreshold){a.fire("squarespace:ontouch",{type:a.Squarespace.TouchEventListener.Types.onTouch,target:this,point:this.touchEndPoint,action:(b<0)?a.Squarespace.TouchEventListener.ActionTypes.swipeUp:a.Squarespace.TouchEventListener.ActionTypes.swipeDown,targetEl:i.target,currentTargetEl:i.currentTarget,touchEvent:i});
return
}}}if(j>1){a.fire("squarespace:ontouch",{type:a.Squarespace.TouchEventListener.Types.onTouch,target:this,action:a.Squarespace.TouchEventListener.ActionTypes.touchMoveEnd,point:this.touchEndPoint,targetEl:i.target,currentTargetEl:i.currentTarget,touchEvent:i});
return
}else{a.fire("squarespace:ontouch",{type:a.Squarespace.TouchEventListener.Types.onTouch,target:this,action:a.Squarespace.TouchEventListener.ActionTypes.tapped,point:this.touchEndPoint,targetEl:i.target,currentTargetEl:i.currentTarget,touchEvent:i});
return
}},onTouchStart:function(d){if(this.captureSettings.preventDefaultTouchEvents){d.preventDefault()
}var b=d,c=b.touches;
this.touchStartTime=new Date();
this.touchStartPoint=this.getTouchPoint(c);
a.fire("squarespace:ontouch",{type:a.Squarespace.TouchEventListener.Types.onTouch,target:this,action:a.Squarespace.TouchEventListener.ActionTypes.touchStart,point:this.touchStartPoint,targetEl:d.target,currentTargetEl:d.currentTarget,touchEvent:d})
},onTouchMove:function(d){if(this.captureSettings.preventDefaultTouchEvents){d.preventDefault()
}var b=d,c=b.touches;
a.fire("squarespace:ontouch",{type:a.Squarespace.TouchEventListener.Types.onTouch,target:this,action:a.Squarespace.TouchEventListener.ActionTypes.touchMove,point:this.getTouchPoint(c),targetEl:d.target,currentTargetEl:d.currentTarget,touchEvent:d})
},onTouchEnd:function(d){if(this.isGesture&&this.captureSettings.gesture){return
}if(this.captureSettings.preventDefaultTouchEvents){d.preventDefault()
}var b=d,c=(b.changedTouches)?b.changedTouches:b.touches;
this.touchEndPoint=this.getTouchPoint(c);
a.fire("squarespace:ontouch",{type:a.Squarespace.TouchEventListener.Types.onTouch,target:this,action:a.Squarespace.TouchEventListener.ActionTypes.touchEnd,point:this.touchEndPoint,targetEl:d.target,currentTargetEl:d.currentTarget,touchEvent:d});
this.fireTouchEvent(d)
}});
a.Squarespace.TouchEventListener.Types={onTouch:"onTouch"};
a.Squarespace.TouchEventListener.ActionTypes={touchStart:"touchStart",touchMove:"touchMove",touchEnd:"touchEnd",touchMoveEnd:"touchMoveEnd",swipeLeft:"swipeLeft",swipeRight:"swipeRight",swipeUp:"swipeUp",swipeDown:"swipeDown",tapped:"tapped"}
});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-gallery-ng",function(){Y.Squarespace.Widgets.Gismo=Y.Base.create("Gismo",Y.Squarespace.Widgets.SSWidget,[Y.Squarespace.GismoBase]);
Y.Squarespace.Gallery2=Y.Base.create("Gallery",Y.Squarespace.Widgets.Gismo,[],{initializer:function(){this._debugger=new Y.Squarespace.Debugger({name:"Gallery2",output:false,uid:true});
this._images=this.get("container").all("img[data-src]");
this._imagesByMedia={};
this._slidesByMedia={};
Y.Squarespace.GalleryManager.registerGallery(this);
this.get("slides").each(function(d){if(!d.getAttribute("data-type")){d.setAttribute("data-type",d.one(".sqs-video-wrapper")?"video":"image")
}});
this._loadByItemId();
this.plugLoaders();
this.plug(this.get("design"),this.get("designOptions"));
this.bindUI();
this.get("container").plug(Y.Squarespace.NodeDestroyNotifier,{onDestroy:function(){this.destroy()
},context:this});
this.get("container").setData("gallery",this)
},destructor:function(){if(this._autoplayHandle){this._autoplayHandle.cancel()
}if(this._wrapperEl){this.get("slides").each(function(d){this.get("container").append(d)
},this);
this._wrapperEl.remove()
}this.get("container").clearData("gallery")
},bindUI:function(){this._flushEvents("refreshOnResize");
if(this.get("refreshOnResize")){if(!this.get("resizeEmitter")){this.set("resizeEmitter",new Y.Squarespace.ResizeEmitter({timeout:100}))
}this._event(this.get("resizeEmitter").on("resize:end",function(){this.refresh()
},this),"refreshOnResize")
}this._flushEvents("refreshOnOrientationChange");
if(this.get("refreshOnOrientationChange")){this._event(Y.one(window).on("orientationchange",function(){this.refresh()
},this),"refreshOnOrientationChange")
}if(this.get("keyboard")){var d=Y.bind(function(){if(this.get("inMotion")){return false
}var f=Y.Squarespace.GalleryManager.getGalleries();
var k=this.get("container").inRegion(Y.one(Y.config.win).get("region"));
var j=true;
var g=false;
for(var h=0;
h<f.length;
h++){var e=f[h];
if(e==this){g=j
}else{if(e.get("container").inRegion(Y.one(Y.config.win).get("region"))){j=false
}}}if(!k){return false
}else{if(j){return true
}else{return g
}}},this);
if(this.get("keys.previous")){this._event(Y.on("key",function(f){if(!d.call(this)){return
}f.preventDefault();
this.previousSlide()
},window,this.get("keys.previous"),this),"keyboard")
}if(this.get("keys.next")){this._event(Y.on("key",function(f){if(!d.call(this)){return
}f.preventDefault();
this.nextSlide()
},window,this.get("keys.next"),this),"keyboard")
}}this._bindUIAutoplay();
this.after("autoplayChange",this._bindUIAutoplay,this);
this.after("autoplayOptionsChange",this._bindUIAutoplay,this);
this._bindUIElements();
this.after("elementsChange",this._bindUIElements,this);
this.fire("bindUI")
},syncUI:function(){var d=this.get("container").all("."+this.getProperty("ACTIVE_CLASS"));
d.removeClass(this.getProperty("ACTIVE_CLASS"));
d.each(function(f){this.setVideoState(f)
},this);
var e=this._currentSlide();
if(e){e.addClass(this.getProperty("ACTIVE_CLASS"))
}if(!this.get("loop")){if(this.get("elements.next")){if(this.get("currentIndex")>=(this.get("numberOfSlides")-1)){this.get("elements.next").addClass(this.getProperty("DISABLED_PAGINATION_CLASS"))
}else{this.get("elements.next").removeClass(this.getProperty("DISABLED_PAGINATION_CLASS"))
}}if(this.get("elements.previous")){if(this.get("currentIndex")<=0){this.get("elements.previous").addClass(this.getProperty("DISABLED_PAGINATION_CLASS"))
}else{this.get("elements.previous").removeClass(this.getProperty("DISABLED_PAGINATION_CLASS"))
}}}if(this.get("elements.currentIndex")){this.get("elements.currentIndex").setContent(this.get("currentIndex")+1)
}if(this.get("elements.totalSlides")){this.get("elements.totalSlides").setContent(this.get("numberOfSlides"))
}this.fire("syncUI")
},refresh:function(){this.syncUI();
if(this.get("lazyLoad")){this.getImages().each(function(d){if(d.getAttribute("src")&&d.loader){d.loader.set("load",true);
d.fire("refresh")
}},this)
}else{this.getImages().each(function(d){d.fire("refresh")
},this)
}this.getSlides("video").each(function(d){d.one(".sqs-video-wrapper").videoloader.reload()
});
this.fire("refresh")
},refreshContentMode:function(d){this.getImages("image").each(function(e){e.loader.set("mode",d)
});
this.getSlides("video").each(function(e){e.one(".sqs-video-wrapper").videoloader.set("mode",d)
})
},plugLoaders:function(){var d={};
if(this.get("lazyLoad")){d.load="viewport"
}d=Y.merge(d,this.get("loaderOptions"));
this.getSlides("video").each(function(e){e.one(".sqs-video-wrapper").plug(Y.Squarespace.VideoLoader,{mode:this.get("loaderOptions.mode")})
},this);
this.getImages().plug(Y.Squarespace.Loader2,d)
},loadImages:function(d){this._event(d.on("load",function(){this.fire("image-loaded")
},this));
d.each(function(e){if(e.loader){e.loader.set("load",true);
e.fire("refresh")
}})
},previousSlide:function(f){if(f){f.preventDefault()
}var g=this._currentSlide();
this.setVideoState(g);
var d=this.get("currentIndex")-1;
if(d<0&&!this.get("loop")){return
}this.set("currentIndex",d%this.get("numberOfSlides"),{direction:-1})
},nextSlide:function(f){if(f){f.preventDefault()
}var g=this._currentSlide();
this.setVideoState(g);
var d=this.get("currentIndex")+1;
if(d>=this.get("numberOfSlides")&&!this.get("loop")){return
}this.set("currentIndex",d%this.get("numberOfSlides"),{direction:1})
},renderWrapper:function(){if(this._wrapperEl){return
}var d=Y.Node.create('<div class="sqs-wrapper"></div>');
this.get("slides").each(function(e){d.append(e)
},this);
this._wrapperEl=d;
this.get("container").append(this._wrapperEl)
},addChild:function(d){var e=this.get("linkedGalleries");
var f=Y.bind(function(h){if(h.calledFromSync){return
}for(var g=0;
g<e.length;
g++){if(h.calledFromChild!=e[g]){e[g].set("currentIndex",this.get("currentIndex"),{calledFromSync:true})
}}},this);
if(!this._linkedGalleryBinding){this._linkedGalleryBinding=this.after("currentIndexChange",function(g){f(g)
},this)
}if(this.get("keyboard")){d.set("keyboard",false)
}d.after("currentIndexChange",function(g){if(!g.calledFromSync){this.set("currentIndex",g.newVal,{calledFromChild:d})
}},this);
e.push(d);
d.get("linkedGalleries").push(this);
d.syncUI()
},setVideoState:function(d){if(this._slideType(d)!="video"){return
}var e=d.one(".sqs-video-wrapper").videoloader;
if(e.get("overlay")){e.showOverlay()
}else{if(e.get("apiFriendly")){e.pause()
}else{if(["object","iframe"].indexOf(e.get("type"))!=-1){e.refreshVideo()
}}}},getSlides:function(d){if(d){return this._slidesByType(d)
}else{return this.get("slides")
}},getImages:function(d){if(d){return this._imagesByType(d)
}else{return this._images
}},_bindUIAutoplay:function(){var j=this.get("autoplay");
if(this._autoplayHandle){this._autoplayHandle.cancel();
this._flushEvents("autoplay")
}if(j){var e=false;
this._autoplayHandle=Y.later(this.get("autoplayOptions.timeout"),this,function(){if(!!e){return
}if(this.get("autoplayOptions.interval")){var i=Math.ceil(Math.random()*this.get("numberOfSlides"));
while(i==this.get("currentIndex")){this.set("currentIndex",i)
}}else{this.nextSlide()
}},null,true);
var h=[this.get("container"),this.get("elements.previous"),this.get("elements.next")];
if(this.get("autoplayOptions.pauseOnMouseover")){var d=this.get("autoplayOptions.pauseOnMouseover");
for(var f=0;
f<d.length;
f++){h.push(Y.one(d[f]))
}}for(var f=0;
f<h.length;
f++){var g=h[f];
if(Y.Lang.isString(g)){g=this.get(g)
}if(g){this._event(g.on(["mouseenter","mousemove"],function(){e=true
}),"autoplay");
this._event(g.on("mouseout",function(){e=false
}),"autoplay")
}}}},_bindUIElements:function(){var d=Y.bind(function(f){for(var e=0;
e<f.length;
e++){element=f[e];
this._flushEvents("controls-"+element);
if(this.get("elements."+element)){this._event(this.get("elements."+element).on("click",this[element+"Slide"],this),"controls-"+element)
}}},this);
d(["previous","next"]);
this._flushEvents("controls-controls");
if(this.get("elements.controls")){this.get("elements.controls").each(function(f){var e=f.get("children");
e.each(function(g,h){this._event(g.on("click",function(){this.set("currentIndex",h)
},this),"controls-controls")
},this);
this.after("currentIndexChange",function(g){e.filter("."+this.getProperty("ACTIVE_CLASS")).removeClass(this.getProperty("ACTIVE_CLASS"));
e.item(g.newVal).addClass(this.getProperty("ACTIVE_CLASS"))
});
e.item(this.get("currentIndex")).addClass(this.getProperty("ACTIVE_CLASS"))
},this)
}},_loadByItemId:function(){this._history=new Y.HistoryHash();
if(this.get("historyHash")){this.on("currentIndexChange",function(f){this._history.replaceValue(this.get("historyHash"),f.newVal)
},this)
}if(this.get("historyHash")||this._history.get("itemId")){var e=this._history.get("itemId")||this._history.get(this.get("historyHash"));
var d;
if(e){this.get("slides").each(function(f,g){if(f.getAttribute("data-slide-id")==e){d=g
}})
}if(!Y.Lang.isNumber(d)){d=parseInt(this._history.get(this.get("historyHash")),10)
}if(!!this._history.get("itemId")){this._history.replaceValue("itemId",null)
}if(Y.Lang.isNumber(d)){this.set("currentIndex",d)
}}},_currentSlide:function(){return this.get("slides").item(this.get("currentIndex"))
},_slidesByType:function(d){if(!this._slidesByMedia[d]){this._slidesByMedia[d]=this.get("slides").filter('[data-type="'+d+'"]')
}return this._slidesByMedia[d]
},_imagesByType:function(d){if(!this._imagesByMedia[d]){this._imagesByMedia[d]=new Y.NodeList();
this._slidesByType(d).each(function(e){var f=e.test("img")?e:e.one("img[data-src]");
if(f){this._imagesByMedia[d].push(f)
}},this)
}return this._imagesByMedia[d]
},_slideType:function(d){if(d.getAttribute("data-type")=="image"){return"image"
}else{if(d.getAttribute("data-type")=="video"){return"video"
}else{return"image"
}}},_getContainer:function(d){if(Y.Lang.isString(d)){d=Y.one(d)
}return d
},_cleanCurrentIndex:function(d){if(d<0){d=this.get("numberOfSlides")+d
}return d%this.get("numberOfSlides")
},_getDesign:function(e){var d=a[e];
if(!d){throw Error("These aren't the gallery designs you're looking for. (We couldn't find a design by the name '"+e+"')")
}return d
},_getElements:function(e){for(var d in e){if(!(e[d] instanceof Y.NodeList)){e[d]=Y.all(e[d])
}}return e
},_setElements:function(d,e){this._bindUIElements()
},_setLoaderOptions:function(d){if(d.hasOwnProperty("fit")&&d.fit){d.mode="fit"
}else{if(d.hasOwnProperty("fill")&&d.fill){d.mode="fill"
}}return d
},_getNumberOfSlides:function(){return this.get("slides").size()
},_getSlides:function(e){var d=this._wrapperEl||this.get("container");
if(!e){e=d.get("children")
}if(Y.Lang.isString(e)){e=d.all(e)
}return e
},_getWrapper:function(d){if(Y.Lang.isString(d)){d=Y.one(d)
}return d
},_validateCurrentIndex:function(d){if(this.get("inMotion")){return false
}else{for(var e=0;
e<this.get("linkedGalleries").length;
e++){var f=this.get("linkedGalleries")[e];
if(f.get("inMotion")&&d!=f.get("currentIndex")){return false
}}return true
}}},{NS:"gallery",ACTIVE_CLASS:"sqs-active-slide",DISABLED_PAGINATION_CLASS:"sqs-disabled",ATTRS:{autoplay:{value:false},autoplayOptions:{value:{randomize:true,timeout:5000,pauseOnMouseover:[]}},container:{getter:"_getContainer"},currentIndex:{value:0,getter:"_cleanCurrentIndex",setter:"_cleanCurrentIndex",validator:"_validateCurrentIndex"},design:{value:"base",getter:"_getDesign"},designOptions:{value:{}},elements:{value:{next:null,previous:null,currentIndex:null,totalSlides:null,controls:null},getter:"_getElements",setter:"_setElements",lazyAdd:false},historyHash:{},inMotion:{value:false},keyboard:{value:true},keys:{value:{previous:"down:37",next:"down:39"}},lazyLoad:{value:false},linkedGalleries:{value:[]},loaderOptions:{value:{},setter:"_setLoaderOptions"},loop:{value:false},numberOfSlides:{getter:"_getNumberOfSlides"},refreshOnResize:{value:false},refreshOnOrientationChange:{value:false},resizeEmitter:{value:null},slides:{getter:"_getSlides"}}});
var c={};
c.ByViewport=Y.Base.create("GalleryLoadingBehavior",Y.Base,[],{initializer:function(){if(this.get("host").get("lazyLoad")){var d=this.get("host").get("container").ancestor(function(e){return(e.getStyle("overflowY").match(/scroll|auto/)&&e.get("scrollHeight")>e.get("clientHeight"))
});
if(!d||d.test("html")){d=Y.one(Y.config.win)
}this.loadHandler=d.on("scroll",function(){this.loadItems()
},this)
}},destructor:function(){if(this.loadHandler){this.loadHandler.detach()
}},loadItems:function(){var e=this.get("host"),d=e.getImages();
if(e.get("lazyLoad")){var g=Y.one(Y.config.win).get("region");
var f=d.filter(Y.bind(function(i){var j=this.get("slideCompare")?Y.one(i).ancestor("."+this._getProperty("SLIDE_CLASS")):Y.one(i),h=j.get("region"),k={};
h.right=h.left+parseInt(j.getComputedStyle("width"));
h.bottom=h.top+parseInt(j.getComputedStyle("height"));
k.top=Math.max(h.top,g.top);
k.right=Math.min(h.right,g.right);
k.bottom=Math.min(h.bottom,g.bottom);
k.left=Math.max(h.left,g.left);
return(k.bottom>=k.top&&k.right>=k.left)
},this));
e.loadImages(f)
}else{e.loadImages(d)
}}});
c.ByCurrentIndex=Y.Base.create("GalleryLoadingBehavior",Y.Base,[],{loadItems:function(){var e=this.get("host"),d=e.getImages();
if(e.get("lazyLoad")){var h=e.get("currentIndex")-this.get("preloadCount"),g=(e.get("currentIndex")+this.get("preloadCount"))%e.get("slides").size(),f=new Y.NodeList();
if(h>=0&&h<=g){f=d.slice(h,g+1)
}else{f=f.concat(d.slice(h));
f=f.concat(d.slice(0,g+1))
}e.loadImages(f)
}else{e.loadImages(d)
}}});
var a={};
a.base=Y.Base.create("GalleryDesignBase",Y.Plugin.Base,[Y.Squarespace.GismoBase,c.ByViewport],{initializer:function(){this.get("host").after("currentIndexChange",function(){this.get("host").syncUI()
},this);
this.loadItems();
this.get("host").syncUI()
},destructor:function(){},_getProperty:function(d){return this.constructor[d]
}},{NS:"gallery-design",ATTRS:{}});
a.stacked=Y.Base.create("GalleryDesignStacked",Y.Plugin.Base,[Y.Squarespace.GismoBase,c.ByCurrentIndex],{initializer:function(){var d=this.get("host");
this.simpleCaption=(Modernizr&&Modernizr.touch&&d.get("container").get("offsetWidth")<500&&this.get("enableSimpleCaption"));
d.get("container").addClass(this._getProperty("CONTAINER_CLASS"));
d.get("slides").addClass(this._getProperty("SLIDE_CLASS"));
this.plug(this.get("transition"),this.get("transitionOptions"));
d.after("currentIndexChange",this.syncUI,this);
d.after("refresh",this.syncUI,this);
d.get("slides").each(function(f,g){var e=f.test("img")?f:f.one("img");
if(e){e.onceAfter("loaded",function(){f.addClass("loaded")
},this)
}else{f.addClass("loaded")
}},this);
if(this.get("autoHeight")){if(!this.containerHeight){this.containerHeight=this._calculateContainerHeight()
}this.get("host").get("container").setStyles({height:this.containerHeight})
}d.getSlides("video").each(function(e){e.one(".sqs-video-wrapper").videoloader.set("mode","fill")
});
if(this.simpleCaption){d.refreshContentMode("fit")
}this.bindUI();
this.syncUI()
},destructor:function(){if(this.get("autoHeight")){this.get("host").get("container").setStyles({height:null})
}this.get("host").get("slides").each(function(d){d.setStyles({opacity:null});
d.removeClass(this._getProperty("SLIDE_CLASS"))
},this)
},bindUI:function(){if(this.get("clickBehavior")){this._event(this.get("host").get("container").on("click",function(h){if(h.target.ancestor("a",true)){return
}var d=h.target.ancestor(".slide");
if(d&&!!d.getAttribute("data-click-through-url")){window.location.href=d.getAttribute("data-click-through-url");
h.preventDefault();
return
}if(this.get("host")._slideType(this.get("host")._currentSlide())!="video"){switch(this.get("clickBehavior")){case"next":this.get("host").nextSlide();
break;
case"previous":this.get("host").previousSlide();
break;
default:var g=this.get("host").get("container").get("region");
var f=(g.width/2)+g.left;
if(h.pageX>f){this.get("host").nextSlide()
}else{this.get("host").previousSlide()
}break
}}h.preventDefault()
},this))
}},syncUI:function(d){this.get("host").syncUI();
this.fire("transition",d||{newVal:this.get("host").get("currentIndex")});
this.loadItems();
this._positionMetaOverlay()
},_positionMetaOverlay:function(){if(!Y.Lang.isNumber(this.get("host").get("currentIndex"))){return
}var d=this.get("host").get("slides").item(this.get("host").get("currentIndex"));
var g=d.one(".meta");
var i=d.one("img");
var e=this.get("host").get("container");
if(!i){i=d
}var h=i.ancestor(".sqs-video-wrapper",true);
if(h){i=d;
h.videoloader.on("showingVideoChange",function(j){d[j.newVal?"addClass":"removeClass"]("video-playing")
})
}if(this.simpleCaption){e.setStyles({height:this.containerHeight});
i.fire("refresh");
e.addClass("mobile-view").setStyles({height:this.containerHeight+(g?g.get("offsetHeight"):0)});
i.setStyles({top:null})
}else{if(g){var f=e.getAncestorData("galleryOptions");
if(f){switch(f["meta-position"]||"bottom"){case"top":case"bottom":g.setStyles({left:i.get("offsetLeft"),width:i.get("offsetWidth")});
break;
case"top-left":case"bottom-left":g.setStyles({left:i.get("offsetLeft"),maxWidth:i.get("offsetWidth")/2});
break;
case"top-right":case"bottom-right":g.setStyles({right:d.get("offsetWidth")-(i.get("offsetLeft")+i.get("offsetWidth")),maxWidth:i.get("offsetWidth")/2});
break;
case"center":g.setStyles({maxWidth:i.get("offsetWidth")/2});
g.setStyles({marginLeft:g.get("offsetWidth")/-2,marginTop:g.get("offsetHeight")/-2});
break
}}if(g.get("offsetHeight")/e.get("offsetHeight")>0.9){g.setStyles({height:e.get("offsetHeight")*0.4}).addClass("overflow")
}}}},_calculateContainerHeight:function(){var e=[];
var d=this.get("host").get("container").get("offsetHeight");
this.get("host").get("slides").each(function(f){switch(this.get("host")._slideType(f)){case"image":var j=f.test("img")?f:f.one("img");
if(j){var g=Y.Squarespace.Rendering.getDimensionsFromNode(j);
var i=Y.Squarespace.Rendering.getHeightForWidth(g.width,g.height,f.get("offsetWidth"));
if(!isNaN(i)){e.push(i)
}}else{this.get("host")._debugger.log("_calculateContainerHeight","Couldnt evaluate height for slide.")
}break;
case"video":var h=Y.Squarespace.Rendering.getHeightForWidth(f.one(".sqs-video-wrapper").videoloader.getWidth(),f.one(".sqs-video-wrapper").videoloader.getHeight(),f.get("offsetWidth"));
if(!isNaN(h)){e.push(h)
}break
}},this);
if(e.length>0){d=Math.min.apply(Math.min,e)
}return d
},_getProperty:function(d){return this.constructor[d]
},_getTransition:function(d){d=b[d];
if(!d){throw Error("These aren't the gallery stacked transitions you're looking for. (We couldn't find a transition by the name "+d+" )")
}return d
}},{NS:"gallery-design",CONTAINER_CLASS:"sqs-gallery-design-stacked",SLIDE_CLASS:"sqs-gallery-design-stacked-slide",ATTRS:{autoHeight:{value:true},clickBehavior:{value:"next"},easing:{value:Y.Easing.easeOutStrong},enableSimpleCaption:{value:false},speed:{value:0.3},preloadCount:{value:7},transition:{value:"fade",getter:"_getTransition"},transitionOptions:{value:{}}}});
a.strip=Y.Base.create("GalleryDesignBase",Y.Plugin.Base,[Y.Squarespace.GismoBase,c.ByCurrentIndex],{initializer:function(){var e=this.get("host");
e.get("container").addClass(this._getProperty("CONTAINER_CLASS"));
e.get("slides").addClass(this._getProperty("SLIDE_CLASS"));
this._event(e.on("image-loaded",this._syncUIRefreshWrapperWidth,this));
var d=e.get("container").get("offsetHeight");
e._slidesByType("video").each(function(f){var g=f.one(".sqs-video-wrapper").videoloader.getWidth()/f.one(".sqs-video-wrapper").videoloader.getHeight();
f.one(".sqs-video-wrapper").setStyle("paddingRight",g*d);
if(f.one("img")){f.one("img").refresh()
}});
e.renderWrapper();
e.after("currentIndexChange",this.syncUI,this);
this.loadItems();
this.syncUI();
this.bindUI()
},destructor:function(){this.get("host").get("container").removeClass(this._getProperty("CONTAINER_CLASS"));
this.get("host").get("slides").removeClass(this._getProperty("SLIDE_CLASS"))
},bindUI:function(){var e=this.get("host")._currentSlide();
this.get("host").get("slides").each(function(f,h){var g=this.get("host")._slideType(f);
if(g=="video"&&f!=e){f.one(".sqs-video-wrapper").videoloader.set("inactive",true)
}this._event(f.on("click",function(m){if(g=="video"&&!f.one(".sqs-video-wrapper").videoloader.get("inactive")){return
}var k=m.target.getAttribute("data-click-through-url");
if(!!k){window.location.href=k
}var n=this.get("host")._currentSlide();
var l=this.get("host")._slideType(n);
if(h==this.get("host").get("currentIndex")){switch(this.get("activeSlideClickBehavior")){case"next":this.get("host").nextSlide();
break;
case"previous":this.get("host").previousSlide();
break;
default:this.get("host").set("currentIndex",h);
break
}}else{this.get("host").set("currentIndex",h)
}var j=this.get("host")._currentSlide();
var i=this.get("host")._slideType(j);
if(n!=j){if(i=="video"){j.one(".sqs-video-wrapper").videoloader.set("inactive",false);
if(j==f){j.one(".sqs-video-wrapper").videoloader.showVideo()
}}if(l=="video"){n.one(".sqs-video-wrapper").videoloader.set("inactive",true)
}}},this))
},this);
this.get("host").on("currentIndexChange",function(i){var g=this.get("host").get("slides");
if(i.newVal<0){i.newVal=g.size()-1
}var f=g.item(i.prevVal);
var h=g.item(i.newVal);
if(this.get("host")._slideType(f)=="video"){f.one(".sqs-video-wrapper").videoloader.set("inactive",true)
}if(this.get("host")._slideType(h)=="video"){h.one(".sqs-video-wrapper").videoloader.set("inactive",false)
}},this);
var d=this.get("host").get("slides").item(this.get("currentIndex")||0);
if(d){d.addClass(this._getProperty("SLIDE_CLASS"))
}},syncUI:function(d){if(!d||!d.calledFromParent){this.get("host").syncUI()
}this._syncUIRefreshWrapperWidth();
this.loadItems()
},_syncUIRefreshWrapperWidth:function(){if(this.get("host").get("container").hasClass("sqs.gallery-thumbnails")){var i=this.get("host").get("container");
var j=i.get("offsetHeight");
i.all(".sqs-video-thumbnail").each(function(l){if(l.hasClass("no-image")){l.one(".sqs-video-thumbnail-inner").setStyles({width:Math.floor(j*(16/9))+"px"})
}var m=l.one("img");
if(m){l.removeClass("loading");
l.setAttribute("style","width: "+m.get("offsetWidth")+"px !important")
}})
}var f=this.get("host")._wrapperEl;
f.setStyles({width:null});
var e=0;
var g=0;
this.get("host").get("slides").each(function(l,m){if(this.get("host").get("currentIndex")>m){g+=l.get("offsetWidth")
}e+=l.get("offsetWidth")
},this);
var h=this.get("host").get("container").get("offsetWidth");
var k=this.get("host")._currentSlide();
switch(this.get("alignment")){case"start":break;
case"middle":g-=(h-k.get("offsetWidth"))/2;
if(g<0){g=0
}break;
case"end":g-=(h-k.get("offsetWidth"));
if(g<0){g=0
}break
}if(e<h){g=(h-e)/-2
}else{if(g>(e-h)){g=(e-h)
}}f.setStyles({width:e*2});
var d=this;
this._anim(f,{left:-1*g},{duration:this.get("speed"),easing:this.get("easing"),start:function(){d.get("host").set("inMotion",true)
},end:function(){d.get("host").set("inMotion",false)
}}).run()
},_getProperty:function(d){return this.constructor[d]
}},{NS:"gallery-design",CONTAINER_CLASS:"sqs-gallery-design-strip",SLIDE_CLASS:"sqs-gallery-design-strip-slide",ATTRS:{speed:{value:0.3},easing:{value:Y.Easing.easeOutStrong},activeSlideClickBehavior:{value:"next"},preloadCount:{value:7},alignment:{value:"middle",validator:function(d){return["start","middle","end"].indexOf(d)!=-1
}}}});
a.grid=Y.Base.create("GalleryDesignGrid",Y.Plugin.Base,[Y.Squarespace.GismoBase,c.ByViewport],{initializer:function(){var d=this.get("host");
d.get("container").addClass(this._getProperty("CONTAINER_CLASS"));
d.get("slides").addClass(this._getProperty("SLIDE_CLASS"));
d.getImages("image").each(function(e){e.setStyles({opacity:0});
this._event(e.once("load",function(){this._timer(Y.later(Math.random()*500,this,function(){var g=this._anim(e,{opacity:1},{duration:1});
if(!this.get("destroyed")&&g.get("node").inDoc()){var f=Y.DOM.viewportRegion();
if(g.get("node").inRegion(f)){g.run()
}else{e.setStyles({opacity:null})
}}}))
},this))
},this);
d.getSlides("video").each(function(e){e.all(".sqs-video-wrapper").each(function(f){f.setStyles({opacity:0});
var g=this._anim(f,{opacity:1},{duration:1});
this._timer(Y.later(Math.random()*500,this,function(){g.run()
}))
},this)
},this);
this.loadItems();
d.getSlides("video").each(function(g){var e=g.one(".sqs-video-wrapper");
var f=e.videoloader;
if(this.get("lightbox")){f.set("inactive",true)
}if(g.one(".content-fit")){f.set("mode","fit")
}else{f.set("mode","fill")
}},this);
this.bindUI()
},destructor:function(){this.get("host").get("container").removeClass(this._getProperty("CONTAINER_CLASS"));
this.get("host").get("slides").removeClass(this._getProperty("SLIDE_CLASS"))
},bindUI:function(){if(!this.get("lightbox")){return
}this.get("host").getSlides("video").each(function(f){var e=f.one(".sqs-video-wrapper").videoloader.get("overlay");
if(e){e.detach("click")
}});
var d=[];
this.get("host").get("slides").each(function(e,i){if(this.get("host")._slideType(e)=="video"){d.push({content:e.one(".sqs-video-wrapper")})
}else{if(!e.hasAttribute("data-title")&&!e.hasAttribute("data-description")){var f=e.one("[data-title],[data-description]");
if(f){e=f
}}var h=e.getAttribute("data-title");
var g=e.getAttribute("data-description");
d.push({content:e.one("img"),meta:(h?"<h1>"+h+"</h1>":"")+(g?g:"")})
}},this);
this.get("host").get("slides").on("click",function(f){f.halt();
var g=f.target.ancestor("."+this._getProperty("SLIDE_CLASS"));
if(!g){return
}if(this.lightbox){this.lightbox.destroy();
delete this.lightbox
}this.lightbox=new Y.Squarespace.Lightbox2({controls:{previous:true,next:true},set:d,currentSetIndex:this.get("host").get("slides").indexOf(f.target.ancestor("."+this._getProperty("SLIDE_CLASS",true)))});
this.lightbox.render()
},this)
},_getProperty:function(d){return this.constructor[d]
}},{NS:"gallery-design",CONTAINER_CLASS:"sqs-gallery-design-grid",SLIDE_CLASS:"sqs-gallery-design-grid-slide",ATTRS:{lightbox:{value:true},perRow:{value:4}}});
a.autocolumns=Y.Base.create("GalleryDesignAutocolumns",Y.Plugin.Base,[Y.Squarespace.GismoBase,c.ByViewport],{initializer:function(){this.dimensions=[];
this.host=this.get("host");
this.host.get("container").addClass(this._getProperty("CONTAINER_CLASS"));
this.host.get("slides").addClass(this._getProperty("SLIDE_CLASS"));
this.host.after("refresh",this.syncUI,this);
this._event((new Y.Squarespace.ResizeEmitter({timeout:100})).on("resize",this.syncUI,this));
this.host.after(["columnWidthChange","columnWidthBehaviorChange","squaresChange","gutterChange","sequentialChange"],function(d){this.set(d.attrName,d.newVal);
this.syncUI()
},this);
this._evaluateBricks();
this.syncUI()
},destructor:function(){this.get("host").get("container").removeClass(this._getProperty("CONTAINER_CLASS"));
this.get("host").get("slides").removeClass(this._getProperty("SLIDE_CLASS"));
this._flushEvents()
},syncUI:function(){var j=this.host.get("container").get("offsetWidth");
var d=Math[this.get("columnWidthBehavior")=="min"?"floor":"ceil"](j/this.get("columnWidth"));
var g=this.get("gutter")*(d-1);
var h=Math.floor((j-g)/d);
var e=[];
for(var f=0;
f<d;
f++){e[f]=0
}this.host.get("slides").each(function(l,k){var p=k%d;
if(!this.get("sequential")){p=e.indexOf(Math.min.apply(Math,e))
}var n=h*p;
if(p!==0){n+=this.get("gutter")*p
}var m=this._getBrickHeight(l,k,h);
var o={top:e[p]+"px",left:n+"px",width:h+"px",height:m+"px"};
l.setStyles(o);
m+=this.get("gutter");
e[p]+=m
},this);
this.host.get("container").setStyle("height",Math.max.apply(Math,e)+"px");
Y.later(1,this,this.loadItems)
},_getBrickHeight:function(e,d,f){if(this.get("squares")){return f
}else{if(this.dimensions[d]){return Math.floor(Y.Squarespace.Rendering.getHeightForWidth(this.dimensions[d].width,this.dimensions[d].height,f))
}else{e.setStyles({width:f+"px",height:null});
return e.get("offsetHeight")
}}},_evaluateBricks:function(){this.host.getSlides().each(function(d){var e=d.one("img[data-image-dimensions]");
if(e){this.dimensions.push(Y.Squarespace.Rendering.getDimensionsFromNode(e))
}else{this.dimensions.push(null)
}},this)
},_getProperty:function(d){return this.constructor[d]
}},{NS:"gallery-design",CONTAINER_CLASS:"sqs-gallery-design-autocolumns",SLIDE_CLASS:"sqs-gallery-design-autocolumns-slide",ATTRS:{columnWidthBehavior:{value:"min"},columnWidth:{value:250},gutter:{value:0},sequential:{value:false},squares:{value:false},slideCompare:{value:true}}});
var b={};
b.base=Y.Base.create("GalleryDesignStackedTransition",Y.Plugin.Base,[Y.Squarespace.GismoBase],{baseZIndex:888,initializer:function(){this.get("host").get("host").get("slides").setStyles({opacity:0,zIndex:this.baseZIndex});
if(Y.UA.ie){this.get("host").get("host").get("slides").setStyles({visibility:"hidden"})
}this.get("host").on("transition",this.transition,this)
},_getProperty:function(d){return this.constructor[d]
}},{NS:"gallery-stacked-transition"});
b.fade=Y.Base.create("GalleryDesignStackedTransition",b.base,[],{transition:function(h){this.get("host").get("host").set("inMotion",true);
var f=h.newVal||this.get("host").get("host").get("currentIndex"),g=h.prevVal;
if(Y.Lang.isNumber(f)){var i=this.get("host").get("host").getSlides().item(f);
if(i){i.setStyles({visibility:null,zIndex:(this.baseZIndex+1)});
this._anim(i,{opacity:1},{duration:this.get("host").get("speed"),easing:this.get("host").get("easing"),end:Y.bind(function(){this.get("host").get("host").set("inMotion",false)
},this)}).run()
}}if(Y.Lang.isNumber(g)){var d=this.get("host").get("host").getSlides().item(g);
if(d){this._anim(d,{opacity:0},{duration:this.get("host").get("speed"),end:Y.bind(function(){d.setStyles({visibility:"hidden",zIndex:null});
this.get("host").get("host").set("inMotion",false)
},this)}).run()
}}}},{NS:"gallery-stacked-transition"});
b.scroll=Y.Base.create("GalleryDesignStackedTransition",b.base,[],{initializer:function(){this.galleryHost=this.get("host").get("host");
this.container=this.galleryHost.get("container");
this.slides=this.galleryHost.get("slides");
this.container.addClass(this._getProperty("CONTAINER_CLASS"));
this.slides.setStyle("opacity",0);
this._adjustPosition(this.slides,this._getContainerDim());
this._event((new Y.Squarespace.ResizeEmitter({timeout:100})).on("resize",function(){var d=this.galleryHost.get("slides");
d.splice(this.galleryHost.get("currentIndex"),1);
this._adjustPosition(d,this._getContainerDim())
},this));
if(Modernizr&&Modernizr.touch){this.touchListener=null,this.touchStartPoint=null,this.touchState={from:null,to:null},this.skipTransition=false,this.haltSliding=false;
this.touchListener=new Y.Squarespace.TouchEventListener(this.container,{move:true,swipe:true,preventDefaultTouchEvents:this.get("preventDefaultTouchEvents")});
Y.on("squarespace:ontouch",function(d){this._onTouch(d)
},this)
}},destructor:function(){this.container.removeClass(this._getProperty("CONTAINER_CLASS"));
if(this.touchListener){this.touchListener.removeEventHandlers()
}this._flushEvents()
},transition:function(g){if(this.skipTransition||this.slides.size()==0){return
}var h=this.slides.item(g.newVal);
var d=this.slides.item(g.prevVal);
if(!h){h=this.slides.item(this.galleryHost.get("currentIndex"))
}var f=(g&&g.direction)?g.direction:this._getDirection(g.prevVal,g.newVal);
if(!Y.Lang.isNumber(g.prevVal)){h.setStyle("opacity",1);
this._adjustPosition(h,0)
}else{h.setStyle("opacity",1);
this._adjustPosition(h,0,f*this._getContainerDim(),true)
}if(Y.UA.ie>0){h.setStyle("visibility",null)
}if(d){d.setStyle("opacity",1);
this._adjustPosition(d,-1*f*this._getContainerDim(),null,true)
}},_getOffsetAttribute:function(){return this.get("direction")=="horizontal"?"offsetWidth":"offsetWidth"
},_getContainerDim:function(){return this.get("host").get("host").get("container").get(this._getOffsetAttribute())
},_getDirection:function(e,d){if(e<d){return 1
}else{return -1
}},_onTouch:function(f){var d=this.get("host").get("host").get("container"),e=f.targetEl;
if(e.getAttribute("href")){this._handleAnchors(e)
}else{if(f.touchEvent.touches.length>1||this.touchZoom){this._handlePanning(f)
}else{if(d.contains(e)){switch(f.action){case Y.Squarespace.TouchEventListener.ActionTypes.swipeUp:Y.fire("transition:scroll:swipeup",{container:d});
break;
case Y.Squarespace.TouchEventListener.ActionTypes.swipeDown:Y.fire("transition:scroll:swipedown",{container:d});
break;
case Y.Squarespace.TouchEventListener.ActionTypes.tapped:Y.fire("transition:scroll:tapped",f);
break;
case Y.Squarespace.TouchEventListener.ActionTypes.touchStart:this.touchStartPoint=f.point;
break;
case Y.Squarespace.TouchEventListener.ActionTypes.touchMove:this._scrollByDistance(f.point);
break;
case Y.Squarespace.TouchEventListener.ActionTypes.touchEnd:this._finishScroll(f.point);
break
}}}}},_handleAnchors:function(d){if(d.getAttribute("target").match(/_blank/)){window.open(d.getAttribute("href"))
}else{window.location.href=d.getAttribute("href")
}},_handlePanning:function(h){if(!h.targetEl.get("tagName").match(/img/i)){return
}if(h.touchEvent.touches.length>1){this.prevScale=this.prevScale||1;
this.touchScale=this.prevScale*h.touchEvent.scale;
if(this.touchScale>=1){this.touchZoom=true;
h.targetEl.setStyles({webkitTransform:"scale3d("+this.touchScale+","+this.touchScale+",1)"});
var g=h.targetEl.getAttribute("src").split("?format=");
if(g.length>1){h.targetEl.setAttribute("src",g[0])
}}else{this.touchZoom=false;
this.touchStartPoint=null;
h.targetEl.setStyles({webkitTransform:"scale3d(1,1,1)",left:null,top:null});
ImageLoader.load(h.targetEl,{load:true})
}}else{if(h.action==Y.Squarespace.TouchEventListener.ActionTypes.tapped){Y.fire("transition:scroll:tapped",h)
}else{if(this.touchZoom&&h.action==Y.Squarespace.TouchEventListener.ActionTypes.touchStart){this.touchStartPoint=h.point;
h.targetEl.setAttribute("original-left",h.targetEl.getStyle("left"));
h.targetEl.setAttribute("original-top",h.targetEl.getStyle("top"))
}else{if(h.action==Y.Squarespace.TouchEventListener.ActionTypes.touchMove){var i=h.targetEl,e=this.touchStartPoint.x-h.point.x,d=this.touchStartPoint.y-h.point.y,j=parseInt(i.getAttribute("original-left"),10),f=parseInt(i.getAttribute("original-top"),10);
i.setStyles({left:j-e+"px",top:f-d+"px"})
}else{if(h.action==Y.Squarespace.TouchEventListener.ActionTypes.touchEnd){this.prevScale=this.touchScale||1
}}}}}},_scrollByDistance:function(f){if(this.haltSliding||!this.touchStartPoint||this.slides.size()<2){return
}var e=this.get("host").get("host"),g=e.get("slides"),d=e.get("currentIndex"),i=0,h={},j={opacity:1};
if(this.get("direction")=="vertical"){i=this.touchStartPoint.y-f.y
}else{i=this.touchStartPoint.x-f.x
}e.set("inMotion",true);
this.touchState.from=g.item(d);
this._adjustPosition(this.touchState.from,-i);
if(i>0){if(d<g.size()-1){this.touchState.to=g.item(d+1)
}else{if(e.get("loop")){this.touchState.to=g.item(0)
}else{this.touchState.to=null;
this.haltSliding=true;
e.set("inMotion",false);
Y.fire("transition:scroll:reached-end");
return
}}this._adjustPosition(this.touchState.to,this._getContainerDim()-i)
}else{if(d>0){this.touchState.to=g.item(d-1)
}else{if(e.get("loop")&&d==0){this.touchState.to=g.item(g.size()-1)
}else{this.touchState.to=null;
this.haltSliding=true;
e.set("inMotion",false);
Y.fire("transition:scroll:reached-beginning");
return
}}this._adjustPosition(this.touchState.to,-this._getContainerDim()-i)
}this.touchState.from.setStyles(h);
this.touchState.to.setStyles(j)
},_finishScroll:function(e){this.haltSliding=false;
if(!this.touchState.to||!this.touchStartPoint||this.slides.size()<2){return
}var d=this.get("host").get("host"),g=0,h={},f={};
if(this.get("direction")=="vertical"){g=this.touchStartPoint.y-e.y
}else{g=this.touchStartPoint.x-e.x
}this._adjustPosition(this.touchState.to,0,null,true);
this._adjustPosition(this.touchState.from,this._getContainerDim()*(g>0?-1:1),null,true);
d.set("inMotion",false);
this.skipTransition=true;
d.set("currentIndex",d.get("slides").indexOf(this.touchState.to),{direction:(g>0?1:-1)});
this.skipTransition=false;
this.touchState.to=null
},_adjustPosition:function(f,e,j,i){var d={},g=this.get("direction"),h=false;
if(h){d.transform=g=="vertical"?"translate3d(0,"+e+"px,0)":"translate3d("+e+"px,0,0)"
}else{d[g=="vertical"?"top":"left"]=e
}if(j){if(h){f.setStyle("transform",g=="vertical"?"translate3d(0,"+j+"px,0)":"translate3d("+j+"px,0,0)")
}else{f.setStyle(g=="vertical"?"top":"left",j)
}}if(i){if(h){f.transition({duration:0.3,transform:d.transform})
}else{this._anim(f,d,{duration:0.6,easing:this.get("host").get("easing")}).run()
}}else{f.setStyles(d)
}}},{NS:"gallery-stacked-transition",CONTAINER_CLASS:"sqs-gallery-design-stacked-scrollHorz",ATTRS:{direction:{value:"horizontal"},preventDefaultTouchEvents:{value:true}}});
Y.Squarespace.Lightbox2Overlay=Y.Base.create("LightboxOverlay",Y.Squarespace.Widgets.Gismo,[],{renderUI:function(){this._overlayEl=Y.Node.create('<div class="sqs-lightbox-overlay sqs-lightbox-overlay-'+this.get("overlayStyle")+'"></div>');
this.get("contentBox").appendChild(this._overlayEl);
this.get("contentBox").plug(Y.Squarespace.ScrollLock);
this.show()
},show:function(){this._overlayEl.setStyles({zIndex:"10000000"});
var d=this._anim(this._overlayEl,{opacity:this.get("opacity")},{duration:this.get("speed")});
d.on("end",function(){this.fire("shown")
},this);
d.run()
},overlayHideAndDestroy:function(){this.once("hidden",this.destroy,this);
this._hide()
},_hide:function(){this.fire("hide");
var d=this._anim(this._overlayEl,{opacity:0},{duration:this.get("speed")});
d.on("end",function(){this.fire("hidden")
},this);
if(this.get("destroyed")){this.fire("hidden")
}else{d.run()
}},_getContainer:function(){return this._overlayEl
}},{NS:"overlay",ATTRS:{opacity:{value:0.95},overlayStyle:{value:"default"},container:{getter:"_getContainer"},speed:{value:0.3}}});
Y.Squarespace.Lightbox2=Y.Base.create("Lightbox2",Y.Squarespace.Widgets.Gismo,[],{initializer:function(){window.ACTIVE_LIGHTBOX=this;
this._overlay=new Y.Squarespace.Lightbox2Overlay();
this._overlay.on("hide",this.hideAndDestroy,this);
this.resizeEmitter=new Y.Squarespace.ResizeEmitter({timeout:100})
},destructor:function(){this._flushEvents();
this._slideshow&&this._slideshow.destroy();
this._overlay.destroy();
Y.one("body").removeClass("sqs-lightbox-open")
},renderUI:function(){Y.Squarespace.Lightbox2.superclass.renderUI.call(this);
Y.one("body").addClass("sqs-lightbox-open");
var d=this.get("contentBox");
this._overlay.render(d);
if(this.get("set").length>0){if(!Modernizr.touch&&this.get("controls.previous")){this._previousEl=Y.Node.create('<a class="sqs-lightbox-previous"></a>');
d.appendChild(this._previousEl)
}if(!Modernizr.touch&&this.get("controls.next")){this._nextEl=Y.Node.create('<a class="sqs-lightbox-next"></a>');
d.appendChild(this._nextEl)
}}else{this.set("set",[{content:this.get("content"),meta:this.get("meta")}])
}this._slideshow=this.createSlideshow(d);
this._lightboxContentEl=this._slideshow.get("container");
this._closeEl=Y.Node.create('<a class="sqs-lightbox-close">&times;</a>').appendTo(d).hide();
if(Modernizr.touch){this._overlay.get("container").setStyle("height",Math.max(Y.one("body").get("docHeight"),Y.one("body").get("winHeight")));
this._metaTriggerEl=Y.Node.create('<a class="sqs-lightbox-meta-trigger">&bull;</a>').appendTo(d)
}this._lightboxContentEl.plug(Y.Squarespace.Animations.Scalable);
this._lightboxContentEl.once("shown",function(){this._lightboxContentEl.setStyles({transform:null})
},this);
this._overlay.once("shown",function(){Y.Squarespace.EscManager.addTarget(this);
this._lightboxContentEl.show();
this._closeEl&&this._closeEl.show();
var e=this._slideshow.get("slides").item(this._slideshow.get("currentIndex")).one(".sqs-video-wrapper");
if(e){e.videoloader.showVideo()
}},this);
d.plug(Y.Squarespace.ScrollLock)
},bindUI:function(){Y.Squarespace.Lightbox2.superclass.bindUI.call(this);
this._slideshow.after("refresh",this.syncUI,this);
this._slideshow.after("currentIndexChange",Y.bind(function(f){this.set("currentSetIndex",f.newVal);
this.syncUI()
},this));
if(this._closeEl){this._event(this._closeEl.on("click",function(f){f.halt();
this.hideAndDestroy(true)
},this))
}if(this._metaTriggerEl){this._event(this._metaTriggerEl.on("click",function(){this.toggleMeta()
},this),"meta-trigger")
}if(this._previousEl){this._event(this._previousEl.on("click",function(f){f.halt();
this.previous()
},this),"previous-click");
var d=Y.throttle(Y.bind(this.previous,this),200);
this._event(Y.on("key",function(f){f.halt();
d()
},window,"down:37",this),"keyboard")
}if(this._nextEl){this._event(this._nextEl.on("click",function(f){f.halt();
this.next()
},this),"next-click");
var e=Y.throttle(Y.bind(this.next,this),200);
this._event(Y.on("key",function(f){f.halt();
e()
},window,"down:39",this),"keyboard");
if(!Modernizr.touch){this.setupNavigationFade()
}}this._event(this.get("contentBox").on("click",this.onContentBoxClick,this));
this._event(Y.on("transition:scroll:tapped",function(f){this.onContentBoxClick(f.touchEvent)
},this))
},onContentBoxClick:function(g){if(!g.target.ancestor("a",true)){g.halt();
if(g.target.ancestor(".sqs-video-wrapper")){g.target.ancestor(".sqs-video-wrapper").videoloader.showVideo();
return
}if(!Modernizr.touch){var f=Y.one("body").get("winWidth"),d=Y.one("body").get("winHeight"),h=parseInt(Y.one(this._slideshow._currentSlide().one(".sqs-lightbox-padder")).getStyle("top"),10)*0.01;
if(g.clientX>f*h&&g.clientX<f*(1-h)&&g.clientY>d*h&&g.clientY<d*(1-h)){if(g.clientX>=f/2&&this._nextEl){this.next();
return
}else{if(g.clientX<Y.one("body").get("winWidth")/2&&this._previousEl){this.previous();
return
}}}}this.hideAndDestroy(true)
}else{g.stopImmediatePropagation()
}},syncUI:function(f){if(!f){f=this._slideshow._currentSlide()
}this.get("contentBox").setStyle("top",Y.one((Y.UA.gecko||Y.UA.ie)?"html":"body").get("scrollTop"));
var e=f.one(".sqs-lightbox-meta")||this.createMetaEl(f);
if(e){this._metaTriggerEl&&this._metaTriggerEl.show();
if(!Modernizr.touch){var d=f.one(".sqs-lightbox-padder").get("children").item(0);
e.setStyles({bottom:d.getStyle("top"),left:d.getStyle("left"),right:d.getStyle("left")})
}else{e.appendTo(f);
e.setStyles({bottom:this.bMetaEnabled?0:"-5000px",left:0,right:0});
e.addClass("overlay-description-visible")
}}else{this._metaTriggerEl&&this._metaTriggerEl.hide()
}},previous:function(){this._slideshow.previousSlide()
},next:function(){this._slideshow.nextSlide()
},close:function(){this.hideAndDestroy()
},toggleMeta:function(){this.get("contentBox").all(".sqs-lightbox-meta").each(Y.bind(function(d){this.bMetaEnabled=parseInt(d.getStyle("bottom"),10)===0?true:false;
this._anim(d,{bottom:this.bMetaEnabled?"-5000px":"0"},{duration:this.get("speed")}).run();
this.bMetaEnabled=!this.bMetaEnabled
},this))
},hideAndDestroy:function(d){if(Y.Lang.isBoolean(d)&&d){this._overlay.overlayHideAndDestroy()
}else{this.once("hidden",this.destroy);
this.hide()
}},hide:function(){var d=this._anim(this.get("contentBox"),{opacity:0},{duration:this.get("speed")});
d.once("end",function(){Y.Squarespace.EscManager.removeTarget(this);
this.fire("hidden")
},this);
if(this.get("destroyed")){d.fire("end")
}else{d.run()
}},setupNavigationFade:function(){var f,d=function(){if(f){f.cancel()
}},e=function(g){d();
if(g&&g.inViewportRegion()){g.addClass("mouseover").siblings().removeClass("mouseover");
f=Y.later(500,this,function(){if(g&&g.inViewportRegion()){g.removeClass("mouseover")
}})
}};
this._event(this._nextEl.on("mouseenter",function(){d()
}),"nav-next-onmouse");
this._event(this._previousEl.on("mouseenter",function(){d()
}),"nav-prev-onmouse");
this._event(this._lightboxContentEl.on("mousemove",Y.bind(function(g){if(g.clientX<this._lightboxContentEl.width()/2){e(this._previousEl)
}else{e(this._nextEl)
}},this)),"container-hovering")
},createSlideshow:function(f){var g=Y.Node.create('<div class="sqs-lightbox-slideshow"></div>').appendTo(f);
var e=this.get("set");
for(var j=0;
j<e.length;
j++){var d=Y.Node.create('<div class="sqs-lightbox-slide"></div>').appendTo(g),l=Y.Node.create('<div class="sqs-lightbox-padder content-fit"></div>').appendTo(d),k=Y.one(e[j].content.cloneNode(true)).appendTo(l).setAttribute("data-image-stretch","false").setStyle("opacity",null)
}var h=new Y.Squarespace.Gallery2({container:g,currentIndex:this.get("currentSetIndex"),loop:true,autoplay:false,refreshOnResize:true,refreshOnOrientationChange:true,design:"stacked",keyboard:false,designOptions:{clickBehavior:false,easing:Y.Easing.easeInOutExpo,speed:0.3,autoHeight:false,transition:"scroll",transitionOptions:{direction:"horizontal"},preloadCount:1},lazyLoad:true});
return h
},createMetaEl:function(f){f=f.one(".sqs-lightbox-padder");
var e=this.getCurrentElMeta();
if(e){var d=Y.Node.create('<div class="sqs-lightbox-meta"></div>');
d.appendChild(e);
f.appendChild(d);
if(!Modernizr.touch){this._event(f.one(":first-child").on("mouseenter",function(){d.addClass("overlay-description-visible")
},this),"meta-hovering");
this._event(f.one(":first-child").on("mouseleave",function(){d.removeClass("overlay-description-visible")
},this),"meta-hovering");
this._event(d.on("mouseenter",function(){d.addClass("overlay-description-visible")
},this),"meta-hovering");
this._event(d.on("mouseleave",function(){d.removeClass("overlay-description-visible")
},this),"meta-hovering")
}return d
}},getCurrentElContent:function(){if(this.get("set").length>0){return this.get("set")[this.get("currentSetIndex")].content
}else{return this.get("content")
}},getCurrentElMeta:function(){if(this.get("set").length>0){return this.get("set")[this.get("currentSetIndex")].meta
}else{return this.get("meta")
}}},{NS:"lightbox2",ATTRS:{content:{},controls:{value:{previous:false,next:false}},currentSetIndex:{value:0},meta:{},padding:{value:100},set:{value:[]},speed:{value:0.3}}});
Y.Squarespace.Lightbox2Plug=Y.Base.create("Lightbox2Plug",Y.Plugin.Base,[Y.Squarespace.GismoBase],{initializer:function(){this._event(this.get("host").on("click",function(f){f.preventDefault();
var d=this;
Y.use("squarespace-ui-base",function(){var e=new Y.Squarespace.Lightbox2(Y.merge({content:Y.Node.create(d.get("host").getAttribute("data-lightbox"))},d.get("lightboxOptions")));
e.render()
})
},this))
}},{NS:"lightbox2plugin",ATTRS:{lightboxOptions:{}}});
Y.Squarespace.GalleryManager=Singleton.create({ready:function(){this._galleries=[];
this._debugger=new Y.Squarespace.Debugger({name:"Gallery Manager",output:false})
},registerGallery:function(d){this._galleries.push(d)
},getGalleries:function(){return this._galleries
},initializeBlock:function(g){var k=g.getAttribute("data-block-json");
var n;
if(k){try{n=JSON.parse(k)
}catch(o){this._debugger.error("Error decoding gallery block data.");
return
}}else{n=g.getAncestorData("block").value
}if(!n){throw"Error evaluating gallery block data."
}var f;
switch(n.design){case"stacked":f="base";
break;
case"slider":f="strip";
break;
case"slideshow":f="stacked";
break;
case"grid":f="grid";
break;
default:f="base";
break
}var d=g.one(".sqs-gallery-container");
if(!d){this._debugger.warn("Returning, no wrapper found.");
return
}if(["grid","stacked"].indexOf(f)!==-1){d.ancestor(".sqs-block").removeClass("vsize-"+n.vSize)
}var r;
if(!d.one(".sqs-gallery").getData("gallery")){var h={};
if(["grid","stacked"].indexOf(f)!==-1){h.autoHeight=true;
h.enableSimpleCaption=true
}if(f=="strip"){var p;
switch(n["active-alignment"]){case"left":p="start";
break;
case"center":p="middle";
break;
case"right":p="end";
break;
default:p="middle";
break
}h.alignment=p
}if(f=="grid"){h.lightbox=Static.IN_BACKEND?false:n.lightbox;
h.perRow=parseInt(n["thumbnails-per-row"],10)
}var l=(f==="grid")?false:true;
this._debugger.log("Initialize Block",n);
d.setData("galleryOptions",n);
r=new Y.Squarespace.Gallery2({containerWrapper:d,container:d.one(".sqs-gallery"),elements:{previous:d.one(".sqs-gallery-controls .previous"),next:d.one(".sqs-gallery-controls .next")},design:f,designOptions:h,loaderOptions:{canvas:false},keyboard:l,lazyLoad:true,autoplay:n.autoplay,loop:true,refreshOnResize:true});
if(n["autoplay-duration"]){var j=parseInt(n["autoplay-duration"]*1000,10);
if(r.get("autoplayOptions.timeout")!=j){r.set("autoplayOptions.timeout",j)
}}}else{this._debugger.log("Refreshing gallery.");
r=d.one(".sqs-gallery").getData("gallery");
r.refresh()
}var m=d.one(".sqs-gallery-thumbnails");
if(m){if(f==="stacked"&&!!n.thumbnails){var q=n["thumbnail-strip-height"];
m.all(".sqs-video-thumbnail").each(function(e){if(e.hasClass("no-image")){e.one(".sqs-video-thumbnail-inner").setStyles({width:Math.floor(q*(16/9))+"px"})
}var s=e.one("img");
if(s){s.once("load",function(){e.removeClass("loading");
e.setAttribute("style","width: "+s.get("offsetWidth")+"px !important")
})
}});
m.setStyles({height:q,marginTop:n["thumbnail-strip-margin"]});
var i;
if(!m.getData("gallery")){i=new Y.Squarespace.Gallery2({container:m,elements:{},loop:true,design:"strip",designOptions:{activeSlideClickBehavior:false,preloadCount:Math.ceil(r.get("container").get("offsetWidth")/q)},lazyLoad:true,loaderOptions:{canvas:false},refreshOnResize:true});
r.addChild(i)
}else{this._debugger.log("Refresh thumbnails.");
i=m.getData("gallery");
i.refresh()
}}}},refreshAll:function(){Y.Array.each(this._galleries,function(d){d.refresh()
})
}})
},"1.0",{requires:["base","plugin","squarespace-ss-widget","squarespace-gismo","squarespace-animations","node","event-key","squarespace-image-loader","squarespace-common","history","yui-throttle","squarespace-gallery-ng-css","squarespace-debugger","event-mouseenter","squarespace-touch-event-listener","squarespace-video-loader"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-census",function(b){var a=function(){};
var c=b.namespace("Squarespace").Census={hit:function(){if(!Static.SQUARESPACE_CONTEXT.authenticatedAccount){if(Static.SQUARESPACE_CONTEXT.itemId){c.view("item",Static.SQUARESPACE_CONTEXT.itemId)
}else{if(Static.SQUARESPACE_CONTEXT.collectionId){c.view("collection",Static.SQUARESPACE_CONTEXT.collectionId)
}else{console.warn("Census: Hit not recorded, somehow not an item or collection.")
}}}},view:function(d,f){var e={url:window.location.pathname,viewportInnerHeight:b.DOM.winHeight(),viewportInnerWidth:b.DOM.winWidth(),screenHeight:window.screen.height,screenWidth:window.screen.width,userAgent:b.UA.userAgent,referrer:window.document.referrer};
if(d==="item"){e.itemId=f
}else{if(d==="collection"){e.collectionId=f
}}c.track(b.Squarespace.Events.VIEW,e)
},track:function(d,e){if(!b.Lang.isObject(e)){e={}
}if(Static.SQUARESPACE_CONTEXT.website){e.websiteId=Static.SQUARESPACE_CONTEXT.website.id
}if(Static.SQUARESPACE_CONTEXT.templateId){e.templateId=Static.SQUARESPACE_CONTEXT.templateId
}if(!b.Squarespace.Utils.isProductionEnvironment()){b.Data.post({url:"/api/census/RecordHit",data:{event:d,data:e},success:a,failure:a})
}}}
},"1.0",{requires:["base","dom-base","io","json-stringify"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-comment-data",function(a){a.namespace("Squarespace");
a.Squarespace.CommentData=Class.create({initialize:function(b){if(b===undefined){throw new Error("You must provide a configuration object.")
}else{if(b.target===undefined){throw new Error("You must provide a target id.")
}else{if(b.targetType===undefined){throw new Error("You must provide a target type.")
}}}this.settings=(b.settings||{approvalRequired:false,allowAnon:true,threaded:true});
this.formatter=(b.formatter||function(c){return c
});
this.page=1;
this.data={comments:[]};
this.topLevelComments=0;
this.visibleComments=0;
this.totalComments=(Static.SQUARESPACE_CONTEXT.item?Static.SQUARESPACE_CONTEXT.item.publicCommentCount:(Static.SQUARESPACE_CONTEXT.collection?Static.SQUARESPACE_CONTEXT.collection.publicCommentCount:0));
this.commentsPerPage=50;
this.target=b.target;
this.targetType=b.targetType;
this.idToIndex={};
this.comments=[];
this.likeMap={};
this.flagMap={};
this.formatted={};
this.currentThreadRoot="";
this.formattedThread={};
this.pageIntervals=[]
},useSecure:function(){return(window.SQUARESPACE_LOGIN&&window.SQUARESPACE_LOGIN.isLoggedIn())
},getCommentById:function(b){return this.comments[this.idToIndex[b]]
},removeCommentById:function(c){var b=this.idToIndex[c];
if(!a.Lang.isUndefined(b)){this.comments.splice(b,1);
this.calculatePagination()
}},removeCommentsByIds:function(b){b.forEach(function(d){var c=this.idToIndex[d];
if(!a.Lang.isUndefined(c)){this.comments.splice(c,1);
this.visibleComments-=1;
this.totalComments-=1
}},this);
this.calculatePagination()
},getFormattedPage:function(c){var b=this.pageIntervals[c-1];
if(b){return Array.prototype.slice.apply(this.comments,b)
}else{return null
}},fullBookkeeping:function(d){var c=0,e={},b={};
this.comments=[];
this.pageIntervals=[];
this.idToIndex={};
for(c=0;
c<d.comments.length;
c++){e=d.comments[c];
this.idToIndex[e.id]=c;
this.comments[c]=e
}this.pageIntervals.push([0,undefined]);
this.flagMap=d.flagMap;
this.likeMap=d.likeMap;
this.commentSettings=d.commentSettings;
this.visibleComments=d.visibleComments;
this.topLevelComments=(this.formatted.topLevelComments||this.topLevelComments);
this.totalComments=(d.totalComments?d.totalComments:this.totalComments);
this.reformat();
this.topLevelComments=d.topLevelComments;
this.numLikes=d.numLikes;
this.numPages=Math.ceil(this.topLevelComments/this.commentsPerPage)
},addCommentData:function(b){this.comments.splice((this.idToIndex[b.parentId]||-1)+1,0,b);
this.calculatePagination()
},calculatePagination:function(){var b=50,e=0,d,f,c;
this.idToIndex={};
this.pageIntervals=[[0,undefined]];
for(c=0;
c<this.comments.length;
c++){f=this.comments[c];
this.idToIndex[f.id]=c;
if(!f.parentId){e+=1;
if(e>b){d=this.pageIntervals[this.pageIntervals.length-1];
d[1]=e-1;
this.pageIntervals.push([d[1],undefined]);
e=0
}}}},appendBookkeeping:function(d){var c=0,b={},e={};
this.pageIntervals[this.pageIntervals.length-1][1]=this.comments.length;
for(c=0;
c<d.comments.length;
c++){e=d.comments[c];
this.idToIndex[e.id]=(this.comments.length+1);
this.comments.push(e)
}this.pageIntervals.push([this.pageIntervals[this.pageIntervals.length-1][1],undefined]);
this.likeMap=a.merge(this.likeMap,d.likeMap);
this.flagMap=a.merge(this.flagMap,d.flagMap);
this.visibleComments+=d.visibleComments;
this.reformat()
},reformat:function(){this.formatted=this.formatter(this.comments,this.likeMap,this.flagMap)
},like:function(c,d){var e=function(f){var g=this.getCommentById(c.id);
if(g){g.likeCount+=1;
this.reformat()
}(c.success||noop).call((d||this),f)
},b=function(f){(c.failure||noop).call((d||this),f)
};
a.Data.post({url:"/api/comment/LikeComment",secure:true,data:{commentId:c.id},success:e,failure:b},this)
},unlike:function(b,c){var d=function(e){var f=this.getCommentById(b.id);
if(f){f.likeCount=Math.max(f.likeCount-1,0);
this.reformat()
}(b.success||noop).call((c||this),e)
};
a.Data.post({url:"/api/comment/UnlikeComment",secure:true,data:{commentId:b.id},success:d,failure:b.failure},this)
},flag:function(c,d){var e=function(f){var g=this.getCommentById(c.id);
if(g){g.flagCount+=1;
this.reformat()
}(c.success||noop).call((d||this),f)
},b=function(f){(c.failure||noop).call((d||this),f)
};
a.Data.post({url:"/api/comment/FlagComment",secure:true,data:{commentId:c.id},success:e,failure:b},this)
},_delete:function(b,c){var d=function(e){b.comments.forEach(function(f){this.removeCommentById(f.id)
},this);
this.visibleComments-=b.comments.length;
this.totalComments-=b.comments.length;
(b.success||noop).call((c||this),e)
};
a.Data.post({url:"/api/comment/admin/DeleteComment",secure:true,data:{markAsSpam:b.spam,comments:(a.Lang.isArray(b.comments)?b.comments:[b.comments])},success:d,failure:(b.failure?a.bind(b.failure,(c||this)):undefined)},this)
},approve:function(b,c){var d=function(e){b.comments.forEach(function(g){var f=this.getCommentById(g.id);
if(f){f.status=a.Squarespace.CommentStatuses.APPROVED
}},this);
this.totalComments+=1;
(b.success||noop).call((c||this),e)
};
a.Data.post({url:"/api/comment/admin/ApproveComments",secure:true,data:{comments:(a.Lang.isArray(b.comments)?b.comments:[b.comments])},success:d,failure:(b.failure?a.bind(b.failure,(c||this)):undefined)},this)
},unflag:function(c,d){var e=function(f){var g=this.getCommentById(c.id);
if(g){g.flagCount=Math.max(g.flagCount-1,0);
this.reformat()
}(c.success||noop).call((d||this),f)
},b=function(f){(c.failure||noop).call((d||this),f)
};
a.Data.post({url:"/api/comment/UnflagComment",secure:true,data:{commentId:c.id},success:e,failure:b},this)
},post:function(b,c){var e={targetId:this.target,targetType:this.targetType,body:b.body,replyToId:b.replyTo,authorName:(a.Squarespace.Escaping.escapeForHtml(b.name)||""),authorEmail:(b.email||""),authorUrl:(b.authorUrl||"")},d=function(f){if(f.comment.status===a.Squarespace.CommentStatuses.APPROVED){this.addCommentData(f.comment);
this.visibleComments+=1;
this.totalComments+=1;
if(!b.replyTo){this.topLevelComments+=1
}this.reformat()
}(b.success||noop).call((c||this),f)
};
a.Data.post({url:"/api/comment/CreateComment",secure:true,data:e,success:d,failure:(b.failure?a.bind(b.failure,(c||this)):undefined)},this)
},getPage:function(b,d,c){if(d<=this.numPages){this.get({sortBy:b.order,page:d,success:b.success,failure:b.failure},c)
}},getSince:function(b,d,c){this.get({since:d,success:b.success,failure:b.failure},c)
},getThread:function(c,d){var e=function(g){this.currentThreadRoot=c.commentId;
var f=g.comments[0].comment.depth;
g.comments=a.Array.map(g.comments,function(h){return h.comment
});
g.comments.forEach(function(h){h.depth=(h.depth-f)
});
this.formattedThread=this.formatter(g.comments,{},{});
if(a.Lang.isFunction(c.success)){c.success.call((d||this),g)
}},b=function(f){if(a.Lang.isFunction(c.failure)){c.failure.call((d||this),f)
}};
a.Data.get({url:"/api/comment/GetThread",secure:this.useSecure(),data:{sortBy:c.order,commentId:c.commentId},success:e,failure:b},this)
},get:function(b,c){var d=function(e){this.page=b.page;
if(b.page<=1){this.fullBookkeeping(e)
}else{if(b.page>1){this.appendBookkeeping(e)
}}if(b.success){b.success.call((c||this),e)
}};
a.Data.get({url:"/api/comment/GetComments",secure:this.useSecure(),data:{targetId:this.target,targetType:this.targetType,since:(b.since||""),page:b.page,sortBy:b.order},success:d,failure:b.failure},this)
},getLikesAndFlags:function(b,c){var d=a.Array.map(this.comments,function(f){return f.id
}),e;
a.Data.post({url:"/api/comment/GetLikesFlags",secure:this.useSecure(),data:{ids:d},success:function(f){if(b.success&&a.Lang.isFunction(b.success)){b.success.call((c||this),f)
}},failure:function(f){if(b.failure&&a.Lang.isFunction(b.failure)){b.failure.call((c||this),f)
}}})
}})
},"1.0",{requires:["squarespace-util"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
(function(){var b={};
b.converter=function(){var an;
var ae;
var W;
var af=0;
this.makeHtml=function(c){an=new Array();
ae=new Array();
W=new Array();
c=c.replace(/~/g,"~T");
c=c.replace(/\$/g,"~D");
c=c.replace(/\r\n/g,"\n");
c=c.replace(/\r/g,"\n");
c="\n\n"+c+"\n\n";
c=Y(c);
c=c.replace(/^[ \t]+$/mg,"");
c=ab(c);
c=ak(c);
c=L(c);
c=U(c);
c=c.replace(/~D/g,"$$");
c=c.replace(/~T/g,"~");
return c
};
var ak=function(c){var c=c.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(d,g,h,e,f){g=g.toLowerCase();
an[g]=ag(h);
if(e){return e+f
}else{if(f){ae[g]=f.replace(/"/g,"&quot;")
}}return""
});
return c
};
var ab=function(c){c=c.replace(/\n/g,"\n\n");
var d="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del";
var e="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";
c=c.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,I);
c=c.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,I);
c=c.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,I);
c=c.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,I);
c=c.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,I);
c=c.replace(/\n\n/g,"\n");
return c
};
var I=function(e,d){var c=d;
c=c.replace(/\n\n/g,"\n");
c=c.replace(/^\n/,"");
c=c.replace(/\n+$/g,"");
c="\n\n~K"+(W.push(c)-1)+"K\n\n";
return c
};
var L=function(c){c=ai(c);
var d=Z("<hr />");
c=c.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,d);
c=c.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,d);
c=c.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,d);
c=O(c);
c=am(c);
c=M(c);
c=ab(c);
c=ah(c);
return c
};
var T=function(c){c=S(c);
c=ac(c);
c=aj(c);
c=N(c);
c=a(c);
c=aa(c);
c=ag(c);
c=al(c);
c=c.replace(/  +\n/g," <br />\n");
return c
};
var ac=function(c){var d=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;
c=c.replace(d,function(e){var f=e.replace(/(.)<\/?code>(?=.)/g,"$1`");
f=J(f,"\\`*_");
return f
});
return c
};
var a=function(c){c=c.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,R);
c=c.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,R);
c=c.replace(/(\[([^\[\]]+)\])()()()()()/g,R);
return c
};
var R=function(j,d,e,f,g,h,k,l){if(l==undefined){l=""
}var m=d;
var o=e;
var n=f.toLowerCase();
var p=g;
var i=l;
if(p==""){if(n==""){n=o.toLowerCase().replace(/ ?\n/g," ")
}p="#"+n;
if(an[n]!=undefined){p=an[n];
if(ae[n]!=undefined){i=ae[n]
}}else{if(m.search(/\(\s*\)$/m)>-1){p=""
}else{return m
}}}p=J(p,"*_");
var c='<a href="'+p+'"';
if(i!=""){i=i.replace(/"/g,"&quot;");
i=J(i,"*_");
c+=' title="'+i+'"'
}c+=">"+o+"</a>";
return c
};
var N=function(c){c=c.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,P);
c=c.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,P);
return c
};
var P=function(j,d,e,f,g,h,k,l){var m=d;
var n=e;
var o=f.toLowerCase();
var p=g;
var i=l;
if(!i){i=""
}if(p==""){if(o==""){o=n.toLowerCase().replace(/ ?\n/g," ")
}p="#"+o;
if(an[o]!=undefined){p=an[o];
if(ae[o]!=undefined){i=ae[o]
}}else{return m
}}n=n.replace(/"/g,"&quot;");
p=J(p,"*_");
var c='<img src="'+p+'" alt="'+n+'"';
i=i.replace(/"/g,"&quot;");
i=J(i,"*_");
c+=' title="'+i+'"';
c+=" />";
return c
};
var ai=function(c){c=c.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(f,e){return Z('<h1 id="'+d(e)+'">'+T(e)+"</h1>")
});
c=c.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,f){return Z('<h2 id="'+d(f)+'">'+T(f)+"</h2>")
});
c=c.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(f,g,h){var e=g.length;
return Z("<h"+e+' id="'+d(h)+'">'+T(h)+"</h"+e+">")
});
function d(e){return e.replace(/[^\w]/g,"").toLowerCase()
}return c
};
var X;
var O=function(c){c+="~0";
var d=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;
if(af){c=c.replace(d,function(e,h,i){var g=h;
var j=(i.search(/[*+-]/g)>-1)?"ul":"ol";
g=g.replace(/\n{2,}/g,"\n\n\n");
var f=X(g);
f=f.replace(/\s+$/,"");
f="<"+j+">"+f+"</"+j+">\n";
return f
})
}else{d=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g;
c=c.replace(d,function(l,h,j,e){var i=h;
var g=j;
var k=(e.search(/[*+-]/g)>-1)?"ul":"ol";
var g=g.replace(/\n{2,}/g,"\n\n\n");
var f=X(g);
f=i+"<"+k+">\n"+f+"</"+k+">\n";
return f
})
}c=c.replace(/~0/,"");
return c
};
X=function(c){af++;
c=c.replace(/\n{2,}$/,"\n");
c+="~0";
c=c.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(d,j,k,e,f){var h=f;
var i=j;
var g=k;
if(i||(h.search(/\n{2,}/)>-1)){h=L(Q(h))
}else{h=O(Q(h));
h=h.replace(/\n$/,"");
h=T(h)
}return"<li>"+h+"</li>\n"
});
c=c.replace(/~0/g,"");
af--;
return c
};
var am=function(c){c+="~0";
c=c.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(f,d,e){var h=d;
var g=e;
h=K(Q(h));
h=Y(h);
h=h.replace(/^\n+/g,"");
h=h.replace(/\n+$/g,"");
h="<pre><code>"+h+"\n</code></pre>";
return Z(h)+g
});
c=c.replace(/~0/,"");
return c
};
var Z=function(c){c=c.replace(/(^\n+|\n+$)/g,"");
return"\n\n~K"+(W.push(c)-1)+"K\n\n"
};
var S=function(c){c=c.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(d,h,i,e,f){var g=e;
g=g.replace(/^([ \t]*)/g,"");
g=g.replace(/[ \t]*$/g,"");
g=K(g);
return h+"<code>"+g+"</code>"
});
return c
};
var K=function(c){c=c.replace(/&/g,"&amp;");
c=c.replace(/</g,"&lt;");
c=c.replace(/>/g,"&gt;");
c=J(c,"*_{}[]\\",false);
return c
};
var al=function(c){c=c.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>");
c=c.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>");
return c
};
var M=function(c){c=c.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(f,e){var d=e;
d=d.replace(/^[ \t]*>[ \t]?/gm,"~0");
d=d.replace(/~0/g,"");
d=d.replace(/^[ \t]+$/gm,"");
d=L(d);
d=d.replace(/(^|\n)/g,"$1  ");
d=d.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(i,h){var g=h;
g=g.replace(/^  /mg,"~0");
g=g.replace(/~0/g,"");
return g
});
return Z("<blockquote>\n"+d+"\n</blockquote>")
});
return c
};
var ah=function(g){g=g.replace(/^\n+/g,"");
g=g.replace(/\n+$/g,"");
var h=g.split(/\n{2,}/g);
var d=new Array();
var f=h.length;
for(var e=0;
e<f;
e++){var i=h[e];
if(i.search(/~K(\d+)K/g)>=0){d.push(i)
}else{if(i.search(/\S/)>=0){i=T(i);
i=i.replace(/^([ \t]*)/g,"<p>");
i+="</p>";
d.push(i)
}}}f=d.length;
for(var e=0;
e<f;
e++){while(d[e].search(/~K(\d+)K/)>=0){var c=W[RegExp.$1];
c=c.replace(/\$/g,"$$$$");
d[e]=d[e].replace(/~K\d+K/,c)
}}return d.join("\n\n")
};
var ag=function(c){c=c.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;");
c=c.replace(/<(?![a-z\/?\$!])/gi,"&lt;");
return c
};
var aj=function(c){c=c.replace(/\\(\\)/g,ad);
c=c.replace(/\\([`*_{}\[\]()>#+-.!])/g,ad);
return c
};
var aa=function(c){c=c.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>');
c=c.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(e,d){return V(U(d))
});
return c
};
var V=function(c){function d(h){var f="0123456789ABCDEF";
var g=h.charCodeAt(0);
return(f.charAt(g>>4)+f.charAt(g&15))
}var e=[function(f){return"&#"+f.charCodeAt(0)+";"
},function(f){return"&#x"+d(f)+";"
},function(f){return f
}];
c="mailto:"+c;
c=c.replace(/./g,function(f){if(f=="@"){f=e[Math.floor(Math.random()*2)](f)
}else{if(f!=":"){var g=Math.random();
f=(g>0.9?e[2](f):g>0.45?e[1](f):e[0](f))
}}return f
});
c='<a href="'+c+'">'+c+"</a>";
c=c.replace(/">.+:/g,'">');
return c
};
var U=function(c){c=c.replace(/~E(\d+)E/g,function(f,d){var e=parseInt(d);
return String.fromCharCode(e)
});
return c
};
var Q=function(c){c=c.replace(/^(\t|[ ]{1,4})/gm,"~0");
c=c.replace(/~0/g,"");
return c
};
var Y=function(c){c=c.replace(/\t(?=\t)/g,"    ");
c=c.replace(/\t/g,"~A~B");
c=c.replace(/~B(.+?)~A/g,function(f,i,d){var g=i;
var e=4-g.length%4;
for(var h=0;
h<e;
h++){g+=" "
}return g
});
c=c.replace(/~A/g,"    ");
c=c.replace(/~B/g,"");
return c
};
var J=function(g,e,d){var f="(["+e.replace(/([\[\]\\])/g,"\\$1")+"])";
if(d){f="\\\\"+f
}var c=new RegExp(f,"g");
g=g.replace(c,ad);
return g
};
var ad=function(e,c){var d=c.charCodeAt(0);
return"~E"+d+"E"
}
};
YUI.add("squarespace-markdown",function(a){a.namespace("Squarespace");
a.Squarespace.Lang.markdownToHTML=function(h){if(!h){return""
}var f=new b.converter();
var g=f.makeHtml(h);
return g
}
},"1.0",{requires:["squarespace-util"]})
})();/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-dialog-field-legacy-interface",function(b){var a=b.namespace("Squarespace").DialogFieldLegacyInterface=function(c){this.inActiveFrame=true;
if(b.Lang.isFunction(this.hideError)){b.Do.after(function(){var d=c.dialog;
if(d){d.clearError(this)
}},this,"hideError",this)
}b.Do.after(function(){this.after(this.get("id")+"|dataChange",function(f){var d=c.dialog;
if(d){d.fire("datachange",this)
}var g=this.get("name");
if(g){this.fire("value-changed",{name:g,value:f.newVal,oldValue:f.prevVal,field:this})
}},this)
},this,"bindUI",this);
b.Do.after(function(){if(c&&c.defaultHidden){this.hide(true)
}},this,"syncUI",this)
};
a.NAME="dialogFieldLegacyInterface";
a.prototype={temporaryHide:function(){this.hide()
},temporaryShow:function(){this.show()
},getName:function(){return this.get("name")
},getType:function(){return this.name
},getValue:function(){return this.get("data")
},getErrors:function(){return this.get("errors")
},getNode:function(){return this.get("boundingBox")
},setValue:function(c){this.set("data",c)
},clearError:function(){this.hideError()
}}
},"1.0");/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-flyout-error-message-template",function(c){var b=c.Handlebars;
(function(){var e=b.template,d=b.templates=b.templates||{};
d["flyout-error-message.html"]=e(function(h,n,g,m,l){g=g||h.helpers;
var k="",f,j,i="function";
k+='<div class="sqs-flyout-error-message">';
j=g.message;
if(j){f=j.call(n,{hash:{}})
}else{f=n.message;
f=typeof f===i?f():f
}if(f||f===0){k+=f
}k+="</div>";
return k
})
})();
var a="flyout-error-message.html";
c.Handlebars.registerPartial(a.replace("/","."),b.templates[a])
},"1.0",{requires:["handlebars-base",]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-attr-validators",function(a){var b=a.namespace("Squarespace").AttrValidators={isBoolean:function(c){if(!a.Lang.isBoolean(c)){console.error('"'+c+'" is not a boolean');
return false
}else{return true
}},isNumber:function(c){if(!a.Lang.isNumber(c)){console.error('"'+c+'" is not a number');
return false
}else{return true
}},isString:function(c){if(!a.Lang.isString(c)){console.error('"'+c+'" is not a string');
return false
}else{return true
}},isNonArrayObject:function(c){if(a.Lang.isArray(c)){console.error('"'+c+'" is an array, not a hash.');
return false
}else{if(!a.Lang.isObject(c)){console.error('"'+c+'" is not an object');
return false
}else{return true
}}},isObject:function(c){if(!a.Lang.isObject(c)){console.error('"'+c+'" is not an object');
return false
}else{return true
}},isArray:function(c){if(!a.Lang.isArray(c)){console.error('"'+c+'" is not an an Array');
return false
}else{return true
}},isFunction:function(c){if(!a.Lang.isFunction(c)){console.error('"'+c+'" is not a function.');
return false
}else{return true
}},isNullOr:function(c){if(!a.Lang.isFunction(c)){console.error("The validator function argument is required.");
return false
}return function(d){if(a.Lang.isNull(d)){return true
}else{return c(d)
}}
},isInstanceOf:function(c){if(!c){console.error(c);
console.error("Constructor object to check against was falsy.");
return false
}return function(d){if(d instanceof c){return true
}else{console.error('"'+d+'" is not an intance of "'+c+'".');
return false
}}
},isTypeOf:function(c){if(!c){console.error("Type string to check against was falsy. Type was:",c);
return false
}return function(d){if((typeof d)===c){return true
}else{console.error('"'+d+'" is not of type "'+c+'".');
return false
}}
},isValueIn:function(c){if(!c){console.error(c);
console.error("Constants object to check against was falsy.");
return false
}return function(d){if(a.Object.values(c).indexOf(d)!==-1){return true
}else{console.error('"'+d+'" is not a valid constant of that type.');
return false
}}
}};
b.isNullOrInstanceOf=function(c){return b.isNullOr(b.isInstanceOf(c))
};
b.isNullOrOfType=function(c){return b.isNullOr(b.isTypeOf(c))
};
b.isDate=b.isInstanceOf(Date);
b.isNullOrString=b.isNullOr(b.isString);
b.isNullOrDate=b.isNullOr(b.isDate);
b.isNullOrBoolean=b.isNullOr(b.isBoolean);
b.isNullOrNumber=b.isNullOr(b.isNumber);
b.isNullOrObject=b.isNullOr(b.isObject);
b.isNullOrNonArrayObject=b.isNullOr(b.isNonArrayObject);
b.isNullOrArray=b.isNullOr(b.isArray);
b.isNullOrFunction=b.isNullOr(b.isFunction)
},"1.0",{requires:["base-base"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-dialog-field-2",function(b){var a="error";
b.Squarespace.Widgets.DialogField2=b.Squarespace.DialogField2=b.Base.create("dialogField",b.Squarespace.Widgets.DataWidget,[b.Squarespace.DialogFieldLegacyInterface,b.WidgetParent,b.WidgetChild],{initializer:function(c){this._saveInitialData(c?c.data:null)
},destructor:function(){this._destroyError();
this.unplug(b.Plugin.WidgetAnim)
},_destroyError:function(){if(this._errorNode){this._errorNode.remove(true);
this._errorNode=null
}},_saveInitialData:function(c){c=b.Lang.isUndefined(c)?this.get("data"):c;
if(b.Lang.isArray(c)){this._initialData=c.slice()
}else{if(b.Lang.isObject(c)){this._initialData=b.clone(c,true)
}else{this._initialData=c
}}},setCurrentDataAsInitial:function(){this._saveInitialData()
},renderUI:function(){b.Squarespace.DialogField2.superclass.renderUI.call(this);
var c=this.get("name");
if(c){this.get("boundingBox").addClass("name-"+c)
}},showError:function(g){if(!g||!this.get("rendered")){return
}var e=this.get("boundingBox"),d=this.get("contentBox"),f=this.get("errorFlyoutAnchor")||d;
if(!f.hasPlugin("flyoutPlugin")){f.plug(b.Squarespace.Animations.Flyout,{duration:0.3})
}var c=f.flyoutPlugin;
var h=b.bind(function(){e.addClass(a);
this._destroyError();
this._errorNode=b.Squarespace.UITemplates.renderAsNodeOrDocFrag("flyout-error-message.html",{message:g});
var m=this.get("dialog");
if(m){this._errorNode.setStyle("zIndex",m.zIndex+10)
}this._errorNode.on(this.get("id")+"|click",function(o){o.halt();
this.hideError()
},this);
var l=b.one(window).get("region").right,k=b.Squarespace.Utils.measureNode(this._errorNode).width,j=f.get("region").right+k,i=j>l;
if(i){this._errorNode.addClass("out-from-left")
}c.setAttrs({node:this._errorNode,alignment:i?"lt":"rt"});
this._clearErrorSub=b.on(this.get("id")+"|click",this.hideError,this);
var n=this.get("id");
c.once(n+"|shown",function(o){this.fire("error-shown")
},this);
f.once("shown",function(o){this._errorNode.setStyle("width","100%")
},this);
c.show()
},this);
if(c.get("visible")){if(this._showErrorSub){this._showErrorSub.detach()
}this._showErrorSub=c.once(this.get("id")+"|hidden",function(){this._showErrorSub=null;
h()
},this);
c.hide()
}else{h()
}},hideError:function(){if(!this.get("rendered")){return
}var e=this.get("boundingBox");
var d=this.get("contentBox");
var f=this.get("errorFlyoutAnchor")||d;
if(!f.hasPlugin("flyoutPlugin")||!f.flyoutPlugin.get("visible")){return
}if(this._clearErrorSub){this._clearErrorSub.detach()
}var c=f.flyoutPlugin;
c.once(this.get("id")+"|hidden",function(g){e.removeClass(a);
this.fire("error-hidden");
this._destroyError()
},this);
c.hide()
},didDataChange:function(){var c=this.get("data");
if(b.Lang.isArray(this._initialData)){return b.JSON.stringify(this._initialData)!==b.JSON.stringify(c)
}if(b.Lang.isObject(this._initialData)){throw"DialogField base class will not compare objects. Define didDataChange for this field."
}return this._initialData!==c
},isEmpty:function(){var c=this.get("data");
return c===""||c===0
},revert:function(){this.set("data",this._initialData,{revert:true})
},_getErrors:function(){return[]
},isValid:function(){return this.get("errors").length>0
}},{CSS_PREFIX:"sqs-dialog-field",ATTRS:{strings:{},name:{value:null,validator:b.Squarespace.AttrValidators.isNullOrString},dialog:{value:null,validator:function(c){if(b.Lang.isNull(c)){return true
}if(!(c instanceof b.Squarespace.EditingDialog||c.constructor instanceof b.Squarespace.EditingDialog.constructor)){console.warn(this.name+": Not an EditingDialog");
return false
}else{return true
}}},required:{value:false,validator:b.Squarespace.AttrValidators.isBoolean},errors:{value:[],readOnly:true,getter:"_getErrors",validator:b.Squarespace.AttrValidators.isArray},errorFlyoutAnchor:{value:null,readOnly:true,validator:b.Squarespace.AttrValidators.isNullOrInstanceOf(b.Node)}}})
},"1.0",{requires:["base-build","widget-child","widget-parent","widget-anim","json-stringify","squarespace-util","squarespace-ss-widget","squarespace-dialog-field-legacy-interface","squarespace-animations","squarespace-flyout-error-message-template","squarespace-attr-validators"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-dialog-hidden",function(b){var a=function(){};
b.namespace("Squarespace.DialogFields").Hidden=b.Base.create("hidden",b.Squarespace.DialogField2,[],{initializer:function(){this.unplug(b.Plugin.WidgetAnim)
},focus:null,enable:null,disable:null,blur:null,renderUI:a,bindUI:a,syncUI:a},{CSS_PREFIX:"sqs-hidden",ATTRS:{visible:{value:false}}});
b.Squarespace.DialogFields.HiddenField=b.Squarespace.DialogFields.Hidden
},"1.0",{requires:["base","base-build","squarespace-dialog-field-2"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-login",function(a){if(!window.SQUARESPACE_LOGIN){window.SQUARESPACE_LOGIN=Singleton.create({ready:function(){if(Static.SQUARESPACE_CONTEXT){this.account=Static.SQUARESPACE_CONTEXT.authenticatedAccount
}this.defaultParams={redirectAfterCancel:true,redirectAfterLogin:true,minimal:false,cancelable:true,overlayOpacity:0.8,disableOverlayCancel:false,forgotPassword:true,disableCreateAccount:true,globalLogin:true,allowSocialLogins:true};
this.params=this.defaultParams;
this.dialogParameters=null
},configure:function(b){this.params=this.defaultParams;
this.params=a.merge(this.params,b)
},reset:function(){this.params=this.defaultParams
},isLoggedIn:function(){return !!this.account
},getAccount:function(){return this.account
},toggle:function(){if(this.loginDialog&&this.loginDialog.isVisible()){this.loginDialog.cancel()
}else{this.show()
}},buildDialog:function(){this.dialogParameters={style:"flyout",discardChangesConfirmation:false,overlay:this.params.overlayOpacity,width:400,closeOthers:false,closeable:!this.params.disableOverlayCancel,disableOverlayCancel:this.params.disableOverlayCancel,tabs:[{title:"Squarespace Login",icon:"/universal/images-v6/dialog/login-icon.png?4",fields:[{type:"multi-frame",name:"login-method-frame",initialFrame:"squarespace",frames:{squarespace:{fields:[{type:"text",required:true,name:"email",title:"Login or Email",titleStyle:"inline",submitOnEnter:true,mailcheck:true,style:"major"},{type:"text",required:true,name:"password",password:true,title:"Password",titleStyle:"inline",submitOnEnter:true,style:"major"},{type:"splitter",fields:[{type:"check",width:0.7,required:true,name:"remember",title:"Stay Signed In",padding:[5,0],description:"Will keep you signed in for 2 weeks."},{type:"link",width:0.3,name:"passwordReset",className:"forgotpassword",title:"Forgot Password?",align:"right"}]}]},facebook:{fields:[{type:"description",name:"facebook-login",text:'<div class="facebook-login-button"></div><div class="big-login-caption">Click above to be redirected to Facebook.</div>'}]},twitter:{fields:[{type:"description",name:"twitter-login",text:'<div class="twitter-login-button"></div><div class="big-login-caption">Click above to be redirected to Twitter.</div>'}]},google:{fields:[{type:"description",name:"google-login",text:'<div class="google-login-button"></div><div class="big-login-caption">Click above to be redirected to Google.</div>'}]}}},{type:"hidden",name:"inviteCode"},{type:"hidden",name:"srcUrl"}]}]};
if(this.params.allowSocialLogins){this.dialogParameters.tabs[0].fields.splice(0,0,{type:"multi-option",name:"login-method",linkFrame:"login-method-frame",defaultValue:"squarespace",titleStyle:"top",padding:[0,20],optionPadding:"45px 0 15px 0",iconDropPx:8,options:[{icon:"/universal/images-v6/dialog/login-squarespace.png",title:"Squarespace",value:"squarespace"},{icon:"/universal/images-v6/dialog/login-twitter.png",title:"Twitter",value:"twitter"},{icon:"/universal/images-v6/dialog/login-facebook.png",title:"Facebook",value:"facebook"},{icon:"/universal/images-v6/dialog/login-google.png",title:"Google",value:"google"}]});
this.dialogParameters.width=460
}else{this.dialogParameters.width=400
}if(this.params.minimal){this.dialogParameters.style="transparent";
this.dialogParameters.top=300;
this.dialogParameters.buttons=[(this.params.cancelable?{type:"cancel",title:"Cancel"}:null),(!this.params.disableCreateAccount?{type:"createAccount",title:"Create Squarespace Account"}:null),{type:"saveAndClose",title:"Login"}]
}else{this.dialogParameters.buttons=[(!this.params.disableOverlayCancel?{type:"cancel",title:"Cancel"}:null),(!this.params.disableCreateAccount?{type:"createAccount",title:"Create Squarespace Account"}:null),{type:"saveAndClose",title:"Login"}]
}},buildCommentDialog:function(b,c,d){this.dialogParameters={name:"comment",style:"flyout",discardChangesConfirmation:false,overlay:this.params.overlayOpacity,width:460,height:275,closeOthers:false,closeable:!this.params.disableOverlayCancel,disableOverlayCancel:this.params.disableOverlayCancel,tabs:[{title:b,icon:"/universal/images-v6/standard/icon_comments_24_light.png",fields:[{type:"hidden",name:"inviteCode"},{type:"hidden",name:"srcUrl"},{type:"multi-option",name:"login-method",linkFrame:"login-method-frame",defaultValue:"squarespace",titleStyle:"top",padding:[0,20],optionPadding:"45px 0 15px 0",iconDropPx:8,options:[{icon:"/universal/images-v6/dialog/login-squarespace.png",title:"Squarespace",value:"squarespace"},{icon:"/universal/images-v6/dialog/login-twitter.png",title:"Twitter",value:"twitter"},{icon:"/universal/images-v6/dialog/login-facebook.png",title:"Facebook",value:"facebook"},{icon:"/universal/images-v6/dialog/login-google.png",title:"Google",value:"google"}]},{type:"multi-frame",name:"login-method-frame",initialFrame:"squarespace",frames:{squarespace:{fields:[{type:"text",required:true,name:"email",title:"Email Address",fieldStyle:"normal",titleStyle:"inline",submitOnEnter:true,style:"major"},{type:"text",required:true,name:"password",password:true,title:"Password",fieldStyle:"normal",titleStyle:"inline",submitOnEnter:true,style:"major"},{type:"splitter",fields:[{type:"check",width:0.7,required:true,name:"remember",title:"Stay Signed In",padding:[5,0],description:"Will keep you signed in for 2 weeks."},{type:"link",width:0.3,name:"passwordReset",className:"forgotpassword",title:"Forgot Password?",align:"right"}]}]},facebook:{fields:[{type:"description",name:"facebook-login",text:'<div class="facebook-login-button"></div><div class="big-login-caption">Click above to be redirected to Facebook.</div>'}]},twitter:{fields:[{type:"description",name:"twitter-login",text:'<div class="twitter-login-button"></div><div class="big-login-caption">Click above to be redirected to Twitter.</div>'}]},google:{fields:[{type:"description",name:"google-login",text:'<div class="google-login-button"></div><div class="big-login-caption">Click above to be redirected to Google.</div>'}]}}}]}]};
if(this.params.minimal){this.dialogParameters.style="transparent";
this.dialogParameters.width=460;
this.dialogParameters.height=275;
this.dialogParameters.top=300;
this.dialogParameters.buttons=[{type:"createAccount",title:"Create Squarespace Account"},{type:"saveAndClose",title:"Login"}]
}else{this.dialogParameters.buttons=[(!this.params.disableOverlayCancel?{type:"cancel",title:"Cancel"}:null),{type:"createAccount",title:"Create Squarespace Account"},{type:"saveAndClose",title:(c||"Login")}]
}if(d){this.dialogParameters.tabs[0].fields.forEach(function(e){if(e.name==="login-method"){e.defaultValue="guest";
e.options.unshift({icon:"/universal/images-v6/dialog/login-guest.png",title:"Guest",value:"guest"})
}if(e.name==="login-method-frame"){e.initialFrame="guest";
e.frames.guest={fields:[{type:"text",name:"displayName",required:true,title:"Your Name",fieldStyle:"normal",titleStyle:"inline",submitOnEnter:true,style:"major"},{type:"text",name:"anonEmail",title:"Email (Optional)",fieldStyle:"normal",titleStyle:"inline",submitOnEnter:true,mailcheck:true,style:"major"},{type:"text",required:false,name:"authorUrl",title:"Website URL (Optional)",fieldStyle:"normal",titleStyle:"inline",submitOnEnter:true,style:"major"}]}
}},this)
}},showCommentLogin:function(b,d,c){this.params.redirectAfterLogin=false;
this.params.redirectAfterCancel=false;
if(this.loginDialog){this.loginDialog=null;
this.dialogParameters=null
}this.buildCommentDialog(b,d,c);
this.show()
},show:function(){a.use("squarespace-dialog","squarespace-external-authentication","squarespace-dialog-hidden",a.bind(function(b){if(this.loginDialog&&this.loginDialog.isVisible()){return
}if(this.loginDialog){this.loginDialog.destroy();
this.loginDialog=null;
this.dialogParameters=null
}if(this.dialogParameters===null){this.buildDialog()
}this.loginDialog=new b.Squarespace.EditingDialog(this.dialogParameters);
this.loginDialog.on(["cancel","overlay-click"],function(){window.SQUARESPACE_LOGIN.fire("cancel");
this.reset()
},this);
this.loginDialog.on("loading",function(){var c=b.Cookie.get("email");
if(window.SQUARESPACE_LOGIN.params.inviteCode){window.SQUARESPACE_LOGIN.showBigText("login");
c=this.params.invitation.email;
this.params.redirectAfterLogin=true
}if(c){this.loginDialog.setInitialData({email:c,inviteCode:window.SQUARESPACE_LOGIN.params.inviteCode,remember:true})
}else{this.loginDialog.setInitialData({inviteCode:window.SQUARESPACE_LOGIN.params.inviteCode,remember:true})
}},this);
this.loginDialog.on("click",function(c){if(!this.externalAuth){this.externalAuth=new b.Squarespace.ExternalAuthentication({loginFlag:true});
this.externalAuth.on("completed",function(){b.Data.post({url:"/api/auth/CheckAuthentication",secure:true,data:{srcUrl:document.location.href},success:function(d){Static.SQUARESPACE_CONTEXT.permissions=d.permissions;
if(d.member){this.close();
Static.SQUARESPACE_CONTEXT.authenticatedAccount=d.member;
window.SQUARESPACE_LOGIN.onLoginComplete(d.member,d.redirectUrl)
}}},this)
},this)
}if(c.target.ancestor(".twitter-login-button",true)){this.externalAuth.openPopupWindow("","",b.Squarespace.ExternalServiceProviders.TWITTER)
}else{if(c.target.ancestor(".facebook-login-button",true)){this.externalAuth.openPopupWindow("","",b.Squarespace.ExternalServiceProviders.FACEBOOK)
}else{if(c.target.ancestor(".google-login-button",true)){this.externalAuth.openPopupWindow("","",b.Squarespace.ExternalServiceProviders.GOOGLEAUTH2)
}}}});
this.loginDialog.on("button-createAccount",function(){this.loginDialog.temporaryHide();
this.createSquarespaceAccount()
},this);
this.loginDialog.on("link-passwordReset",function(){this.loginDialog.temporaryHide();
var c=this.loginDialog.getData();
this.passwordReset(c.email)
},this);
this.loginDialog.on("datachange",function(){if(!this.getData().remember){b.Cookie.remove("email")
}this.hideErrors()
});
this.loginDialog.on("cancel",function(){if(this.params.redirectAfterCancel&&!SQUARESPACE_LOGIN.params.externalSwitcher){document.location.href="http://"+document.location.host+"/"
}});
this.loginDialog.on("send-requested",function(){var e=this.loginDialog.getData();
if(e["login-method"]==="guest"){var c=new Date();
c.setSeconds(c.getSeconds()+30);
b.Cookie.set("email",e.anonEmail,{path:"/",expires:c});
b.Cookie.set("displayName",e.displayName,{path:"/",expires:c});
b.Cookie.set("websiteUrl",e.authorUrl,{path:"/",expires:c});
this.loginDialog.close();
this.fire("guestLogin")
}else{if(e.email.indexOf("@")===-1){b.use("thirdparty-sha1",b.bind(function(g){var f=b64_sha1(e.password);
g.Data.post({xdr:{credentials:true},url:"http://squarespace5."+Static.SQUARESPACE_CONTEXT.appDomain+"/process/service/CredentialCheck",data:{A:e.email,B:f,from6:true},success:function(h){g.Data.post({xdr:{credentials:true},url:"http://"+e.email+"."+Static.SQUARESPACE_CONTEXT.appDomain+"/process/Login",data:{username:e.email,encryptedPassword:f,from6:true},success:function(i){if(i.result==="success"){this.loginDialog.close();
top.location.replace("http://"+e.email+"."+Static.SQUARESPACE_CONTEXT.appDomain);
return
}},failure:function(i){this.loginDialog.showErrors(i.errors)
}},this)
},failure:function(i){if(i.errors){this.loginDialog.showErrors(i.errors)
}else{var h={password:"There was an unexpected error. Please try again later."};
this.loginDialog.showErrors(h)
}}},this)
},this))
}else{var d=this.loginDialog.getField("srcUrl");
if(d&&this.loginDialog.getName()!=="comment"){d.setValue(document.location.href)
}b.Data.sendForm(this.loginDialog,{url:"/api/auth/Login",secure:true,success:function(f){if(e.remember){b.Cookie.set("email",e.email,{path:"/",expires:new Date("January 1, 2030")})
}b.Cookie.remove("displayName");
Static.SQUARESPACE_CONTEXT.permissions=f.permissions;
Static.SQUARESPACE_CONTEXT.ownedWebsites=f.ownedWebsites;
Static.SQUARESPACE_CONTEXT.authenticatedAccount=f.account;
this.loginDialog.close();
this.onLoginComplete(f.account,f.redirectUrl)
}},this)
}}},this);
this.loginDialog.setInitialData({"login-method":"squarespace",login:Static.SQUARESPACE_CONTEXT.website.identifier,password:"",remember:false,inviteCode:Static.SQUARESPACE_CONTEXT.inviteCode});
if(!this.loginDialog.isVisible()){this.loginDialog.show();
this.loginDialog.once("shown",function(){this.loginDialog.getField("email").focus()
},this)
}},this))
},createSquarespaceAccount:function(){if(!this.createAccountDialog){var d={loadingText:"Loading...",savingText:"Submitting...",closingText:"",style:"flyout",overlay:this.params.overlayOpacity,width:460,top:200,closeOthers:false,closeable:!this.params.disableOverlayCancel,disableOverlayCancel:this.params.disableOverlayCancel,title:"Create Squarespace Account",buttons:[{type:"cancel",title:"Cancel"},{type:"saveAndClose",title:"Create Login"}],tabs:[{title:"",fields:[{type:"description",text:"<strong>Below you can sign up for a Squarespace account.</strong>  Squarespace accounts let you keep a profile for editing and commenting on Squarespace websites.",padding:[0,15]},{type:"splitter",fields:[{type:"text",width:0.5,required:true,name:"firstName",title:"First Name",style:"title",titleStyle:"inline",submitOnEnter:true},{type:"text",width:0.5,required:true,name:"lastName",title:"Last Name",style:"title",titleStyle:"inline",submitOnEnter:true}]},{type:"text",required:true,name:"email",title:"your@email.com",style:"title",titleStyle:"inline",submitOnEnter:true},{type:"text",required:true,name:"password",password:true,title:"Password",style:"title",titleStyle:"inline",submitOnEnter:true}]}]};
if(this.params.minimal){d.style="transparent";
d.tabs[0].fields[0]=null;
d.top=260
}else{d.style=null;
d.tabs[0].icon="/universal/images-v6/dialog/dialog-icon-member.png"
}this.createAccountDialog=new a.Squarespace.EditingDialog(d);
this.createAccountDialog.on("loading",function(){this.showBigText("create")
},this);
this.createAccountDialog.on("cancel",function(){this.showBigText("login");
this.loginDialog.temporaryShow()
},this);
this.createAccountDialog.on("send-requested",function(){var c=this.createAccountDialog.getData();
a.Data.sendForm(this.createAccountDialog,{url:"/api/auth/CreateSquarespaceAccount",secure:true,success:function(e){this.createAccountDialog.close();
this.loginDialog.temporaryShow();
this.loginDialog.getField("email").setValue(c.email);
this.loginDialog.getField("password").setValue(c.password);
this.loginDialog.save()
}},this)
},this)
}if(this.params.invitation){var b={email:this.params.invitation.email};
this.createAccountDialog.setInitialData(b)
}this.createAccountDialog.show()
},passwordReset:function(b){if(!this.passwordResetDialog){var d={subtext:"Squarespace",style:"minimal",overlay:this.params.overlayOpacity,width:460,top:280,closeOthers:false,closeable:!this.params.disableOverlayCancel,disableOverlayCancel:this.params.disableOverlayCancel,buttons:[{type:"cancel",title:"Cancel"},{type:"saveAndClose",title:"Send Email"}],tabs:[{title:"",fields:[{type:"description",text:"Please enter the email address that you used when creating your account.  An email will be sent to that address with further instructions on how to reset your password."},{type:"text",required:true,name:"email",password:false,title:"your@email.com",style:"title",titleStyle:"inline",submitOnEnter:true}]}]};
d.tabs[0].title="Password Reset";
d.tabs[0].icon="/universal/images-v6/dialog/dialog-icon-member.png";
this.passwordResetDialog=new a.Squarespace.EditingDialog(d);
this.passwordResetDialog.on("loading",function(){},this);
this.passwordResetDialog.on("cancel",function(){this.showBigText("login");
this.loginDialog.temporaryShow()
},this);
this.passwordResetDialog.on("send-requested",function(){var c=this.passwordResetDialog.getData();
a.Data.sendForm(this.passwordResetDialog,{url:"/api/auth/PasswordReset",secure:true,success:function(e){this.passwordResetDialog.close();
this.passwordResetDone(e)
},failure:function(e){}},this)
},this)
}this.passwordResetDialog.setInitialData({email:(b?b:"")});
this.passwordResetDialog.show()
},passwordResetDone:function(b){var d={subtext:"Squarespace",style:"minimal",overlay:this.params.overlayOpacity,width:460,top:280,closeOthers:false,closeable:!this.params.disableOverlayCancel,disableOverlayCancel:this.params.disableOverlayCancel,buttons:[{type:"done",title:"Back to Login"}],tabs:[{title:"",fields:[{type:"description",text:"You have been sent an email with further instructions on resetting your password."}]}]};
d.tabs[0].title="Password Reset";
d.tabs[0].icon="/universal/images-v6/dialog/dialog-icon-member.png";
this.passwordResetDialogDone=new a.Squarespace.EditingDialog(d);
this.passwordResetDialogDone.on("button-done",function(){this.passwordResetDialogDone.close();
this.showBigText("login");
this.loginDialog.temporaryShow()
},this);
this.passwordResetDialogDone.show()
},getPasswordResetDialogParams:function(b){var d={loadingText:"Loading...",savingText:"",closingText:"",style:"minimal",overlay:this.params.overlayOpacity,width:460,top:280,closeOthers:false,closeable:!this.params.disableOverlayCancel,disableOverlayCancel:this.params.disableOverlayCancel,buttons:[(b.invalidRecoveryId?{type:"login",title:"Back To Login"}:{type:"saveAndClose",title:"Update"})],tabs:[{title:"",fields:[]}]};
if(b.invalidRecoveryId){d.tabs[0].fields=[{type:"description",text:"This URL is no longer valid, please go back to login and start over."}]
}else{d.tabs[0].fields=[{type:"description",text:"Hi, <strong>"+b.displayName+"</strong>"},{type:"description",text:"Please enter your new account password for the account with email: <strong>"+b.email+"</strong>."},{type:"text",required:true,name:"password",password:true,title:"New Password",style:"title",titleStyle:"inline",submitOnEnter:true}]
}d.tabs[0].title="Password Reset";
d.tabs[0].icon="/universal/images-v6/dialog/dialog-icon-member.png";
return d
},bindPasswordResetDialog:function(b,c){b.on("button-login",function(){document.location.replace(document.location.pathname)
});
b.on("send-requested",function(){var d=this.dialog.getData();
d.email=this.params.email;
d.recoveryId=this.params.recoveryId;
a.Data.sendForm(this.dialog,{data:d,url:"/api/auth/PasswordReset",secure:true,success:function(e){this.dialog.close();
document.location.replace(document.location.pathname)
},failure:function(e){}},{that:this.that,dialog:b})
},{dialog:b,params:c})
},passwordResetConfirmation:function(d){var e=this.getPasswordResetDialogParams(d);
var b=new a.Squarespace.EditingDialog(e);
this.bindPasswordResetDialog(b,d);
b.show()
},accountActivationConfirmation:function(d){d.recoveryId=d.activationId;
var e=this.getPasswordResetDialogParams(d);
if(!d.invalidRecoveryId){e.tabs[0].fields=[{type:"description",text:"Welcome, <strong>"+d.displayName+"</strong>"},{type:"description",text:"To Activate your account you need to first set your account password associated with the email: <strong>"+d.email+"</strong>."},{type:"text",required:true,name:"password",password:true,title:"New Password",style:"title",titleStyle:"inline",submitOnEnter:true}];
e.tabs[0].title="Activate Account"
}var b=new a.Squarespace.EditingDialog(e);
this.bindPasswordResetDialog(b,d);
b.show()
},showBigText:function(b){if(b==="login"){if(a.one(".bigtext")){a.one(".bigtext").one(".title").set("innerHTML","Accept Invitation");
a.one(".bigtext").one(".description").set("innerHTML","You have been invited to manage this account by <strong>"+this.params.invitingMember.displayName+"</strong>.  <br/>Sign in or create an account below to get started.")
}}else{if(b==="create"){if(a.one(".bigtext")){a.one(".bigtext").one(".title").set("innerHTML","Create Account");
a.one(".bigtext").one(".description").set("innerHTML","Use this form to create a new Squarespace account for use across our system.")
}}}},onLoginComplete:function(d,c){window.SQUARESPACE_LOGIN.account=d;
var b=a.Squarespace.Utils.userHasAccessPermission(a.Squarespace.AccessPermissions.CONFIG);
if(SQUARESPACE_LOGIN.loginRPCProvider&&c){window.SQUARESPACE_LOGIN.fire("iframeLogin",c)
}else{if(this.params.redirectAfterLogin||this.params.reloadAfterLogin){if(c){if(c===window.location.href){window.location.reload()
}else{window.location.replace(c)
}return
}else{new a.Squarespace.Alert().show("No Administrative Privileges","Your Squarespace account is not listed as an administrator on any sites.")
}}else{window.SQUARESPACE_LOGIN.fire("login");
if(this.params.globalLogin){a.Global.fire("squarespace:login")
}this.reset()
}}},logout:function(b){if(b){b.halt()
}if(this.loggingOut||!Static.SQUARESPACE_CONTEXT.authenticatedAccount){return
}this.loggingOut=true;
a.Data.post({url:"/api/auth/Logout",secure:true,success:function(c){this.account=null;
delete window.SQUARESPACE_LOGIN.account;
delete Static.SQUARESPACE_CONTEXT.authenticatedAccount;
delete Static.SQUARESPACE_CONTEXT.permissions;
window.SQUARESPACE_LOGIN.fire("logout");
a.Global.fire("squarespace:logout");
if(this.memberAccount&&this.memberAccount.editor){this.memberAccount.editor.close()
}a.all(".sqs-layout[data-type=block-field]").each(function(e){var d=e.getData("layoutengine");
if(d){d.destroy()
}e.removeClass("editing")
});
document.location.href="http://"+document.location.host+"/?logout=true";
this.loggingOut=false
}},this)
},_buildIFrameLoginDialog:function(){this.buildDialog();
this.dialogParameters.overlay=0.8
},_showLoginInIframe:function(b,d,c){SQUARESPACE_LOGIN.params.disableCreateAccount=true;
SQUARESPACE_LOGIN.params.externalSwitcher=true;
SQUARESPACE_LOGIN.params.allowSocialLogins=false;
if(this.loginDialog){this.loginDialog=null;
this.dialogParameters=null
}this._buildIFrameLoginDialog(b,d,c);
this.show();
SQUARESPACE_LOGIN.on("cancel",function(){SQUARESPACE_LOGIN.loginRPCProvider.hide()
});
SQUARESPACE_LOGIN.on("iframeLogin",function(f){f=f+"&redirectUrl=/config/iframelogin";
var e=a.Node.create('<iframe style="position:fixed; top:-2000px;" src="'+f+'"></div>');
e.on("load",function(){var g=f.substring(0,f.indexOf("/",10));
SQUARESPACE_LOGIN.loginRPCProvider.redirect(g+"/config")
});
a.one("body").append(e)
})
},loadRPCProvider:function(){try{this.loginRPCProvider=new easyXDM.Rpc({},{local:{show:function(){SQUARESPACE_LOGIN._showLoginInIframe()
}},remote:{redirect:{},hide:{},remove:{}}})
}catch(b){console.log("failed to load RPC",b)
}},_loadRPCConsumer:function(b){this.loginRPCConsumer=new easyXDM.Rpc({remote:"https://oauth."+Static.SQUARESPACE_CONTEXT.appDomain+"/config/iframeLogin",container:b,props:{style:{width:"100%",height:"100%",top:0,left:0,position:"fixed",zIndex:30040}}},{local:{redirect:function(c){window.location.replace(c)
},hide:function(){SQUARESPACE_LOGIN.iFrameLoginHide()
},remove:function(){SQUARESPACE_LOGIN.iFrameLoginRemove()
}},remote:{show:{}}})
},iFrameLoginLoad:function(){var b=a.Node.create('<div class="login-wrapper hidden" ></div>');
a.one("body").append(b);
this._loadRPCConsumer(b.getDOMNode())
},iFrameLoginShow:function(b){if(b){b.preventDefault()
}if(!this.loginRPCConsumer){SQUARESPACE_LOGIN.iFrameLoginLoad()
}this.loginRPCConsumer.show();
a.one(".login-wrapper").removeClass("hidden")
},iFrameLoginHide:function(){a.one(".login-wrapper").addClass("hidden")
},iFrameLoginRemove:function(){this.loginRPCConsumer.destroy();
delete this.loginRPCConsumer;
a.one(".login-wrapper").remove()
}});
a.augment(window.SQUARESPACE_LOGIN,a.EventTarget)
}},"1.0",{requires:["squarespace-util","squarespace-dialog-hidden","squarespace-enum","thirdparty-easyxdm","ui-base-css"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-ui-base",function(c){c.mix(c.Node.DOM_EVENTS,{message:true});
c.namespace("Squarespace");
c.Squarespace.DIALOG_ZINDEX_BASE=30000;
c.Anim._intervalTime=10;
var a=Number;
c.Anim.DEFAULT_SETTER=function(h,i,k,l,n,g,j,m){var e=h._node,f=e._node,d=j(n,a(k),a(l)-a(k),g);
if(e._node===null){console.warn("Could not find the animating DOMNode. Might have been destroyed. Bailing out for safety.");
return
}if(f){if("style" in f&&(i in f.style||i in c.DOM.CUSTOM_STYLES)){m=m||"";
e.setStyle(i,d+m)
}else{if("attributes" in f&&i in f.attributes){e.setAttribute(i,d)
}else{if(i in f){f[i]=d
}}}}else{if(e.set){e.set(i,d)
}else{if(i in e){e[i]=d
}}}};
c.Squarespace.Debug={dumpDDs:function(){for(var e=0;
e<c.DD.DDM.targets.length;
++e){var d=c.DD.DDM.targets[e];
console.log(e,d.get("node").get("className"))
}}};
var b=function(d){c.Squarespace.DDBehavior.superclass.constructor.apply(this,arguments)
};
b.NAME="DDBehavior";
b.NS="ddb";
b.ATTRS={host:{},validHandleClass:{}};
c.extend(b,c.Plugin.Base,{initializer:function(d){var e=this.get("host");
for(var f in d.behaviors){if(f.indexOf("drop:")!=-1&&e.target){e.target.on(f,d.behaviors[f],d.context)
}else{e.on(f,d.behaviors[f],d.context)
}}}});
c.Squarespace.DDBehavior=b;
c.Squarespace.SimpleFlexibleGrid=c.Base.create("SimpleFlexibleGrid",c.Plugin.Base,[],{initializer:function(){this._stylesheetEl=c.Node.create("<style></style>");
this.get("host").append(this._stylesheetEl);
this._resizeEvent=c.on("resize",this.syncUI,c.config.win,this);
this.syncUI()
},syncUI:function(){var d;
if(this.get("minWidth")){d=Math.floor(this.get("container").get("offsetWidth")/this.get("minWidth"))
}else{d=Math.ceil(this.get("container").get("offsetWidth")/this.get("maxWidth"))
}this._stylesheetEl.set("innerHTML",this.get("selector")+"{width:"+(100/d)+"% !important;}");
this.get("host").fire("simpleFlexibleGridSyncUI")
},destructor:function(){this._stylesheetEl.remove();
this._resizeEvent.detach()
}},{ATTRS:{container:{},selector:{},maxWidth:{},minWidth:{}},NS:"simple-flexible-grid"});
c.Squarespace.Mouse={lastX:100,lastY:100};
c.on(c.UA.mobile?"touchmove":"mousemove",function(d){c.Squarespace.Mouse.lastX=d.pageX;
c.Squarespace.Mouse.lastY=d.pageY
},c.one(document.body));
c.Squarespace.Image={loadAndFit:function(e,f){var d=new Image();
d.src=f;
c.one(d).on("load",function(i,h,g){h.set("src",g.src);
h.resizeToParent({scale:"cover"})
},this,e,d)
},rotate:function(e,d,j){var m=e.get("parentNode").get("offsetWidth");
var o=e.get("parentNode").get("offsetHeight");
var l=e.get("offsetWidth");
var k=e.get("offsetHeight");
var i=c.Squarespace.LoaderUtils.evaluateModeDimensions({mode:"fit",containerWidth:m,containerHeight:o,data:{dimensions:{width:l,height:k}}});
var n=c.Squarespace.LoaderUtils.evaluateModeDimensions({mode:"fit",containerWidth:o,containerHeight:m,data:{dimensions:{width:l,height:k}}});
var g,h;
if(j%180===0){g=i;
h=n
}else{g=n;
h=i
}var f=new c.Anim({node:e,from:{rotate:j,width:g.width,height:g.height,left:(m-g.width)/2,top:(o-g.height)/2},to:{rotate:d,width:h.width,height:h.height,top:(o-h.height)/2,left:(m-h.width)/2},easing:c.Easing.easeBothStrong,duration:0.3});
f.run()
},straighten:function(f,k,h,e){var g=(e<0?360-e:e)%360,d=g;
if(g>=90){d=g%90-90
}if(g>=180){d=-1*g%180-180
}if(g>=270){d=g%270-90
}var j=Math.abs(d)*(Math.PI/180);
var i;
if(h>k){i=(k*Math.cos(j)+h*Math.sin(j))/k
}else{i=(h*Math.cos(j)+k*Math.sin(j))/h
}f.setStyle("transform","rotate("+e+"deg) scale("+Math.abs(i)+")")
}};
c.Squarespace.Position=Class.create({initialize:function(d){this.EDGE_MARGIN=20;
this.avoidElX=d.avoidElX;
this.avoidElY=d.avoidElY;
this.xdir=d.xdir;
this.ydir=d.ydir;
this.x=d.x;
this.y=d.y;
this.xo=(d.xo?d.xo:0);
this.yo=(d.yo?d.yo:0);
this.w=d.w;
this.h=d.h;
this.initialX=this.getX();
this.initialY=this.getY()
},setX:function(d){this.x=d
},setY:function(d){this.y=d
},getX:function(){return this.x+this.getXO()
},getY:function(){return this.y+this.getYO()
},getXAdj:function(){return this.initialX-this.getX()
},getYAdj:function(){return this.initialY-this.getY()
},getXO:function(){return((this.avoidElX&&this.xdir=="right")?this.avoidElX.get("offsetWidth"):0)+this.xo
},getYO:function(){return((this.avoidElY&&this.ydir=="top")?-this.avoidElY.get("offsetHeight"):0)+this.yo
},isRightViolation:function(){return((this.x+this.w-Math.abs(this.getXO())+this.EDGE_MARGIN)>c.one(document.body).get("winWidth"))
},isLeftViolation:function(){return((this.x-Math.abs(this.getXO())-this.EDGE_MARGIN)<0)
},isTopViolation:function(){return((this.y-Math.abs(this.getYO())-this.EDGE_MARGIN)<c.one(document.body).get("docScrollY"))
},isBottomViolation:function(){return((this.y+this.h-Math.abs(this.getYO())+this.EDGE_MARGIN)>(c.one(document.body).get("winHeight")+c.one(document.body).get("docScrollY")))
},reflectFix:function(){if(this.xdir=="right"&&this.isRightViolation()){this.xdir="left";
this.getX=function(){return this.x-this.w-this.getXO()+11
}
}else{if(this.xdir=="left"&&this.isLeftViolation()){this.xdir="right";
this.getX=function(){return this.x+this.w+this.getXO()
}
}}if(this.ydir=="bottom"&&this.isBottomViolation()){this.ydir="top";
this.getY=function(){return this.y-this.h-this.getYO()
};
console.log("bottom violation .. now "+this.getY())
}else{if(this.ydir=="top"&&this.isTopViolation()){this.ydir="bottom";
this.getY=function(){return this.y+this.h+this.getYO()
};
console.log("top violation")
}}if((this.getY()-this.EDGE_MARGIN)<0){this.getY=function(){return c.one(document.body).get("winHeight")-this.h-this.EDGE_MARGIN
};
this.ydir="bottom"
}else{if((this.getY()+this.h+this.EDGE_MARGIN)>(c.one(document.body).get("winHeight")+c.one(document.body).get("docScrollY"))){this.getY=function(){return c.one(document.body).get("winHeight")+c.one(document.body).get("docScrollY")-this.EDGE_MARGIN-this.h
};
this.ydir="top"
}}if((this.getX()-this.EDGE_MARGIN)<0){this.getX=function(){return this.EDGE_MARGIN
};
this.ydir="left"
}else{if((this.getX()+this.w+this.EDGE_MARGIN)>(c.one(document.body).get("winWidth"))){this.getX=function(){return c.one(document.body).get("winWidth")-this.w-this.EDGE_MARGIN
};
this.ydir="right"
}}if(this.getY()<c.one(document.body).get("docScrollY")){console.log("fixing y offscreen issues.");
this.yo=(c.one(document.body).get("docScrollY")+this.EDGE_MARGIN)-this.y
}},nudgeFix:function(){if(this.isRightViolation()){this.getX=function(){return c.one(document.body).get("winWidth")+c.one(document.body).get("docScrollX")-this.w-this.EDGE_MARGIN
}
}else{if(this.isLeftViolation()){this.getX=function(){return this.EDGE_MARGIN
}
}}if(this.isBottomViolation()){this.getY=function(){return c.one(document.body).get("winHeight")+c.one(document.body).get("docScrollY")-this.h-this.EDGE_MARGIN
}
}else{if(this.isTopViolation()){this.getY=function(){return this.EDGE_MARGIN
}
}}},overflowFix:function(){if(this.isRightViolation()){this.x=c.one(document.body).get("winWidth")+c.one(document.body).get("docScrollX")-this.w-this.EDGE_MARGIN
}else{if(this.isLeftViolation()){this.x=this.EDGE_MARGIN
}}if(this.isBottomViolation()){this.y=c.one(document.body).get("winHeight")+c.one(document.body).get("docScrollY")-this.h-this.EDGE_MARGIN
}else{if((this.y-Math.abs(this.getXO())-this.EDGE_MARGIN)<0){this.y=this.EDGE_MARGIN
}}}});
c.Squarespace.ToolTipManager={canShow:true,disableTooltips:function(){this.canShow=false;
if(this.currentTip){this.currentTip.hide();
this.currentTip=null
}},enableTooltips:function(){this.canShow=true
}};
c.Squarespace.ToolTip=Class.create({initialize:function(e){this.params=e;
var d=c.all(this.params.target);
if(d.size()==0){console.warn("Couldn't find ToolTip target: "+this.params.target);
return
}if(this.params.showTimeout===undefined){this.params.showTimeout=1200
}if(this.params.width===undefined){this.params.width=250
}if(this.params.style===undefined){this.params.style="info"
}this.mouseOffset=15;
this.events=[d.on("mousemove",function(f){this.lastX=f.pageX;
this.lastY=f.pageY;
this.move();
if(this.showTimer){return
}this.showTimer=c.later(this.params.showTimeout,this,this.show)
},this),d.on("mouseout",function(f){if(this.showTimer){this.showTimer.cancel();
this.showTimer=null
}this.hide()
},this),d.on("click",function(f){if(!this.params.clickToShow){this.hide()
}else{this.show();
f.halt()
}},this),c.Global.on("manager:change-mode",function(f){this.hide()
},this)]
},destroy:function(){for(var d=0;
d<this.events.length;
++d){this.events[d].detach()
}if(this.el){this.el.remove();
this.el=null
}this.events=[];
this.destroyed=true;
this.shown=false
},move:function(){if(!this.el){return
}this.position.x=this.lastX;
this.position.y=this.lastY;
if(this.a){this.el.setStyles({left:this.position.getX()+"px"})
}else{this.el.setStyles({left:this.position.getX()+"px",top:this.position.getY()+"px"})
}},show:function(){if(this.el||this.destroyed||this.shown){return
}if(!c.Squarespace.ToolTipManager.canShow&&!this.params.dialogTooltip){return
}this.el=c.DB.DIV("sqsp-tooltip "+this.params.style,c.DB.DIV("title",{html:this.params.title}),(this.params.body?c.DB.DIV("description",{html:this.params.body}):null));
c.one(document.body).append(this.el);
this.position=new c.Squarespace.Position({xdir:"right",ydir:"bottom",x:this.lastX,y:this.lastY,xo:this.mouseOffset,yo:this.mouseOffset,w:this.el.get("offsetWidth"),h:this.el.get("offsetHeight")});
this.position.reflectFix();
this.el.setStyles({left:this.position.getX()+"px",top:(this.position.getY()-this.position.yo)+"px",width:(this.params.width)+"px",zIndex:1000000,opacity:0});
if(this.params.icon){this.el.setStyle(backgroundImage,"url("+this.params.icon+")")
}this.shown=true;
this.a=new c.Anim({node:this.el,to:{top:this.position.getY(),opacity:1},duration:0.3,easing:c.Easing.easeOutStrong});
this.a.on("end",function(){this.a=null
},this);
this.a.run();
c.Squarespace.ToolTipManager.currentTip=this
},hide:function(){if(!this.el){return
}var d=new c.Anim({node:this.el,to:{top:(this.position.getY()+15),opacity:0},duration:0.3,easing:c.Easing.easeOutStrong});
d.on("end",function(){this.get("node").remove()
});
d.run();
this.el=null;
this.a=null;
this.shown=false
}});
c.Squarespace.CURRENT_CONFIRMATION_DIALOG=null;
c.Squarespace.ConfirmationDialog=Class.create({defaultOpts:{width:230,className:"question",position:"mouse",extreme:false,escToCancel:true,style:"proceedOrCancel",confirmText:"Confirm",showSaveOverlay:true,screenOverlayOpacity:0.5,showScreenOverlay:true},initialize:function(d){this.params=c.merge(this.defaultOpts,d);
this.finished=false;
this.ignoreBodyClicks=true;
if(!this.params.zIndex){c.Squarespace.DIALOG_ZINDEX_BASE+=10;
this.zIndex=c.Squarespace.DIALOG_ZINDEX_BASE
}else{this.zIndex=this.params.zIndex
}},getFields:function(){if(this.params.fields){return this.params.fields
}else{return[]
}},getButtons:function(){if(this.params.style=="confirmOrReject"){var d=[];
if(!this.params.hideCancel){d.push(c.DB.DIV("cancel",{html:"Cancel"}))
}d.push(c.DB.INPUT("reject",{type:"button",value:this.params.rejectText}));
d.push(c.DB.INPUT("proceed",{type:"button",value:this.params.confirmText}));
return d
}else{if(this.params.style=="proceedOrCancel"){return[c.DB.DIV("cancel",{html:"Cancel"}),c.DB.INPUT("proceed",{type:"button",value:this.params.confirmText})]
}else{if(this.params.style=="confirmOnly"){return[c.DB.INPUT("proceed",{type:"button",value:this.params.confirmText})]
}}}},showChoice:function(i,f,g,h,e,j,d){this.params.style="confirmOrReject";
this.params.confirmText=g;
this.params.rejectText=e;
this.params.onReject=j;
this.show(i,f,h,d)
},showScreenOverlay:function(){if(this.overlayEl){this.fire("overlay-shown")
}else{var e=c.one(document).get("winWidth");
var f=c.one(document).get("winHeight");
this.overlayEl=c.DB.DIV("dialog-screen-overlay "+(this.params.extreme?"extreme":""));
this.overlayEl.setStyles({height:f+"px",width:e+"px"});
this.overlayEl.setStyle("zIndex",(this.zIndex+10));
c.one(document.body).append(this.overlayEl);
var d=new c.Anim({node:this.overlayEl,to:{opacity:this.params.screenOverlayOpacity},duration:0.1,easing:c.Easing.easeOutStrong});
d.on("end",function(){this.fire("overlay-shown")
},this);
d.run()
}},hideScreenOverlay:function(){if(this.overlayEl){var d=new c.Anim({node:this.overlayEl,to:{opacity:0},duration:0.1,easing:c.Easing.easeOutStrong});
d.on("end",function(){this.fire("overlay-hidden");
if(this.overlayEl){this.overlayEl.remove();
delete this.overlayEl
}},this);
d.run()
}else{this.fire("overlay-hidden")
}},show:function(h,f,g,e){if(this.finished){return
}if(!g){g=this.params.onSuccess||function(){}
}if(!e){e=this.params.scope||this
}this.params.confirmText=this.params.confirmText||h;
if(c.Squarespace.CURRENT_CONFIRMATION_DIALOG){c.Squarespace.CURRENT_CONFIRMATION_DIALOG.hide()
}if(this.params.escToCancel){c.Squarespace.CURRENT_CONFIRMATION_DIALOG=this
}if(h){this.params.title=h
}if(f){this.params.message=f
}if(e){this.params.scope=e
}if(g){this.params.onSuccess=g
}if(this.params.showSaveOverlay){if(this.params.scope&&this.params.scope.on&&this.params.scope.showSaveOverlay){this.params.scope.on("close",this.answer,this,null,false);
this.params.scope.on("cancel",this.answer,this,null,false);
this.params.scope.showSaveOverlay(true)
}}var d=c.bind(function(){c.Squarespace.EscManager.addTarget(this);
this.el=c.DB.DIV("sqsp-tooltip clear "+this.params.className,{style:"width: "+this.params.width+"px"},(this.params.spinner!==undefined?c.DB.DIV("spinner"):""),c.DB.DIV("title",{html:this.params.title}),(this.params.message!==undefined?c.DB.DIV("description",{html:this.params.message}):""),(this.getFields()?c.DB.DIV("fields",this.getFields()):null),(this.getButtons()?c.DB.DIV("buttons",this.getButtons()):null));
this.el.on("click",function(n){n.stopPropagation()
},this);
var j=this.el.one(".cancel");
if(j){j.on("click",this.answer,this,false)
}if(this.getButtons()){if(this.el.one(".proceed")){this.el.one(".proceed").on("click",this.answer,this,true,"proceed")
}if(this.el.one(".reject")){this.el.one(".reject").on("click",this.answer,this,true,"reject")
}}if(this.params.clickToClose){this.el.once("click",this.hide,this,true)
}c.one(document.body).append(this.el);
var i,m;
if(this.params.position=="mouse"){i=c.Squarespace.Mouse.lastX;
m=c.Squarespace.Mouse.lastY;
this.position=new c.Squarespace.Position({xdir:"right",ydir:"bottom",x:i,y:m,xo:-150,yo:-80,w:this.el.get("offsetWidth"),h:this.el.get("offsetHeight")});
this.position.nudgeFix();
this.el.setStyles({position:"absolute",left:(this.position.getX())+"px",top:this.position.getY()+"px",zIndex:1000000,opacity:0})
}else{if(this.params.position=="anchor"&&this.params.anchorEl){var l=c.one(this.params.anchorEl);
i=l.getX();
m=l.getY();
this.position=new c.Squarespace.Position({xdir:"right",ydir:"bottom",x:i,y:m,xo:-150,yo:-80,w:this.el.get("offsetWidth"),h:this.el.get("offsetHeight")});
this.position.nudgeFix();
this.el.setStyles({position:"absolute",left:this.position.getX()+"px",top:this.position.getY()+"px",zIndex:1000000,opacity:0})
}else{if(this.params.position=="center"){var m=(c.one(document.body).get("winHeight")/2-this.el.get("offsetHeight")/2),i=(c.one(document.body).get("winWidth")/2-this.el.get("offsetWidth")/2);
this.el.setStyles({position:"fixed",left:i+"px",top:m+"px",zIndex:1000000,opacity:0})
}else{if(this.params.position.indexOf("top")!=-1){m=20
}else{m=(c.one(document.body).get("winHeight")-this.el.get("offsetHeight"))-20
}if(this.params.position.indexOf("right")!=-1){i=(c.one(document.body).get("winWidth")-this.el.get("offsetWidth"))-20
}else{i=20;
c.all(".config-panel").each(function(o){i+=o.get("offsetWidth")
})
}if(this.params.position=="lower-left"){this.el.setStyles({position:"fixed",left:(parseInt(c.one(".config-panel.root").getComputedStyle("width"),10)+10)+"px",bottom:"20px",zIndex:1000000,opacity:0})
}else{if(this.params.position=="top-center"){var i=(c.one(document.body).get("winWidth")/2-this.el.get("offsetWidth")/2);
this.el.setStyles({position:"fixed",left:i+"px",top:"20px",zIndex:1000000,opacity:0})
}else{if(this.params.position.indexOf("bottom")!=-1){this.el.setStyles({position:"fixed",left:i+"px",bottom:"20px",zIndex:1000000,opacity:0})
}else{this.el.setStyles({position:"fixed",left:i+"px",top:m+"px",zIndex:1000000,opacity:0})
}}}}}}var k=c.Squarespace.Transitions.getTransition({el:this.el,name:"scale",direction:"in"});
if(this.el.one(".proceed")){this.el.one(".proceed").focus()
}k.run();
if(this.params.autoHide){this.hideTimer=c.later(this.params.autoHide,this,this.hide)
}},this);
if(this.params.showScreenOverlay){this.showScreenOverlay();
this.once("overlay-shown",d)
}else{d()
}},setCenter:function(d){this.el.setStyles({left:d.left-this.el.get("offsetWidth")/2,top:d.top-this.el.get("offsetHeight")/2})
},answer:function(f,g,d){if(this.finished){return
}if(f){f.halt()
}this.hide(g);
if(g){if(d=="proceed"){if(this.params.scope){this.params.onSuccess.apply(this.params.scope)
}else{this.params.onSuccess()
}}else{if(this.params.scope){this.params.onReject.apply(this.params.scope)
}else{this.params.onReject()
}}}else{if(this.params.onCancel){this.params.onCancel.apply(this.params.scope||this)
}}},close:function(){this.hide(false)
},hide:function(e){this.finished=true;
if(this.pulseAnim){this.pulseAnim.stop()
}if(this.hideTimer){this.hideTimer.cancel();
this.hideTimer=null
}if(this.params.showSaveOverlay){if(this.params.scope&&this.params.scope.on&&this.params.scope.hideSaveOverlay){this.params.scope.hideSaveOverlay(0.3)
}}var d=c.bind(function(){if(c.Squarespace.EscManager){c.Squarespace.EscManager.removeTarget(this)
}var f=c.Squarespace.Transitions.getTransition({el:this.el,name:"scale",direction:"out"});
f.on("end",function(h,g){if(g){g.remove()
}this.fire("hidden")
},this,this.el);
f.run();
this.el=null;
this.a=null;
if(this.params.escToCancel){c.Squarespace.CURRENT_CONFIRMATION_DIALOG=null
}},this);
this.once("overlay-hidden",d);
this.hideScreenOverlay()
}});
c.augment(c.Squarespace.ConfirmationDialog,c.EventTarget);
c.Squarespace.Alert=Class.extend(c.Squarespace.ConfirmationDialog,{initialize:function(d){if(!d){d={}
}d.className="alert";
d.showScreenOverlay=false;
c.Squarespace.Alert.prototype.superclass.initialize.call(this,d)
},getButtons:function(){return[c.DB.INPUT("proceed",{type:"button",value:"Ok"})]
}});
c.Squarespace.Notice=Class.extend(c.Squarespace.ConfirmationDialog,{initialize:function(d){if(!d){d={}
}d.className="okay";
d.showScreenOverlay=false;
c.Squarespace.Alert.prototype.superclass.initialize.call(this,d)
},getButtons:function(){return[c.DB.INPUT("proceed",{type:"button",value:"Ok"})]
}});
c.Squarespace.Information=Class.extend(c.Squarespace.ConfirmationDialog,{initialize:function(d){if(!d){d={}
}d=c.merge({className:"okay",autoHide:2000,clickToClose:true,escToCancel:false,showScreenOverlay:false},d);
c.Squarespace.Alert.prototype.superclass.initialize.call(this,d)
},getButtons:function(){return null
}});
c.Squarespace.Loading=Class.extend(c.Squarespace.ConfirmationDialog,{initialize:function(d){if(!d){d={}
}d.className="loading";
d.clickToClose=false;
d.escToCancel=false;
d.spinner=true;
c.Squarespace.Loading.prototype.superclass.initialize.call(this,d)
},show:function(g,e,f,d){this._super(g,e,f,d)
},hide:function(d){if(d===undefined){d=0
}setTimeout(c.bind(this._super,this),d)
},getButtons:function(){return null
}});
c.Squarespace.OptionConfirmationDialog=Class.extend(c.Squarespace.ConfirmationDialog,{initialize:function(d){if(!d){d={}
}d.clickToClose=false;
d.escToCancel=false;
c.Squarespace.Loading.prototype.superclass.initialize.call(this,d)
},getFields:function(){this.active=true;
var d=this.params.optionConfig;
this.checkEl=c.DB.DIV("field-wrapper check-field-wrapper clear thin",(d.padding?{style:"padding-top: "+d.padding[0]+"; padding-bottom: "+d.padding[1]+";"}:null),c.DB.DIV("check-element "+(this.active?"active":""),((d.title)?c.DB.DIV("field-title",{html:d.title}):null),(d.description?c.DB.DIV("field-description-wrapper",c.DB.DIV("field-description",{html:d.description})):null)));
this.checkEl.on("click",this.onClick,this);
return[this.checkEl]
},onClick:function(d){this.setValue(!this.active)
},getValue:function(){return this.active
},setValue:function(d){this.active=d;
if(this.active){this.checkEl.one(".check-element").addClass("active")
}else{this.checkEl.one(".check-element").removeClass("active")
}}});
c.Squarespace.Lightbox=Class.create({defaultOpts:{overlayShowDuration:0.35,contentShowDuration:0.6,margin:0,opacity:1,transition:"fade",clickAnywhereToExit:true,name:null,theme:"black",overlayStyle:"orb"},name:"Lightbox",initialize:function(d){this.enabled=true;
this.params=c.merge(this.defaultOpts,d);
if(!this.params.transition){this.params.transition="fade"
}if(!this.params.zIndex){c.Squarespace.DIALOG_ZINDEX_BASE+=10;
this.params.zIndex=c.Squarespace.DIALOG_ZINDEX_BASE
}this.events=[]
},enable:function(){this.enabled=true;
this.overlayEl.setStyle("display","block")
},disable:function(){this.enabled=false;
this.overlayEl.setStyle("display","none")
},getContentEl:function(){return this.contentEl
},show:function(){var e=c.one(document).get("winWidth");
var g=c.one(document).get("winHeight");
var f="sqs-lightbox"+(this.params.name?" sqs-lightbox-"+this.params.name:"");
this.contentEl=c.DB.DIV(f,(c.Lang.isString(this.params.content)?{html:this.params.content}:this.params.content));
this.contentEl.setStyles({position:"fixed",opacity:"0",overflow:"hidden",zIndex:(this.params.zIndex)});
this.events.push(c.on("resize",this.position,c.one(window),this));
if(!this.params.disableNormalClose){c.Squarespace.EscManager.addTarget(this)
}c.one(document.body).append(this.contentEl);
if(!this.params.contentOnly){var d="sqs-lightbox-overlay"+(this.params.name?" sqs-lightbox-overlay-"+this.params.name:"")+" "+this.params.theme;
if(this.params.name){d+=" sqs-lightbox-overlay-"+this.params.name
}if(this.params.overlayStyle){d+=" sqs-lightbox-overlay-style-"+this.params.overlayStyle
}this.overlayEl=c.DB.DIV(d);
this.overlayEl.setStyles({zIndex:this.params.zIndex-1});
c.one(document.body).append(this.overlayEl);
this.fire("showing");
this.a=c.Squarespace.Transitions.getTransition({el:this.overlayEl,opacity:this.params.opacity,name:"fade",direction:"in",duration:this.params.overlayShowDuration});
this.a.on("end",function(){this.fire("overlay-visible");
this.a=null;
this._showContent()
},this);
this.a.run();
if(!this.params.disableNormalClose){this.events.push(c.on("click",this.close,this.overlayEl,this))
}}else{this._showContent()
}if(this.params.clickAnywhereToExit){this.events.push(c.on("click",this.hide,this.contentEl,this))
}},position:function(){if(!this.enabled){return
}var h=c.one(document).get("winWidth");
var e=c.one(document).get("winHeight");
var g,d;
if(h<this.naturalW+(this.params.margin*2)){g=h-(this.params.margin*2)
}else{g=this.naturalW
}if(e<this.naturalH+(this.params.margin*2)){d=e-(this.params.margin*2)
}else{d=this.naturalH
}var i=(h-g)/2;
var f=(e-d)/2;
if(this.contentAttached){this.contentEl.setStyles({left:i+"px",top:f+"px",width:g+"px"});
if(!this.params.noHeightConstrain){this.contentEl.setStyles({height:d+"px"})
}if(this.resizeTarget){this.resizeTarget.resizeToParent({scale:"contain"})
}}this.fire("position",{width:g,height:d,verticalWidth:h,verticalHeight:e,maxWidth:h-(this.params.margin*2),maxHeight:e-(this.params.margin*2)})
},_showContent:function(){this.contentAttached=true;
this.resizeTarget=this.contentEl.one(".resize-target");
this.naturalW=this.contentEl.get("offsetWidth");
this.naturalH=this.contentEl.get("offsetHeight");
this.position();
this.fire("content-ready");
var d=c.Squarespace.Transitions.getTransition({el:this.contentEl,name:this.params.transition,direction:"in",duration:this.params.contentShowDuration});
d.on("end",function(){this.fire("content-visible")
},this);
d.run()
},close:function(d){if(!this.params.clickAnywhereToExit){if(!d||this.overlayEl.compareTo(d.target)){return
}}this.hide()
},hide:function(){if(!this.enabled){return
}if(this.a){this.a.stop()
}this.a=null;
this.fire("hiding");
c.Squarespace.EscManager.removeTarget(this);
if(this.overlayEl){var d=c.Squarespace.Transitions.getTransition({el:this.overlayEl,name:"fade",direction:"out",duration:this.params.overlayShowDuration});
if(this.params.overlayShowDuration>this.params.contentShowDuration){this.a=d
}d.run()
}var d=c.Squarespace.Transitions.getTransition({el:this.contentEl,name:this.params.transition,direction:"out",duration:this.params.contentShowDuration});
if(!this.a){this.a=d
}d.run();
this.a.on("end",function(){this.destroy();
this.fire("hidden")
},this)
},destroy:function(){for(var d=0;
d<this.events.length;
++d){this.events[d].detach()
}if(this.contentEl){this.contentEl.remove()
}if(this.overlayEl){this.overlayEl.remove()
}this.contentEl=null;
this.overlayEl=null;
this.events=[]
}});
c.augment(c.Squarespace.Lightbox,c.EventTarget);
c.Squarespace.CustomAnim=Class.create({initialize:function(d){this.params=d
},cancel:function(){},stop:function(){}});
c.augment(c.Squarespace.CustomAnim,c.EventTarget);
c.augment(c.Squarespace.CustomAnim,c.Attribute);
c.Squarespace.Transitions={STANDARD_DURATION:0.3,getTransition:function(d){if(!d.el||!d.el._node){console.warn("ui-base: [Transitions] You're trying to animate a non-existent element, returning blank animation");
return new c.Anim()
}if(!d.duration){d.duration=c.Squarespace.Transitions.STANDARD_DURATION
}return c.Squarespace.Transitions.transitionsByName[d.name](d)
},transitionsByName:{fade:function(d){return new c.Anim({node:d.el,to:{opacity:(d.opacity==null?(d.direction=="in"?1:0):d.opacity)},duration:c.Squarespace.Transitions.STANDARD_DURATION,easing:c.Easing.easeOutStrong})
},scale:function(d){return new (Class.extend(c.Squarespace.CustomAnim,{run:function(){if(!d.opacity){d.opacity=1
}if(d.duration==null){d.duration=c.Squarespace.Transitions.STANDARD_DURATION
}var e=this.params.el;
if(this.params.direction=="in"){e.setStyles({transform:"scale(.95)",opacity:0});
c.later(10,e,e.setStyles,{transitionProperty:"transform, opacity",transitionDuration:d.duration+"s",transitionTimingFunction:"ease-out","backface-visibility":"hidden"});
c.later(20,e,e.setStyles,{transform:"scale(1)",opacity:d.opacity})
}else{e.setStyles({transform:"scale(1)",opacity:d.opacity});
c.later(10,e,e.setStyles,{transitionProperty:"transform, opacity",transitionDuration:d.duration+"s",transitionTimingFunction:"ease-out",backfaceVisibility:"hidden"});
c.later(20,e,e.setStyles,{transform:"scale(.95)",opacity:0})
}c.later((d.duration*1000)+100,this,function(){this.fire("end",{_event:true})
})
}}))(d)
},none:function(d){return new (Class.extend(c.Squarespace.CustomAnim,{run:function(){if(this.params.direction=="in"){this.el.setStyle("opacity",1)
}else{this.el.setStyle("opacity",0)
}this.fire("end")
}}))(d)
}}};
c.Squarespace.Effects={bounce:function(d){d.setStyles({transform:"scale(1)"});
c.later(10,d,d.setStyles,{transitionProperty:"transform, opacity",transitionDuration:".2s",transitionTimingFunction:"ease-out",backfaceVisibility:"hidden"});
c.later(20,d,d.setStyles,{transform:"scale(1.3)"});
c.later(200,d,d.setStyles,{transform:"scale(1)"})
},focus:function(e){e.setStyle("outline","4px solid rgba(99, 145, 0, 0.8)");
var d=new c.Anim({node:e,to:{},duration:1.4,easing:c.Easing.easeOutStrong});
d.on("tween",function(g){var f=(1-(this.get("elapsedTime")/(this.get("duration")*1000)));
this.get("node").setStyle("outline","4px solid rgba(99, 145, 0, "+(f)+")")
});
d.on("end",function(){this.get("node").setStyle("outline","")
});
d.run()
},blink:function(e){var d=new c.Anim({node:e,to:{opacity:0},duration:0.6,easing:c.Easing.easeOutStrong});
d.on("end",function(){var f=new c.Anim({node:this.get("node"),to:{opacity:1},duration:0.6,easing:c.Easing.easeOutStrong});
f.on("end",function(){});
f.run()
});
d.run()
}};
c.Squarespace.NodeDestroyNotifier=c.Base.create("NodeDestroyNotifier",c.Plugin.Base,[],{destructor:function(){if(this.get("onDestroy")){this.get("onDestroy").call(this.get("context")||this)
}}},{NS:"nodedestroynotifier",ATTRS:{onDestroy:{},context:{}}});
c.augment(c.Node,Class.create({intersectXY:function(f,e){var d=this.get("region");
return(d.left<f&&f<d.right&&d.top<e&&e<d.bottom)
},forceClass:function(d,e){this[e?"addClass":"removeClass"](d)
},data:function(d){var e=this._node;
if(d){while(e){if(e.data&&e.className.indexOf(d)!=-1){return e.data
}e=e.parentNode
}}else{while(e){if(e.data){return e.data
}e=e.parentNode
}}return(null)
},setNodeData:function(d){this._node.data=d
}}));
c.Squarespace.RelativeTimeDisplay=c.Base.create("RelativeTimeDisplay",c.Plugin.Base,[],{initializer:function(){this.timer=c.later(this.get("interval"),this,this.syncUI,{},true);
this.syncUI()
},syncUI:function(){var d=Math.floor((new Date().getTime()-this.get("date").getTime())/1000);
if(d<60){if(d===0){this.get("host").setContent("just now")
}else{this.get("host").setContent("about "+d+" seconds ago")
}}else{this.get("host").setContent(c.Squarespace.Utils.humanizeDate(this.get("date"),true))
}},destructor:function(){this.timer.cancel()
}},{NS:"RelativeTimeDisplay",CSS_NAMESPACE:"sqs-action-overlay",ATTRS:{date:{valueFn:function(){return new Date()
}},interval:{value:5000}}});
c.Squarespace.PositionAnimator=c.Base.create("PositionAnimator",c.Plugin.Base,[],{initializer:function(){},hold:function(){this.set("originalTop",this.get("host").get("offsetTop"));
this.set("originalLeft",this.get("host").get("offsetLeft"));
this.previousPosition=this.get("host").getStyle("position")
},release:function(){var e=this.get("host").get("offsetTop");
var g=this.get("host").get("offsetLeft");
this.get("host").setStyles({position:"relative",top:this.get("originalTop")-e,left:this.get("originalLeft")-g});
var d=this;
var f=this.get("host").anim({top:0,left:0},{duration:this.get("baseSpeed")+(Math.random()*0.2),end:function(){if(!this.get("node")._node){return
}this.get("node").setStyles({position:this.previousPosition,top:null,left:null});
if(d.get("releasedFn")){d.get("releasedFn")()
}d.fire("released")
}});
setTimeout(function(){f.run()
},200*Math.random())
},destructor:function(){}},{NS:"positionAnimator",ATTRS:{originalTop:{},originalLeft:{},releasedFn:{value:false},baseSpeed:{value:0.2}}})
},"1.0",{requires:["node","base","plugin","event-custom","attribute","squarespace-dombuilder","anim","squarespace-ui-base-css","thirdparty-spinner"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-json-template",function(V){V.namespace("JSONTemplate");
var K="apply ";
function X(a){return a.replace(/([\{\}\(\)\[\]\|\^\$\-\+\?])/g,"\\$1")
}var Z={};
function C(e,c){var a=e+c;
var d=Z[a];
if(d===undefined){var b="("+X(e)+"\\S.*?"+X(c)+"\n?)";
d=new RegExp(b,"g")
}return d
}V.JSONTemplate.DEFAULT_FORMATTERS=V.Squarespace.TEMPLATE_FORMATTERS;
V.JSONTemplate.DEFAULT_PREFIX_FORMATTERS=[].concat(V.Squarespace.TEMPLATE_PREFIX_FORMATTERS,[{name:"pluralize",func:function(c,e,a){var d,b;
switch(a.length){case 0:d="";
b="s";
break;
case 1:d="";
b=a[0];
break;
case 2:d=a[0];
b=a[1];
break;
default:throw {name:"EvaluationError",message:"pluralize got too many args"}
}return(c==1)?d:b
}},{name:"encode-space",func:function(b,c,a){return b.replace(/\s/g,"&nbsp;")
}},{name:"truncate",func:function(c,d,e){var a=e[0]||100;
var b=e[1]||"...";
if(c&&c.length>a){c=c.substring(0,a);
c=c.replace(/\w+$/,"");
c+=b
}return c
}},{name:"date",func:function(d,f,a){if(!V.Lang.isNumber(d)){return"Invalid date."
}var b=0,e=f.get("website.machineTimeZoneOffset");
if(e&&V.Lang.isNumber(e)){b=parseInt(e)
}var c=a.join(" ");
return V.DataType.Date.format(new Date(d+b),{format:c})
}},{name:"image",func:function(b,c,d){var a;
if(b.mediaFocalPoint){a=b.mediaFocalPoint.x+","+b.mediaFocalPoint.y
}return'<img class="'+(d[0]?d[0]:"thumb-image")+'" '+(b.title?'alt="'+V.Squarespace.Escaping.escapeForHtmlTag(b.title)+'" ':"")+' data-image="'+b.assetUrl+'" data-image-dimensions="'+b.originalSize+'" data-image-focal-point="'+a+'"/>'
}},{name:"timesince",func:function(c,d,a){if(!V.Lang.isNumber(c)){return"Invalid date."
}var b=a.join(" ");
return'<span class="timesince" data-date="'+c+'">'+V.Squarespace.Utils.humanizeDate(c)+"</span>"
}},{name:"resizedHeightForWidth",func:function(f,h,g){var c=f.split("x");
if(c.length!=2){return"Invalid source parameter.  Pass in 'originalSize'."
}var b=parseInt(c[0],10);
var e=parseInt(c[1],10);
var a=parseInt(g[0],10);
var i=a/b;
var d=parseInt(e*i,10);
return d
}},{name:"resizedWidthForHeight",func:function(f,i,g){var d=f.split("x");
if(d.length!=2){return"Invalid source parameter.  Pass in 'originalSize'."
}var c=parseInt(d[0],10);
var e=parseInt(d[1],10);
var a=parseInt(g[0],10);
var b=a/e;
var h=parseInt(c*b,10);
return h
}},{name:"squarespaceThumbnailForWidth",func:function(b,c,a){return V.Squarespace.Rendering.getSquarespaceSizeForWidth(parseInt(a[0],10))
}},{name:"squarespaceThumbnailForHeight",func:function(f,i,g){var d=f.split("x");
if(d.length!=2){return"Invalid source parameter.  Pass in 'originalSize'."
}var c=parseInt(d[0],10);
var e=parseInt(d[1],10);
var a=parseInt(g[0],10);
var b=a/e;
var h=parseInt(c*b,10);
return V.Squarespace.Rendering.getSquarespaceSizeForWidth(h)
}},{name:"cycle",func:function(b,c,a){return a[(b-1)%a.length]
}}]);
var H=function(a){return{lookup:function(b){var c=a[b]||null;
return[c,null]
}}
};
var A=function(a){return{lookup:function(b){for(var d=0;
d<a.length;
d++){var e=a[d].name,c=a[d].func;
if(b.slice(0,e.length)==e){var f;
var g=b.charAt(e.length);
if(g===""){f=[]
}else{f=b.split(g).slice(1)
}return[c,f]
}}return[null,null]
}}
};
var S=function(a){return{lookup:function(b){for(var c=0;
c<a.length;
c++){var d=a[c].lookup(b);
if(d[0]){return d
}}return[null,null]
}}
};
function E(b,c){var a=[{context:b,index:-1}];
return{PushSection:function(e){if(e===undefined||e===null){return null
}var d;
if(e=="@"){d=a[a.length-1].context
}else{d=a[a.length-1].context[e]||null
}a.push({context:d,index:-1});
return d
},Pop:function(){a.pop()
},next:function(){var e=a[a.length-1];
if(e.index==-1){e={context:null,index:0};
a.push(e)
}var d=a[a.length-2].context;
if(e.index==d.length){a.pop();
return undefined
}e.context=d[e.index++];
return true
},_Undefined:function(d){if(c===undefined){return null
}else{return c
}},_LookUpStack:function(h){var f=a.length-1;
while(true){var d=a[f];
if(h=="@index"){if(d.index!=-1){return d.index
}}else{var g=d.context;
if(typeof g==="object"){var e=g[h];
if(e!==undefined){return e
}}}f--;
if(f<=-1){return this._Undefined(h)
}}},get:function(g){if(g=="@"){return a[a.length-1].context
}var d=g.split(".");
var e=this._LookUpStack(d[0]);
if(d.length>1){for(var f=1;
f<d.length;
f++){if(e==null){return"[JSONT: Can't resolve '"+g+"'.]"
}e=e[d[f]];
if(e===undefined){return this._Undefined(d[f])
}}}return e
}}
}var T=function(a){var b={};
b.current_clause=[];
b.Append=function(c){b.current_clause.push(c)
};
b.AlternatesWith=function(){throw {name:"TemplateSyntaxError",message:"{.alternates with} can only appear with in {.repeated section ...}"}
};
b.NewOrClause=function(c){throw {name:"NotImplemented"}
};
return b
};
var Q=function(a){var b=T(a);
b.statements={"default":b.current_clause};
b.section_name=a.section_name;
b.Statements=function(c){c=c||"default";
return b.statements[c]||[]
};
b.NewOrClause=function(c){if(c){throw {name:"TemplateSyntaxError",message:"{.or} clause only takes a predicate inside predicate blocks"}
}b.current_clause=[];
b.statements.or=b.current_clause
};
return b
};
var D=function(a){var b=Q(a);
b.AlternatesWith=function(){b.current_clause=[];
b.statements.alternate=b.current_clause
};
return b
};
var R=function(a){var b=T(a);
b.clauses=[];
b.NewOrClause=function(c){c=c||[function(d){return true
},null];
b.current_clause=[];
b.clauses.push([c,b.current_clause])
};
return b
};
function O(a,e,b){for(var f=0;
f<a.length;
f++){var c=a[f];
if(typeof(c)=="string"){b(c)
}else{var d=c[0];
var g=c[1];
d(g,e,b)
}}}function U(e,f,b){var d;
d=f.get(e.name);
for(var g=0;
g<e.formatters.length;
g++){var c=e.formatters[g];
var h=c[0];
var a=c[1];
d=h(d,f,a)
}b(d)
}function L(f,e,b){var c=f;
var d=e.PushSection(c.section_name);
var a=false;
if(d){a=true
}if(d&&d.length===0){a=false
}if(a){O(c.Statements(),e,b);
e.Pop()
}else{e.Pop();
O(c.Statements("or"),e,b)
}}function I(j,d,e){var c=j;
var h=d.get("@");
for(var b=0;
b<c.clauses.length;
b++){var i=c.clauses[b];
var f=i[0][0];
var g=i[0][1];
var k=i[1];
var a=f(h,d,g);
if(a){O(k,d,e);
break
}}}function W(g,d,e){var a=g;
var f=d.PushSection(a.section_name);
var b=true;
if(f&&f.length>0){var i=f.length-1;
var h=a.Statements();
var c=a.Statements("alternate");
for(var j=0;
d.next()!==undefined;
j++){O(h,d,e);
if(j!=i){O(c,d,e)
}}}else{O(a.Statements("or"),d,e)
}d.Pop()
}var F=/(repeated)?\s*(section)\s+(\S+)?/;
var J=/^or(?:[\s\-]+(.+))?/;
var Y=/^if(?:[\s\-]+(.+))?/;
function P(i,k){var e=new S([H(V.JSONTemplate.DEFAULT_FORMATTERS),A(V.JSONTemplate.DEFAULT_PREFIX_FORMATTERS)]);
var n=S([H(V.JSONTemplate.DEFAULT_PREDICATES),A(V.JSONTemplate.DEFAULT_PARAMETRIC_PREDICATES)]);
var am="str";
function q(ab){if(ab.startsWith(K)){var ac=k.partials[ab.substr(K.length)];
if(ac){return[function(ad,ae,af){return V.JSONTemplate.evaluateJsonTemplate(ac,ad)
},null]
}else{throw {name:"BadPartialInclude",message:ab.substr(K)+" is not a valid partial. Remember, loops are not supported (a partial include cannot be included inside itself)."}
}}var aa=e.lookup(ab);
if(!aa[0]){throw {name:"BadFormatter",message:ab+" is not a valid formatter"}
}return aa
}function ap(aa){var ab=n.lookup(aa);
if(!ab[0]){throw {name:"BadPredicate",message:aa+" is not a valid predicate"}
}return ab
}var h=k.format_char||"|";
if(h!=":"&&h!="|"){throw {name:"ConfigurationError",message:"Only format characters : and | are accepted"}
}var aj=k.meta||"{}";
var w=aj.length;
if(w%2==1){throw {name:"ConfigurationError",message:aj+" has an odd number of metacharacters"}
}var y=aj.substring(0,w/2);
var ag=aj.substring(w/2,w);
var ai=C(y,ag);
var an=Q({});
var l=[an];
var ak=y.length;
var b;
var r;
var a=0;
while(true){b=ai.exec(i);
if(b===null){break
}else{var r=b[0]
}if(b.index>a){var x=i.slice(a,b.index);
an.Append(x)
}a=ai.lastIndex;
var d=false;
if(r.slice(-1)=="\n"){r=r.slice(null,-1);
d=true
}r=r.slice(ak,-ak);
if(r.charAt(0)=="#"){continue
}if(r.charAt(0)=="."){r=r.substring(1,r.length);
var z={"meta-left":y,"meta-right":ag,space:" ",tab:"\t",newline:"\n"}[r];
if(z!==undefined){an.Append(z);
continue
}var p,o;
var v=r.match(F);
if(v){var aq=v[1];
var f=v[3];
if(aq){o=W;
p=D({section_name:f})
}else{o=L;
p=Q({section_name:f})
}an.Append([o,p]);
l.push(p);
an=p;
continue
}var m,ao;
var al=r.match(J);
if(al){m=al[1];
ao=m?ap(m):null;
an.NewOrClause(ao);
continue
}var ah=false;
var c=r.match(Y);
if(c){m=c[1];
ah=true;
if(m.indexOf("?")==-1){var g=(function(aa){return function(ab,ac){if(aa.indexOf(" || ")!==-1){var ae=aa.split("||");
for(var ad=0;
ad<ae.length;
ad++){var af=ae[ad].trim();
if(ac.get(af)){return true
}}return false
}else{if(aa.indexOf(" && ")!==-1){var ae=aa.split(" && ");
for(var ad=0;
ad<ae.length;
ad++){var af=ae[ad].trim();
if(!ac.get(af)){return false
}}return true
}else{return(ac.get(aa))
}}}
}(m));
ao=[g,null];
p=R();
p.NewOrClause(ao);
an.Append([I,p]);
l.push(p);
an=p;
continue
}}else{if(r.charAt(r.length-1)=="?"||r.split(" ")[0].charAt(r.split(" ")[0].length-1)=="?"){m=r;
ah=true
}}if(ah){ao=m?ap(m):null;
p=R();
p.NewOrClause(ao);
an.Append([I,p]);
l.push(p);
an=p;
continue
}if(r=="alternates with"){an.AlternatesWith();
continue
}if(r=="end"){l.pop();
if(l.length>0){an=l[l.length-1]
}else{throw {name:"TemplateSyntaxError",message:"Got too many {end} statements"}
}continue
}}var t=r.split(h);
var j;
var s;
if(t.length==1){if(am===null){throw {name:"MissingFormatter",message:"This template requires explicit formatters."}
}j=[q(am)];
s=r
}else{j=[];
for(var u=1;
u<t.length;
u++){j.push(q(t[u]))
}s=t[0]
}an.Append([U,{name:s,formatters:j}]);
if(d){an.Append("\n")
}}an.Append(i.slice(a));
if(l.length!==1){throw {name:"TemplateSyntaxError",message:"Got too few {end} statements."}
}return an
}var G=/^([a-zA-Z\-]+):\s*(.*)/;
var B=["meta","format-char","default-formatter","undefined-str"];
var M=new RegExp(B.join("|"));
function N(g,f){var i={};
var a=0,l=0;
while(true){var d=false;
l=g.indexOf("\n",a);
if(l==-1){break
}var e=g.slice(a,l);
a=l+1;
var k=e.match(G);
if(k!==null){var c=k[1].toLowerCase(),h=k[2];
if(c.match(M)){c=c.replace("-","_");
h=h.replace(/^\s+/,"").replace(/\s+$/,"");
if(c=="default_formatter"&&h.toLowerCase()=="none"){h=null
}i[c]=h;
d=true
}}if(!d){break
}}var j;
if(i!=={}){j=g.slice(a)
}else{j=g
}for(var b in f){i[b]=f[b]
}return V.JSONTemplate.Template(j,i)
}V.JSONTemplate.Template=Class.create({initialize:function(a,c,b){a=this.removeMultilineComments(a);
this._options=c||{};
this._program=P(a,this._options)
},removeMultilineComments:function(b){var c=b.search("{##");
var a;
while(c>=0){a=b.substr(c);
b=b.substr(0,c)+a.substr(a.search("##}")+3);
c=b.search("{##")
}return b
},render:function(a,b){var c=E(a,this._options.undefined_str);
O(this._program.Statements(),c,b)
},expand:function(a){var b=[];
this.render(a,function(c){b.push(c)
});
return b.join("")
}});
V.JSONTemplate.DEFAULT_PREDICATES=V.Squarespace.TEMPLATE_PREDICATES;
V.JSONTemplate.DEFAULT_PARAMETRIC_PREDICATES=V.Squarespace.TEMPLATE_PARAMETRIC_PREDICATES;
V.JSONTemplate.evaluateJsonTemplate=function(c,b,a){if(typeof(c)!="string"){return"JSON Template Error: Processing failed because no input was provided. (type: "+typeof(c)+", template: "+JSON.stringify(c)+", dictionary: "+JSON.stringify(b)+", partials: "+JSON.stringify(a)+")"
}return new V.JSONTemplate.Template(c,{partials:a}).expand(b)
}
},"1.0",{requires:["datatype-date-format","squarespace-common","squarespace-util","json","squarespace-template-helpers"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-comments",function(a){a.namespace("Squarespace");
a.Squarespace.Comments=Class.create({initialize:function(b){this.settings={likesAllowed:b.likesAllowed,flagsAllowed:b.flagsAllowed,threaded:b.threaded,approvalRequired:b.approvalRequired,allowAnon:b.allowAnon,avatarsHidden:!b.avatarsOn,readOnly:b.readOnly};
this.commentData=new a.Squarespace.CommentData({target:b.identifier,targetType:b.type,settings:this.settings,formatter:a.bind(this.formatData,this)});
this.targetId=b.identifier;
this.params=(b||{design:{}});
this.replyCompleteEvents={};
this.threadState=false;
this.lastSortTime=new Date();
this.lastHashChangeTime=new Date();
this.PaginationModes={EXTEND:1,PAGE:2};
this.containerEl=a.one(this.params.containerEl);
this.params.paginationMode=this.PaginationModes.EXTEND;
this.type=a.Squarespace.WidgetTypes.COMMENT;
this.currentPage=1;
this.maxComments=50;
this.sortOrderLookup=[null];
this.sortOrderLookup.push("Oldest First","Newest First","Most Liked","Least Liked");
this.sortOrder=this.params.sortType;
this.commentsEl=a.DB.DIV("comments-content",a.DB.DIV("comment-list"));
this.commentsEl.appendTo(this.containerEl);
this.loadMoreNode=a.DB.DIV("load-more",a.DB.DIV("view-more-btn",{html:"Load More Comments"}));
this.fullViewNode=a.DB.DIV("full-view-btn",{html:"View full comment thread"});
this.history=new a.HistoryHash();
this.commentsEl.delegate("click",this.onReplyToggleClick,".reply",this);
this.commentsEl.delegate("click",this.onLikeClick,".comment:not(.liked):not(.read-only) .like",this);
this.commentsEl.delegate("click",this.onUnlikeClick,".comment.liked:not(.read-only) .like",this);
this.commentsEl.delegate("click",this.onFlagClick,".comment:not(.flagged):not(.read-only) .flag",this);
this.commentsEl.delegate("click",this.onUnflagClick,".comment.flagged:not(.read-only) .flag",this);
this.commentsEl.delegate("click",this.onApproveClick,".comment.unmoderated:not(.read-only) .approve",this);
this.commentsEl.delegate("click",this.onDeleteClick,".comment:not(.read-only) .delete",this);
this.commentsEl.delegate("click",this.replyBtnOnClick,".reply-area-wrapper .comment-btn:not(.read-only)",this);
this.commentsEl.delegate("click",this.togglePreview,".reply-area-wrapper .preview-comment",this);
this.commentsEl.delegate("click",this.showSubscribe,".subscribe",this);
this.commentsEl.delegate("click",this.unsubscribe,".unsubscribe",this);
this.history.on("commentIdChange",this.commentIdHashOnChange,this);
this.history.on("commentIdRemove",this.commentIdHashOnRemove,this);
this.containerEl.delegate("click",(function(){var c,e,d;
return function(g){SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,allowAnonymous:this.settings.allowAnon,overlayOpacity:0.5});
var f=function(){this.onLoading();
this.commentData.visibleComments=0;
this.retrieveComments({onSuccess:function(h){this.fullDataRender(h)
},page:1,order:this.sortOrder},this);
c.detach();
d.detach()
};
c=SQUARESPACE_LOGIN.once("cancel",function(){e.detach();
d.detach()
},this);
e=SQUARESPACE_LOGIN.once("login",f,this);
d=SQUARESPACE_LOGIN.once("guestLogin",f,this);
SQUARESPACE_LOGIN.show()
}
})(),".squarespace-comment-login",this);
SQUARESPACE_LOGIN.on("login",function(){this.updateLikedFlaggedState();
this.refreshCommentPostButtons();
this.moderationMode=a.Squarespace.Utils.userHasAccessPermission(a.Squarespace.AccessPermissions.CONFIG_ACTIVITY_COMMENTS)
},this);
SQUARESPACE_LOGIN.on("logout",function(){this.updateLikedFlaggedState();
this.refreshCommentPostButtons();
this.refreshSubscribeControl();
this.moderationMode=false
},this);
this.containerEl.delegate("click",function(c){SQUARESPACE_LOGIN.onLogoutClick()
},".squarespace-comment-logout",this);
this.containerEl.delegate("focus",function(){this.set("text","");
this.setAttribute("data-edited",true)
},".comment-input");
this.containerEl.delegate("blur",function(){if(this.get("value")===""){this.setAttribute("data-edited",false)
}},".comment-input");
this.containerEl.delegate("focus",function(c){c.target.setAttribute("data-edited",true)
},".new-comment-area textArea",this);
this.containerEl.delegate("click",this.extendComments,".view-more-btn",this);
this.containerEl.delegate("click",this.fullViewOnClick,".full-view-btn",this);
this.containerEl.delegate("click",this.commentBtnOnClick,".top-level-comment-area .comment-btn:not(.read-only)",this);
this.containerEl.delegate("click",this.togglePreview,".top-level-comment-area .preview-comment",this);
this.containerEl.delegate("change",function(c){this.sort(c.target.get("value"))
},".hidden-ordering",this);
a.Cookie.remove("displayName",{path:"/"});
this.subscribeDialogParams={name:"subscribe",style:"flyout",flyoutPointerDirection:"top",width:320,position:"center",closeable:true,overlay:0.5,top:200,discardChangesConfirmation:false,title:"Subscribe by Email",primaryTabs:[{title:"Subscribe by Email",icon:"/universal/images-v6/standard/icon_invites_24_light.png",fields:[{type:"text",required:true,name:"email",title:"Email",fieldStyle:"normal",titleStyle:"inline",submitOnEnter:true,style:"major"},{type:"description",text:"Subscribe to this comment thread by email.",padding:[0,0]}]}],buttons:[{type:"cancel",title:"Cancel"},{type:"saveAndClose",title:"Submit"}]}
},doAfterLogin:function(c,b,f){var g,e,d;
e=c.once("login",function(){b.call(this);
d.detach();
g.detach()
},f);
d=c.once("guestLogin",function(){e.detach();
g.detach()
});
g=c.once("cancel",function(){e.detach();
d.detach()
})
},doAfterGuestLogin:function(c,b,f){var g,d,e;
d=c.once("guestLogin",function(){b.call(this);
e.detach();
g.detach()
},f);
e=c.once("login",function(){d.detach();
g.detach()
});
g=c.once("cancel",function(){d.detach();
e.detach()
})
},fullViewOnClick:function(){this.history.addValue("commentId",null)
},updateTopLevelButton:function(){var c=a.one(".top-level-comment-area .comment-btn"),d={newCommentAreaTop:{authenticatedAccount:(SQUARESPACE_LOGIN.account===null?undefined:SQUARESPACE_LOGIN.account)},comments:[{}]},b=this.renderToFragment(d),e=b.one(".top-level-comment-area .comment-btn");
if(c){c.ancestor(".comment-btn-wrapper").append(e);
c.remove(true)
}},updateReplyAreaButtons:function(){var c={comments:[{authenticatedAccount:SQUARESPACE_LOGIN.account}]},b=this.renderToFragment(c).one(".reply-area-wrapper .comment-btn");
if(b){this.commentsEl.all(".reply-area-wrapper .comment-btn").each(function(d){d.insert(b.cloneNode(true),"after");
d.remove(true)
})
}},refreshCommentPostButtons:function(){this.updateTopLevelButton();
this.updateReplyAreaButtons()
},refreshSubscribeControl:function(){if(!SQUARESPACE_LOGIN.account){Static.SQUARESPACE_CONTEXT.subscribed=false
}var c={subscribed:Static.SQUARESPACE_CONTEXT.subscribed,comments:[{}]},d,b=this.renderToFragment(this.scatterData(c)).one(".subscribe-control");
if(b){d=a.one(".subscribe-control");
d.insert(b,"after");
d.remove(true)
}},generatePreview:function(b){var g=a.Squarespace.Escaping.escapeForHtml(b.get("value")),j={comments:[{}]},c=null,k=null,f=j.comments[0],e=b.ancestor(".reply-area-wrapper"),i=!b.ancestor(".reply-area-wrapper"),d,h;
if(!i){h=a.one('.comment[data-commentId="'+b.ancestor(".reply-area-wrapper").getAttribute("data-commentId")+'"]');
d=(h.hasAttribute("data-depth")?parseInt(h.getAttribute("data-depth"),10)+1:1)
}else{d=0
}f.body=a.Squarespace.Lang.markdownToHTML(a.Squarespace.Utils.preFormatMarkdown(g));
f.memberAccount=a.clone(SQUARESPACE_LOGIN.account);
f.authorName=((SQUARESPACE_LOGIN.account?SQUARESPACE_LOGIN.account.displayName:a.Cookie.get("displayName"))||"Not Logged In");
f.addedOn=(new Date()).getTime();
f.depth=d;
k=this.renderToFragment(this.scatterData(j));
c=k.one(".comment");
c.addClass("comment-preview");
if(i){c.addClass("top-level")
}else{c.setAttribute("data-previewId",h.getAttribute("data-commentId"));
c.setAttribute("data-replyTo",h.getAttribute("data-commentId"))
}return k
},replyBtnOnClick:function(g){var j=g.target.ancestor(".reply-area-wrapper"),b=j.getAttribute("data-commentId"),i=a.one('.comment[data-commentId="'+b+'"]'),h=j.one("textArea"),f=h.get("value"),d,c=function(){var e=this.injectReply(f,i);
this.replyTo(j.getAttribute("data-commentId"),f,e,h)
};
if(f.trim()===""){this.showEmptyText()
}else{if(SQUARESPACE_LOGIN.account){d=new a.Squarespace.ConfirmationDialog({style:"proceedOrCancel",showScreenOverlay:false,confirmText:"Post Comment",width:214,onSuccess:c,scope:this});
d.show("Post Comment","Are you sure you want to post this comment?")
}else{c.call(this)
}}g.stopImmediatePropagation()
},subscribe:function(b){a.Data.post({url:"/api/comment/Subscribe",secure:true,data:{targetId:this.targetId},success:function(){Static.SQUARESPACE_CONTEXT.subscribed=true;
this.refreshSubscribeControl();
(new a.Squarespace.Information()).show("Subscribed","Successfully subscribed")
},failure:function(){SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,overlayOpacity:0.5});
this.doAfterLogin(SQUARESPACE_LOGIN,function(){this.subscribe(b)
},this);
SQUARESPACE_LOGIN.showCommentLogin("Log In to Subscribe","Subscribe",false)
}},this)
},unsubscribe:function(b){a.Data.post({url:"/api/comment/Unsubscribe",secure:true,data:{targetId:this.targetId},success:function(){Static.SQUARESPACE_CONTEXT.subscribed=false;
this.refreshSubscribeControl();
(new a.Squarespace.Information()).show("Unsubscribed","Successfully unsubscribed")
},failure:function(c){if(c.loginRequired){SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,overlayOpacity:0.5});
this.doAfterLogin(SQUARESPACE_LOGIN,function(){this.unsubscribe(b)
},this);
SQUARESPACE_LOGIN.showCommentLogin("Log In to Unsubscribe","Unsubscribe",false)
}}},this)
},showSubscribe:function(c){var b=new a.Squarespace.ConfirmationDialog({style:"proceedOrCancel",showScreenOverlay:false,confirmText:"Subscribe",width:344,onSuccess:this.subscribe,scope:this});
b.show("Subscribe to Thread","Are you sure you wish to subscribe to this comment thread? You will receive updates via the email on file in your profile.")
},togglePreview:function(b){var d=b.target.ancestor(".reply-area-wrapper"),c;
if(d){c=d.one("textArea")
}else{c=b.target.ancestor(".top-level-comment-area").one("textArea")
}if(c.get("value")!==""){if(b.target.getAttribute("data-state")==="open"){b.target.setAttribute("data-state","closed");
this.hidePreview(c)
}else{b.target.setAttribute("data-state","open");
this.showPreview(c)
}}},showPreview:function(c){if(c){var f=this.generatePreview(c),e=f.one(".comment"),d=c.ancestor(".reply-area-wrapper"),j=c.ancestor(".input"),h=!d,g,i,b;
e.wrap('<div class="new comment-preview-wrapper closed"></div>');
b=e.ancestor(".comment-preview-wrapper");
if(!h){d.insert(b,"after");
b.setAttribute("data-commentId",d.getAttribute("data-commentId"))
}else{b.addClass("top-level");
a.one(".comment-list").prepend(b)
}c.ancestor(".new-comment-area").one(".preview-comment").set("innerHTML","Edit");
j.setStyle("height",j.get("offsetHeight"));
g=new a.Anim({node:j,duration:0.3,easing:a.Easing.easeOutStrong,to:{height:0}});
g.on("start",function(){this._node.setStyle("overflow","hidden")
});
g.run();
i=new a.Anim({node:b,duration:0.3,easing:a.Easing.easeOutStrong,to:{height:e.get("offsetHeight")+parseInt(e.getComputedStyle("paddingBottom"),10)+parseInt(e.getComputedStyle("marginBottom"),10)}});
i.on("end",function(){this._node.addClass("open")
});
i.run()
}},hideAllPreviews:function(){a.all(".comment-preview-wrapper:not(.top-level)").each(function(c){var b=new a.Anim({node:c,duration:0.3,easing:a.Easing.easeOutStrong,to:{height:0}});
b.on("end",function(){this._node.remove(true)
});
b.run()
},this);
a.all('.preview-comment[data-state="open"]:not(.top-level-preview-btn)').each(function(b){b.setAttribute("data-state","closed");
b.set("innerHTML","Preview")
},this)
},hidePreview:function(f){if(f){var c=f.ancestor(".reply-area-wrapper"),e,d,b,g;
if(c){b=a.one('.comment-preview[data-previewId="'+c.getAttribute("data-commentId")+'"]')
}else{b=a.one(".comment-preview.top-level")
}f.ancestor(".new-comment-area").one(".preview-comment").set("innerHTML","Preview");
e=new a.Anim({node:f.ancestor(".input"),duration:0.3,easing:a.Easing.easeOutStrong,to:{height:f.get("offsetHeight")}});
e.on("end",function(){this._node.setStyle("overflow","visible")
});
e.run();
if(b){g=b.ancestor(".comment-preview-wrapper");
d=new a.Anim({node:g,duration:0.3,easing:a.Easing.easeOutStrong,to:{height:0}});
d.on("start",function(){this._node.removeClass("open");
this._node.addClass("closed")
});
d.on("end",function(){this._node.remove(true)
});
d.run()
}}},getTemplateData:function(c,b){a.Data.get({url:"/api/template/GetTemplateSchema",data:{type:a.Squarespace.WidgetTypes.COMMENTS,componentType:"widget"},success:function(d){this._template=new a.JSONTemplate.Template(d.html);
c.call(this)
},failure:b},this)
},updateLikedFlaggedState:function(){if(this.settings.flagsAllowed||this.settings.likesAllowed){this.commentData.getLikesAndFlags({success:function(c){var b=a.one(".comment-list");
b.all(".comment").each(function(e){var d=e.getAttribute("data-commentId");
if(this.settings.flagsAllowed){if(c.flagMap[d]){e.addClass("flagged")
}else{e.removeClass("flagged")
}}if(this.settings.likesAllowed){if(c.likeMap[d]){e.addClass("liked")
}else{e.removeClass("liked")
}}},this)
}},this)
}},create:function(){if(a.Squarespace.Utils.userHasAccessPermission(a.Squarespace.AccessPermissions.CONFIG_ACTIVITY_COMMENTS)){this.moderationMode=true
}this.getTemplateData(function(){var b=this.history.get("commentId");
if(!a.Lang.isUndefined(b)){this.onLoading();
this.retrieveThread({onSuccess:this.threadRender,onFailure:function(c){this.onLoading();
this.retrieveComments({onSuccess:function(d){this.fullDataRender(d)
},page:1,order:this.sortOrder})
},order:this.sortOrder,commentId:b})
}else{this.onLoading();
this.retrieveComments({onSuccess:function(c){this.fullDataRender(c)
},page:1,order:this.sortOrder})
}},function(){})
},updateCommentCounts:function(){var b=this.renderToFragment({visibleComments:this.commentData.visibleComments,totalComments:this.commentData.totalComments,comments:[]});
if(this.commentData.visibleComments===0){this.containerEl.addClass("empty")
}else{this.containerEl.removeClass("empty")
}a.one(".comment-count").set("innerHTML",b.one(".comment-count").get("innerHTML"))
},buildInfoPane:function(g){var c=(a.DB.DIV("squarespace-user-info",a.DB.DIV("user-info-header",a.DB.DIV("avatar",a.DB.IMG("",{src:(g.avatarId?"http://"+Static.SQUARESPACE_CONTEXT.website.identifier+"."+Static.SQUARESPACE_CONTEXT.appDomain+"/global/"+g.avatarId:"/universal/images-v6/default-avatar.png")+"?format=50w"})),a.DB.DIV("info",a.DB.DIV("name",{html:g.displayName}),a.DB.A("website",{href:(g.websiteUrl?"http://"+a.Squarespace.Escaping.escapeForHtml(g.websiteUrl):""),html:(g.websiteUrl||"")}))),a.DB.DIV("user-info-body",{html:"<p>"+a.Squarespace.Utils.truncateAt(a.Squarespace.Escaping.escapeForHtml(g.bio,60))+"</p>"}),a.DB.DIV("user-social-opts",a.DB.DIV("social-leftcol"),a.DB.DIV("social-rightcol"),a.DB.DIV("clearfix"))));
var b=c.one(".social-leftcol"),e=c.one(".social-rightcol");
var h=(function(){var i=function(k,j){return function(l){return"http://"+k+"."+("com"||j)+"/"+l
}
};
return{foursquare:function(j){if(/[a-zA-Z]/.exec(j)===null){return"http://www.foursquare.com/user/"+j
}else{return"http://www.foursquare.com/"+j
}},facebook:i("facebook"),twitter:i("twitter")}
})();
if(g.socialOptions){for(var d=0;
d<g.socialOptions.length;
d++){var f=a.DB.DIV("social-widget",a.DB.A("",{href:h[g.socialOptions[d].type](g.socialOptions[d].username)},a.DB.IMG("social-icon",{src:(g.socialOptions[d].type==="foursquare"?"/universal/images-v6/member/icon-foursquare-small.png":"/universal/images-v6/social/"+g.socialOptions[d].type+"_16.png")})),a.DB.A("social-name",{html:g.socialOptions[d].type,href:h[g.socialOptions[d].type](g.socialOptions[d].username)}));
if((d%2)===0){b.append(f)
}else{e.append(f)
}}}return c
},showClickOverlay:function(){var d=a.one(document),c=d.get("winHeight"),b=d.get("winWidth");
this.overlayEl=a.DB.DIV("user-profile-overlay");
this.overlayEl.setStyles({position:"fixed",background:"#000",height:c+"px",width:b+"px",opacity:"0",top:"0px",left:"0px",zIndex:999});
a.one("body").append(this.overlayEl);
a.on("click",this.hideUserProfileFlyout,this.overlayEl,this)
},showUserProfileFlyout:function(g){if(!g.target.hasClass("squarespace-comment-user-flyout")&&!g.target.ancestor(".squaresapce-comment-user-flyout")&&!this.flyoutOpen){var f=g.target.ancestor(".comment").getAttribute("data-commentid"),h=this.commentData.getCommentById(f);
var c=h.memberAccount;
if(!c){return
}var d=a.DB.DIV("squarespace-comment-user-flyout",this.buildInfoPane(c),a.DB.DIV("squarespace-user-activity",a.DB.DIV("squarespace-activity-header",a.DB.DIV("title",{html:"Activity"}),a.DB.DIV("description",{html:"Comments and likes across the Squarespace platform"})),a.DB.DIV("feed")),a.DB.DIV("squarespace-comment-user-clearfix"));
var b=a.one(document.body);
b.append(d);
d.setStyles({position:"fixed",left:"50%",top:"50%",opacity:0,zIndex:1000,transform:"scale(.95)"});
d.setStyles({marginTop:-(parseInt(d.get("offsetHeight"),10)/2),marginLeft:-(parseInt(d.get("offsetWidth"),10)/2)});
d.transition({WebkitTransform:{duration:0.3,easing:"ease-out",value:"scale(1)"},opacity:{duration:0.3,easing:"ease-out",value:1}});
a.Data.get({url:"/api/comment/GetRecentActivity",data:{user:c.id},success:function(l){for(var j=0;
j<l.authored.length;
j++){l.authored[j].type="authored"
}for(j=0;
j<l.liked.length;
j++){l.liked[j].type="liked"
}var e=l.authored.concat(l.liked);
for(j=0;
j<e.length;
j++){this.escapeComment(e[j])
}e.sort(function(m,i){return m.actionTime<i.actionTime
});
var k=d.one(".feed");
for(j=0;
j<3;
j++){k.append(a.DB.DIV("feed-item",a.DB.DIV("type-icon",a.DB.IMG("",{src:(e[j].type==="authored"?"/universal/images-v6/comments/icon-mail-16x16-wht.png":"/universal/images-v6/comments/icon-like-16x16-wht.png")})),a.DB.DIV("content",a.DB.DIV("header",{html:(e[j].type==="authored"?"Commented on ":"Liked a comment by "+e[j].comment.authorName+" on ")+'"'+e[j].targetName+'" '},a.DB.SPAN("time",{html:a.Squarespace.Utils.humanizeDate(parseInt(e[j].actionTime,10))})),a.DB.DIV("body",{html:a.Squarespace.Utils.truncateAtCharacters(e[j].comment.body,82)}))))
}},failure:function(e){d.one(".feed").append(a.DB.DIV("no-feed",{html:"This user's activity feed is unavailable."}))
}},this)
}this.flyoutOpen=true;
this.showClickOverlay();
g.stopImmediatePropagation()
},hideUserProfileFlyout:function(c){if(this.flyoutOpen){var b=a.one(".squarespace-comment-user-flyout");
if(b){b.transition({WebkitTransform:{duration:0.3,easing:"ease-out",value:"scale(1.08)"},opacity:{duration:0.4,easing:"ease-out",value:0},on:{end:a.bind(function(){b.remove(true);
c.target.remove(true);
this.flyoutOpen=false
},this)}})
}}},getThreadNodes:function(b,c){var d=b.getAttribute("data-commentId");
c.push(b);
a.all('.comment[data-replyTo="'+d+'"]').each(function(e){this.getThreadNodes(e,c)
},this)
},actualDelete:function(i,l,j){var h=i.target.ancestor(".comment"),b=h.getAttribute("data-commentId"),g,c,m=this.lastSortTime,f=this.lastHashChangeTime,k=function(e){if(m===this.lastSortTime&&f===this.lastHashChangeTime){g=a.DB.DIV("delete-anim-wrapper");
h.insert(g,"after");
j.forEach(function(p){g.append(p);
var o=a.one('.reply-area-wrapper[data-commentId="'+p.getAttribute("data-commentId")+'"]');
if(o){o.remove(true)
}});
c=new a.Anim({node:g,duration:0.5,easing:a.Easing.easeOutStrong,to:{height:0}});
c.on("end",function(){g.remove(true);
if(j.length>1){this.commentData.removeCommentsByIds(j.map(function(n){return n.getAttribute("data-commentId")
}).filter(function(n){return n!==b
}))
}this.updateCommentCounts()
},this);
c.run()
}},d=function(e){if(e.loginRequired){SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,overlayOpacity:0.5});
this.doAfterLogin(SQUARESPACE_LOGIN,function(){this.actaulDelete(i,l,j)
},this);
SQUARESPACE_LOGIN.showCommentLogin("Log In to Delete Comments","Delete Comments",false)
}else{if(e.authorizationFail){(new a.Squarespace.Alert("Authorization Failure","You are not allowed to perform that action.")).show()
}}};
this.commentData._delete({comments:[b],spam:l,success:k,failure:d},this)
},onDeleteClick:function(d){var k,c=d.target.ancestor(".comment"),f=function(){var e=[];
this.getThreadNodes(c,e);
return e
},h=f.call(this),b=function(){h.forEach(function(l){if(!l.hasClass("unmoderated")){var e=new a.Anim({node:l,duration:0.3,easing:a.Easing.easeOutStrong,to:{opacity:1}});
e.on("end",function(){this._node.removeClass("pending-delete")
});
e.run()
}else{l.removeClass("pending-delete")
}})
},g=function(){b();
this.actualDelete(d,true,h)
},j=function(){b();
this.actualDelete(d,false,h)
},i=function(){b()
};
h.forEach(function(l){if(!l.hasClass("unmoderated")){var e=new a.Anim({node:l,duration:0.3,easing:a.Easing.easeOutStrong,to:{opacity:0.5}});
e.on("end",function(){this._node.addClass("pending-delete")
});
e.run()
}else{l.addClass("pending-delete")
}});
k=new a.Squarespace.ConfirmationDialog({style:"confirmOrReject",rejectText:"Delete",showScreenOverlay:false,confirmText:"Delete & Report Spam",width:344,onCancel:i,onReject:j,onSuccess:g,scope:this});
k.show((h.length===1?"Delete Comment":"Delete "+h.length+" Comments"),(h.length>1?"Are you sure you wish to delete these comments?":"Are you sure you wish to delete this comment?"))
},onApproveClick:function(b){var c=b.target.ancestor(".comment");
this.approve(c.getAttribute("data-commentId"),c);
b.stopImmediatePropagation()
},approve:function(e,c){var d=function(f){this.updateCommentCounts()
},b=function(f){if(f.loginRequired){c.addClass("unmoderated");
SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,overlayOpacity:0.5});
this.doAfterLogin(SQUARESPACE_LOGIN,function(){this.approve(e,c)
},this);
SQUARESPACE_LOGIN.showCommentLogin("Log In to Approve Comments","Approve Comments",false)
}};
c.removeClass("unmoderated");
this.commentData.approve({comments:[e],success:d,failure:b},this)
},onUnlikeClick:function(b){var c=b.target.ancestor(".comment");
this.unlike(c.getAttribute("data-commentId"),c);
b.stopImmediatePropagation()
},unlike:function(f,d){var c=d.one(".likes"),e=function(){if(c){var h={comments:[{likesAllowed:{likeCount:this.commentData.getCommentById(f).likeCount}}]},g=this.renderToFragment(this.scatterData(h)).one(".likes");
c.replace(g)
}},b=function(g){d.addClass("liked");
if(g.loginRequired){SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,overlayOpacity:0.5});
this.doAfterLogin(SQUARESPACE_LOGIN,function(){this.unlike(f,d)
},this);
SQUARESPACE_LOGIN.showCommentLogin("Log In to Dislike Comment","Dislike Comment",false)
}};
d.removeClass("liked");
this.commentData.unlike({id:f,success:e,failure:b},this)
},onFlagClick:function(c){var b=function(){var d=c.target.ancestor(".comment");
this.flag(d.getAttribute("data-commentId"),d)
};
(new a.Squarespace.ConfirmationDialog()).show("Flag Comment","Are you sure you wish to flag this comment as inappropriate?",b,this);
c.stopImmediatePropagation()
},flag:function(e,c){var d=function(){},b=function(g){c.removeClass("flagged");
if(g.loginRequired){SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,overlayOpacity:0.5});
var f;
this.doAfterLogin(SQUARESPACE_LOGIN,function(){this.flag(e,c);
f.detach()
},this);
f=SQUARESPACE_LOGIN.once("cancel",function(){c.removeClass("flagged")
},this);
SQUARESPACE_LOGIN.showCommentLogin("Log In to Flag Comment","Flag Comment",false)
}};
c.addClass("flagged");
this.commentData.flag({id:e,success:d,failure:b},this)
},onUnflagClick:function(b){var c=b.target.ancestor(".comment");
this.unflag(c.getAttribute("data-commentId"),c);
b.stopImmediatePropagation()
},unflag:function(e,c){var d=function(){},b=function(f){c.addClass("flagged");
if(f.loginRequired){SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,opacity:0.5});
this.doAfterLogin(SQUARESPACE_LOGIN,function(){this.unflag(e,c)
},this);
SQUARESPACE_LOGIN.showCommentLogin("Log In to Unflag Comment","Unflag Comment",false)
}};
c.removeClass("flagged");
this.commentData.unflag({id:e,success:d,failure:b},this)
},onLikeClick:function(b){var c=b.target.ancestor(".comment");
this.like(c.getAttribute("data-commentId"),c);
b.stopImmediatePropagation()
},like:function(h,e){var c=e.one(".likes"),d=e.getAttribute("data-commentid"),g,f=function(){if(c&&!a.Lang.isNull(e._node)){var j={comments:[{likesAllowed:{likeCount:this.commentData.getCommentById(d).likeCount}}]},i=this.renderToFragment(this.scatterData(j)).one(".likes");
c.replace(i)
}},b=function(i){e.removeClass("liked");
if(i.loginRequired){SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,overlayOpacity:0.5});
this.doAfterLogin(SQUARESPACE_LOGIN,function(){this.like(h,e)
},this);
SQUARESPACE_LOGIN.showCommentLogin("Log In to Like Comment","Like Comment",false)
}};
e.addClass("liked");
this.commentData.like({id:h,success:f,failure:b},this)
},addLoadMoreControls:function(c){var b=a.one(".load-more");
if(b){b.remove(true)
}if(!this.threadState&&this.commentData.page<this.commentData.numPages){this.containerEl.append(this.loadMoreNode.cloneNode(true))
}},addFullViewControls:function(c){var b=a.one(".full-view-btn");
if(b){b.remove(true)
}if(this.threadState){this.containerEl.one(".comment-list").insert(this.fullViewNode.cloneNode(true),"before")
}},onReplyToggleClick:function(l){var j=l.target.ancestor(".comment"),d=j.getAttribute("data-commentid"),b=a.one('.reply-area-wrapper[data-commentid="'+d+'"]'),k=a.one("body"),g,f,m=a.bind(function(n,e){if(n){n.setStyles({overflow:"hidden",height:n.get("offsetHeight")});
n.one(".input").setStyle("height","auto");
a.one('.comment[data-commentid="'+n.getAttribute("data-commentId")+'"]').fire("reply-close");
g=new a.Anim({node:n,duration:0.3,easing:a.Easing.easeOutStrong,to:{height:0}});
g.on("end",function(){},this);
g.run()
}},this),i=a.bind(function(o){if(o){var n,e;
e=o.one(".new-comment-area").cloneNode(true);
e.setStyles({visibility:"hidden",display:"block",position:"absolute"});
j.append(e);
n=e.get("offsetHeight");
e.remove(true);
a.one('.comment[data-commentid="'+o.getAttribute("data-commentId")+'"]').fire("reply-open");
this.hideAllPreviews();
f=new a.Anim({node:o,duration:0.3,easing:a.Easing.easeOutStrong,to:{height:Math.max(n,190)+15}});
f.on("end",function(){this._node.setStyle("height","auto");
var q=(this._node.getY()+this._node.get("offsetHeight"))-(k.get("docScrollY")+k.get("winHeight")),r=k.get("scrollTop"),p;
if(q>=0){p=new a.Anim({node:k,duration:0.3,easing:a.Easing.easeOutStrong,to:{scrollTop:r+q}});
p.run()
}});
f.run()
}},this),h=function(e){return e.hasClass("reply-open")
};
if(h(j)){j.removeClass("reply-open");
this.hideAllPreviews();
m(b)
}else{b.one(".reply-area").setAttribute("replyid",d);
a.all(".comment.reply-open").each(function(o){o.removeClass("reply-open");
var e=a.one('.reply-area-wrapper[data-commentid="'+o.getAttribute("data-commentid")+'"]');
m(e)
});
var c=b.one("textArea");
if(!this.replyCompleteEvents[j.getAttribute("data-commentId")]){this.replyCompleteEvents[j.getAttribute("data-commentId")]=this.once("reply-complete",function(e){m(b,function(){this.one(".input").setStyle("height","auto")
});
this.replyCompleteEvents[j.getAttribute("data-commentId")]=null
},this)
}c.on("focus",function(){this.setAttribute("data-edited",true)
});
c.on("blur",function(){if(this.get("value")===""){this.setAttribute("data-edited",false)
}});
j.addClass("reply-open");
i(b)
}l.stopImmediatePropagation()
},escapeComment:function(b){b.authorName=a.Squarespace.Escaping.escapeForHtml(b.authorName);
if(b.memberAccount){b.memberAccount.displayName=a.Squarespace.Escaping.escapeForHtml(b.memberAccount.displayName);
b.memberAccount.bio=a.Squarespace.Escaping.escapeForHtml(b.memberAccount.bio)
}},addReplyArea:function(c){var e=a.one(".reply-area-wrapper"),g,d,b,f;
if(e){e.one(".preview-comment").setAttribute("data-state","closed").set("innerHTML","Preview");
g=e.cloneNode(true);
g.setAttribute("data-commentId",c.getAttribute("data-commentId"));
g.setAttribute("data-depth",c.getAttribute("data-depth"));
f=g
}else{d={comments:[{id:c.getAttribute("data-commentId"),depth:c.getAttribute("data-depth")}]};
b=this.renderToFragment(d);
f=b.one(".reply-area-wrapper").cloneNode(true)
}f.setStyle("height",null);
c.insert(f,"after")
},prependComment:function(h){var b=((SQUARESPACE_LOGIN.account?SQUARESPACE_LOGIN.account.displayName:a.Cookie.get("displayName"))||"Not Logged In"),c=a.one(".top-level-comment-area .comment-input"),d=a.one(".top-level.comment-preview"),e=false,g,f;
if(!d){d=this.generatePreview(c).one(".comment-preview");
e=true;
d.wrap('<div class="comment-preview-wrapper"></div>');
f=d.ancestor(".comment-preview-wrapper");
a.one(".comment-list").prepend(f)
}else{d.one(".author").set("innerHTML",b);
f=d.ancestor(".comment-preview-wrapper")
}d.removeClass("comment-preview");
d.addClass("pending");
a.one(".top-level-comment-area .preview-comment").setAttribute("data-state","closed");
this.hidePreview(c);
if(e){g=new a.Anim({node:f,duration:0.3,easing:a.Easing.easeOutStrong,to:{height:d.get("offsetHeight")+parseInt(d.getComputedStyle("marginBottom"),10)}});
g.on("end",function(){d.unwrap()
});
g.run()
}else{d.unwrap()
}this.containerEl.removeClass("empty");
this.makeMostRecent(d);
return d
},injectReply:function(h,j){var b=j.getAttribute("data-commentId"),i=a.one('.comment-preview-wrapper[data-commentId="'+b+'"]'),e=a.one('.reply-area-wrapper[data-commentId="'+b+'"]').one("textArea"),g=((SQUARESPACE_LOGIN.account?SQUARESPACE_LOGIN.account.displayName:a.Cookie.get("displayName"))||"Not Logged In"),f=false,d;
if(!i){d=this.generatePreview(e).one(".comment-preview");
f=true;
d.wrap('<div class="comment-preview-wrapper"></div>');
i=d.ancestor(".comment-preivew-wrapper")
}else{d=i.one(".comment-preview");
d.one(".author").set("innerHTML",g)
}if(j.hasAttribute("data-depth")){d.setAttribute("data-depth",parseInt(j.getAttribute("data-depth"),10)+1)
}d.unwrap();
d.removeClass("comment-preview");
d.addClass("pending");
j.removeClass("reply-open");
j.fire("reply-complete");
if(f){var c=e.ancestor(".reply-area-wrapper").cloneNode(true);
e.ancestor(".reply-area-wrapper").insert(d,"after")
}this.makeMostRecent(d);
this.fire("reply-complete",{node:d});
return d
},makeMostRecent:function(b){if(b.hasClass("comment")){a.all(".comment.pending.most-recent").each(function(c){if(!c.ancestor(".most-recent-anim-wrapper")){c.removeClass("most-recent")
}});
b.addClass("most-recent")
}},fullDataRender:function(){this.render(this.commentData.formatted);
this.commentList=a.one(".comment-list")
},threadRender:function(){this.render(this.commentData.formattedThread);
this.commentList=a.one(".comment-list");
this.commentList.one('.comment[data-commentId="'+this.commentData.currentThreadRoot+'"]').addClass("target")
},showEmptyText:function(){new a.Squarespace.Alert().show("Enter Comment Text","Enter text in the field above to post a comment.")
},showModerationNotification:function(){new a.Squarespace.Notice().show("Comment Awaiting Moderation","Your comment has been successfully posted and is awaiting moderation.")
},showCommentSuccessNotification:function(){new a.Squarespace.Notice().show("Comment Posted","Your comment has been successfully posted.")
},showPostCommentNotification:function(){if(this.settings.approvalRequired&&!a.Squarespace.Utils.userHasAccessPermission(a.Squarespace.AccessPermissions.CONFIG_TRUSTED_COMMENTER)){this.showModerationNotification()
}},squarespaceAdminOnly:function(){return(Static.SQUARESPACE_CONTEXT.website.cloneable&&!a.Squarespace.Utils.isSquarespaceAdmin())
},commentBtnOnClick:function(g){var b=a.one(".top-level-comment-area .comment-input"),f=b.get("value"),d,c=function(){var e=this.prependComment(f);
this.submitTopLevel(f,e,b)
};
if(f.trim()===""){this.showEmptyText()
}else{if(SQUARESPACE_LOGIN.account){d=new a.Squarespace.ConfirmationDialog({style:"proceedOrCancel",showScreenOverlay:false,confirmText:"Post Comment",width:214,onSuccess:c,scope:this});
d.show("Post Comment","Are you sure you want to post this comment?")
}else{c.call(this)
}}g.stopImmediatePropagation()
},updateWithMemberAccount:function(c,e){if(e&&!SQUARESPACE_LOGIN.account){var d=c.one(".author");
if(d){d.setContent(e.displayName)
}var b=c.one(".avatar img");
if(b){if(e.avatarUrl){b.setAttribute("src",e.avatarUrl)
}else{if(e.avatarId){b.setAttribute("src","/global/"+e.avatarId+"?format=36w")
}}}}},submitTopLevel:function(d,e,c){this.setPosting(e,(!this.approvalRequired||!this.moderationMode));
var b=c.get("value");
c.set("value","");
this.addComment({onSuccess:function(f){this.updateCommentCounts();
if(!a.Lang.isNull(e._node)){this.setPosted(e);
e.setAttribute("data-commentId",f.comment.id);
if(f.comment.status===a.Squarespace.CommentStatuses.APPROVED){e.removeClass("pending")
}this.addReplyArea(e);
this.updateWithMemberAccount(e,f.comment.memberAccount);
this.showPostCommentNotification()
}},onFailure:function(k){c.set("value",b);
if(k.errors){if(k.errors.anonEmail||k.errors.authorEmail||k.errors.authorName){var i=e.one(".author");
if(k.errors.anonEmail){new a.Squarespace.Notice().show("Comment Failed",k.errors.anonEmail)
}var h=function(){this.submitTopLevel(d,e,c);
if(!a.Lang.isNull(i)||a.Lang.isNull(i._node)){i.set("innerHTML",SQUARESPACE_LOGIN.account.displayName)
}if(SQUARESPACE_LOGIN.account.avatarId){var l=e.one(".avatar");
l.one("img").setAttribute("src","/global/"+SQUARESPACE_LOGIN.account.avatarId+"?format=36w")
}f.detach()
};
var g=function(){this.submitTopLevel(d,e,c);
var l=a.Cookie.get("displayName");
if(!(a.Lang.isNull(i)||a.Lang.isNull(i._node)||a.Lang.isNull(l))){i.set("innerHTML",l)
}f.detach()
};
var j=function(){this.removeMostRecentPending()
};
SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,overlayOpacity:0.5});
this.doAfterLogin(SQUARESPACE_LOGIN,h,this);
this.doAfterGuestLogin(SQUARESPACE_LOGIN,g,this);
var f=SQUARESPACE_LOGIN.once("cancel",j,this);
SQUARESPACE_LOGIN.showCommentLogin("Log In to Post Comment","Post Comment",this.settings.allowAnon)
}else{this.showPostCommentNotification()
}}},body:d},this)
},removeMostRecentPending:function(){var d=a.one(".comment.most-recent"),c,b;
if(d.ancestor(".comment-preview-wrapper")){d.unwrap()
}d.wrap('<div class="most-recent-anim-wrapper"></div>');
b=d.ancestor(".most-recent-anim-wrapper");
b.setStyles({overflow:"hidden",height:d.get("offsetHeight")});
c=new a.Anim({node:b,duration:0.3,easing:a.Easing.easeOutStrong,to:{height:0}});
c.on("end",function(){this._node.remove(true)
});
c.run()
},onLoading:function(){var d=a.one(".comments-content"),b=a.DB.DIV("comment-event-capture"),c;
b.setStyles({position:"absolute",top:d.getY(),left:d.getX(),width:d.get("offsetWidth"),height:d.get("offsetHeight"),zIndex:1000});
b.on("hover",function(f){f.stopImmediatePropagation()
});
b.on("click",function(f){f.stopImmediatePropagation()
});
a.one("body").append(b);
c=new a.Anim({node:d,duration:0.3,easing:a.Easing.easeOutStrong,to:{opacity:0.3}});
c.run()
},commentIdHashOnChange:function(b){if(!(a.Lang.isNull(b.newVal)||a.Lang.isUndefined(b.newVal))){this.threadState=true;
this.lastHashChangeTime=new Date();
this.onLoading();
this.retrieveThread({commentId:b.newVal,order:this.sortOrder,onSuccess:function(){this.threadRender()
}})
}},commentIdHashOnRemove:function(){this.threadState=false;
this.lastHashChangeTime=new Date();
this.onLoading();
this.retrieveComments({onSuccess:function(b){this.fullDataRender(b)
},page:1,order:this.sortOrder},this)
},retrieveThread:function(b,c){this.threadState=true;
var d=function(e){this.threadState=false;
b.onFailure.call((c||this),e)
};
this.commentData.getThread({order:b.order,commentId:b.commentId,success:b.onSuccess,failure:d},(c||this))
},retrieveComments:function(d,e){var c=this.params.identifier,f=this.params.type;
var g={targetId:c,targetType:f,since:(d.since||""),page:d.page,sortBy:d.order};
var b=a.bind(function(h){this.lastPollTime=new Date();
d.onSuccess.call((e||this),h);
this.updateLikedFlaggedState()
},this);
this.commentData.get({order:d.order,page:d.page,since:(d.since||""),success:b,failure:d.onFailure},this)
},addComment:function(c,d){var b=a.bind(function(e){if(a.Lang.isFunction(c.onSuccess)){(c||noop).onSuccess.call((d||this),e)
}a.Cookie.remove("displayName",{path:"/"})
},this);
this.commentData.post({body:c.body,replyTo:c.replyTo,name:(SQUARESPACE_LOGIN.account?SQUARESPACE_LOGIN.account.displayName:a.Cookie.get("displayName")),email:(SQUARESPACE_LOGIN.account?SQUARESPACE_LOGIN.account.email:a.Cookie.get("email")),authorUrl:(SQUARESPACE_LOGIN.account?SQUARESPACE_LOGIN.account.websiteUrl:a.Cookie.get("websiteUrl")),success:b,failure:c.onFailure},(d||this))
},setPosting:function(d,c){d.all(".posting-text").each(function(e){e.removeClass("visible")
});
var b=d.one(".posting-text"+(c?".moderated":""));
if(b){b.addClass("visible")
}},setPosted:function(c){var b=c.all(".posting-text");
if(b){b.each(function(d){d.removeClass("visible")
})
}},replyTo:function(f,d,e,b){this.setPosting(e,(!this.approvalRequired||!this.moderationMode));
var c=b.get("value");
b.set("value","");
this.addComment({body:d,replyTo:f,onSuccess:function(g){this.updateCommentCounts();
if(!a.Lang.isNull(b._node)){this.setPosted(e);
e.setAttribute("data-commentId",g.comment.id);
if(g.comment.status===a.Squarespace.CommentStatuses.APPROVED){e.removeClass("pending")
}this.addReplyArea(e);
this.updateWithMemberAccount(e,g.comment.memberAccount);
this.showPostCommentNotification()
}},onFailure:function(k){b.set("value",c);
if(k.errors){if(k.errors.anonEmail||k.errors.authorEmail||k.errors.authorName){var j,i,h;
if(k.errors.anonEmail){new a.Squarespace.Notice().show("Comment Failed",k.errors.anonEmail)
}j=function(){this.removeMostRecentPending()
};
i=function(){this.replyTo(f,d,e,b);
a.one('.comment[data-replyTo="'+f+'"] .author').set("innerHTML",SQUARESPACE_LOGIN.account.displayName);
e.one(".author").set("innerHTML",SQUARESPACE_LOGIN.account.displayName);
if(SQUARESPACE_LOGIN.account.avatarId){var l=e.one(".avatar");
l.one("img").setAttribute("src","/global/"+SQUARESPACE_LOGIN.account.avatarId+"?format=36w")
}g.detach()
};
h=function(){this.replyTo(f,d,e,b);
var l=a.Cookie.get("displayName");
if(!a.Lang.isNull(l)){a.one('.comment[data-replyTo="'+f+'"] .author').set("innerHTML",l)
}g.detach()
};
SQUARESPACE_LOGIN.configure({redirectAfterLogin:false,reloadAfterLogin:false,overlayOpacity:0.5});
this.doAfterLogin(SQUARESPACE_LOGIN,i,this);
this.doAfterGuestLogin(SQUARESPACE_LOGIN,h,this);
var g=SQUARESPACE_LOGIN.once("cancel",j,this);
SQUARESPACE_LOGIN.showCommentLogin("Log In to Post Reply","Post Reply",this.settings.allowAnon)
}}}},this)
},extendComments:function(){this.currentPage=this.currentPage+1;
var b=this.lastSortTime,c=this.lastHashChangeTime;
this.retrieveComments({order:this.sortOrder,onSuccess:function(){if(b===this.lastSortTime&&c===this.lastHashChangeTime){this.attachComments.call(this)
}},page:this.currentPage},this)
},attachComments:function(){var d=this.commentData.formatted;
d.comments=this.commentData.getFormattedPage(this.currentPage);
var b=this.renderToFragment(d);
this.updateCommentCounts();
var c=a.one(".comment-list");
b.all(".comment, .reply-area-wrapper").each(function(e){c.append(e)
});
this.containerEl.one(".load-more").remove(true);
this.addLoadMoreControls()
},sort:function(d){var c=this.sortOrderLookup[d];
a.Cookie.set("commentSortOrder",d);
this.sortOrder=d;
this.currentPage=1;
var b=function(e){this.lastSortTime=new Date();
this.fullDataRender(e);
var f=a.one(".comment-sort");
f.one("span").set("innerHTML",c);
f.one("select").set("value",this.sortOrder)
};
this.onLoading();
this.retrieveComments({order:this.sortOrder,onSuccess:b,page:this.currentPage})
},formatData:function(h,e,d){var c,k={comments:[]},g,b;
e=(e||{});
d=(d||{});
var j=(this.squarespaceAdminOnly()||this.settings.readOnly);
k.noAvatars=this.settings.avatarsHidden;
k.likesAllowed=this.settings.likesAllowed;
k.newCommentAreaTop={authenticatedAccount:SQUARESPACE_LOGIN.account,readOnly:j};
k.commentSortTitle=this.sortOrderLookup[this.sortOrder];
k.sortOldestFirst=this.sortOrder===a.Squarespace.CommentSortTypes.OLDEST_FIRST;
k.sortNewestFirst=this.sortOrder===a.Squarespace.CommentSortTypes.NEWEST_FIRST;
k.sortMostLiked=this.sortOrder===a.Squarespace.CommentSortTypes.MOST_LIKED;
k.sortLeastLiked=this.sortOrder===a.Squarespace.CommentSortTypes.LEAST_LIKED;
k.totalComments=this.commentData.totalComments;
k.visibleComments=this.commentData.visibleComments;
k.subscribed=Static.SQUARESPACE_CONTEXT.subscribed;
for(var f=0;
f<h.length;
f++){g=h[f];
g.unmoderated=(g.status===a.Squarespace.CommentStatuses.AWAITING_MODERATION);
g.moderationMode=this.moderationMode;
g.readOnly=j;
g.flagsAllowed=this.settings.flagsAllowed;
if(g.memberAccount){g.authorName=g.memberAccount.displayName;
g.authorUrl=g.memberAccount.websiteUrl
}if(g.authorUrl){if(!(g.authorUrl.startsWith("http://")||g.authorUrl.startsWith("https://"))){g.authorUrl="http://"+g.authorUrl
}}c=g.id;
if(this.settings.likesAllowed){g.likesAllowed={likeCount:g.likeCount};
if(e[c]){g.likesAllowed.liked=true
}}if(d[c]){g.flagged=true
}g.threaded=this.settings.threaded;
k.comments.push(g)
}return k
},scatterData:function(c){var d=(this.squarespaceAdminOnly()||this.settings.readOnly);
c.noAvatars=this.settings.avatarsHidden;
c.likesAllowed=this.settings.likesAllowed;
c.newCommentAreaTop={};
c.newCommentAreaTop.readOnly=d;
c.newCommentAreaTop.authenticatedAccount=SQUARESPACE_LOGIN.account;
c.commentSortTitle=this.sortOrderLookup[this.sortOrder];
c.subscribed=Static.SQUARESPACE_CONTEXT.subscribed;
if(this.commentData.totalComments===0){c.noComments=true
}var e={};
for(var b=0;
b<c.comments.length;
b++){e=c.comments[b];
e.flagsAllowed=this.settings.flagsAllowed;
e.moderationMode=this.moderationMode;
if(e.memberAccount){e.authorName=e.memberAccount.displayName;
e.authorUrl=e.memberAccount.websiteUrl
}if(e.authorUrl){if(!(e.authorUrl.startsWith("http://")||e.authorUrl.startsWith("https://"))){e.authorUrl="http://"+e.authorUrl
}}e.readOnly=d;
if(this.settings.likesAllowed){if(!e.likesAllowed){e.likesAllowed={likeCount:0}
}e.likesAllowed.likeCount=(e.likesAllowed.likeCount===0?undefined:e.likesAllowed.likeCount)
}e.threaded=this.settings.threaded;
if(c.likeMap&&c.likeMap[e.id]&&(e.likesAllowed!==undefined)){e.likesAllowed.liked=true
}if(c.flagMap&&c.flagMap[e.id]){e.flagged=true
}c.comments[b]=e
}return c
},render:function(d){var c=this.renderToFragment(d),f=this.commentsEl,e,b=a.one(".comment-event-capture");
if(!d.comments.length){this.containerEl.addClass("empty")
}else{this.containerEl.removeClass("empty")
}f.empty();
f.append(c);
e=new a.Anim({node:f,duration:0.3,easing:a.Easing.easeOutStrong,to:{opacity:1}});
e.on("end",function(){b.remove(true)
});
e.run();
this.addFullViewControls();
switch(this.params.paginationMode){case this.PaginationModes.PAGE:break;
case this.PaginationModes.EXTEND:this.addLoadMoreControls();
break;
default:break
}this.fire("render")
},renderToFragment:function(e){for(var d=0;
d<e.comments.length;
d++){this.escapeComment(e.comments[d]);
var b=e.comments[d].body;
b=a.Squarespace.Utils.preFormatMarkdown(b);
e.comments[d].body=b
}var c=a.Node.create(this._template.expand(e)),f=c.all(".comment");
f.each(function(h,g){h.setAttribute("data-commentId",e.comments[g].id)
});
return c
}});
a.augment(a.Squarespace.Comments,a.EventTarget);
a.on("domready",function(){var g=a.one(".squarespace-comments"),h,c,d=Static.SQUARESPACE_CONTEXT.websiteSettings;
if(g&&!d.disqusShortname){h=(Static.SQUARESPACE_CONTEXT.itemId||Static.SQUARESPACE_CONTEXT.collectionId);
if(h){c=(Static.SQUARESPACE_CONTEXT.itemId?a.Squarespace.CommentTargetTypes.ITEM:a.Squarespace.CommentTargetTypes.COLLECTION);
var e=false,j=false;
if(c===a.Squarespace.CommentTargetTypes.ITEM){var k=Static.SQUARESPACE_CONTEXT.item;
if(k){if(k.commentState===a.Squarespace.CommentStates.DISABLED){if(k.publicCommentCount===0){e=true
}else{j=true
}}}}else{var f=Static.SQUARESPACE_CONTEXT.collectionsById[h];
if(f){if(!f.configuration.commentsOn){if(f.publicCommentCount===0){e=true
}else{j=true
}}}}if(!e){var i=function(){a.use("squarespace-comments","cookie",function(l){if(Static.SQUARESPACE_CONTEXT.authenticatedAccount&&!Static.SQUARESPACE_CONTEXT.website.cloneable){l.use("squarespace-management",function(m){m.Squarespace.Management.showChrome()
})
}(new l.Squarespace.Comments({containerEl:g,identifier:h,type:c,likesAllowed:d.commentLikesAllowed,flagsAllowed:d.commentFlagsAllowed,threaded:d.commentThreaded,approvalRequired:d.commentApprovalRequired,allowAnon:d.commentAnonAllowed,avatarsOn:d.commentAvatarsOn,readOnly:j,sortType:(l.Cookie.get("commentSortOrder")||d.commentSortType)})).create()
})
};
var b=function(){a.use("squarespace-comments","cookie",function(m){var l=function(){m.Data.get({url:"/api/auth/CheckAuthentication",secure:true,success:function(n){if(n.member!==null){m.use("squarespace-management",function(o){Static.SQUARESPACE_CONTEXT.authenticatedAccount=n.member;
SQUARESPACE_LOGIN.params=o.merge(SQUARESPACE_LOGIN.params,{redirectAfterCancel:false,redirectAfterLogin:false});
SQUARESPACE_LOGIN.onLoginComplete(n.member)
})
}i()
},failure:i})
};
if(m.Data.TRANSPORT_READY){l()
}else{console.warn("Flash cross-domain transport not initialized yet. Delaying comment initialization until flash is ready.");
m.once("io:xdrReady",l)
}})
};
if(Static.SQUARESPACE_CONTEXT.authenticatedAccount||Static.SQUARESPACE_CONTEXT.website.cloneable){i()
}else{b()
}}}}})
},"1.0",{requires:["history","squarespace-comment-data","squarespace-util","squarespace-markdown","squarespace-login","squarespace-ui-base","node","event","selector-css3","squarespace-json-template","anim","transition"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-animation-manager",function(a){a.namespace("Squarespace").AnimationManager=Class.create({initialize:function(){this._concurrentAnimations=[];
this._animationsFinished=false;
this._destroyed=false
},push:function(b){if(a.Lang.isArray(b)){for(var c=0;
c<b.length;
c++){this._concurrentAnimations.push(b[c])
}}else{this._concurrentAnimations.push(b)
}},run:function(e,c){this.callback=e;
this.context=c||this;
var d=function(){this._animEnd()
};
for(var b=0;
b<this._concurrentAnimations.length;
b++){this._concurrentAnimations[b].on("end",d,this);
this._concurrentAnimations[b].run()
}this._running=true
},stop:function(c){c=!!c;
for(var b=0;
b<this._concurrentAnimations.length;
b++){this._concurrentAnimations[b].stop(c);
this._animationsFinished=true
}if(this._running){this._running=false
}},_animEnd:function(){if(a.Array.every(this._concurrentAnimations,function(b){return !b.get("running")
})){this._animationsFinished=true;
this._running=false;
if(this.callback){this.callback.call(this.context)
}this.fire("end")
}},isRunning:function(){return this._running
},destroy:function(b){this.fire("destroy");
if(this._destroyed){throw"MultipleAnimationManager: Sorry bro, I'm already destroyed."
}this._destroyed=true;
this.stop(b);
for(var c=0;
c<this._concurrentAnimations.length;
c++){this._concurrentAnimations[c].destroy()
}if(this._running){this._running=false;
this._animationsFinished=!!b
}this.fire("destroyed")
},isDestroyed:function(){return this._destroyed
}});
a.augment(a.Squarespace.AnimationManager,a.EventTarget)
},"1.0");/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-gizmo",function(g){g.namespace("Squarespace");
var f="squarespace-";
var b="-bbox";
var d=new RegExp("[ ]+","g");
var e=new RegExp("[^a-zA-Z0-9\\-]","g");
var c=function(m,h,i,k,j){var l=j?g.Array.reject:g.Array.filter;
return l(m,function(p){for(var n=0;
n<i.length;
++n){var o=i[n];
var q=k[n];
if(p[o]!==q){return false
}}if(h){h(p)
}return true
})
};
var a=function(n,m,l,o,j){if(this._destroyed){return
}if(g.Lang.isArray(m)){return g.Array.map(m,function(h){return a.apply(this,[n].concat(g.Array(h)))
},this)
}if(g.Lang.isObject(m)&&g.Lang.isFunction(m[n])){var i=[l,o,j||this];
i=i.concat(Array.prototype.slice.call(arguments,5));
var k=m[n].apply(m,i);
this._eventSubList.push({object:m,event:l,eventSub:k});
return k
}else{throw"Gizmo["+this._name+"]: Could not subscribe to event: "+l
}};
g.Squarespace.Gizmo=Class.create({_name:"Gizmo",_events:{render:{},rendered:{},destroy:{},destroyed:{}},initialize:function(j){g.augment(this,g.EventTarget,true,null,{prefix:this._name});
this.params=g.merge(j);
this._initState();
var i=this;
var h=function(k,l){this.publish(l,k)
};
while(i!==null&&i!==undefined){g.Object.each(i._events,h,this);
i=i.superclass
}},getClassNames:function(){var i=this;
var h=[];
for(;
;
i=i.superclass){if(!i){return h
}h.push(i.getClassName())
}},_initState:function(){this._el=null;
this._parentEl=null;
this._eventSubList=[];
this._anims=[];
this._timers=[];
this._destroyed=false;
this._children=[];
this._guid=g.guid();
if(!this._name){this._name="No Name"
}},getClassName:function(){return this._name
},getId:function(){return this._guid
},getCssClassName:function(){var h=this._name;
h=h.trim().replace(d,"-").replace(e,"").toLowerCase();
return f+h
},getElement:function(){return this._el
},render:function(h){this.fire("render");
h=h||this._parentEl;
if(this.params.noBoundingBox){this._el=this._render()
}else{this._el=g.Node.create("<div></div>");
this._el.addClass(this.getCssClassName()+b);
this._el.append(this._render())
}if(h&&g.Lang.isFunction(h.append)){h.append(this._el)
}this._parentEl=h;
this.fire("rendered")
},_render:function(){},_subscribe:function(k,j,l,i){var h=["on"].concat(g.Array(arguments));
return a.apply(this,h)
},_subscribeOnce:function(k,j,l,i){var h=["once"].concat(g.Array(arguments));
return a.apply(this,h)
},_subscribeBefore:function(k,j,l,i){var h=["before"].concat(g.Array(arguments));
return a.apply(this,h)
},_subscribeAfter:function(k,j,l,i){var h=["after"].concat(g.Array(arguments));
return a.apply(this,h)
},_unsubscribe:function(j,i){var h=i?["object","event"]:["object"];
this._eventSubList=c(this._eventSubList,function(k){k.eventSub.detach()
},h,g.Array(arguments),true)
},_detach:function(h){this._eventSubList=c(this._eventSubList,function(i){i.eventSub.detach()
},["eventSub"],[h],true)
},_clearEvents:function(){var j=this._eventSubList;
for(var h=0;
h<j.length;
++h){j[h].eventSub.detach()
}this._eventSubList=[]
},destroy:function(){if(this._destroyed){console.warn("Gizmo["+this._name+"] already destroyed.");
return
}if(!this._eventSubList){console.error("Gizmo not initialized for...",this);
throw ("Gizmo["+this._name+"] was never initialzed.  Missing _super?")
}this.fire("destroy");
this._destroy();
var j=0;
this._clearEvents();
this._eventSubList=[];
var l=[];
g.Array.each(this._anims,function(i){l.push(i)
},this);
g.Array.each(l,function(i){if(i.get("running")){i.stop(false)
}i.destroy()
});
this._anims=null;
var k=this._children;
while(k.length>0){var n=k[0];
n._removeParent();
n.destroy()
}this._children=null;
var m=this._timers;
for(j=0;
j<m.length;
++j){var h=m[j];
h.cancel()
}this._timers=null;
if(this._el&&g.Lang.isFunction(this._el.remove)){this._el.remove();
this._el=null
}this._destroyed=true;
this.fire("destroyed")
},_destroy:function(){},isDestroyed:function(){return this._destroyed
},_setParent:function(h){this._parentGizmo=h
},_removeParent:function(){if(this._parentGizmo){this._parentGizmo._removeChild(this);
this._parentGizmo=null
}},_addChild:function(h){if(!this._children){return
}if(h._setParent){h._setParent(this)
}this._children.push(h)
},_removeChild:function(h){this._children.splice(this._children.indexOf(h),1)
},_getChildren:function(){return this._children
},_anim:function(i){if(this.destroyed){return
}if(!i.node){throw"Gizmo["+this._name+"]: Animation must specify a node!"
}var h;
if(!i.node.ancestor("body",true)){console.warn("Gizmo["+this._name+"]: _anim passed a YUI node not in the DOM! Returning an empty animation.");
h=new g.Anim()
}else{if(!i.node._node){console.warn("Gizmo["+this._name+"]: _anim passed a YUI node with _node = null! Returning an empty animation.");
console.trace();
h=new g.Anim()
}else{h=new g.Anim(i);
h.on("end",function(j){this._removeAnim(h)
},this);
this._anims.push(h)
}}return h
},_removeAnim:function(j){var h=this._anims.indexOf(j);
if(h!==-1){this._anims.splice(h,1)
}},_trace:function(m){var n=this.getEvent(m);
var k=n.getSubs();
var o=[];
var h=function(p,i){if(p.context&&p.context.getName){o.push(p.context.getName())
}else{var q={};
q[p.fn.name]=p.fn.toString();
o.push(q)
}};
for(var j=0;
j<k.length;
++j){var l=k[j];
g.Object.each(l,h)
}console.log("[trace] Event",m,"is notifying the following:",o);
this.fire(m)
},_later:function(h,j,m,l,k){if(this.destroyed){return
}m=m||this;
var i=g.later(h,m,j,l,k);
this._timers.push(i);
return i
},_cb:function(h){var i=g.bind(function(){if(!this._destroyed){return h.apply(this,arguments)
}},this);
return i
}});
g.augment(g.Squarespace.Gizmo,g.EventTarget);
g.Squarespace.ZombieGizmo=Class.extend(g.Squarespace.Gizmo,{_name:"ZombieGizmo",_events:{resurrect:{},resurrected:{}},initialize:function(h){this._super(h)
},destroy:function(){this._super();
this.resurrect()
},resurrect:function(){this.fire("resurrect");
this._initState();
this.fire("resurrected")
}})
},"1.0",{requires:["array-extras","node","event-custom"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-toggle",function(a){a.namespace("Squarespace.Widgets").ToggleButton=a.Base.create("toggleButton",a.Widget,[a.WidgetChild],{renderUI:function(){var c=this.get("contentBox"),e=this.get("active"),d=e?"active":"inactive";
c.append(a.DB.DIV("switch-box-container animate "+d,a.DB.DIV("switch-box",a.DB.DIV("toggle-box",a.DB.DIV("togglebg",a.DB.DIV("on",{html:this.get("onLabel")}),a.DB.DIV("off",{html:this.get("offLabel")})))),a.DB.DIV("switch-shadow",{html:"&nbsp;"}),a.DB.DIV("handle-wrapper",a.DB.DIV("handle",{html:"&nbsp;"}))))
},destructor:function(){a.detachAll(this.get("id")+"|*")
},bindUI:function(){var c=this.get("contentBox"),d=this.get("id");
c.one(".handle-wrapper").on(d+"|click",this._onClick,this);
this.after("activeChange",this.syncUI,this);
this.after("enabledChange",this.syncUI,this)
},_onClick:function(c){c.halt();
if(this.get("enabled")){this.set("active",!this.get("active"))
}},syncUI:function(){var c=this.get("contentBox"),f=c.one(".switch-box-container"),g=c.all(".togglebg, .handle"),h=this.get("active");
g.setStyles({marginLeft:null,left:null});
if(h){f.removeClass("inactive").addClass("active")
}else{f.removeClass("active").addClass("inactive")
}var e=this.get("boundingBox");
var d=this.get("enabled");
if(d){e.removeClass("disabled").addClass("enabled")
}else{e.removeClass("enabled").addClass("disabled")
}}},{ATTRS:{active:{value:false},onLabel:{value:"On"},offLabel:{value:"Off"},enabled:{value:true}}});
function b(){b.superclass.constructor.apply(this,arguments)
}b.NAME="toggleDragPlugin";
b.NS="drag";
a.extend(b,a.Plugin.Base,{initializer:function(){this._host=this.get("host");
this.afterHostMethod("bindUI",this._afterBindUI)
},destructor:function(){a.detachAll(this.get("id")+"|*");
if(this._handleDrag){this._handleDrag.destroy()
}},_afterBindUI:function(){var c=this._host.get("contentBox"),d=c.one(".switch-box"),f=c.one(".handle-wrapper").get("region"),e=this.get("id");
this._handleDrag=new a.DD.Drag({node:c.one(".handle")});
this._handleDrag.plug(a.Plugin.DDProxy);
this._handleDrag.on(e+"|drag:start",this._onDragStart,this);
this._handleDrag.on(e+"|drag:drag",this._onDragDrag,this);
this._handleDrag.on(e+"|drag:end",this._onDragEnd,this)
},_onDragStart:function(d){var c=d.target,f=this._host.get("contentBox").one(".handle-wrapper").get("region");
if(!c.hasPlugin("con")){c.plug(a.Plugin.DDConstrained,{constrain:f})
}},_onDragDrag:function(h){var g=h.target;
var c=this._host.get("contentBox");
var i=this.get("maxValue");
var f=c.one(".handle-wrapper").getX();
var d=Math.abs(f-g.lastXY[0]);
d=Math.max(0,d);
d=Math.min(i,d);
c.one(".togglebg").setStyle("marginLeft",d);
c.one(".handle").setStyle("left",h.target.get("dragNode").getX()-c.one(".handle-wrapper").getX())
},_onDragEnd:function(i){var f=i.target;
var g=f.get("node");
var h=f.con.get("constrain");
var d=Math.abs(h.left-h.right);
var j=Math.abs(f.nodeXY[0]-f.lastXY[0])/(d-g.get("offsetWidth"));
var c=this._host.get("active");
if(j>0.5){this._host.set("active",!c)
}if(this._host.get("active")===c){this._host.syncUI()
}}},{ATTRS:{resistance:{value:10},maxValue:{value:70}}});
a.Squarespace.ToggleDrag=b
},"1.0",{requires:["widget","widget-child","squarespace-toggle-css","dd-drag","dd-constrain","dd-proxy"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-node-flyout",function(a){a.namespace("Squarespace.Animations").Flyout=a.Base.create("flyoutPlugin",a.Plugin.Base,[],{initializer:function(b){this._mask=a.Node.create('<div class="flyout-animation-wrapper"></div>');
this._mask.setStyles({position:"fixed",overflow:"hidden"});
this._mask.setStyle("z-index","200000");
this._isShowing=false;
this._isHiding=false
},destructor:function(){if(this._anim){this._anim.stop().destroy()
}this._mask.remove(true);
a.detachAll(this.get("id")+"|*")
},_onScroll:function(c){var b=this.get("host");
if(c.target.contains(b)||c.currentTarget.contains(b)){this._updateMaskPosition()
}},_onResize:function(){this._updateMaskPosition()
},show:function(){if(!this.get("visible")&&!this._isShowing){this._animateFlyout(true)
}},hide:function(){if(this.get("visible")&&!this._isHiding){this._animateFlyout(false)
}},_measureNode:a.Squarespace.Utils.measureNode,_animateFlyout:function(g){var c=this._mask,b=this.get("node"),e=b.get("region"),d=this._measureNode(b),f=this._getInitialFlyoutOffset();
this._updateMaskPosition();
if(this._anim){this._anim.stop(true);
this._anim=null
}if(g){c.setStyles({height:d.height,width:d.width+1});
b.setStyles({position:"absolute",top:f.yOffset,left:f.xOffset});
c.appendChild(b);
a.one("body").appendChild(c)
}this._anim=new a.Anim({duration:this.get("duration"),easing:this.get("easing"),node:b,to:{top:g?0:f.yOffset,left:g?0:f.xOffset}});
if(this.get("animateOpacity")){this._anim.set("from.opacity",g?0:1);
this._anim.set("to.opacity",g?1:0)
}this._anim.on(this._yuid+"|end",function(){this._anim=null;
if(g){this._isShowing=false;
this._mousewheelEvent=a.on(this.get("id")+"|mousewheel",this._onScroll,this);
this._resizeEvent=a.one(window).on(this.get("id")+"|resize",this._onResize,this)
}else{this._isHiding=false;
b.remove();
c.remove();
if(this._mousewheelEvent){this._mousewheelEvent.detach();
this._mousewheelEvent=null
}if(this._resizeEvent){this._resizeEvent.detach();
this._resizeEvent=null
}}this.set("visible",g);
this.fire(g?"shown":"hidden",{flyout:b});
this.get("host").fire("flyout-"+g?"shown":"hidden",{flyout:b})
},this);
if(g){this._isShowing=true
}else{this._isHiding=true
}if(b.inDoc()){this._anim.run()
}},_updateMaskPosition:function(){if(!this._mask){return
}var b=this._mask,c=this._getIntendedMaskPosition();
b.setStyles({left:c.x,top:c.y});
return c
},_getInitialFlyoutOffset:function(){var c=a.Squarespace.Animations.Flyout,f=this.get("alignment"),d=this._measureNode(this.get("node"));
var b,e;
switch(f){case c.LT:case c.LC:case c.LR:b=d.width;
break;
case c.TL:case c.TC:case c.TR:case c.BL:case c.BC:case c.BC:b=0;
break;
case c.RT:case c.RC:case c.RB:b=d.width*-1;
break;
default:throw"Flyout: This should never happened, check your alignment settings"
}switch(f){case c.LT:case c.LC:case c.LB:case c.RT:case c.RC:case c.RB:e=0;
break;
case c.BL:case c.BC:case c.BR:e=d.height*-1;
break;
case c.TL:case c.TC:case c.TR:e=d.height;
break;
default:throw"Flyout: This should never happened, check your alignment settings"
}return{xOffset:b,yOffset:e}
},_getIntendedMaskPosition:function(){var c=a.Squarespace.Animations.Flyout,i=this.get("alignment"),e=this.get("host").get("region"),d=this._measureNode(this.get("node"));
var b,h;
var g=a.DOM.docScrollY(),f=a.DOM.docScrollX();
e.top-=g;
e.bottom-=g;
e.left-=f;
e.right-=f;
switch(i){case c.RT:case c.RC:case c.RB:b=e.right;
break;
case c.LT:case c.LC:case c.LB:b=e.left-d.width;
break;
case c.TR:case c.BR:b=e.left;
break;
case c.TC:case c.BC:b=e.left+e.width/2-d.width/2;
break;
case c.TR:case c.BR:b=e.right-d.width;
break;
default:throw"Flyout: This should never happened, check your alignment settings"
}switch(i){case c.TL:case c.TC:case c.TR:h=e.top-d.height;
break;
case c.LT:case c.RT:h=e.top;
break;
case c.LC:case c.RC:h=e.top+e.height/2-d.height/2;
break;
case c.LB:case c.RB:h=e.bottom-d.height;
break;
case c.BL:case c.BC:case c.BR:h=e.bottom;
break;
default:throw"Flyout: This should never happened, check your alignment settings"
}return{x:b,y:h}
}},{NS:"flyoutPlugin",TL:"tl",TC:"tc",TR:"tr",RT:"rt",RC:"rc",RB:"rb",BC:"bc",BL:"bl",BR:"br",LT:"lt",LC:"lc",Lb:"lb",ATTRS:{duration:{value:0.3,validator:a.Lang.isNumber},easing:{value:a.Easing.easeOutStrong},alignment:{value:"rt",validator:function(c){var b=a.Squarespace.Animations.Flyout;
switch(c){case b.TL:case b.TC:case b.TR:case b.LT:case b.RT:case b.LC:case b.RC:case b.LB:case b.RB:case b.BL:case b.BC:case b.BR:return true;
default:console.warn(this.name+": Invalid alignment value ("+c+")");
return false
}}},node:{value:null},animateOpacity:{value:true},visible:{value:false}}})
},"1.0",{requires:["plugin","node"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-structured-input",function(b){var a="\1";
b.namespace("Squarespace");
b.Squarespace.StructuredInput=b.Base.create("structuredInput",b.Base,[],{initializer:function(d){this.config=b.merge({selectAllOnFocus:false},d);
this.fieldScroll=0;
this.targetEl=b.instanceOf(d.target,b.Node)?d.target:b.one(d.target);
if(!this.targetEl){console.error("Invalid structured input target: ",d.target);
return
}this.leftPadding=parseInt(this.targetEl.getStyle("paddingLeft"),10);
this.topPadding=parseInt(this.targetEl.getStyle("paddingTop"),10);
this.inputEl=b.DB.INPUT();
if(this.config.tabIndex){this.inputEl.set("tabIndex",this.config.tabIndex)
}this.targetEl.setContent();
this.targetEl.append(this.inputEl);
this.contentEl=b.DB.DIV();
this.contentEl.setContent("&nbsp;");
this.targetEl.append(this.contentEl);
this.helpEl=b.DB.DIV("help-tag");
this.targetEl.append(this.helpEl);
var e="This field accepts variables.  Type one of the codes below to activate a variable:<br/><br/>";
for(var c in this.config.variables){e+="<strong>"+c+"</strong> &mdash; "+this.config.variables[c].tip;
e+="<br/>"
}this.tooltip=new b.Squarespace.ToolTip({target:this.helpEl,title:"Formatting",dialogTooltip:true,body:e.trim(),showTimeout:200,width:300,clickToShow:true});
this.targetEl.on("mousedown",this.mousedown,this);
this.targetEl.on("mousemove",this.mousemove,this);
this.targetEl.on("mouseup",this.mouseup,this);
this.targetEl.on("dblclick",this.selectAll,this);
this.inputEl.on("focus",this.onFocus,this);
this.inputEl.on("blur",this.onBlur,this);
this.inputEl.on("keydown",this.onKeyDown,this);
this.cursorEl=b.DB.DIV("cursor");
this.targetEl.append(this.cursorEl);
this.lineHeightPx=(this.targetEl.get("offsetHeight")-(this.topPadding*2))+2;
this.cursorEl.setStyle("height",this.lineHeightPx+"px");
this.cursorEl.setStyle("top",(this.topPadding-2)+"px");
this.scrapeChars();
this.render();
this.updateCursor()
},destructor:function(){if(this.cursorBlinkInterval){this.cursorBlinkInterval.cancel()
}if(this.scrapeInterval){this.scrapeInterval.cancel()
}if(this.resumeBlinkTimer){this.resumeBlinkTimer.cancel()
}if(this.tooltip){this.tooltip.destroy()
}},stopScrape:function(){if(this.scrapeInterval){this.scrapeInterval.cancel()
}},startScrape:function(){this.scrapeInterval=b.later(50,this,this.scrapeChars,null,true)
},onFocus:function(){this.startScrape();
this.resumeBlink();
if(!this.hasSel()){this.cursorEl.setStyle("display","block")
}this.targetEl.addClass("focused")
},onBlur:function(){this.mousepressed=false;
this.stopScrape();
this.clearSel();
this.pauseBlink();
this.updateCursor();
this.cursorEl.setStyle("display","none");
this.targetEl.removeClass("focused")
},pauseBlink:function(){if(this.cursorBlinkInterval){this.cursorBlinkInterval.cancel();
this.cursorBlinkInterval=null;
this.cursorEl.setStyle("visibility","visible");
if(this.resumeBlinkTimer){this.resumeBlinkTimer.cancel()
}this.resumeBlinkTimer=b.later(400,this,this.resumeBlink)
}},resumeBlink:function(){if(!this.cursorBlinkInterval){if(this.resumeBlinkTimer){this.resumeBlinkTimer.cancel();
this.resumeBlinkTimer=null
}this.cursorBlinkInterval=b.later(600,this,this.blinkCursor,null,true)
}this.cursorEl.setStyle("visibility","visible")
},blinkCursor:function(){if(this.cursorEl.getStyle("visibility")=="hidden"){this.cursorEl.setStyle("visibility","visible")
}else{this.cursorEl.setStyle("visibility","hidden")
}},updateCursor:function(){var d;
if(this.hasSel()){var h=this.getDistanceToPos(this.selStart,"cursor");
var f=this.getDistanceToPos(this.selEnd,"cursor");
if(this.movingLeft){d=Math.min(h,f)
}else{d=Math.max(h,f)
}if(!this.selEl){this.selEl=b.DB.DIV("sel");
this.targetEl.append(this.selEl);
this.selEl.setStyles({top:(parseInt(this.cursorEl.getStyle("top"))-1)+"px",height:(this.lineHeightPx+6)+"px"});
this.cursorEl.setStyle("display","none")
}this.selEl.setStyles({left:(this.leftPadding+Math.min(h,f)+this.fieldScroll)+"px",width:Math.abs(h-f)+"px"})
}else{if(b.Lang.isUndefined(this.cursorPos)){this.cursorPos=this.length()
}var c=this.getDistanceToPos(this.cursorPos,"cursor");
d=c;
this.cursorEl.setStyle("left",(this.leftPadding+c)+"px");
if(this.selEl){this.selEl.remove();
this.selEl=null;
this.cursorEl.setStyle("display","block")
}}var e=this.targetEl.get("offsetWidth")-64;
var g=false;
if((d+this.fieldScroll-1)>e){while(d+this.fieldScroll-1>e){this.fieldScroll-=60
}g=true
}else{if(d<-this.fieldScroll){while(d<-this.fieldScroll){this.fieldScroll+=60
}g=true
}}if(g){this.contentEl.setStyle("margin-left",this.fieldScroll+"px");
this.cursorEl.setStyle("margin-left",this.fieldScroll+"px")
}},insertChars:function(g){var e=this._compressVariables(this.get("value"));
var d=e.substring(0,this.cursorPos);
var f=e.substring(this.cursorPos);
this.set("value",this._uncompressVariables((d+g+f).replace(new RegExp("\\s+","g")," ")));
this.cursorPos+=g.length;
this.render();
this.updateCursor()
},escapeBuffer:function(c){return c.replace(new RegExp("&","g"),"&amp;").replace(new RegExp("\\s+","g"),"&nbsp;")
},unescapeBuffer:function(c){return c.replace(new RegExp("&nbsp;","g")," ").replace(new RegExp("&amp;","g"),"&")
},render:function(){var g=this.get("value");
if(g.length==0){this.contentEl.setContent("&nbsp;");
return
}this.contentEl.setContent("");
var f="";
for(var e=0;
e<g.length;
++e){if(this.isVariableAt(g,e)){if(f.length>0){this.contentEl.append(b.DB.SPAN({html:this.escapeBuffer(f)}));
f=""
}var c=g[e]+g[e+1];
var d=this.config.variables[c];
if(d){this.contentEl.append(b.DB.SPAN("unbreakable",{html:d.title,title:d.tip}))
}else{f+=c
}e+=(this.getVariableLengthAt(g,e)-1)
}else{f+=g[e]
}}if(f.length>0){this.contentEl.append(b.DB.SPAN({html:this.escapeBuffer(f)}));
f=""
}},isVariableAt:function(e,d){if(e[d]!="%"||(d+1)>=e.length){return
}var c=this.config.variables[this.getVariableAt(e,d)];
return(c!=null)
},getVariableAt:function(d,c){return(d[c]+d[c+1])
},getVariableLengthAt:function(d,c){return 2
},_compressVariables:function(f){var c="";
this.varStack=[];
for(var e=0;
e<f.length;
++e){if(this.isVariableAt(f,e)){var d=this.getVariableAt(f,e);
if(this.config.variables[d]){this.varStack.push(d);
c+=a;
e+=(this.getVariableLengthAt(f,e)-1);
continue
}}c+=f[e]
}return c
},_uncompressVariables:function(e){var c="";
var f=0;
for(var d=0;
d<e.length;
++d){if(this.isVariableAt(e,d)){this.cursorPos-=(this.getVariableLengthAt(e,d)-1)
}if(e[d]==a){c+=this.varStack[f];
++f
}else{c+=e[d]
}}delete this.varStack;
return c
},_varCount:function(c){var e=0,d=-1;
while(true){d=c.indexOf(a,d);
if(d==-1){break
}e++;
d++
}return e
},deleteChars:function(j,d){if(j<0){return
}var f=this._compressVariables(this.get("value"));
var e=f.substring(0,j);
var g=f.substring(j,j+d);
var i=f.substring(j+d);
var c=this._varCount(g);
if(c>0){var h=this._varCount(e);
while(c>0){this.varStack.splice(h,1);
c--
}}this.set("value",this._uncompressVariables(e+i));
if(j<this.cursorPos){this.cursorPos-=d
}this.render();
this.updateCursor()
},deleteSelection:function(){this.deleteChars(Math.min(this.selStart,this.selEnd),Math.abs(this.selStart-this.selEnd));
this.cursorPos=Math.min(this.selStart,this.selEnd);
this.clearSel();
this.updateCursor()
},onKeyDown:function(c){this.pauseBlink();
if((c.keyCode==8||c.keyCode==46)&&this.hasSel()){this.deleteSelection();
return
}if(c.shiftKey){if(!this.hasSel()){this.selStart=this.cursorPos;
this.selEnd=this.selStart
}}if(c.keyCode==8){this.deleteChars((this.cursorPos-1),1)
}else{if(c.keyCode==46){this.deleteChars(this.cursorPos,1)
}else{if(c.keyCode==65&&(c.metaKey)){this.cursorPos=0;
this.selStart=0;
this.selEnd=this.length();
this.updateCursor()
}else{if(c.keyCode==38){this.cursorPos=0;
if(c.shiftKey){this.selEnd=this.cursorPos
}else{if(this.hasSel()){this.clearSel()
}}this.movingLeft=true;
this.updateCursor()
}else{if(c.keyCode==40){this.cursorPos=this.length();
if(c.shiftKey){this.selEnd=this.cursorPos
}else{if(this.hasSel()){this.clearSel()
}}this.movingLeft=false;
this.updateCursor()
}else{if(c.keyCode==37){if(c.shiftKey){if(this.selEnd==0){return
}this.selEnd--
}else{if(this.hasSel()){this.cursorPos=Math.min(this.selStart,this.selEnd);
this.clearSel()
}else{if(this.cursorPos==0){return
}this.cursorPos--
}}this.movingLeft=true;
this.updateCursor()
}else{if(c.keyCode==39){if(c.shiftKey){if(this.selEnd==this.length()){return
}this.selEnd++
}else{if(this.hasSel()){this.cursorPos=Math.max(this.selStart,this.selEnd);
this.clearSel()
}else{if(this.cursorPos==this.length()){return
}this.cursorPos++
}}this.movingLeft=false;
this.updateCursor()
}else{b.later(1,this,this.scrapeChars)
}}}}}}}},scrapeChars:function(){var c=this.inputEl.get("value");
this.inputEl.set("value","");
if(c!=""){if(this.hasSel()){this.deleteSelection()
}this.insertChars(c)
}},length:function(){return this._compressVariables(this.get("value")).length
},getDistanceToPos:function(e,h){if(e==0){return 0
}var f=b.DB.SPAN("measure-span",{style:"visibility: hidden; left: -9999px"});
var c=0;
var g=0;
this.targetEl.append(f);
this.contentEl.all("span").each(function(p){if((h=="cursor"&&c==e)||(h=="px"&&f.get("offsetWidth")>=e)){return
}if(p.hasClass("unbreakable")){c++;
f.append(b.DB.SPAN("unbreakable",{html:p.getContent()}));
if(h=="px"){if(f.get("offsetWidth")>=e){c--
}}}else{var m=this.unescapeBuffer(p.getContent());
if(h=="cursor"){var k="";
for(var l=0;
l<m.length;
++l){k+=m[l];
c++;
if(c==e){break
}}if(k!=""){f.append(b.DB.SPAN({html:this.escapeBuffer(k)}))
}}else{var j=b.DB.SPAN();
f.append(j);
for(var l=0;
l<m.length;
++l){var o=m[l];
c++;
if(o==" "){o="&nbsp;"
}j.setContent(j.getContent()+o);
if(f.get("offsetWidth")>=e){c--;
break
}}}}},this);
var d=f.get("offsetWidth");
f.remove();
if(h=="cursor"){return d
}else{return c
}},clearSel:function(){delete this.selStart;
delete this.selEnd
},hasSel:function(){return !b.Lang.isUndefined(this.selStart)&&!b.Lang.isUndefined(this.selStart)
},mousedown:function(c){this.mousepressed=true;
this.focus(c);
c.halt()
},mousemove:function(d){if(this.mousepressed){if(!this.hasSel()){this.selStart=this.cursorPos
}var c=(d.clientX-this.targetEl.getXY()[0]-this.leftPadding)-this.fieldScroll;
this.selEnd=this.getDistanceToPos(c,"px");
this.updateCursor()
}},mouseup:function(c){this.mousepressed=false
},selectAll:function(){this.selStart=0;
this.selEnd=this.length();
this.updateCursor()
},focus:function(f){var d=this.length();
var g=false;
if(f){var c=(f.clientX-this.targetEl.getXY()[0]-this.leftPadding)-this.fieldScroll;
this.cursorPos=this.getDistanceToPos(c,"px")
}else{this.cursorPos=d
}if(!this.targetEl.hasClass("focused")){if(this.cursorPos==d){this.selStart=d;
this.selEnd=0;
g=this.config.selectAllOnFocus
}}if(!g){this.clearSel()
}this.updateCursor();
this.inputEl.focus()
}},{ATTRS:{value:{value:""}}})
},"1.0",{requires:["base","squarespace-dombuilder","squarespace-ui-base"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-mailcheck",function(a){a.namespace("Squarespace.Plugin");
a.Squarespace.Plugin.MailCheck=a.Base.create("MailCheck",a.Plugin.Base,[],{initializer:function(b){this._host=b.host;
this._host.on("blur",this.checkMailAddress,this)
},checkMailAddress:function(c){var b=this._host.get("value");
if(b!=null&&b.length>3){Kicksend.mailcheck.run({email:b,suggested:a.bind(this.emailSuggestions,this),empty:a.bind(this.noEmailSuggestions,this)})
}},emailSuggestions:function(c){if(!this._host.hasPlugin("flyoutPlugin")){this._host.plug(a.Squarespace.Animations.Flyout,{duration:0.3})
}this.get("field").showError('Did you mean <a class="corrected-email" href="#">'+c.full+"</a>?");
var b=a.one(".corrected-email");
if(b){a.one(".corrected-email").once("click",this._onClick,this)
}},noEmailSuggestions:function(c){var b=this._host.flyoutPlugin;
if(b){b.hide()
}},_onClick:function(c){c.preventDefault();
c.halt();
var b=this._host.flyoutPlugin;
if(b){this._host.set("value",b.get("node").one("a").getHTML());
b.hide();
this.get("field").clearError()
}},destructor:function(){}},{NS:"mailCheck",ATTRS:{field:{}}})
},"1.0",{requires:["thirdparty-kicksend","squarespace-node-flyout"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-dialog-fields",function(b){b.namespace("Squarespace");
function a(d){var c={13:true,27:true,16:true,17:true,18:true,20:true,36:true,35:true,33:true,34:true,37:true,38:true,39:true,40:true,112:true,113:true,114:true,115:true,116:true,117:true,118:true,119:true,120:true,121:true,122:true,123:true,45:true,91:true,144:true};
return !c[d]
}b.Squarespace.DialogField=Class.extend(b.Squarespace.Gizmo,{_name:"DialogField",initialize:function(e,d,f){this._super();
var c={defaultHidden:false};
this.config=b.merge(c,e);
this.panel=f;
this.dialog=f;
this.initialData=b.merge({},d);
this.className="";
this.inActiveFrame=true;
if(this.config&&(typeof this.config.name!=="undefined")&&(this.config.name in d)){this.value=d[this.config.name]
}this._debug=new b.Squarespace.Debugger({name:this._name,output:false})
},hide:function(c){this.temporaryHide(c)
},getTakenHeight:function(){return this.html.get("offsetHeight")
},show:function(c){this.temporaryShow(c)
},getName:function(){return this.config.name
},getType:function(){return this.type
},getDialog:function(){return this.dialog
},append:function(c){c.append(this.html);
if(this.config.defaultHidden){this.temporaryHide(false)
}},resize:function(){},isValid:function(){return this.getErrors().length>0
},getErrors:function(){if(this.config.validator&&this.config.validationErrorMsg&&!this.config.validator.call(this)){return[this.config.validationErrorMsg]
}return[]
},showError:function(d){if(!d){return
}var e=this.errorFlyoutAnchor||this.control;
if(!e){console.error("dialog-field: [DialogField] No control or error flyout anchor set to throw form field error on. Set this.control or this.errorFlyoutAnchor to a node.")
}if(!e.hasPlugin("flyoutPlugin")){e.plug(b.Squarespace.Animations.Flyout,{duration:0.3})
}var c=e.flyoutPlugin;
if(c.get("visible")){if(this._showErrorSub){this._showErrorSub.detach()
}this._showErrorSub=c.once(this.getId()+"|hidden",function(){this._showErrorSub=null;
this._doShowErrorFlyout(d)
},this);
c.hide()
}else{this._doShowErrorFlyout(d)
}},_doShowErrorFlyout:function(i){var h=(this.errorFlyoutAnchor||this.control);
var d=h.flyoutPlugin;
this.html.addClass("error");
if(!this._errorEl){this._errorEl=b.DB.DIV("flyout-error-message",{html:i});
this._errorEl.setStyle("zIndex",this.dialog.zIndex+10);
this._errorEl.on(this.getId()+"|click",function(k){k.halt()
},this)
}this._errorEl.setContent(i);
var f=b.Squarespace.Utils.measureNode(this._errorEl).width,j=(h.getX()+h.get("offsetWidth")-(this.html.hasClass("thin")?-10:1)),g=j+f,e=b.one(window).get("region").right,c=g>e;
if(c){this._errorEl.addClass("out-from-left")
}d.setAttrs({node:this._errorEl,alignment:c?"lt":"rt"});
this._clearErrorSub=b.on(this.getId()+"|click",this.clearError,this.errorEl,this);
d.show()
},hideError:function(){var d=this.errorFlyoutAnchor||this.control;
if(!d||!d.hasPlugin("flyoutPlugin")||!d.flyoutPlugin.get("visible")){return
}if(this._clearErrorSub){this._clearErrorSub.detach()
}var c=d.flyoutPlugin;
this._subscribeOnce(c,this.getId()+"|hidden",function(f){this.html.removeClass("error")
},this);
c.hide()
},clearError:function(){this.dialog.clearError(this);
this.hideError()
},updateInlineTitle:function(){},setHeight:function(c){if(this.control){this.control.setStyle("height",c+"px")
}},getValue:function(){return this.value
},setValue:function(c){var d=this.value;
this.value=c;
if("config" in this&&"name" in this.config){this.fire("value-changed",{name:this.config.name,value:c,oldValue:d,field:this})
}},temporaryHide:function(c){this.fire("hide",this);
this.hidden=true;
if(this.hideAnim){this.hideAnim.stop()
}if(c){this.html.setStyle("display","none");
this.fire("hidden",this)
}else{this.hideAnim=this._anim({node:this.html,to:{opacity:0},duration:0.35,easing:b.Easing.easeOutStrong});
this.hideAnim.on("end",function(){this.html.setStyle("display","none");
this.fire("hidden",this)
},this);
this.hideAnim.run()
}},temporaryShow:function(){this.fire("show",this);
this.hidden=false;
if(this.hideAnim){this.hideAnim.stop()
}this.html.setStyle("display","block");
this.hideAnim=this._anim({node:this.html,to:{opacity:1},duration:0.35,easing:b.Easing.easeOutStrong});
this.hideAnim.on("end",function(){b.fire("shown",this);
b.fire("showing",this);
this.fire("shown")
},this);
this.hideAnim.run()
},getNode:function(){return this.html
},didDataChange:function(){if(this.config.ignoreChanges){return false
}var c;
if(!this.initialData||(b.Lang.isUndefined(this.initialData[this.getName()])&&this.getValue()==="")){c=false
}else{if(b.Lang.isArray(this.initialData[this.getName()])){c=b.JSON.stringify(this.initialData[this.getName()])!==b.JSON.stringify(this.getValue())
}else{c=this.getValue()!==this.initialData[this.getName()]
}}if(c){this._debug.log(this.getName(),this.getType(),"changed",["current",this.getValue()],["initial",this.initialData[this.getName()]])
}return c
}});
b.Squarespace.DialogFieldGenerators={select:Class.extend(b.Squarespace.DialogField,{initialize:function(f,c,d){this._super(f,c,d);
if(!this.config.options){this.config.options=[];
console.warn("Select '"+this.config.name+"' has no options.")
}if(!this.config.icon){this.config.icon="";
this.noIcon=true
}this.control=b.DB.DIV("field-input-wrapper select "+(this.config.className?this.config.className:""),{html:"&nbsp;"});
if(this.config.width){if(b.Lang.isNumber(this.config.width)){if(this.config.width>=1){this.selectElWidth=this.config.width+"px"
}}else{if(b.Lang.isString(this.config.width)){this.selectElWidth=this.config.width
}else{console.log("dialog: [DialogField] Width is not a number or string",this)
}}}else{this.selectElWidth=false
}this.underlyingControl=b.DB.SELECT("input",{tabIndex:d.getNextTabIndex(),style:"position: absolute; top: 0; left: 0px; opacity: 0"});
var g;
for(var e in this.config.options){if(c[this.config.name]==e){this.value=e
}if(!g){g=e
}this.underlyingControl.append(b.DB.OPTION({html:this.config.options[e].title,value:e}))
}if(b.Lang.isUndefined(this.value)||b.Lang.isNull(this.value)||!this.config.options[this.value]){if(this.config.defaultValue!=null&&!b.Lang.isUndefined(this.config.defaultValue)&&this.config.options[this.config.defaultValue]){this.value=this.config.defaultValue
}else{this.value=g
}}this.html=b.DB.DIV("field-wrapper select-field-wrapper clear thin dialog-field-"+this.config.name,(this.config.title?b.DB.DIV("field-title",{html:this.config.title}):null),b.DB.DIV("field-wrapper-inner clear"+(this.config.icon?" icon "+this.config.icon:""),{style:"position: relative;"+(this.selectElWidth?"width: "+this.selectElWidth:"")},b.DB.DIV("field-rhs",this.control),this.underlyingControl),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description",{html:this.config.description})):null));
this.setValue(this.value);
this._subscribe([[this.html.one(".field-wrapper-inner"),"click",this.onClick],[this.underlyingControl,"change",this.onChange]]);
if(this.config.onChange){this._subscribe([[this.underlyingControl,"change",this.config.onChange]])
}if(b.Object.isEmpty(this.config.options)){this.html.setStyle("display","none")
}if(f.hidden){this.temporaryHide(true)
}},didDataChange:function(){if(b.Lang.isNumber(Number(this.initialData[this.getName()]))&&b.Lang.isNumber(this.getValue())){return Number(this.initialData[this.getName()])!=Number(this.getValue())
}else{return this.initialData[this.getName()]!=this.getValue()
}},updateOptions:function(d,c){d=d||{};
this.html.setStyle("display",b.Object.isEmpty(d)?"none":null);
this.config.options=d;
this.underlyingControl.set("innerHTML","");
b.Object.each(d,function(f,e){this.underlyingControl.append(b.DB.OPTION({html:d[e].title,value:e}))
},this);
if(!b.Lang.isUndefined(c)&&d[c]!=null){this.setValue(c);
this.html.one(".field-input-wrapper.select").setContent(this.getValueTitle(c))
}},onClick:function(f){f.halt();
if(this._disabled){return
}var d;
if(f.target.get("tagName")=="SELECT"){return
}else{if(f.target.hasClass("field-wrapper-inner")){d=f.target
}else{if(!f.target.ancestors(".field-wrapper-inner").isEmpty()){d=f.target.ancestors(".field-wrapper-inner").item(0)
}else{return
}}}var c=d.one("select");
c.simulate("mousedown")
},show:function(){if(!this.noIcon){var d=parseInt(this.html.get("offsetWidth"),10)-parseInt(this.html.getStyle("paddingLeft"),10);
var c=(d-5);
this.underlyingControl.setStyle("width",c+"px")
}},onChange:function(){this.setValue(this.underlyingControl.get("value"));
this.fire("change",this.getValue());
this.dialog.fire("datachange",this)
},hideDescription:function(){this.html.one(".field-description").hide()
},showDescription:function(c){this.html.one(".field-description").show();
this.html.one(".field-description").setContent(c)
},getDescription:function(){return this.html.one(".field-description")
},rollback:function(){this.setValue(this.previousValue);
this.html.one(".field-input-wrapper.select").setContent(this.getValueTitle(this.getValue()))
},setValue:function(c){this.previousValue=this.value;
this.value=c;
this.underlyingControl.set("value",c);
if(!b.Object.isEmpty(this.config.options)){this.control.setContent(this.getValueTitle());
if(this.getValueIsEmpty()){this.html.addClass("empty-value")
}else{this.html.removeClass("empty-value")
}}},getPreviousValue:function(){return this.previousValue
},getValue:function(){return this.underlyingControl.get("value")
},getValueTitle:function(){return this.config.options[this.underlyingControl.get("value")].title
},getValueIsEmpty:function(){return this.config.options[this.underlyingControl.get("value")].empty
},disable:function(){this._disabled=true;
this.underlyingControl.setAttribute("disabled","disabled");
this.html.addClass("disabled")
},enable:function(){this._disabled=false;
this.underlyingControl.removeAttribute("disabled");
this.html.removeClass("disabled")
}}),"multi-frame":Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.frames={};
this.activeEl=null;
this.value=this.config.initialFrame;
this.panel.bodyEvents.push(b.on("click",this.onClick,this.html,this))
},onClick:function(c){this.panel.fire("datachange",this)
},show:function(d){var g=this.frames[d];
if(this.activeEl){if(this.activeEl==g){return
}if(this.activeEl.a){this.activeEl.a.stop()
}var c=this.activeEl.fields;
this.activeEl.a=this._anim({node:this.activeEl.el,to:{height:0},duration:0.3,easing:b.Easing.easeOutStrong});
c.forEach(this.setInActiveFrame(false),this);
this.activeEl.a.on("end",function(f){f.target.get("node").addClass("hidden")
},this);
this.activeEl.a.run()
}if(g.a){g.a.stop()
}if(this.activeEl){g.el.ancestor().insertBefore(g.el,this.activeEl.el.next())
}g.el.removeClass("hidden");
var e=g.el.getStyle("height");
g.el.setStyles({height:null});
g.realHeight=g.el.get("offsetHeight");
g.el.setStyles({height:e});
g.a=this._anim({node:g.el,to:{height:g.realHeight},duration:0.3,easing:b.Easing.easeOutStrong});
g.a.on("end",function(l,k){for(var j=0;
j<k.fields.length;
++j){var h=this.panel.fields[k.fields[j].name];
if(h&&h.updateInlineTitle){h.updateInlineTitle()
}}this.focusCurrentFrame()
},this,g);
g.a.run();
g.fields.forEach(this.setInActiveFrame(true),this);
this.activeEl=g;
this.value=d
},focusCurrentFrame:function(){for(var c=0;
c<this.activeEl.fields.length;
++c){var d=this.panel.fields[this.activeEl.fields[c].name];
if(d.getNode){d.getNode().focus();
return
}}},setInActiveFrame:function(c){return function(e){if(e.name){var d=this.panel.getField(e.name);
d.inActiveFrame=c;
d.fire("mutli-frame-focus")
}}
},append:function(d,c,e,g){for(var i in this.config.frames){var f=this.config.frames[i];
var h=b.DB.DIV("frame-wrapper clear");
e.append(h);
this.panel._renderFields(d,f.fields,h,g);
this.frames[i]=this.config.frames[i];
this.frames[i].el=h;
this.frames[i].realHeight=h.get("offsetHeight");
if(i!=this.config.initialFrame){h.setStyle("height","0px");
h.addClass("hidden");
this.frames[i].visible=false;
this.config.frames[i].fields.forEach(this.setInActiveFrame(false),this)
}else{this.activeEl=this.frames[i];
this.frames[i].visible=true;
this.config.frames[i].fields.forEach(this.setInActiveFrame(true),this)
}}}}),"multi-option":Class.extend(b.Squarespace.DialogField,{initialize:function(f,k,c){this._super(f,k,c);
this.config.options=this.config.options.filter(function(i){return !b.Lang.isUndefined(i)&&!b.Lang.isNull(i)
});
this.value=(k[this.config.name]?k[this.config.name]:this.config.defaultValue);
if(!this.config.columns){this.config.columns=this.config.options.length
}if(!this.value&&this.config.multi){this.value=[]
}this.options=[];
this.tips=[];
this.remover={};
this.dds=[];
for(var l=0;
l<this.config.options.length;
++l){var d=this.config.options[l];
if(!d){continue
}var g;
if(this.config.multi){g=false;
for(var h=0;
h<this.value.length;
++h){if(this.value[h]==d.value){g=true;
break
}}}else{g=(d.value==this.value)
}if(!d.disabled||(!this.config.hideDisabled&&d.disabled)){var e=b.DB.DIV("multioption-element option-"+d.value+(g?" active":"")+(this.config.buttonStyle?" button":"")+(this.config.optionStyle?" "+this.config.optionStyle:"")+(d.optionStyle?" "+d.optionStyle:"")+(d.disabled?" disabled":""),{html:'<div class="text clear"><div class="title">'+d.title+"</div>"+(d.description?'<div class="description">'+d.description+"</div>":"")+"</div>",style:"background-position: center "+this.config.iconDropPx+"px; padding: "+this.config.optionPadding,data:{value:d.value}});
if(d.icon){e.setStyle("backgroundImage","url("+d.icon+")")
}if(this.config.height){e.setStyle("height",this.config.height)
}if(!d.title&&!d.description){e.setStyle("visibility","hidden")
}this.options.push(e);
this.remover[d.value]=e;
if(d.value==this.value){this.activeEl=e
}if(this.config.dragTray){e.setStyle("cursor","move");
e.setData(d);
var m=new b.DD.Drag({node:e}).plug(b.Plugin.DDProxy,{moveOnEnd:false,hideOnEnd:false});
this.dds.push(m);
m.on("drag:start",function(o,i,n){var j=o.target.get("node");
b.one("body").append(j);
j.addClass("free-block reattached-node");
this.dds.splice(this.dds.indexOf(i),1);
this.panel.close()
},this,m,d.value);
m.on("drag:end",function(r,j,q){var o=b.DD.DDM.activeDrag;
var p=o.get("node");
var n=o.get("dragNode");
var s={easing:"ease-out",transform:{value:(!p.placeholder?"scale(1.04)":"scale(.6)"),duration:0.4},opacity:{value:0,duration:0.4}};
n.transition(s,function(){this.setStyle("display","none");
this.setStyle("transform","");
this.setStyle("opacity","")
});
j.destroy();
var i=b.one("body").one(".reattached-node");
if(i){i.remove()
}},this,m,d.value);
this.config.attachDragHandlers(m)
}}}this.empty=b.DB.DIV("multioption-placeholder",{style:(this.config.backgroundIcon?"backgroundImage: url("+this.config.backgroundIcon+")":"")});
this.elements=b.DB.DIV("field-input-wrapper",(this.options.length>0?this.options:this.empty));
this.html=b.DB.DIV("field-wrapper multioption-field-wrapper clear "+(this.config.alwaysShowTitles?" show-titles ":"")+(this.config.style?this.config.style:""),(this.config.padding?{style:"padding-top: "+this.config.padding[0]+"; padding-bottom: "+this.config.padding[1]+";"}:null),((this.config.title&&(this.config.titleStyle=="left"||this.config.titleStyle=="top"))?b.DB.DIV("field-lhs "+this.config.titleStyle,{html:this.config.title}):null),b.DB.DIV("field-rhs",this.elements,(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description "+this.config.titleStyle,{html:this.config.description})):null)));
this.control=this.html;
this.panel.bodyEvents.push(b.on("click",this.onClick,this.html,this));
this.panel.bodyEvents.push(b.on("contextmenu",this.onRightClick,this.html,this))
},show:function(){this.config.options.forEach(function(d){var c=b.one(".option-"+d.value);
if(d.tip&&c){this.tips.push(new b.Squarespace.ToolTip({target:c,alwaysEnable:true,title:d.tip.title,body:d.tip.text,dialogTooltip:true}))
}},this)
},onRightClick:function(f){var c=f.target.ancestor(".multioption-element",true);
if(!c){return
}var d=this.value;
this.value=c.data().value;
this.panel.fire("contextmenu",this);
this.value=d;
f.halt()
},onClick:function(f){this.previousValue=this.value;
var c=f.target.ancestor(".multioption-element",true);
f.halt();
if(!c){return
}var g=c.getData();
var d=g.value;
if(!d){return
}if(c.hasClass("disabled")){this.fire("disabled-click",g.value);
return
}this.panel.fire("multioption-click",c.data().value);
if(this.config.multi){c.toggleClass("active");
this.value=[];
this.html.all(".multioption-element.active").each(function(e){this.value.push(e.data().value)
},this)
}else{if(this.activeEl){this.activeEl.removeClass("active")
}c.addClass("active");
this.activeEl=c;
this.value=d
}if(this.config.linkFrame){this.panel.getField(this.config.linkFrame).show(this.value)
}this.panel.fire("datachange",this,g)
},resize:function(){var d=parseInt(this.html.getStyle("width"),10);
if(this.config.titleStyle=="left"){d-=110
}var e=(d-(this.config.columns*2))/this.config.columns;
for(var c=0;
c<this.options.length;
++c){this.options[c].setStyle("width",e+"px")
}},add:function(e,d,f){this.empty.setStyle("display","none");
var c=b.DB.DIV("multioption-element "+(e==this.value?"active":"")+(this.config.buttonStyle?"button":""),{html:'<div class="multioption-thumbnail" style="background-image:url('+d+')"></div><div class="multioption-title">'+f+"</div>",style:"padding: "+this.config.optionPadding+(this.config.height?"height: "+this.config.height+"px;":""),data:{value:e}});
this.remover[e]=c;
this.elements.appendChild(this.remover[e])
},remove:function(c){if(this.remover[c]){this.remover[c].remove();
delete this.remover[c]
}},clear:function(){for(var c in this.remover){if(c!==false&&c!==undefined){this.remover[c].remove();
delete this.remover[c]
}}this.empty.setStyle("display","block")
},setHighlight:function(c){if(this.remover[c]){this.remover[c].addClass("highlighted")
}},removeHighlight:function(c){if(this.remover[c]){this.remover[c].removeClass("highlighted")
}},clearHighlight:function(c){this.html.all(".multioption-element").removeClass("highlighted")
},_destroy:function(){var c;
this._super();
for(c=0;
c<this.tips.length;
++c){this.tips[c].destroy()
}for(c=0;
c<this.dds.length;
++c){this.dds[c].destroy()
}}}),slider:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
if(e.min===e.max){console.error("Created Slider "+(e.name||e.title||"NO NAME")+" with no range. ["+e.min+", "+e.max+"]")
}else{if(b.Lang.isUndefined(e.min)||b.Lang.isUndefined(e.max)){console.error("Created Slider "+(e.name||e.title||"NO NAME")+" with undefined min or max value.")
}}this.config=e;
this.panel=d;
this.value=((c.hasOwnProperty(this.config.name)?c[this.config.name]:this.config.defaultValue)||this.config.min);
this.control=b.DB.DIV("slider-container",{style:(this.config.labelWidth?"margin-left: "+this.config.labelWidth+"px":"")});
this.titleEl=b.DB.DIV("field-lhs "+this.config.titleStyle,{html:this.config.title});
this.sliderDisplayEl=b.DB.DIV("slider-numeric-display",{html:this.getDisplayValue(),style:(this.config.labelWidth?"width: "+this.config.labelWidth+"px":"")});
this.html=b.DB.DIV("field-wrapper slider-field-wrapper clear "+(this.config.style),((this.config.title&&(this.config.titleStyle=="left"||this.config.titleStyle=="top"))?this.titleEl:null),b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.sliderDisplayEl,this.control),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description "+this.config.titleStyle,{html:this.config.description})):null)));
this.on("shown",this.resize,this);
if(e.hidden){this.temporaryHide(true)
}},getDisplayValue:function(){if(this.config.percentage){return Math.floor((this.value/this.config.max)*100)+"%"
}else{return(this.value===0&&this.config.zeroTitle?this.config.zeroTitle:this.value+(this.config.numericSuffix?"&nbsp;"+this.config.numericSuffix+(this.value!=1?"s":""):""))
}},resize:function(){var c=this.control.get("offsetWidth");
if(this.slider){this.slider.destroy()
}this.slider=new b.Slider({min:this.config.min,max:this.config.max,length:c,axis:"x",value:this.value});
this.slider.after("valueChange",function(d){this.value=d.newVal;
this.sliderDisplayEl.set("innerHTML",this.getDisplayValue());
this.panel.fire("datachange",this)
},this);
this.slider.render(this.control)
},_destroy:function(){this._super();
this.slider.removeTarget()
}}),check:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.active=((c[this.config.name]===undefined?this.config.defaultValue:c[this.config.name])?true:false);
this.html=b.DB.DIV("field-wrapper check-field-wrapper clear thin",(this.config.padding?{style:"padding-top: "+this.config.padding[0]+"; padding-bottom: "+this.config.padding[1]+";"}:null),b.DB.DIV("check-element "+(this.active?"active":""),((this.config.title)?b.DB.DIV("field-title",{html:this.config.title}):null),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description",{html:this.config.description})):null)));
if(e.hidden){this.temporaryHide(true)
}this.panel.bodyEvents.push(b.on("click",this.onClick,this.html,this))
},onClick:function(c){this.setValue(!this.active);
this.panel.fire("datachange",this);
this.fire("changed",this.getValue())
},setValue:function(c){this.active=c;
if(this.active){this.html.one(".check-element").addClass("active")
}else{this.html.one(".check-element").removeClass("active")
}},getValue:function(){return this.active
},didDataChange:function(){if(!this.initialData[this.getName()]&&!this.getValue()){return false
}else{return this._super()
}}}),text:Class.extend(b.Squarespace.DialogField,{initialize:function(f,d,e){this.hideAnim=null;
this._super(f,d,e);
var c=d[this.config.name];
if(b.Lang.isUndefined(c)||b.Lang.isNull(c)){c=""
}this.control=b.DB.INPUT("field-input "+(this.config.className?this.config.className:""),{type:(this.config.password?"password":"text"),spellcheck:"false",tabIndex:this.panel.getNextTabIndex(),value:c,style:(f.bold?"font-weight: bold;":"")+((f.width&&f.width>1)?"width: "+f.width+"px;":""),maxLength:(f.maxLength?f.maxLength:""),placeholder:(this.config.placeholder?this.config.placeholder:"")});
if(this.config.readonly){this.control.setAttribute("readonly",true)
}if(!this.config.titleStyle){this.config.titleStyle="top"
}if(!this.config.style){this.config.style="normal"
}if(!this.config.filter){this.config.filter="none"
}if(!this.config.icon){this.config.icon="none"
}if(this.config.style=="minor"){this.html=b.DB.DIV("field-wrapper text-field-wrapper clear minor dialog-field-"+this.config.name,b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.control),((this.config.title&&this.config.titleStyle=="top")?b.DB.DIV("field-lhs",{html:this.config.title}):null),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description",{html:this.config.description})):null)))
}else{if(this.config.style=="thin"||this.config.style=="small"){this.prefixEl=b.DB.DIV("field-lhs",{html:this.config.prefix});
this.html=b.DB.DIV("field-wrapper text-field-wrapper clear "+this.config.style+" dialog-field-"+this.config.name,((this.config.title&&this.config.style!="small")?b.DB.DIV("field-title",{html:this.config.title}):null),b.DB.DIV("field-wrapper-inner clear "+this.config.icon,this.prefixEl,b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.control))),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description",{html:this.config.description})):null));
this.errorFlyoutAnchor=this.html.one(".field-wrapper-inner")
}else{if(this.config.style=="normal"||this.config.style=="major"||this.config.style=="title"){if(this.config.prefixText){this.titleEl=b.DB.DIV("field-lhs left",{html:this.config.prefixText})
}else{if(this.config.title&&(this.config.titleStyle=="left"||this.config.titleStyle=="top")){this.titleEl=b.DB.DIV("field-lhs "+this.config.titleStyle,{html:this.config.title})
}}this.html=b.DB.DIV("field-wrapper text-field-wrapper clear "+(this.config.style)+" dialog-field-"+this.config.name,this.titleEl,b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.control),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description "+this.config.titleStyle,{html:this.config.description})):null)))
}}}if(this.config.hide){this.html.setStyle("display","none")
}this.panel.bodyEvents.push(b.on("paste",this.onPaste,this.control,this));
this.panel.bodyEvents.push(b.on("keyup",this.onKeyUp,this.control,this));
this.panel.bodyEvents.push(b.on("keypress",this.applyKeyFilter,this.control,this));
this.panel.bodyEvents.push(b.on("keydown",this.onKeyDown,this.control,this));
this.panel.bodyEvents.push(b.on("key",this.onSubmit,this.control,"down:13",this));
this.control.on("input",function(g){console.log(g.target.get("value"))
});
this._subscribe([[this.control,"change",this.onChange]]);
if(f.mailcheck){this.control.plug(b.Squarespace.Plugin.MailCheck,{field:this})
}},onChange:function(){this.fire("change",this.getValue());
this.dialog.fire("datachange",this)
},onPaste:function(c){b.later(1,this,function(){this.updateInlineTitle();
this.updateTextSuffix()
})
},onKeyDown:function(c){if(c.keyCode===9){this.updateInlineTitle();
this.updateTextSuffix()
}else{if(a(c.keyCode)){this.hideInlineTitle()
}}if(c.keyCode!==27){c.stopPropagation()
}},applyKeyFilter:function(d){if(this.config.keyFilter){if(b.UA.gecko!==0&&!d._event.isChar){return
}var f=String.fromCharCode(d.which);
if(!f.match(new RegExp(this.config.keyFilter))&&f.length>0){if(this.config.keyFilterExplanation){this.showError(this.config.keyFilterExplanation)
}d.halt()
}}},onKeyUp:function(d){if(this.config.filter==="url-slug"||this.config.filter=="url-slug-with-slash"){var c,f=this.control.get("value");
if(this.config.filter==="url-slug"){c=b.Squarespace.Utils.createUrl(f)
}else{c=b.Squarespace.Utils.createUrlWithSlash(f)
}var g=this.control._node.selectionStart-(d.keyCode==32?0:1);
if(f!=c){this.control.set("value",c);
this.control._node.selectionStart=g;
this.control._node.selectionEnd=g
}}if(this.config.syncedField){this.panel.getField(this.config.syncedField).setValue(this.getValue())
}if(a(d.keyCode)){this.panel.fire("keyup",this);
this.updateInlineTitle();
this.updateTextSuffix();
this.panel.fire("datachange",this);
this.clearError();
d.stopPropagation()
}if(d.keyCode==13){this.fire("keyup-enter")
}},onSubmit:function(c){c.halt(true);
if(this.config.submitOnEnter){this.dialog.saveAndClose()
}if(this.config.saveOnEnter){if(this.dialog.anchorData){this.dialog.anchorData.once("save",function(){this.panel.hideSaveOverlay()
},this)
}this.panel.save()
}},isEmpty:function(){if(!this.control){return false
}return(this.control.get("value").length===0)
},enable:function(){this.html.removeClass("disabled");
this.control.set("disabled","")
},disable:function(){this.html.addClass("disabled");
this.control.set("disabled","true")
},showInlineTitle:function(){if(this.hideAnim!==null){this.hideAnim.stop();
this.hideAnim=null
}if(this.control.getDOMNode()==null||this.html.getDOMNode()==null){console.warn("Text field DOM nodes in invalid states. Bailing.");
return
}if(!this.inlineTitle){this.inlineTitle=b.DB.DIV("inline-field-title "+(this.config.style),{html:this.config.title});
this.inlineTitle.event=b.on("click",this.focus,this.inlineTitle,this);
if(this.html.getDOMNode()!==null){b.one(this.html).append(this.inlineTitle)
}else{console.warn('Text Field "html" property is null.')
}}var d,c;
switch(this.config.style){case"major":d=16;
break;
case"title":d=17;
break;
case"small":d=3;
break;
default:d=15
}if(this.config.prefixText){d+=110
}c=(this.control.get("offsetHeight")-this.inlineTitle.get("offsetHeight"))/2;
this.currentXY=[d+26,c];
this.inlineTitle.setStyles({left:this.currentXY[0]+"px",top:this.currentXY[1]+"px",opacity:1})
},hideInlineTitle:function(){if(this.hideAnim!==null){this.hideAnim.stop();
this.hideAnim=null
}if(this.inlineTitle&&this.inlineTitle.inDoc()){this.hideAnim=this._anim({node:this.inlineTitle,from:{opacity:1},to:{opacity:0},duration:0.05,easing:b.Easing.easeOutStrong});
this.hideAnim.on("end",function(){this.inlineTitle.event.detach();
this.inlineTitle.remove();
this.inlineTitle=null;
this.hideAnim=null
},this);
this.hideAnim.run()
}},updateInlineTitle:function(){if(this.config.titleStyle=="inline"){if(this.isEmpty()){this.showInlineTitle()
}else{this.hideInlineTitle()
}}},showTextSuffix:function(){var f=null;
var h=10,e=6;
if(this.config.style=="major"){h=12;
e=11
}if(this.config.style=="title"){h=19;
e=10
}if(this.config.style=="small"){h=3;
e=3
}if(!this.textSuffixwrapper){f=b.DB.DIV("suffix inline-field-title "+(this.config.style),{style:"position: relative;",html:this.config.suffix});
f.setStyles({top:e+"px",opacity:1});
this.textSuffixwrapper=b.DB.DIV("suffix-wrapper",f);
this.textSuffixwrapper.setStyle("height",this.control.get("offsetHeight")+"px");
this.textSuffixwrapper.setStyle("width",this.control.get("offsetWidth")+"px");
this.textSuffixwrapper.setStyle("top",(e)+"px");
this.textSuffixwrapper.setStyle("overflow","hidden");
this.textSuffixwrapper.setStyle("position","absolute");
this.textSuffixwrapper.event=this.textSuffixwrapper.on("click",this.focus,this);
b.one(this.html.one(".field-input-wrapper")).append(this.textSuffixwrapper);
this.measurementEl=b.DB.DIV("measurement-el inline-field-title "+(this.config.style),{style:"position: absolute; opacity: 0;",html:""});
b.one(this.html.one(".field-input-wrapper")).append(this.measurementEl)
}if(f===null){f=this.textSuffixwrapper.one(".suffix")
}var g=this.getValue().replace(/ /g,".");
this.measurementEl.setContent(g);
h+=this.measurementEl.get("offsetWidth");
var d=this.control.get("offsetWidth");
var c=23;
this.textSuffixwrapper.setStyle("width",(d-h)+"px");
this.textSuffixwrapper.setStyle("left",(c+h)+"px");
this.textSuffixwrapper.setStyle("top","0px")
},hideTextSuffix:function(){if(this.textSuffixwrapper){this.textSuffixwrapper.remove();
this.textSuffixwrapper.event.detach();
this.textSuffixwrapper=null;
this.measurementEl.remove()
}},updateTextSuffix:function(){if(this.config.suffix){if(this.isEmpty()){this.hideTextSuffix()
}else{this.showTextSuffix()
}}},resize:function(){var c;
if(this.config.titleStyle=="left"){c=parseInt(this.html.getStyle("width"),10)-parseInt(this.titleEl.get("offsetWidth"),10);
this.control.setStyle("width",c+"px")
}else{if(this.config.style=="thin"){c=parseInt(this.html.getStyle("width"),10)-parseInt(this.html.getStyle("paddingLeft"),10)-parseInt(this.html.getStyle("paddingRight"),10);
this.control.setStyle("width",(c-this.prefixEl.get("offsetWidth")-(this.config.icon!==""?18:0))+"px")
}}},focus:function(c){if(c){c.halt()
}if(this.control){this.control.focus()
}},show:function(){if(this.config.titleStyle=="inline"){if(this.isEmpty()){this.showInlineTitle()
}else{this.updateTextSuffix()
}}this._super()
},hide:function(){if(this.config.titleStyle=="inline"){this.hideInlineTitle()
}this._super()
},getErrors:function(){var c=this._super();
if(this.config.required&&this.control.get("value")===""){return["Required field."]
}else{return c
}},getValue:function(){return this.control.get("value")
},setValue:function(c){if(!this.control){return
}this.control.set("value",(c!==undefined?c:""));
this.updateInlineTitle();
this.updateTextSuffix();
this.clearError()
},_destroy:function(){this._super();
if(this.testSuffixwrapper&&this.testSuffixwrapper.event){this.testSuffixwrapper.event.detach()
}}}),textarea:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this.hideAnim=null;
this._super(e,c,d);
this.control=b.DB.TEXTAREA("field-textarea",{tabIndex:d.getNextTabIndex()});
if(!this.config.titleStyle){this.config.titleStyle="top"
}if(c[this.config.name]){this.control.set("value",c[this.config.name])
}this.fieldTitleEl=((this.config.title&&this.config.titleStyle=="top")?b.DB.DIV("field-lhs top",{html:this.config.title}):null);
this.html=b.DB.DIV("field-wrapper textarea-field-wrapper clear "+(this.config.style),this.fieldTitleEl,b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.control),(this.config.description?b.DB.DIV("field-description-wrapper",b.DB.DIV("field-description",{html:this.config.description})):null)));
if(this.config.height){this.control.setStyle("height",this.config.height+"px")
}this.panel.bodyEvents.push(b.on("keydown",function(f){if(f.keyCode===9){this.updateInlineTitle()
}f.stopPropagation()
},this.control,this));
this.panel.bodyEvents.push(b.on("keyup",this.onDataChanged,this.control,this));
this.panel.bodyEvents.push(b.on("focus",this.onFocus,this.control,this));
this.panel.bodyEvents.push(b.on("blur",this.onBlur,this.control,this));
if(this.value){this.setValue(c[this.config.name])
}if(this.config.hide){this.html.setStyle("display","none")
}},isEmpty:function(){if(!this.control){return false
}return(this.control.get("value").length===0)
},enable:function(){this.html.removeClass("disabled");
this.control.set("disabled","")
},disable:function(){this.html.addClass("disabled");
this.control.set("disabled","true")
},showInlineTitle:function(){if(this.hideAnim!==null){this.hideAnim.stop();
this.hideAnim=null
}if(!this.inlineTitle){this.inlineTitle=b.DB.DIV("inline-field-title textarea",{html:this.config.title});
this.currentXY=[38,12];
this.inlineTitle.setStyles({top:this.currentXY[1]+"px",left:this.currentXY[0]+"px",opacity:1});
this.inlineTitle.event=b.on("click",this.focus,this.inlineTitle,this);
b.one(this.html).append(this.inlineTitle)
}},hideInlineTitle:function(){if(this.inlineTitle&&this.hideAnim===null){this.hideAnim=this._anim({node:this.inlineTitle,from:{opacity:1},to:{opacity:0},duration:0.05,easing:b.Easing.easeOutStrong});
this.hideAnim.on("end",function(){this.inlineTitle.event.detach();
this.inlineTitle.remove();
this.inlineTitle=null;
this.hideAnim=null
},this);
this.hideAnim.run()
}},updateInlineTitle:function(){if(this.config.titleStyle=="inline"){if(this.isEmpty()){this.showInlineTitle()
}else{this.hideInlineTitle()
}}},focus:function(){this.control.focus()
},onDataChanged:function(c){this.updateInlineTitle();
this.panel.fire("datachange",this);
this.clearError()
},onBlur:function(){if(window.CONFIG_PANEL){window.CONFIG_PANEL.set("allowContextMenu",false)
}},onFocus:function(){if(window.CONFIG_PANEL){window.CONFIG_PANEL.set("allowContextMenu",true)
}},show:function(){if(this.config.titleStyle=="inline"){if(this.isEmpty()){this.showInlineTitle()
}}},hide:function(){if(this.config.titleStyle=="inline"){this.hideInlineTitle()
}},getTakenHeight:function(){if(this.config.verticalSpan){return(this.html.get("offsetHeight")-this.control.get("offsetHeight"))
}else{return(this.html.get("offsetHeight"))
}},getValue:function(){return this.control.get("value")
},setValue:function(c){this.control.set("value",(c?c:""));
this.updateInlineTitle();
this.clearError()
}}),tags:Class.extend(b.Squarespace.DialogField,{_defaultOptions:{allowOnlyExistingTags:false,style:"thin"},initialize:function(e,c,d){this._super(e,c,d);
this.config=b.merge(this._defaultOptions,e);
this.panel=d;
if(this.config.options===null){this.config.options=[]
}this.control=b.DB.DIV("tag-field clear",{html:"&nbsp;"});
if(this.config.style=="minor"){if(this.config.description){this.descriptionEl=b.DB.DIV("field-description",{html:this.config.description})
}this.html=b.DB.DIV("field-wrapper tag-field-wrapper clear minor",b.DB.DIV("field-rhs",b.DB.DIV("field-lhs",{html:this.config.title}),b.DB.DIV("field-input-wrapper",this.control),(this.config.description?b.DB.DIV("field-description-wrapper",this.descriptionEl):null)))
}else{if(this.config.style=="thin"){this.html=b.DB.DIV("field-wrapper tag-field-wrapper clear thin",b.DB.DIV("field-lhs",{html:this.config.title}),b.DB.DIV("field-rhs",b.DB.DIV("field-input-wrapper",this.control)))
}}var f={};
if(this.config.collectionId){f.collectionId=this.config.collectionId
}if(this.config.mode==="tags"&&(this.config.existingTags===null||this.config.existingTags.length<=0)&&!this.config.allowOnlyExistingTags&&this.config.autoCompleteTagsUrl){b.Data.get({url:this.config.autoCompleteTagsUrl,data:f,success:this._cb(function(g){this.config.existingTags=g
})},this)
}if(this.config.mode=="select"){b.Data.get({url:"/api/commondata/GetCollectionCategories",data:f,success:this._cb(function(h){var g=[],i;
for(i in h){if(!h.hasOwnProperty(i)){continue
}g.push(h[i].name)
}this.config.options=g
})},this)
}this.dialog._subscribe([[b,"mouseenter",this.onMouseEnter,this.control,this],[b,"mouseover",this.onMouseOver,this.control,this],[b,"mouseout",this.onMouseOut,this.control,this],[b,"mousemove",this.onMouseMove,this.control,this],[b,"click",this.onClick,this.html,this]]);
if(c[this.config.name]){this.setValue(c[this.config.name])
}else{this.setValue({})
}},blurTag:function(){if(this.activeTag){this.activeTag.a.stop();
var c=this.activeTag.one(":last-child");
if(c){c.remove()
}this.activeTag.setStyle("paddingRight","18px");
this._anim({node:this.activeTag,to:{paddingRight:6},duration:0.25,easing:b.Easing.easeOutStrong}).run();
this.activeTag=null
}},onClick:function(g){g.halt();
if(g.target.get("className")=="x"){var h=b.DB.unpackData(this.activeTag);
this.removeTag(h)
}else{if(this.config.mode=="tags"){if(this.flyoutOpen){return
}this.flyoutOpen=true;
var c=this.html.getX()+40;
var j=this.control.getY()-b.one(document.body).get("docScrollY");
this.flyoutControl=b.DB.INPUT("field-input");
if(this.config.maxtaglength){this.flyoutControl.setAttribute("maxlength",this.config.maxtaglength)
}this.flyoutContents=b.DB.DIV("workflow-flyout-options clear",b.DB.DIV("flyout-title",{html:this.config.createLabel}),this.flyoutControl);
this.flyout=b.DB.DIV("workflow-flyout tight",this.flyoutContents,b.DB.DIV("flyout-notch"));
b.one(document.body).append(this.flyout);
this.flyoutHeight=this.flyout.get("offsetHeight");
this.fieldTop=j-this.flyoutHeight-2;
this.flyout.setStyles({width:(250)+"px",height:this.flyoutHeight+"px",opacity:1,left:(c-10)+"px",top:this.fieldTop+"px"});
this.flyoutContents.setStyles({marginTop:this.flyoutHeight+"px",opacity:0});
var d=this._anim({node:this.flyoutContents,to:{marginTop:0,opacity:1},duration:0.2,easing:b.Easing.easeOutStrong});
d.on("end",function(){this.flyoutControl.focus()
},this);
d.run();
this.flyoutAutoCompleteContents=b.DB.DIV("workflow-flyout-autocomplete clear",{html:"&nbsp;"});
this.flyoutAutoComplete=b.DB.DIV("workflow-flyout tight",this.flyoutAutoCompleteContents);
b.one(document.body).append(this.flyoutAutoComplete);
this.flyoutAutoCompleteContents.setStyles({height:"0px"});
if(this.descriptionEl){this._anim({node:this.descriptionEl,to:{opacity:0},duration:0.2,easing:b.Easing.easeOutStrong}).run()
}this._subscribe([[b,"keydown",this.onTagsFieldKeyDown,this.flyoutControl,this],[b,"keyup",this.onTagsFieldKeyUp,this.flyoutControl,this],[b,"click",this.onAutoCompleteAreaClick,this.flyoutAutoCompleteContents,this]]);
this.panel.setActiveFlyout({constraintClasses:".workflow-flyout, .match",field:this});
if(this.selectCount===0){this.control.set("innerHTML",'<div class="text">'+this.config.emptyText+"</div>")
}}else{if(this.config.mode=="select"){if(this.flyoutOpen){return
}this.flyoutOpen=true;
this.flyoutOptions=[];
for(var f in this.config.options){if(!this.config.options.hasOwnProperty(f)){continue
}this.flyoutOptions.push(b.DB.DIV("flyout-option "+(this.values[this.config.options[f]]?"active":""),{html:this.config.options[f],data:this.config.options[f]}))
}if(this.config.canAddElements){this.createOption=b.DB.DIV("flyout-option add",{html:this.config.addElementText});
this.flyoutOptions.push(this.createOption)
}this.flyoutOptionsArea=b.DB.DIV("flyout-select-options dialog-style-scroll",this.flyoutOptions);
this.flyoutContents=b.DB.DIV("workflow-flyout-options clear",b.DB.DIV("flyout-title",{html:this.config.selectLabel}),this.flyoutOptionsArea);
this.flyout=b.DB.DIV("workflow-flyout tight",this.flyoutContents,b.DB.DIV("flyout-notch"));
var c=this.html.getX()+40;
var j=this.control.getY()-b.one(document.body).get("docScrollY");
b.one(document.body).append(this.flyout);
this.flyoutHeight=this.flyout.get("offsetHeight");
this.fieldTop=j-this.flyoutHeight;
this.flyout.setStyles({width:(this.html.get("offsetWidth")+30)+"px",height:this.flyoutHeight+"px",opacity:1,left:(c-20)+"px",top:this.fieldTop+"px"});
this.flyoutContents.setStyles({marginTop:this.flyoutHeight+"px",opacity:0});
this._anim({node:this.flyoutContents,to:{marginTop:0,opacity:1},duration:0.2,easing:b.Easing.easeOutStrong}).run();
if(this.descriptionEl){this._anim({node:this.descriptionEl,to:{opacity:0},duration:0.2,easing:b.Easing.easeOutStrong}).run()
}this.createControl=b.DB.INPUT("flyout-option-add");
if(this.config.maxtaglength){this.createControl.setAttribute("maxlength",this.config.maxtaglength)
}this._subscribe([[b,"click",this.onFlyoutOptionsClick,this.flyoutOptionsArea,this],[b,"blur",this.onFlyoutCreateFieldBlur,this.createControl,this],[b,"keydown",this.onFlyoutCreateFieldKeyDown,this.createControl,this],[b,"keyup",this.onFlyoutCreateFieldKeyUp,this.createControl,this],[b,"createcategory",this.categoryCreatedCallback,this]]);
this.panel.setActiveFlyout({constraintClasses:".workflow-flyout",field:this});
if(this.selectCount===0){this.control.set("innerHTML",'<div class="text">'+this.config.emptyText+"</div>")
}}}}},onFlyoutOptionsClick:function(d){var c=d.target;
if(c.hasClass("flyout-option")){if(c.hasClass("add")){c.addClass("active");
c.set("innerHTML","");
c.append(this.createControl);
this.createControl.focus();
c.scrollIntoView()
}else{var f=b.DB.unpackData(c);
if(c.hasClass("active")){c.removeClass("active");
this.removeTag(f)
}else{c.addClass("active");
this.createTag(f)
}}}},onFlyoutCreateFieldBlur:function(c){this.createOption.set("innerHTML",this.config.addElementText);
this.createOption.removeClass("active")
},onFlyoutCreateFieldKeyUp:function(c){c.halt()
},onFlyoutCreateFieldKeyDown:function(d){d.stopPropagation();
var f=this._filterVal(this.createControl.get("value"));
if(d.keyCode===13&&f!==""){this.createControl.blur();
this.createControl.set("value","");
if(b.Array.indexOf(this.config.options,f)>=0){this.createOption.set("innerHTML",this.config.addElementText);
this.createOption.removeClass("active");
this.createOption.addClass("add");
var c=this.flyoutOptionsArea.all(".flyout-option");
c.each(function(e){if(f===e.get("text")){e.addClass("active")
}});
this.createTag(f);
return
}this.createOption.set("innerHTML","Creating...");
this.createOption.removeClass("add");
this.createOption.addClass("active");
b.Data.post({url:"/api/commondata/AddCategory",data:{collectionId:this.config.collectionId,category:f},success:this._cb(function(h){var i=b.Squarespace.Library.getCollection(this.config.collectionId);
var g=i.getCategories()||[];
g.push(f);
i.setCategories(g);
var e=[];
h=h.collectionCategories;
for(var j in h){if(!h.hasOwnProperty(j)){continue
}e.push(h[j].name)
}this.config.options=e;
b.fire("createcategory",f)
}),failure:function(e){console.log("Failed to add category")
}},this)
}},onAutoCompleteAreaClick:function(d){if(d.target.hasClass("match")){var c=b.DB.unpackData(d.target);
var f=this.currentAutoCompleteMatches[c.matchIdx].value;
this._addTag(f);
this.flyoutControl.focus()
}},categoryCreatedCallback:function(e){this.createOption.set("innerHTML",this.config.addElementText);
this.createOption.removeClass("active");
this.createOption.addClass("add");
if(e){var d=b.DB.DIV("flyout-option",{style:"opacity: 0; height: 0",html:e,data:e});
this.flyoutOptionsArea.append(d);
this.flyoutOptionsArea.append(this.createOption);
var c=this._anim({node:d,to:{opacity:1,height:16},duration:0.25,easing:b.Easing.easeOutStrong});
c.on("end",function(){this.get("node").setStyle("opacity","");
this.get("node").addClass("active")
});
c.run();
this.createTag(e)
}this.createControl.blur()
},_wordHighlight:function(d,g){var c;
if(d.startsWith(g)){c=0
}else{c=d.toLowerCase().indexOf(" "+g.toLowerCase());
c++
}var f=d.substring(0,c);
var e=d.substring(c,c+g.length);
var h=d.substring(c+g.length);
return(f+"<strong>"+e+"</strong>"+h)
},_filterVal:function(c){return b.Lang.trim((c.replace(new RegExp("[,<>]","g"),"")))
},_addTag:function(c){if(c.length===0||this.values[c]){return
}if(this.config.allowOnlyExistingTags){if(b.Object.hasValue(this.config.existingTags,c)){this.flyoutControl.set("value","");
this.createTag(c);
this.autoCompleteIndex=-1;
this._displayAutoComplete()
}}else{if(this.config.existingTags&&!b.Object.hasValue(this.config.existingTags,c)){this.config.existingTags.push(c)
}this.flyoutControl.set("value","");
this.createTag(c);
this.autoCompleteIndex=-1;
this._displayAutoComplete()
}},onTagsFieldKeyDown:function(d){if(d.keyCode===13||d.keyCode===188){d.preventDefault();
var c=this.flyoutControl.get("value");
var f=this._filterVal(c);
this._addTag(f)
}else{if(d.keyCode==38){if(!this.currentAutoCompleteMatches.length){return
}if(this.autoCompleteIndex!=-1){this.currentAutoCompleteMatches[this.autoCompleteIndex].node.removeClass("selected")
}if(this.autoCompleteIndex>0){this.autoCompleteIndex--
}this.flyoutControl.set("value",this.currentAutoCompleteMatches[this.autoCompleteIndex].value);
this.currentAutoCompleteMatches[this.autoCompleteIndex].node.addClass("selected");
d.preventDefault()
}else{if(d.keyCode==40){if(!this.currentAutoCompleteMatches.length){return
}if(this.autoCompleteIndex!=-1){this.currentAutoCompleteMatches[this.autoCompleteIndex].node.removeClass("selected")
}if(this.autoCompleteIndex<(this.currentAutoCompleteMatches.length-1)){this.autoCompleteIndex++
}this.flyoutControl.set("value",this.currentAutoCompleteMatches[this.autoCompleteIndex].value);
this.currentAutoCompleteMatches[this.autoCompleteIndex].node.addClass("selected");
d.preventDefault()
}else{this.autoCompleteIndex=-1
}}}d.stopPropagation()
},_displayAutoComplete:function(){var j=this.flyoutControl.get("value").replace(new RegExp("[,<>]","g"),"");
var f=0;
this.flyoutAutoCompleteContents.set("innerHTML","");
if(j.length!==0){var h="";
this.currentAutoCompleteMatches=[];
for(var e=0;
e<this.config.existingTags.length;
++e){var d=j.toLowerCase();
var g=this.config.existingTags[e].toLowerCase();
var c=g.indexOf(d);
if(c===0||g[c-1]===" "){var k=b.DB.DIV("match",{html:this._wordHighlight(this.config.existingTags[e],d),data:{matchIdx:f}});
this.flyoutAutoCompleteContents.append(k);
this.currentAutoCompleteMatches.push({node:k,value:this.config.existingTags[e]});
f++
}if(this.currentAutoCompleteMatches.length==6){break
}}}if(this.flyoutAnim){this.flyoutAnim.stop()
}if(f){this.flyoutControl.setStyles({borderBottomLeftRadius:"0px",borderBottomRightRadius:"0px"});
this.flyoutAutoComplete.setStyles({display:"block",width:(210-2)+"px",opacity:1,left:(this.flyoutControl.getX()-this.flyoutControl.get("docScrollX"))+"px",top:(this.flyoutControl.getY()+this.flyoutControl.get("offsetHeight")-this.flyoutControl.get("docScrollY"))+"px"});
this.flyoutAutoCompleteContents.setStyles({opacity:1,display:"block"});
this.flyoutAnim=this._anim({node:this.flyoutAutoCompleteContents,to:{height:(f*23)},duration:0.25,easing:b.Easing.easeOutStrong});
this.flyoutAnim.run()
}else{this.flyoutControl.setStyles({borderBottomLeftRadius:"3px",borderBottomRightRadius:"3px"});
this.flyoutAnim=this._anim({node:this.flyoutAutoCompleteContents,to:{height:0},duration:0.25,easing:b.Easing.easeOutStrong});
this.flyoutAnim.on("end",function(){this.get("node").setStyle("display","none")
});
this.flyoutAnim.run()
}},onTagsFieldKeyUp:function(c){c.halt();
if(this.config.mode=="tags"&&this.autoCompleteIndex==-1){this._displayAutoComplete()
}},createTag:function(h,g){if(!g){g=h
}if(this.values[h]){return
}if(this.selectCount===0){this.control.set("innerHTML","")
}var c=b.DB.DIV("tag "+this.config.itemClass,{html:h,data:g});
c.setStyle("opacity",0);
this.control.append(c);
var e=c.get("offsetWidth");
c.setStyles({width:"0px",paddingLeft:"0px",paddingRight:"0px",opacity:1});
this.updateMeasurements(e);
this.viewportToPercent(100);
if(this.config.style=="minor"){c.a=this._anim({node:c,to:{width:e-20,paddingRight:14,paddingLeft:10},duration:0.15,easing:b.Easing.easeOutStrong})
}else{c.a=this._anim({node:c,to:{width:e-20,paddingRight:6,paddingLeft:14},duration:0.15,easing:b.Easing.easeOutStrong})
}c.a.on("end",function(){this.get("node").setStyle("width","")
});
c.a.run();
this.values[h]=true;
this.selectCount++;
var f=b.Squarespace.Library.getCollection(this.config.collectionId);
var d=f.getTags()||[];
d.push(g);
f.setTags(d);
this.panel.fire("datachange",this)
},removeTag:function(d){this.seekVal=d;
this.control.all(".tag").each(function(f){var e=b.DB.unpackData(f);
if(this.seekVal==e){this.theNode=f
}},this);
this.seekVal=null;
if(!this.theNode){return
}if(this.activeTag==this.theNode){this.removingNode=this.theNode;
this.activeTag=null
}if(this.theNode.a){this.theNode.a.stop()
}var c=this._anim({node:this.theNode,to:{width:0,paddingRight:0,paddingLeft:0,marginRight:0},duration:0.15,easing:b.Easing.easeOutStrong});
c.on("end",function(){this.theNode.remove();
this.theNode=null;
if(this.selectCount===0){this.control.set("innerHTML",'<div class="text dialog-element">'+(this.flyoutOpen?this.config.emptyText:this.config.addText)+"</div>")
}this.updateMeasurements()
},this);
c.run();
delete this.values[d];
this.selectCount--;
this.panel.fire("datachange",this)
},closeFlyout:function(){if(this.selectCount===0){this.control.set("innerHTML",'<div class="text dialog-element">'+this.config.addText+"</div>")
}if(this.descriptionEl){this._anim({node:this.descriptionEl,to:{opacity:1},duration:0.2,easing:b.Easing.easeOutStrong}).run()
}var d=this._anim({node:this.flyoutContents,to:{marginTop:this.flyoutHeight,opacity:0},duration:0.2,easing:b.Easing.easeOutStrong});
d.on("end",function(){this._clearEvents();
this.flyout.remove();
this.flyoutOpen=false
},this);
d.run();
if(this.flyoutAutoCompleteContents){var c=this._anim({node:this.flyoutAutoCompleteContents,to:{marginTop:-this.flyoutAutoComplete.get("offsetHeight"),opacity:0},duration:0.2,easing:b.Easing.easeOutStrong});
c.on("end",function(){this.flyoutAutoComplete.remove()
},this);
c.run()
}this.panel.clearActiveFlyout()
},updateMeasurements:function(f){if(!f){f=0
}var c=this.html.one(".tag-field .tag:last-child");
var d=this.html.one(".field-input-wrapper");
var e=parseInt(this.html.one(".tag-field").getStyle("margin-left"));
if(c){this.lastChildEndX=c.getX()-this.html.getX()+c.get("offsetWidth")-19-e+f
}},onMouseEnter:function(){if(!this.lastChildEndX){this.updateMeasurements()
}},onMouseMove:function(i){var f=this.html.one(".field-input-wrapper");
var d=f.get("offsetWidth");
var h=this.lastChildEndX-d;
if(h>0){var c=i.clientX-f.getX();
var g=c/d;
this.viewportToPercent(g)
}},onMouseOver:function(c){if(this.blurTimer){this.blurTimer.cancel();
this.blurTimer=null
}if(this.snapBackTimer){this.snapBackTimer.cancel();
this.snapBackTimer=null
}if(c.target.hasClass("tag")){if(this.activeTag==c.target){return
}if(this.removingNode==c.target){return
}this.blurTag();
this.activeTag=c.target;
this.activeTag.a=this._anim({node:this.activeTag,to:{paddingRight:18},duration:0.25,easing:b.Easing.easeOutStrong});
this.activeTag.a.on("end",function(){this.get("node").append(b.DB.DIV("x",{html:"&times;"}));
this.get("node").setStyle("paddingRight","2px")
});
this.activeTag.a.run()
}},onMouseOut:function(c){if(c.target.hasClass("x")){return
}if(this.blurTimer){return
}if(!this.snapBackTimer){this.snapBackTimer=b.later(150,this,this.viewportTo,0)
}this.blurTimer=b.later(50,this,this.blurTag)
},viewportToPercent:function(e){var d=this.html.one(".field-input-wrapper");
var c=d.get("offsetWidth");
var f=this.lastChildEndX-c;
if(f>0){if(e<0.04){e=0
}if(e>0.96){e=1
}var g=f*e;
this.html.one(".tag-field").setStyle("margin-left","-"+g)
}},viewportTo:function(c){if(this.snapBackAnim){this.snapBackAnim.stop()
}this.snapBackAnim=this._anim({node:this.html.one(".tag-field"),to:{marginLeft:c},duration:0.3,easing:b.Easing.easeOutStrong});
this.snapBackAnim.run();
this.snapBacktimer=null
},focus:function(){this.control.focus()
},onDataChanged:function(c){this.panel.fire("datachange",this)
},getValue:function(){if(!this.selectCount){return null
}var d=[];
for(var c in this.values){d.push(c)
}return d
},setValue:function(d){if(!d){d={}
}this.values={};
this.selectCount=0;
if(b.Lang.isArray(d)){for(var e=0;
e<d.length;
++e){this.values[d[e]]=true;
this.selectCount++
}}else{for(var c in d){this.values[c]=d[c];
this.selectCount++
}}if(this.selectCount===0){this.control.set("innerHTML",'<div class="text dialog-element">'+this.config.addText+"</div>")
}else{this.control.set("innerHTML","");
for(var f in this.values){this.control.append(b.DB.DIV("tag "+this.config.itemClass,{html:f,data:f}))
}}}}),progress:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.control=b.DB.DIV("field-progress-inner",{html:"&nbsp;",style:"width: 0px;"});
this.controlContainer=b.DB.DIV("field-progress-wrapper",this.control);
this.html=b.DB.DIV("field-wrapper clear",(this.config.title?b.DB.DIV("field-lhs",{html:this.config.title}):null),b.DB.DIV("field-rhs",this.controlContainer))
},setMessage:function(c){this.control.set("innerHTML",'<div class="text dialog-element">'+c+"</div>")
},setProgress:function(c,d){if(c>1){c=1
}if(c<0){c=0
}this.a=this._anim({node:this.control,to:{width:Math.round(c*this.controlContainer.get("offsetWidth")-6)},duration:0.25,easing:b.Easing.easeOutStrong});
if(d){this.a.on("end",function(){this.control.set("innerHTML",'<div class="text dialog-element">'+d+"</div>");
this.a=null
},this)
}else{this.a.on("end",function(){this.control.set("innerHTML",'<div class="text dialog-element">'+Math.round(c*100)+"%</div>");
this.a=null
},this)
}this.a.run();
this.previousPercentage=c
},hide:function(){if(this.a){this.a.stop()
}}}),html:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
var f;
if(typeof this.config.html=="string"){f=b.Node.create(this.config.html)
}else{f=this.config.html.cloneNode(true)
}this.html=f.addClass("field-wrapper clear html-field"+("name" in this.config?" "+this.config.name:"")+("className" in this.config?" "+this.config.className:""))
},getNode:function(){return this.getWrapperNode()
},getWrapperNode:function(){return this.html
},getContent:function(){return this.html.getContent()
},setContent:function(c){this.html.setContent(c)
}}),description:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
if(!this.config.text){this.config.text=""
}this.html=b.DB.DIV("field-wrapper clear",b.DB.DIV("custom-field-description "+(this.config.className?this.config.className:""),{html:(this.config.title?'<div class="title">'+this.config.title+'</div><div class="text">'+this.config.text+"</div>":this.config.text),style:((this.config.width&&this.config.width>1)?"width: "+this.config.width+"px;":"")+(this.config.padding?"padding-top: "+this.config.padding[0]+"px;":"")+(this.config.padding?"padding-bottom: "+this.config.padding[1]+"px;":"")}))
},setTitle:function(c){this.html.one(".title").setContent(c)
},setText:function(d){var c=this.config.title?'<div class="title">'+this.config.title+'</div><div class="text">'+d+"</div>":d;
this.html.one(".custom-field-description").setContent(c)
},onClick:function(c){this.panel.fire("click",this.config.name)
}}),link:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.html=b.DB.DIV("field-wrapper clear active custom-field-link "+(this.config.className?this.config.className:""),{html:"<span>"+(this.config.href?'<a href="'+this.config.href+'">'+this.config.title+"</a>":this.config.title)+"</span>"});
if(e.align){this.html.setStyle("textAlign",e.align)
}this.html.on("click",this.onClick,this)
},onClick:function(c){this.panel.fire("link-"+this.config.name,this.config.name)
}}),"section-title":Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.value=null;
this.titleRhs=[];
this.tabEls={};
if(this.config.tabs){for(var g=0;
g<this.config.tabs.length;
++g){var f=this.config.tabs[g];
this.tabEls[f.name]=b.DB.DIV("tab",{html:f.title,data:{value:f.name}});
this.titleRhs.push(this.tabEls[f.name]);
if(f.active){this.tabEls[f.name].addClass("active");
this.activeEl=this.tabEls[f.name];
this.value=f.name
}}}this.html=b.DB.DIV("field-wrapper clear",b.DB.DIV("nothing",{style:(this.config.padding?"padding-top: "+this.config.padding[0]+"px;":"")+(this.config.padding?"padding-bottom: "+this.config.padding[1]+"px;":"")},b.DB.DIV("field-section-title clear "+this.config.className,b.DB.DIV("lhs",{html:this.config.text}),b.DB.DIV("rhs",this.titleRhs))));
this.panel.bodyEvents.push(b.on("click",this.onClick,this.html,this))
},onClick:function(c){if(!c.target.hasClass("tab")){return
}if(this.activeEl){this.activeEl.removeClass("active")
}c.target.addClass("active");
this.activeEl=c.target;
this.value=b.DB.unpackData(c.target).value;
if(this.config.linkFrame){this.panel.getField(this.config.linkFrame).show(this.value)
}this.panel.fire("datachange",this)
},getValue:function(){return this.value
}}),statepicker:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.value=c[this.config.name];
if(!this.value){this.value={state:this.config.stateOrder[0],date:(this.params.allowNever?undefined:new Date().getTime())}
}if(this.value.date){this.durationOffset=Math.round((this.value.date-new Date().getTime()-Static.SQUARESPACE_CONTEXT.website.timeZoneOffset)/1000/60/60/24)
}else{this.durationOffset=-1
}this.stateLabel=b.DB.DIV("field-workflow-title",{html:"&nbsp;"});
this.stateDescription=b.DB.DIV("field-workflow-description",{html:"&nbsp;"});
this.html=b.DB.DIV("field-wrapper clear field-workflow-wrapper",this.stateLabel,this.stateDescription);
this.panel.bodyEvents.push(b.on("click",this.onStateChangeRequest,this.stateLabel,this));
this.panel.bodyEvents.push(b.on("click",this.onStateChangeRequest,this.stateDescription,this));
this.updateDisplay()
},onStateChangeConfirm:function(d){var c=b.DB.unpackData(d.target);
if(this.value.state!=c){this.panel.fire("datachange",this)
}this.value.state=c;
this.updateDisplay();
this.closeFlyout(c)
},updateDisplay:function(){this.stateLabel.set("innerHTML",this.getStateTitle());
this.stateDescription.set("innerHTML",this.getStateDescription())
},closeFlyout:function(e){var d;
if(this.dateFlyout){this.html.removeClass("date-picker-active");
d=this._anim({node:this.dateFlyoutContents,to:{marginTop:this.dateFlyoutHeight,opacity:0},duration:0.2,easing:b.Easing.easeOutStrong});
d.on("end",function(){for(var f=0;
f<this.dateFlyoutEvents.length;
++f){this.dateFlyoutEvents[f].detach()
}if(this.durationSlider){this.durationSlider.detach()
}this.dateFlyout.remove();
this.dateFlyout=null;
this.dateFlyoutContents=null
},this);
d.run()
}else{if(!e){e=this.value.state
}for(var c=0;
c<this.optEls.length;
++c){if(this.optEls[c]._node.data!=e){this._anim({node:this.optEls[c],to:{height:0},duration:0.25,easing:b.Easing.easeOutStrong}).run()
}this.optElEvents[c].detach()
}if(this.config.direction=="up"){d=this._anim({node:this.flyout,to:{top:this.fieldTop},duration:0.25,easing:b.Easing.easeOutStrong});
d.run()
}d=this._anim({node:this.flyout,to:{opacity:0},duration:0.55,easing:b.Easing.easeOutStrong});
d.on("end",function(){this.flyout.remove()
},this);
d.run()
}this.panel.clearActiveFlyout()
},_renderCalendar:function(f,e){var n=new Date(f.getTime());
n.setMinutes(n.getMinutes()+n.getTimezoneOffset()+parseInt(Static.SQUARESPACE_CONTEXT.website.timeZoneOffset,10)/60000);
var p=["Su","Mo","Tu","We","Th","Fr","Sa"];
var m='<div class="calendar-wrapper"><div class="header"><div class="back">&nbsp;</div>'+b.Squarespace.Utils.dateFormat(f,{format:"%B %Y"})+'<div class="next">&nbsp;</div></div>';
m+='<table cellpadding="0" cellspacing="0">';
m+='<tr class="header-row">';
m+=(p.reduce(function(d,i){return d+"<td>"+i+"</td>"
},""));
m+="</tr>";
var k=new Date(n.getTime());
var u=new Date(n.getTime());
u.moveToFirstDayOfMonth();
var c=u.getDay();
var t=f.getDaysInMonth();
var g=new Date(n.getTime());
g.addMonths(-1);
var s=g.getDaysInMonth();
var q=new Date();
var o=new Date(this.value.date);
o.setMinutes(o.getMinutes()+o.getTimezoneOffset()+parseInt(Static.SQUARESPACE_CONTEXT.website.timeZoneOffset,10)/60000);
var r=1;
for(var l=0;
l<6;
++l){m+='<tr class="body-row">';
if(r>(t+c)){for(var l=0;
l<7;
++l){m+='<td class="fade">&nbsp;</td>'
}}else{for(var h=0;
h<7;
++h){if(r<=c){m+='<td class="fade">'+(s-c+r)+"</td>"
}else{if(r<=(t+c)){k.set({day:(r-c)});
if(this.dateFlyoutType=="duration"){if(this.value.date&&(o.getMonth()==n.getMonth())&&(o.getDate()==(r-c))){m+='<td class="active selected">'+(r-c)+"</td>"
}else{if((q.getMonth()==n.getMonth())&&(q.getDate()==(r-c))){m+='<td class="today">'+(r-c)+"</td>"
}else{if(k.getTime()<q.getTime()){m+='<td class="fade">'+(r-c)+"</td>"
}else{m+='<td class="active">'+(r-c)+"</td>"
}}}}else{if(this.value.date&&(o.getMonth()==n.getMonth())&&(o.getDate()==(r-c))){m+='<td class="active selected">'+(r-c)+"</td>"
}else{if((q.getMonth()==n.getMonth())&&(q.getDate()==(r-c))){m+='<td class="active today">'+(r-c)+"</td>"
}else{m+='<td class="active">'+(r-c)+"</td>"
}}}}else{m+='<td class="fade">'+(r-c-t)+"</td>"
}}++r
}}m+="</tr>"
}m+="</table></div>";
e.set("innerHTML",m)
},onCalendarClick:function(f){if(f.target.hasClass("back")){this.currentCalendarMonth.addMonths(-1);
this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer)
}else{if(f.target.hasClass("next")){this.currentCalendarMonth.addMonths(1);
this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer)
}else{if(this.dateFlyoutType=="duration"&&(f.target.hasClass("fade")||f.target.hasClass("selected"))&&this.config.allowNever){this.value.date=null;
this.durationSlider.setValue(-1);
this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer);
this.updateDisplay()
}else{if(f.target.hasClass("active")||f.target.hasClass("today")){if(!this.value.date){this.value.date=new Date()
}var d=new Date(this.value.date);
d.setMinutes(d.getMinutes()+d.getTimezoneOffset()+parseInt(Static.SQUARESPACE_CONTEXT.website.timeZoneOffset,10)/60000);
var c=new Date(d).set({year:this.currentCalendarMonth.getFullYear(),month:this.currentCalendarMonth.getMonth(),day:parseInt(f.target.get("innerHTML"),10),second:0,millisecond:0});
c.setMinutes(d.getMinutes()-c.getTimezoneOffset()-parseInt(Static.SQUARESPACE_CONTEXT.website.timeZoneOffset,10)/60000);
this.value.date=c.getTime();
if(this.dateFlyoutType=="duration"){this.durationOffset=Math.round((this.value.date-new Date().getTime()-Static.SQUARESPACE_CONTEXT.website.timeZoneOffset)/1000/60/60/24);
this.durationDisplay.set("innerHTML",this.getDurationTextShort())
}this.hourControl.set("value",b.Lang.trim(b.Squarespace.Utils.dateFormat(c,{format:"%l"})));
this.minuteControl.set("value",b.Lang.trim(b.Squarespace.Utils.dateFormat(c,{format:"%M"})));
this.ampmControl.set("value",b.Lang.trim(b.Squarespace.Utils.dateFormat(c,{format:"%p"})));
this._updateTime();
this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer);
this.updateDisplay()
}}}}},onTimeFieldKeyUp:function(d){var c;
if(d.target.hasClass("hour")){c=parseInt(this.hourControl.get("value"),10);
if(c>12||c<1){this.hourControl.set("value",this.prevVal)
}}else{if(d.target.hasClass("minute")){c=parseInt(this.minuteControl.get("value"),10);
if(c>60||c<0){this.minuteControl.set("value",this.prevVal)
}}}this._updateTime()
},onTimeFieldClick:function(c){if(c.target.hasClass("hour")){this.hourControl.select()
}else{if(c.target.hasClass("minute")){this.minuteControl.select()
}else{if(c.target.hasClass("ampm")){this.ampmControl.select()
}}}},onTimeFieldBlur:function(d){var c;
if(d.target.hasClass("hour")){c=this.hourControl.get("value");
if(c.indexOf("0")===0){this.hourControl.set("value",parseInt(c,10))
}c=parseInt(c,10);
if(c>12||c<1){this.hourControl.set("value",12)
}}else{if(d.target.hasClass("minute")){c=parseInt(this.minuteControl.get("value"),10);
if(c>=0&&c<=9){this.minuteControl.set("value","0"+c)
}c=parseInt(c,10);
if(c>60||c<0){this.minuteControl.set("value",0)
}}}this._updateTime()
},onTimeFieldKeyDown:function(c){if(c.keyCode==65){this.ampmControl.set("value","AM");
c.halt();
this._updateTime();
return
}else{if(c.keyCode==80){this.ampmControl.set("value","PM");
c.halt();
this._updateTime();
return
}else{if(c.keyCode==13){this.closeFlyout();
return
}}}if(c.target.hasClass("hour")){if(c.keyCode==186){this.minuteControl.select();
c.halt();
return
}if((c.keyCode>57||c.keyCode<48)&&(c.keyCode<96||c.keyCode>105)&&c.keyCode!=9&&c.keyCode!=37&&c.keyCode!=39&&c.keyCode!=16&&c.keyCode!=46&&c.keyCode!=8){c.halt();
return
}this.prevVal=this.hourControl.get("value")
}else{if(c.target.hasClass("minute")){if(c.keyCode==32){this.ampmControl.select();
c.halt();
return
}if((c.keyCode>57||c.keyCode<48)&&(c.keyCode<96||c.keyCode>105)&&c.keyCode!=9&&c.keyCode!=37&&c.keyCode!=39&&c.keyCode!=16&&c.keyCode!=46&&c.keyCode!=8){c.halt();
return
}this.prevVal=this.minuteControl.get("value")
}else{if(c.target.hasClass("ampm")){if(c.keyCode!=9){c.halt()
}}}}},_updateTime:function(){var e=parseInt(this.hourControl.get("value"),10);
var c=parseInt(this.minuteControl.get("value"),10);
var d=this.ampmControl.get("value");
if(isNaN(e)){return
}if(isNaN(c)){return
}if(e>12||e<=0){e=12
}if(c>60||c<0){c=0
}if(e==12&&d=="AM"){e=0
}else{if(e!=12&&d=="PM"){e+=12
}}var i=new Date(this.value.date);
var g=e-b.Lang.trim(b.Squarespace.Utils.dateFormat(i,{format:"%H"}));
var f=c-b.Lang.trim(b.Squarespace.Utils.dateFormat(i,{format:"%M"}));
i.setHours(i.getHours()+g);
i.setMinutes(i.getMinutes()+f);
this.value.date=i.getTime();
this.updateDisplay()
},onDateChangeRequest:function(g,j){if(this.dateFlyout){return
}this.dateFlyoutType=j;
var f=400;
var h=new Date(this.value.date);
this.html.addClass("date-picker-active");
this.dateCalendarContainer=b.DB.DIV("empty",{html:"&nbsp;",style:"float: left;"});
this.hourControl=b.DB.INPUT("time-control hour",{maxlength:2,style:"text-align: right;",value:b.Lang.trim(b.Squarespace.Utils.dateFormat(h,{format:"%l"}))});
this.minuteControl=b.DB.INPUT("time-control minute",{maxlength:2,style:"text-align: left;",value:b.Squarespace.Utils.dateFormat(h,{format:"%M"})});
this.ampmControl=b.DB.INPUT("time-control ampm",{maxlength:2,style:"text-align: left; width: 36px;",value:b.Squarespace.Utils.dateFormat(h,{format:"%p"})});
this.durationDisplay=b.DB.DIV("duration-display",{html:this.getDurationTextShort()});
this.timeWrapper=b.DB.DIV("time-wrapper",this.hourControl,b.DB.DIV("time-control",{html:":",style:"width: 5px; border: 0px"}),this.minuteControl,this.ampmControl);
if(!this.value.date){this.timeWrapper.addClass("disabled");
this.hourControl.set("value","10");
this.minuteControl.set("value","00");
this.ampmControl.set("value","AM")
}else{this.timeWrapper.removeClass("disabled")
}this.dateFlyoutContents=b.DB.DIV("workflow-flyout-options",b.DB.DIV("flyout-title clear",{html:"Select a Date & Time",style:"padding-bottom: 8px;"}),b.DB.DIV("flyout-calendar clear",this.dateCalendarContainer,this.timeWrapper),(this.dateFlyoutType=="duration"?b.DB.DIV("duration-wrapper clear",this.durationDisplay,b.DB.DIV("slider-container-wrapper",b.DB.DIV("slider-container",{style:"margin-left: 75px;",id:"duration-slider-display-"+this.getName()}))):null));
var m=b.one(this.stateDescription).one((j=="duration"?".duration":".date"));
this.dateFlyout=b.DB.DIV("workflow-flyout tight",this.dateFlyoutContents,b.DB.DIV("flyout-notch"));
this.dateFlyoutEvents=[b.on("click",this.onCalendarClick,this.dateFlyout,this),b.on("keyup",this.onTimeFieldKeyUp,this.hourControl,this),b.on("keyup",this.onTimeFieldKeyUp,this.minuteControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.hourControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.minuteControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.ampmControl,this),b.on("blur",this.onTimeFieldBlur,this.hourControl,this),b.on("blur",this.onTimeFieldBlur,this.minuteControl,this),b.on("click",this.onTimeFieldClick,this.hourControl,this),b.on("click",this.onTimeFieldClick,this.minuteControl,this),b.on("click",this.onTimeFieldClick,this.ampmControl,this)];
this.currentCalendarMonth=new Date();
if(this.value.date){this.currentCalendarMonth.setTime(this.value.date)
}this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer);
b.one(document.body).append(this.dateFlyout);
var n=this.stateLabel.getX();
var k=this.stateLabel.getY()-b.one(document.body).get("docScrollY");
this.dateFlyoutWidth=f;
this.dateFlyoutHeight=this.dateFlyout.get("offsetHeight");
this.fieldTop=k-this.dateFlyoutHeight+22;
var c=new b.Squarespace.Position({x:(n-31),y:(this.fieldTop+b.one(document.body).get("docScrollY")),w:this.dateFlyoutWidth,h:this.dateFlyoutHeight});
c.nudgeFix();
var i=m.getX()-b.one(this.stateDescription).getX();
this.dateFlyout.setXY([c.getX(),c.getY()]);
this.dateFlyout.setStyles({width:(f)+"px",height:this.dateFlyoutHeight+"px",opacity:1});
this.dateFlyout.one(".flyout-notch").setStyle("margin-left",(c.getXAdj()+(i+(m.get("offsetWidth")/2)-8))+"px");
this.dateFlyoutContents.setStyles({marginTop:this.dateFlyoutHeight,opacity:0});
var l=this._anim({node:this.dateFlyoutContents,to:{marginTop:0,opacity:1},duration:0.2,easing:b.Easing.easeOutStrong});
l.on("end",function(){if(this.dateFlyoutType=="duration"){this.durationSlider=new b.Slider({min:(j=="duration"&&this.config.allowNever?-1:0),max:90,axis:"x",length:b.one("#duration-slider-display-"+this.getName()).get("offsetWidth")+"px",value:this.durationOffset});
this.durationSlider.after("valueChange",function(d){this.durationOffset=d.newVal;
if(this.durationOffset==-1){this.timeWrapper.addClass("disabled");
this.value.date=null
}else{this.timeWrapper.removeClass("disabled");
if(!this.value.date){this.value.date=new Date()
}this.value.date=(new Date().getTime()+(d.newVal*1000*60*60*24));
this._updateTime();
this.currentCalendarMonth=new Date();
this.currentCalendarMonth.setTime(this.value.date)
}this.durationDisplay.set("innerHTML",this.getDurationTextShort());
this._renderCalendar(this.currentCalendarMonth,this.dateCalendarContainer);
this.updateDisplay()
},this);
this.durationSlider.render("#duration-slider-display-"+this.getName())
}},this);
l.run();
this.panel.setActiveFlyout({constraintClasses:".workflow-flyout, .calendar-wrapper",field:this})
},onStateChangeRequest:function(k){if(k.target.hasClass("date")){this.onDateChangeRequest(k,"date");
return
}if(k.target.hasClass("duration")){this.onDateChangeRequest(k,"duration");
return
}if(Object.keys(this.config.states).length<=1){return
}this.optEls=[];
this.optElEvents=[];
for(var f=0;
f<this.config.stateOrder.length;
++f){var o=this.config.stateOrder[f];
var q=this.config.states[o];
this.optEls.push(b.DB.DIV("field-workflow-flyout-option-wrapper "+(this.value.state==o?"selected":""),{data:o},b.DB.DIV("field-workflow-flyout-option",b.DB.DIV("field-workflow-title",{html:q.title}),b.DB.DIV("field-workflow-description",{html:q.optionDesc}))));
this.optElEvents.push(b.on("click",this.onStateChangeConfirm,this.optEls[f],this))
}var r=b.DB.DIV("workflow-flyout-options",this.optEls);
this.flyout=b.DB.DIV("workflow-flyout",r);
b.one(document.body).append(this.flyout);
var m=this.stateLabel.getX();
var l=this.stateLabel.getY()-b.one(document.body).get("docScrollY");
var n=this.optEls[0].get("offsetHeight");
var g=this.flyout.get("offsetHeight");
this.fieldTop=l-g+(n*this.optEls.length)+10;
for(var f=0;
f<this.optEls.length;
++f){if(this.optEls[f]._node.data!=this.value.state){this.optEls[f].setStyle("height","0px")
}}var c=new b.Squarespace.Position({x:(m-31),y:(this.fieldTop+b.one(document.body).get("docScrollY")),w:this.flyout.get("offsetWidth"),h:this.flyout.get("offsetHeight")});
this.flyout.setXY([c.getX(),c.getY()]);
this.flyout.setStyles({width:(this.stateLabel.get("offsetWidth")+30)+"px",opacity:1});
if(this.config.direction=="up"){this._anim({node:this.flyout,to:{top:this.fieldTop-(n*(this.optEls.length-1))},duration:0.25,easing:b.Easing.easeOutStrong}).run()
}for(var d=0;
d<this.optEls.length;
++d){if(this.optEls[d]._node.data!=this.value.state){this._anim({node:this.optEls[d],to:{height:n},duration:0.25,easing:b.Easing.easeOutStrong}).run()
}}this.panel.setActiveFlyout({constraintClasses:".workflow-flyout",field:this})
},getStateTitle:function(){return this.config.states[this.value.state].title
},getDurationText:function(){var c=new Date(this.value.date);
if(this.durationOffset==-1){return'<span class="duration-wrapper"><span class="duration">never</span></span>'
}else{if(this.durationOffset<0){return'<span class="duration-wrapper"><span class="duration">now</span></span>'
}else{if(this.durationOffset===0){return'<span class="duration-wrapper"><span class="duration">today at '+b.Squarespace.Utils.dateFormat(c,{format:"%l:%M %p"})+"</span></span>"
}else{if(this.durationOffset==1){return'<span class="duration-wrapper"><span class="duration">tomorrow at '+b.Squarespace.Utils.dateFormat(c,{format:"%l:%M %p"})+"</span></span>"
}else{return'<span class="duration-wrapper"><span class="duration">in '+this.durationOffset+" days at "+b.Squarespace.Utils.dateFormat(c,{format:"%l:%M %p"})+"</span></span>"
}}}}},getDurationTextShort:function(){if(this.durationOffset==-1){return'<span class="duration">Never</span>'
}else{if(this.durationOffset===0){return'<span class="duration">Today</span>'
}else{if(this.durationOffset==1){return'<span class="duration">Tomorrow</span>'
}else{if(this.durationOffset<-1){return'<span class="duration">'+this.durationOffset+" Days ago</span>"
}else{return'<span class="duration">In '+this.durationOffset+" Days</span>"
}}}}},getStateDescription:function(){var c,d;
d='<span class="date-wrapper"><span class="date">'+b.Squarespace.Utils.dateFormat(new Date(this.value.date),{format:"%a, %b %d at %l:%M %p"})+"</span></span>";
return(this.config.states[this.value.state].stateDesc.replace("[DATE]",d).replace("[DURATION]",this.getDurationText()))
},focus:function(){this.control.focus()
},setValue:function(c){if(!c){c={state:this.config.stateOrder[0],date:null}
}this.updateDisplay();
this._super(c)
}}),button:Class.extend(b.Squarespace.DialogField,{_events:{click:{}},initialize:function(d,c,e){this._super(d,c,e);
this._buttonEl=b.DB.BUTTON((this.config.className?this.config.className:"normal-button"),{type:"button",name:(this.config.name?this.config.name:""),value:(this.config.value?this.config.value:""),"data-field-name":(this.config.name?this.config.name:"")});
this.html=b.DB.DIV("field-wrapper button");
this.html.appendChild(this._buttonEl);
if(this.config.alignment){this.html.setStyle("text-align",this.config.alignment)
}this.control=this.html;
if(this.config.waiting){this._waitingEl=b.DB.DIV("waiting");
this.html.appendChild(this._waitingEl);
this._waitingEl.hide()
}if(this.config.icon){this._buttonEl.appendChild(b.DB.DIV("icon"))
}this._textEl=b.DB.SPAN("text",{html:(this.config.text?this.config.text:"")});
this._buttonEl.appendChild(this._textEl);
this._subscribe(this._buttonEl,"click",this._onClick,this,this.html);
this.setActiveStatus(c[this.config.name]?true:false)
},_onClick:function(c){if(!this.disabled){if(this.config.href){window.location=this.config.href
}else{if(this.config.onclick){this.config.onclick.call(this.config.context||this)
}else{this.dialog.fire("click",this);
this.fire("click",this.isActive())
}}}},setText:function(c){if(this._textEl){this._textEl.setContent(c)
}},getText:function(){return this._textEl.getContent()
},setTextAnimated:function(e){var c=new b.Anim({node:this._textEl,from:{opacity:0},to:{opacity:1},duration:0.2,easing:"easeOut"});
var d=new b.Anim({node:this._textEl,from:{opacity:1},to:{opacity:0},duration:0.2,easing:"easeIn"});
c.on("end",b.bind(function(){this.enable();
this.temporaryShow()
},this));
d.on("end",b.bind(function(){this._textEl.setContent(e);
c.run()
},this));
this.disable();
d.run()
},showWaiting:function(){this._waitingEl.show()
},hideWaiting:function(){this._waitingEl.hide()
},disable:function(){this.disabled=true;
this._buttonEl.setAttribute("disabled","disabled");
this.html.addClass("disabled")
},enable:function(){this.disabled=false;
this._buttonEl.removeAttribute("disabled");
this.html.removeClass("disabled")
},isEnabled:function(){return !this.disabled
},setActiveStatus:function(c){if(c){this.active=true;
this.html.addClass("active")
}else{this.active=false;
this.html.removeClass("active")
}},setActive:function(){this.setActiveStatus(true)
},setInactive:function(){this.setActiveStatus(false)
},isActive:function(){return this.active
}}),rating:Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.active=(c[this.config.name]?true:false);
this.value=0;
this.control=b.DB.DIV("rating-slider");
this.html=b.DB.DIV("field-wrapper",b.DB.DIV("rating-field-wrapper",b.DB.DIV("rating-element",b.DB.DIV("rating-overlay"),this.control)));
this.panel.bodyEvents.push(b.on("mousedown",this.onClick,this.html,this));
this.setValue(c.rating?c.rating:0)
},onClick:function(h){var f=h.pageX-this.html.one(".rating-element").getX();
var g=13;
var c=0;
for(var d=0;
d<11;
d++){if(d*g-f>0){c=d;
break
}}this.value=c/2;
this.control.setStyle("width",c*g)
},setValue:function(c){if(c<0||c>5){return
}this.value=Math.round(c*2)/2;
this.control.setStyle("width",this.value*26)
},getValue:function(){return this.value?this.value:0
}}),"social-accounts":Class.extend(b.Squarespace.DialogField,{initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.config.networks=["facebook","twitter","foursquare","google","tumblr","email","blogger","linkedin","reddit","stumbleupon"];
this.accountContainerEl=b.DB.DIV("social-accounts");
this.html=b.DB.DIV("field-wrapper social-adder-wrapper",b.DB.DIV("header",b.DB.DIV("title",{html:"Connected Accounts"}),b.DB.DIV("description",{html:"Add your social links."})),this.accountContainerEl);
this.html.append(this.chooser);
this.panel.bodyEvents.push(b.on("click",this.onClick,this.html,this));
this.panel.bodyEvents.push(b.on("keyup",this.onKeyUp,this.html,this));
if(c[this.config.name]){this.render(c[this.config.name])
}else{this.accountContainerEl.append(this.renderSocialAccount({type:this.config.networks[0],username:""}))
}},onKeyUp:function(c){this.panel.fire("datachange",this)
},onClick:function(h){var k=h.target;
var d=k.ancestor(".social-account",true);
if(!k.hasClass("logo")&&!k.hasClass("chooser-button")&&this.activeEl){this.hideChooser(this.activeEl)
}h.halt();
if(k.hasClass("logo")){this.toggleChooser(d)
}else{if(k.hasClass("plus")){if(this.getCount()>=this.config.maxCount){return
}this.showChooser(d.insert(this.renderSocialAccount({type:this.config.networks[0],username:""}),"after").next());
this.panel.fire("datachange",this)
}else{if(k.hasClass("minus")){d.remove();
if(this.getCount()<1){this.accountContainerEl.append(this.renderSocialAccount({type:this.config.networks[0],username:""}))
}this.panel.fire("datachange",this)
}else{if(k.hasClass("chooser-button")){var g=d.one(".logo");
var f=d.one(".chooser");
this.clearSocial(g);
var j=this.config.networks;
for(var c=0;
c<j.length;
c++){if(h.target.hasClass(j[c])){g.addClass(j[c]);
d.one(".type").set("text",j[c])
}}this.hideChooser(d);
this.panel.fire("datachange",this)
}}}}},clearSocial:function(d){var e=this.config.networks;
for(var c=0;
c<e.length;
c++){console.log(e[c]);
d.removeClass(e[c])
}},toggleChooser:function(c){if(c.one(".logo").hasClass("active")){this.hideChooser(c)
}else{this.showChooser(c)
}},hideChooser:function(d){d.one(".logo").removeClass("active");
this.activeEl=null;
var c=this._anim({node:d.one(".chooser"),to:{width:0},duration:0.25,easing:b.Easing.easeOutStrong});
c.run()
},showChooser:function(d){var e=d.one(".chooser");
b.all(".social-account .chooser").setStyle("width","0");
var c=this._anim({node:e,to:{width:154},duration:0.25,easing:b.Easing.easeOutStrong});
this._subscribe(c,"end",function(){var f=this.panel.bodyEl;
var i=e.get("region").bottom;
var g=f.get("region").bottom;
var h=i>g;
if(f.hasClass("scrollable")&&h){f.set("scrollTop",f.get("scrollHeight"))
}},this);
c.run();
d.one(".logo").addClass("active");
this.activeEl=d
},renderSocialAccount:function(d,f){var c=b.DB.DIV("chooser-container");
var g=this.config.networks;
for(var e=0;
e<g.length;
e++){c.append(b.DB.DIV("chooser-button "+g[e]))
}return b.DB.DIV("social-account "+(f?"hidden":""),b.DB.DIV("logo "+(d.type?d.type:""),b.DB.DIV("chooser",c)),b.DB.DIV("type",{html:d.type}),b.DB.INPUT("username",{value:d.username,placeholder:"Enter Username",maxlength:30,spellcheck:false,autocomplete:false}),b.DB.DIV("buttons",b.DB.DIV("plus"),b.DB.DIV("minus")))
},render:function(c){this.accountContainerEl.set("innerHTML","");
if(c){for(var d=0;
d<c.length;
d++){this.accountContainerEl.append(this.renderSocialAccount(c[d]))
}}},getValue:function(){var c=[];
this.accountContainerEl.all(".social-account").each(function(d){var e={type:d.one(".type").get("text"),username:d.one("input").get("value").replace(" ","")};
if(e.username.length>0){c.push(e)
}},this);
return c
},setValue:function(c){this.render(c)
},getCount:function(){var c=0;
this.accountContainerEl.all(".social-account").each(function(d){c++
},this);
return c
}})};
b.Squarespace.DialogFieldGenerators["date-picker"]=Class.extend(b.Squarespace.DialogField,{_name:"date-picker",_defaultOptions:{"yui3-calendar":{showPrevMonth:true,showNextMonth:true,width:"100%",height:"100%",selectionMode:"single"}},initialize:function(d,c,e){this._super(d,c,e);
this.config=b.merge(this._defaultOptions,d);
this.calendarOptions=b.merge(this._defaultOptions["yui3-calendar"]);
if(d["yui3-calendar"]){this.calendarOptions=b.merge(this.calendarOptions,d["yui3-calendar"])
}if(c[this.config.name]){this.calendarOptions.date=new Date(c[this.config.name])
}if(this.config.width){this.calendarOptions.width=this.config.width
}if(this.config.height){this.calendarOptions.height=this.config.height
}this.calendar=new b.Calendar(this.calendarOptions);
this.html=b.DB.DIV("field-wrapper clear"+(this.config.className?this.config.className:"")+" date-picker");
this.calendarWrapper=b.DB.DIV("calendar-wrapper");
this.html.append(this.calendarWrapper);
this._subscribe(this.calendar,"selectionChange",this.onSelectionChange);
this.value=c[this.config.name]||null;
this.calendar.selectDates([new Date(this.value)]);
this.render()
},render:function(){this.calendar.render(this.calendarWrapper)
},focus:function(){this.calendar.focus()
},enable:function(){this.html.removeClass("disabled");
this.calendar.enable()
},disable:function(){this.html.addClass("disabled");
this.calendar.disable()
},getValue:function(){return this.value?this.value.valueOf():null
},onSelectionChange:function(c){this.value=c.newSelection[0]
},setValue:function(c){this._super(c);
if(c){this.calendar.selectDates([c])
}},_destroy:function(){this.calendar.destroy()
}});
b.Squarespace.DialogFieldGenerators["datetime-picker"]=Class.extend(b.Squarespace.DialogFieldGenerators["date-picker"],{_name:"datetime-picker",initialize:function(d,c,e){this._super(b.merge({dateFormat:"%A, %B %d %Y at %I:%M%p"},d),c,e);
if(c[d.name]){this.setValue(new Date(c[d.name]))
}else{if(!this.config.clearable){this.setValue(new Date())
}else{this.setValue(null)
}}},render:function(){this._renderPicker();
this._renderLabel()
},_renderPicker:function(){this.html=b.DB.DIV("field-wrapper clear "+(this.config.className?this.config.className:"")+" datetime-picker-field");
this.calendarWrapper=b.DB.DIV("calendar-wrapper");
var c=this.value;
this.hourControl=b.DB.INPUT("time-control hour",{maxlength:2,style:"text-align: right;"});
this.minuteControl=b.DB.INPUT("time-control minute",{maxlength:2,style:"text-align: left;"});
this.ampmControl=b.DB.INPUT("time-control ampm",{maxlength:2,style:"text-align: left; width: 36px;"});
this.timeWrapper=b.DB.DIV("time-wrapper",this.hourControl,b.DB.DIV("time-control",{html:":",style:"width: 5px; border: 0px"}),this.minuteControl,this.ampmControl);
if(c){this.updateFlyout(c)
}this.calendar.render(this.calendarWrapper);
this.dateFlyoutEvents=[b.on("click",this.onCalendarClick,this.dateFlyout,this),b.on("keyup",this.onTimeFieldKeyUp,this.hourControl,this),b.on("keyup",this.onTimeFieldKeyUp,this.minuteControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.hourControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.minuteControl,this),b.on("keydown",this.onTimeFieldKeyDown,this.ampmControl,this),b.on("blur",this.onTimeFieldBlur,this.hourControl,this),b.on("blur",this.onTimeFieldBlur,this.minuteControl,this),b.on("click",this.onTimeFieldClick,this.hourControl,this),b.on("click",this.onTimeFieldClick,this.minuteControl,this),b.on("click",this.onTimeFieldClick,this.ampmControl,this),b.on("resize",this.onResize,b.one(window),this)];
this.errorFlyoutAnchor=this.html
},updateFlyout:function(c){this.hourControl.set("value",b.Lang.trim(b.Squarespace.Utils.dateFormat(c,{format:"%l"})));
this.minuteControl.set("value",b.Squarespace.Utils.dateFormat(c,{format:"%M"}));
this.ampmControl.set("value",b.Squarespace.Utils.dateFormat(c,{format:"%p"}));
this.calendar.set("date",c)
},_renderLabel:function(){this.label=b.DB.DIV("field-workflow-description",b.DB.SPAN("datetime-label",this.config.title+"&nbsp;"),b.DB.SPAN("date","Feb 20 2012"));
this.html.append(b.DB.DIV("date-picker-field",this.label));
this.panel.bodyEvents.push(b.on("click",this.onDatetimeChangeRequest,this.label.one(".date"),this));
if(this.config.clearable){var c=b.DB.DIV("remove-date",{html:"&nbsp;"});
this.label.append(c);
c.on("click",this.onClearDate,this)
}},onClearDate:function(){this.setValue(null)
},setValue:function(c){this._super(c);
this.updateDisplay()
},onDatetimeChangeRequest:function(c){if(this.flyout){return
}if(c.target.hasClass("date")){this.html.addClass("date-picker-active");
this.openFlyout();
this.calendarWrapper.one(".yui3-calendar").setStyle("width","auto");
this.refreshTimeField();
return
}this.closeFlyout();
return
},onResize:function(){if(this.flyout){this.alignFlyout()
}},alignFlyout:function(){var d=b.one(document.body).get("docScrollY");
this.dateFlyoutWidth=this.flyout.get("offsetWidth");
var c=this.label.getX()-(this.dateFlyoutWidth-this.label.get("offsetWidth"))/2-15;
var e=this.label.getY()+this.label.get("offsetHeight")+5;
this.flyout.setXY([c,e])
},openFlyout:function(){var e=this.label.getX();
var d=400;
this.flyout=b.DB.DIV("workflow-flyout tight",b.DB.DIV("workflow-flyout-content",b.DB.DIV("flyout-notch-select-top"),b.DB.DIV("workflow-flyout-options",{style:"position:relative; top:-1px;"},b.DB.DIV("flyout-title","Select a Date & Time"),b.DB.DIV("flyout-calendar",this.calendarWrapper,this.timeWrapper))));
b.one(document.body).append(this.flyout);
this.flyout.one(".flyout-notch-select-top").setStyles({marginLeft:((d/2)-8)});
this.dateFlyoutHeight=this.flyout.get("offsetHeight");
this.dateFlyoutWidth=this.flyout.get("offsetWidth");
this.flyout.setStyles({width:(d)+"px",height:this.dateFlyoutHeight+"px",opacity:1});
this.dateFlyoutContents=this.flyout.one(".workflow-flyout-content");
this.dateFlyoutContents.setStyles({marginTop:-1*this.dateFlyoutHeight,opacity:0});
this.alignFlyout();
var c=this._anim({node:this.dateFlyoutContents,to:{marginTop:0,opacity:1},duration:0.2,easing:b.Easing.easeOutStrong});
c.run();
this.panel.setActiveFlyout({constraintClasses:".workflow-flyout, .calendar-wrapper",field:this})
},refreshTimeField:function(){if(!this.value){this.timeWrapper.addClass("disabled");
this.hourControl.set("value","10");
this.minuteControl.set("value","00");
this.ampmControl.set("value","AM")
}else{this.timeWrapper.removeClass("disabled");
this.hourControl.set("value",b.Squarespace.Utils.dateFormat(this.value,{format:"%I"}));
this.minuteControl.set("value",b.Squarespace.Utils.dateFormat(this.value,{format:"%M"}));
this.ampmControl.set("value",b.Squarespace.Utils.dateFormat(this.value,{format:"%p"}))
}},updateDisplay:function(){if(this.label){if(!this.value){this.label.one(".date").setContent("Not Set");
this.html.addClass("no-date")
}else{this.label.one(".date").setContent(b.Squarespace.Utils.dateFormat(this.value,{format:this.config.dateFormat}));
this.html.removeClass("no-date")
}}else{console.log("[datetime-picker] tried to update display but no label el was found")
}},closeFlyout:function(){if(!this.flyout){return
}this.html.removeClass("date-picker-active");
var c=this.flyout.get("offsetHeight");
animation=this._anim({node:this.dateFlyoutContents,to:{marginTop:-1*c,opacity:0},duration:0.2,easing:b.Easing.easeOutStrong});
animation.on("end",function(){this.flyout.remove();
this.flyout=null;
this.dateFlyoutContents=null
},this);
animation.run();
this.panel.clearActiveFlyout()
},onTimeFieldKeyUp:function(d){var c;
if(d.target.hasClass("hour")){c=parseInt(this.hourControl.get("value"),10);
if(c>12||c<1){this.hourControl.set("value",this.prevVal)
}}else{if(d.target.hasClass("minute")){c=parseInt(this.minuteControl.get("value"),10);
if(c>60||c<0){this.minuteControl.set("value",this.prevVal)
}}}this._updateTime()
},onTimeFieldClick:function(c){if(c.target.hasClass("hour")){this.hourControl.select()
}else{if(c.target.hasClass("minute")){this.minuteControl.select()
}else{if(c.target.hasClass("ampm")){this.ampmControl.select()
}}}},onTimeFieldBlur:function(d){var c;
if(d.target.hasClass("hour")){c=this.hourControl.get("value");
if(c.indexOf("0")===0){this.hourControl.set("value",parseInt(c,10))
}c=parseInt(c,10);
if(c>12||c<1){this.hourControl.set("value",12)
}}else{if(d.target.hasClass("minute")){c=parseInt(this.minuteControl.get("value"),10);
if(c>=0&&c<=9){this.minuteControl.set("value","0"+c)
}c=parseInt(c,10);
if(c>60||c<0){this.minuteControl.set("value",0)
}}}this._updateTime()
},onTimeFieldKeyDown:function(c){if(c.keyCode==65){this.ampmControl.set("value","AM");
c.halt();
this._updateTime();
return
}else{if(c.keyCode==80){this.ampmControl.set("value","PM");
c.halt();
this._updateTime();
return
}else{if(c.keyCode==13){this.closeFlyout();
return
}}}if(c.target.hasClass("hour")){if(c.keyCode==186){this.minuteControl.select();
c.halt();
return
}if((c.keyCode>57||c.keyCode<48)&&(c.keyCode<96||c.keyCode>105)&&c.keyCode!=9&&c.keyCode!=37&&c.keyCode!=39&&c.keyCode!=16&&c.keyCode!=46&&c.keyCode!=8){c.halt();
return
}this.prevVal=this.hourControl.get("value")
}else{if(c.target.hasClass("minute")){if(c.keyCode==32){this.ampmControl.select();
c.halt();
return
}if((c.keyCode>57||c.keyCode<48)&&(c.keyCode<96||c.keyCode>105)&&c.keyCode!=9&&c.keyCode!=37&&c.keyCode!=39&&c.keyCode!=16&&c.keyCode!=46&&c.keyCode!=8){c.halt();
return
}this.prevVal=this.minuteControl.get("value")
}else{if(c.target.hasClass("ampm")){if(c.keyCode!=9){c.halt()
}}}}},_updateTime:function(){var f=parseInt(this.hourControl.get("value"),10);
var c=parseInt(this.minuteControl.get("value"),10);
var e=this.ampmControl.get("value");
if(f>12||f<=0){f=12
}if(c>60||c<0){c=0
}if(f==12&&e=="AM"){f=0
}else{if(f!=12&&e=="PM"){f+=12
}}var d=new Date(this.value.getTime()).set({hour:f,minute:c});
d.setMinutes(d.getMinutes()-d.getTimezoneOffset()-parseInt(Static.SQUARESPACE_CONTEXT.website.timeZoneOffset,10)/60000);
this.setValue(d);
this.updateDisplay()
},onSelectionChange:function(c){if(!this.label){return
}var f=c.newSelection[0];
if(this.value){f.setHours(this.value.getHours());
f.setMinutes(this.value.getMinutes())
}this.value=f;
this.updateDisplay()
}});
b.Squarespace.DialogFieldGenerators["textbox-datetime-picker"]=Class.extend(b.Squarespace.DialogFieldGenerators["datetime-picker"],{initialize:function(d,c,e){this._super(d,c,e);
b.Squarespace.EscManager.addTarget(this)
},getValue:function(){return this.value!=null?this.value.valueOf():null
},render:function(){this._renderPicker();
this.label=b.Node.create('<input type = "text" class = "field-input date" spellcheck="false"/>');
this.html.append(this.label);
this.panel.bodyEvents.push(b.on("click",this.onDatetimeChangeRequest,this.label,this));
this.label.on("keyup",function(c){if(a(c.keyCode)){this.lastChangeTime=(new Date()).valueOf();
b.later(500,this,this.onKeyup,[this.lastChangeTime])
}},this);
this.label.on("blur",this.updateDisplay,this)
},updateDisplay:function(){if(this.value){var c=b.Squarespace.Utils.dateFormat(this.value,{format:"%D @ %I:%M %p"});
this.label.set("value",c)
}else{this.label.set("value","")
}},closeFlyout:function(){this._super();
this.updateDisplay()
},onKeyup:function(d){var c=new Date(this.label.get("value"));
if(b.Lang.isNumber(c.valueOf())){this.value=c;
this.calendar.deselectDates();
this.updateFlyout(c);
this.calendar.selectDates([c])
}},onSelectionChange:function(d){var c=d.newSelection[0];
var f=this.value?new Date(this.value):new Date();
if(c){c.setHours(f.getHours());
c.setMinutes(f.getMinutes());
this.value=c;
if(this.label){if(this.label.get("value")===""||c.valueOf()!==f.valueOf()){this.updateDisplay()
}}}},_destroy:function(){this._super();
b.Squarespace.EscManager.removeTarget(this)
},close:function(){this.closeFlyout()
}});
b.Squarespace.DialogFieldGenerators.toggle=Class.extend(b.Squarespace.DialogField,{initialize:function(d,c,e){this._super(d,c,e);
this.value=((c[this.config.name]===undefined?this.config.defaultValue:c[this.config.name])?true:false);
this._toggle=new b.Squarespace.Widgets.ToggleButton({active:this.value}).plug(b.Squarespace.ToggleDrag);
this._bindToggleChangeEvent();
this.html=b.DB.DIV("field-wrapper clear toggle");
if(this.config.padding){this.html.setStyle("padding-top",this.config.padding[0]);
this.html.setStyle("padding-bottom",this.config.padding[1])
}this._toggle.render(this.html)
},_bindToggleChangeEvent:function(){this._toggleChangeEvent=this._toggle.after("activeChange",function(c){this.setValue(c.newVal);
this.dialog.fire("datachange",{field:this})
},this)
},setValue:function(c){this._toggleChangeEvent.detach();
this._toggle.set("active",c);
this._bindToggleChangeEvent();
if(this.value!==c){this._super(c)
}},getValue:function(){return this._toggle.get("active")
},updateDisplay:function(){this._toggle.set("active",this.value)
}});
b.Squarespace.DialogFieldGenerators.datatable=Class.extend(b.Squarespace.DialogField,{initialize:function(d,c,e){this._super(d,c,e);
var g=["sku","name","price"];
this.data=[{id:"ga-3475",sku:"14612",name:"gadget",price:"6.99",cost:"$5.99"},{id:"sp-9980",sku:"125601",name:"sprocket",price:"3.75",cost:"$3.25"},{id:"wi-0650",sku:"55019",name:"widget",price:"4.25",cost:"$3.75"}];
this.html=b.DB.DIV("field-wrapper clear datatable");
var f=new b.DataTable.Base({columnset:g,recordset:this.data}).render(this.html)
},getValue:function(){return this.data
}});
b.Squarespace.DialogFieldGenerators.picker=Class.extend(b.Squarespace.DialogField,{_name:"Picker",initialize:function(d,c,e){this._super(d,c,e);
this.control=b.DB.DIV("field-input-wrapper select",{html:"test"});
this.html=b.DB.DIV("field-wrapper picker clear");
this.valueToNode={};
this.value=c[this.config.name]
},render:function(){var c=b.DB.DIV("options-wrapper");
if(!this.config.groups){this.renderGroup(c,this.config.data)
}c.delegate("click",this.onClick,".option",this);
this.html.append(c);
if(this.value){this.setValue(this.value)
}},onClick:function(d){var c=d.target.ancestor(".option",true).getData("value");
this.setValue(c)
},setValue:function(d){var c=this.getValue();
this._super(d);
this.panel.fire("datachange",this);
if(this.isValidValue(d)){if(c){this.getNode(c).removeClass("active")
}this.getNode(d).addClass("active")
}this.dialog.edited=true
},renderGroup:function(c,d){b.Array.each(d,function(f){var e=b.DB.DIV("option",{data:{value:f.value}},b.DB.DIV("title",{html:f.title}),f.description?b.DB.DIV("description",{html:f.description}):null);
this.registerNode(f.value,e);
c.append(e)
},this);
return c
},show:function(){this.render()
},registerNode:function(d,c){this.valueToNode[d]=c
},getNode:function(c){return this.valueToNode[c]
},isValidValue:function(d){if(!this.config.groups){for(var c=0;
c<this.config.data.length;
c++){if(this.config.data[c].value==d){return true
}}}return false
}});
b.Squarespace.DialogFieldGenerators["module-picker"]=Class.extend(b.Squarespace.DialogField,{_name:"ModulePicker",initialize:function(e,c,d){this._super(e,c,d);
this.config=e;
this.panel=d;
this.control=b.DB.DIV("field-input-wrapper select",{html:"Anthony Casalena"});
if(!this.config.mode){this.config.mode="pages"
}this.html=b.DB.DIV("field-wrapper clear navigation-field-mode-"+this.config.mode);
if(!b.Lang.isUndefined(this.config.className)){this.html.addClass(this.config.className)
}this.value=c[this.config.name];
Static.SQUARESPACE_CONTEXT.navigationData=null;
this.html.set("innerHTML","Loading...");
this.events=[];
this.library=b.Squarespace.Library
},showEmptyMessage:function(){this.html.appendChild(b.DB.DIV("empty-message",{html:this.config.emptyMessage||"There are no collections available."}))
},render:function(){this.destroy();
this.html.set("innerHTML","");
this.events=[this.html.on("click",this.onClick,this)];
if(this.config.groups){var c=this.config.groups;
for(var e in c){if(!c.hasOwnProperty(e)){continue
}var f=c[e];
this._renderGroup(f.collections,f.title)
}}this.setValue(this.value);
var d=this.html.ancestor(".standard-dialog-wrapper").one(".edit-pages");
if(d){this.events.push(d.on("click",this.onEditPages,this))
}},_renderGroup:function(g,j){var e=b.DB.DIV("navigation-wrapper",{data:{actualHeight:null}},b.DB.DIV("navigation-title clear",b.DB.DIV("text",{html:j||""}),b.DB.DIV("active-count")));
var c=0;
for(var d=0;
d<g.length;
d++){var k=d;
var f=b.Squarespace.Library.getCollection(g[k].getId());
if(!f||!f.getEnabled()){continue
}var h=this._createPageElement(f);
++c;
e.append(h)
}if(c){this.html.append(e)
}},_createPageElement:function(e){var d=b.DB.DIV("page clear module-"+e.getTypeName()+" "+e.getClass(),{data:{item:e}},b.DB.DIV("title",{html:b.Escape.html(e.getNavigationTitle())}),b.DB.DIV("description",{html:e.getTypeLabel()}));
if(this.config.deleteCollections){var c=b.DB.A("delete");
c.on("click",this.onDeleteClick,e);
d.append(c)
}return d
},onDeleteClick:function(c){c.halt();
new b.Squarespace.ConfirmationDialog().show("Remove "+this.getName(),"Are you sure you wish to remove this "+this.getName().toLowerCase()+"?  <strong>All contained data will be deleted.</strong>",function(){c.target.ancestor(".page").transition({opacity:0},function(){this.remove()
});
this.remove()
},this)
},show:function(){this.render()
},destroy:function(){for(var c=0;
c<this.events.length;
++c){this.events[c].detach()
}},onEditPages:function(c){this.panel.close();
b.Squarespace.Management.manageSite("content",(Static.SQUARESPACE_CONTEXT.collectionId?Static.SQUARESPACE_CONTEXT.collectionId:null))
},onClick:function(h){var f=h.target.ancestor(".page",true);
var c=h.target.ancestor(".navigation-group-wrapper");
var g=h.target.ancestor(".navigation-wrapper");
var i=h.target.ancestor(".navigation-title",true);
if(this.config.mode=="page"){this.html.all(".page").each(function(e){e.removeClass("active")
},this);
if(f){f.addClass("active")
}if(f){this.setValue(f.data().item.getId())
}}else{if(f){if(f.hasClass("active")){f.removeClass("active")
}else{f.addClass("active")
}var d=g.all(".page.active").size();
f.ancestor(".navigation-wrapper").one(".active-count").set("innerHTML",(d?d+" Selected":""))
}}this.panel.fire("datachange",this)
},getValue:function(){if(this.config.mode=="pages"){this.value=[];
this.html.all(".page.active").each(function(d){this.value.push("page-"+d.data().item.getId())
},this);
return this.value
}else{var c=null;
this.html.all(".page.active").each(function(d){c=d.data().item.getId()
},this);
return c||this.value
}},setValue:function(c){var f={};
if(c){if(typeof(c)=="object"){for(var e=0;
e<c.length;
e++){var d=c[e];
if(d.indexOf("page-")===0){f[d.substring(5)]=true
}else{f[d]=true
}}}else{f[c]=true
}}this.html.all(".page").each(function(g){if(f[g.data().item.getId()]){g.addClass("active")
}else{g.removeClass("active")
}},this);
if(this.config.mode==="pages"){this.html.all(".navigation-wrapper").each(function(h){var g=h.all(".page.active").size();
h.one(".active-count").set("innerHTML",(g?g+" Selected":""));
if(g===0){h.addClass("collapsed");
h.data().actualHeight=h.get("offsetHeight");
h.setStyle("height",h.one(".navigation-title").get("offsetHeight"))
}})
}this.value=c
},createGroupNode:function(c){return b.DB.DIV("site-page clear",b.DB.DIV("site-page-title",{html:page.title}),b.DB.DIV("site-page-type",{html:this.getPageTypeDisplayName(page.type)}),b.DB.DIV("site-page-url",{html:(page.url?page.url:"-")}),b.DB.DIV("site-page-controls",{html:"configure"}))
}});
b.Squarespace.DialogFieldGenerators.email=Class.extend(b.Squarespace.DialogFieldGenerators.text,{initialize:function(d,c,e){this._super(d,c,e);
this._emailRegex=new RegExp(/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/)
},isValid:function(){var g=this.control.get("value"),d=[this._validateExistence,this._validateFormat],c=true;
for(var f=0;
f<d.length;
f++){var e=d[f];
c=c&&e.call(this,g);
if(!c){break
}}return c
},getErrors:function(){var d=this.control.get("value");
var c=[this._validateFormat,this._validateExistence].map(function(e){return e.call(this,d)
},this).filter(b.Lang.isString);
return c
},_validateExistence:function(f){var e=!!this.config.required,c=f!=="",d=true;
if(e&&!c){d=false
}if(!d){return"Required field"
}return null
},_validateFormat:function(e){var d=e.match(this._emailRegex)||[],c=!!d.length;
if(!c){return"The email address you entered is invalid."
}return null
}});
b.Squarespace.DialogFieldGenerators["structured-input"]=Class.extend(b.Squarespace.DialogField,{initialize:function(d,c,e){this._super(d,c,e);
this.value=c[d.name];
this.dialog=e;
this._variables=d.variables;
this.render()
},render:function(){this.html=b.DB.DIV("field-wrapper clear structured-input-field");
this.control=b.DB.DIV("structured-input-wrapper",b.DB.DIV("structured-input"));
if(this.config.width){this.control.setStyle("width",this.config.width)
}this.html.append(this.control)
},destroy:function(){if(this._structInput){this._structInput.destroy()
}},show:function(){this._structInput=new b.Squarespace.StructuredInput({target:this.control.one(".structured-input"),value:this.value,variables:this._variables,tabIndex:this.dialog.getNextTabIndex()});
var c=this.html.one("input");
this._subscribe(this._structInput,"valueChange",function(){this.dialog.fire("datachange")
},this)
},getValue:function(){return this._structInput.get("value")
}});
b.Squarespace.DialogFieldGenerators.numeric=Class.extend(b.Squarespace.DialogFieldGenerators.text,{initialize:function(e,c,d){this._super(e,c,d);
if(c[e.name]===undefined){if(this.config.defaultValue!==undefined){this.setValue(Number(this.config.defaultValue))
}}},didDataChange:function(){return this.initialData[this.getName()]!=Number(this.getValue())
},getErrors:function(){var c=this._super();
if(this.config.required&&(this.getValue().trim()===""||!b.Lang.isNumber(Number(this.getValue())))){return["This must be a numeric value."]
}else{return c
}}});
b.Squarespace.DialogFieldGenerators.percentage=Class.extend(b.Squarespace.DialogFieldGenerators.numeric,{getErrors:function(){var d=this._super();
var c=Number(this.getValue());
if(c>100||c<0){return["This must be between 0% and 100%."]
}else{return d
}},getValue:function(){return this.control.get("value").trim()
}});
b.Squarespace.DialogFieldGenerators.url=Class.extend(b.Squarespace.DialogFieldGenerators.text,{initialize:function(e,c,d){this._super(e,c,d);
this.panel=d;
var f=b.DB.DIV("internal-linker",b.DB.DIV("icon"))
}})
},"1.0",{requires:["node","datatype-date","node-focusmanager","anim","dd","attribute","slider","datatable","json","widget","node-event-simulate","calendar","squarespace-gizmo","squarespace-dombuilder","squarespace-dialog-css","squarespace-debugger","squarespace-toggle","squarespace-node-flyout","squarespace-structured-input","squarespace-mailcheck"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-drag-selection-selector-blacklist",function(b){var a=b.namespace("Squarespace").DragSelectionSelectorBlackList=b.Base.create("dragSelectionSelectorBlackList",b.Base,[],{_getInvalidRegions:function(c){return c.concat(this.get("selectorBlacklist"))
}},{ATTRS:{invalidRegions:{value:[],getter:"_getInvalidRegions"},selectorBlacklist:{valueFn:function(){var c=[".dialog-screen-overlay",".mode-visual",".mode-source",".content-title .add-content",".config-panel-wrapper","input","object",".dropdown select"];
if(b.Squarespace.STANDARD_CONTROL_CLASSES){c=c.concat(b.Squarespace.STANDARD_CONTROL_CLASSES)
}c=b.Array.dedupe(c);
c.remove(".standard-dialog-wrapper");
return c
}}}})
},"1.0",{requires:["base-build"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-drag-selection",function(b){var a=b.namespace("Squarespace").DragSelection=b.Base.create("dragSelection",b.Base,[b.Squarespace.DragSelectionSelectorBlackList],{initializer:function(c){var d=this.get("id");
this._selectionNode=b.Node.create("<div></div>");
this._selectionNode.addClass("squarespace-selection").setAttribute("data-selection-id",d);
this._dragClassName="drag-selection-dragging";
this.publish("selection-started",{preventable:true,defaultFn:this._initSelection,context:this,broadcast:2});
this.on([d+"|nodeChange"],this._bindUI,this);
this._bindUI()
},destructor:function(){if(this._hideAnimation){this._hideAnimation.stop()
}this._selectionNode.remove(true);
this._selectionNode=null;
b.detachAll(this.get("id")+"|*");
if(this._activationSub){this._activationSub.detach();
this._activationSub=null
}},_bindUI:function(){if(this._activationSub){this._activationSub.detach()
}this._activationSub=this.get("node").on("mousedown",this._onMouseDown,this)
},_onMouseDown:function(c){if(!this.get("enabled")){return
}this.fire("selection-started",{originalMousedown:c})
},_initSelection:function(d){var c=d.originalMousedown;
if(this.get("dragging")||c.button!==1){return
}this._origin={x:c.pageX,y:c.pageY};
if(!this._pointInActivationRegion(this._origin.x,this._origin.y)){return
}if(!this._mouseDownInValidRegion(c)){return
}if(this._hideAnimation){this._hideAnimation.stop(true)
}this._selectionNode.setStyles({top:this._origin.y+1,left:this._origin.x+1,right:b.one("body").get("offsetWidth")-this._origin.x,bottom:b.one(window).get(".innerHeight")-this._origin.y});
b.one("body").addClass(this._dragClassName).appendChild(this._selectionNode);
b.one(window).once(this.get("id")+"|mouseup",this._endSelection,this);
this._mouseMoveSubscription=b.one(window).on(this.get("id")+"|mousemove",this._dragSelection,this)
},_dragSelection:function(e){if(!this.get("enabled")){return
}if(!this._origin){return
}e.halt();
var g=this.get("boundingRegion"),d=this._origin,j={x:e.pageX,y:e.pageY},i=j.x>d.x?d.x:j.x,f=j.x>d.x?j.x:d.x,h=j.y>d.y?d.y:j.y,c=j.y>d.y?j.y:d.y;
if(g){if(g.top){h=h<g.top?g.top:h
}if(g.bottom){c=c>g.bottom?g.bottom:c
}if(g.left){i=i<g.left?g.left:i
}if(g.right){f=f>g.right?g.right:f
}}this._selectionNode.setStyles({top:h,left:i,right:document.body.offsetWidth-f,bottom:window.innerHeight-c});
this.fire("selection-dragged",{region:this._selectionNode.get("region"),originalMousemove:e})
},_endSelection:function(c){if(c){c.halt()
}if(this._mouseMoveSubscription){this._mouseMoveSubscription.detach();
delete this._mouseMoveSubscription
}if(this._clickBlockSubscription){this._clickBlockSubscription.detach();
delete this._clickBlockSubscription
}if(this._origin){delete this._origin
}b.one("body").removeClass(this._dragClassName);
this.fire("selection-complete",{region:this._selectionNode.get("region"),originalMouseup:c});
if(this._selectionNode.ancestor("body")){this._hideAnimation=new b.Anim({node:this._selectionNode,to:{opacity:0},duration:0.3,easing:b.Easing.easeOutStrong});
this._hideAnimation.once(this.get("id")+"|end",function(){this._selectionNode.remove();
this._selectionNode.setStyle("opacity",1);
delete this._hideAnimation
},this);
this._hideAnimation.run()
}},_mouseDownInValidRegion:function(d){var c=this.get("invalidRegions");
for(var e=0;
e<c.length;
e++){var f=c[e];
if(!f){continue
}if(typeof(f)==="string"){if(d.target.ancestor(f,true)){return false
}}else{f=this._getRegion(f);
if(this._pointInRegion(this._origin.x,this._origin.y,f)){return false
}}}return true
},_pointInActivationRegion:function(c,e){var d=this.get("activationRegion");
if(!d){return true
}return this._pointInRegion(c,e,d)
},_pointInRegion:function(c,e,d){if(d.top&&d.right&&d.bottom&&d.left){return(c>=d.left&&c<=d.right)&&(e>=d.top&&e<=d.bottom)
}if(d.left&&c<d.left){return false
}if(d.right&&c>d.right){return false
}if(d.top&&e<d.top){return false
}if(d.bottom&&e>d.bottom){return false
}return true
},_getRegion:function(c){if(b.instanceOf(c,b.Node)){return c.get("region")
}return c
},_getNode:function(c){if(!c){throw this.name+": The node attr is required."
}if(!b.Lang.isString(c)&&!b.instanceOf(c,b.Node)){throw this.name+": The node attr must be a Y.Node instance or selector string."
}if(b.Lang.isString(c)){c=b.one(c)
}return c
},_getDragging:function(){var c=b.one("body");
if(!!c){return c.hasClass(this._dragClassName)
}return false
},_setEnabled:function(c){if(this._activationSub){this._activationSub.detach()
}if(!c){if(this.get("dragging")){this._endSelection()
}}else{this._bindUI()
}b.one("body").addClass(c?"drag-selection-enabled":"drag-selection-disabled").removeClass(!c?"drag-selection-enabled":"drag-selection-disabled");
return c
},enable:function(){this.set("enabled",true)
},disable:function(){this.set("enabled",false)
}},{ATTRS:{node:{value:null,getter:"_getNode",validator:function(c){if(!b.Lang.isString&&!(c instanceof b.Node)){throw this.name+": node attr must be a node or selector string."
}return true
}},boundingRegion:{value:null,getter:"_getRegion"},activationRegion:{value:null,getter:"_getRegion"},enabled:{value:true,setter:"_setEnabled"},dragging:{value:false,valueFn:"_getDragging",getter:"_getDragging",readOnly:true},invalidRegions:{value:[]}}})
},"1.0",{requires:["base-build","node","anim","squarespace-drag-selection-selector-blacklist"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-dialog",function(a){a.namespace("Squarespace");
a.Squarespace.OPEN_DIALOGS=[];
a.Squarespace.DialogStates={CLOSED:1,EDITING:2,LOADING:3,CLOSING:4,SAVING:5,MOVING:6};
a.Squarespace.EditingDialog=Class.extend(a.Squarespace.ZombieGizmo,{_name:"EditingDialog",_events:{show:{},shown:{},aftershowanim:{},"align-to-anchor":{},"aligned-to-anchor":{},loading:{},"cancel-loading":{},"loading-ready":{},ready:{},drag:{},hide:{},hidden:{},close:{},closed:{},canceled:{},"overlay-click":{},"show-save-overlay":{},"save-overlay-shown":{},"hide-save-overlay":{},"save-overlay-hidden":{},"render-anchor":{},datachange:{},datachanged:{},"send-requested":{},"remove-requested":{},"data-saved":{},"auto-save":{},"allow-editing":{},"editing-allowed":{},"show-errors":{},"local-errors":{}},initialize:function(b){this._super(b);
this.setParams(b);
this.state=a.Squarespace.DialogStates.CLOSED;
this.bodyEvents=[];
this.buttonEvents=[];
this.globalEvents=[];
this.childDialogs=[];
this.verticalFields=[];
this.timers=[];
this.fields={};
this.sections={};
this._noNameFields=[];
this.edited=false;
this.editedSinceLastSave=false;
this.NOTCH_WIDTH=20;
this.BUTTONS_BASE_IDX=100;
this.NOTCH_HEIGHT=11;
this.lastTabIndex=1;
this.on("datachange",this.onDataChange,this);
this._debug=new a.Squarespace.Debugger({name:"EditingDialog",output:false})
},defaultOpts:{tabs:[],initialData:{},buttons:[],style:"standard",colorScheme:"light",buttonAlign:"right",position:"center",verticalHeight:"fixed",flyoutPointerDirection:"left",closingText:"Canceled...",savingText:"Saving...",top:60,closeOthers:true,disableTips:true,closeable:true,autoFocus:true,discardChangesConfirmation:true,overlay:false,validateActiveTabOnly:false,edgeMargin:20,initialDataByReference:false},getName:function(){return this.params.name
},getInitialData:function(){return this.params.initialData
},setParams:function(b){if(!b){return
}if(b.embedWithinEl){b.closeable=false;
b.closeOthers=false;
if(!b.style){b.style="transparent"
}if(!b.colorScheme){b.colorScheme="dark"
}if(!b.buttonAlign){b.buttonAlign="left"
}if(!b.top){b.top=null
}}this.params=a.merge(this.defaultOpts,b);
if(this.params.primaryTabs){this.params.tabs=this.params.tabs.concat(this.params.primaryTabs);
delete this.params.primaryTabs
}if(this.params.secondaryTabs){this.params.tabs=this.params.tabs.concat(this.params.secondaryTabs);
delete this.params.secondaryTabs
}if((!this.params.tabs||this.params.tabs.length==0)&&this.params.fields){this.params.tabs=[{fields:this.params.fields}]
}if(!this.params.tabs[0].tabTitle){this.params.tabs[0].tabTitle="Item"
}if(!this.params.tabs[0].name){this.params.tabs[0].name="item"
}if(this.params.style=="transparent"){this.params.disableSaveOverlay=true
}if(!b.discardChangesConfirmation&&this.params.buttons.length===0){this.params.discardChangesConfirmation=false
}this.definitionChanged=true
},show:function(e){this.fire("show");
this._debug.log("Showing",["showParams",e],["this.params",this.params]);
if(this.moving){this.state=a.Squarespace.DialogStates.EDITING;
if(this.a){this.a.stop()
}this.fire("cancel-loading")
}if(this.destroyTimer||(this.state===a.Squarespace.DialogStates.LOADING||this.state===a.Squarespace.DialogStates.CLOSING)){return
}if(a.Squarespace.ToolTipManager&&this.params.disableTips){a.Squarespace.ToolTipManager.disableTooltips()
}if(this.anchorEl){this.anchorEl.removeClass("targeted")
}if(e){if(e.data){this.data=e.data
}if(e.anchor){this.anchorEl=e.anchor
}if(e.anchorData){this.anchorData=e.anchorData
}if(e.top){this.params.top=e.top
}if(e.flyoutPointerDirection){this.params.flyoutPointerDirection=e.flyoutPointerDirection
}}if(this.params.parentDialog){this.params.parentDialog.addChildDialog(this)
}if(this.state!==a.Squarespace.DialogStates.CLOSED){if(this.anchorEl){this.anchorEl.addClass("targeted")
}else{return
}this.state=a.Squarespace.DialogStates.LOADING;
this.moving=true;
this.updateTitle();
this.fire("loading");
this._updatePosition(false);
if(this.position){this.a=this._anim({node:this.el,to:{left:this.position.getX()+"px",top:this.position.getY()+"px"},duration:0.25,easing:a.Easing.easeOutStrong});
this.a.on("end",function(){this.fire("loading-ready");
this.dataReady()
},this);
this.a.run()
}return
}this.definitionChanged=false;
if(this.params.closeOthers){for(var f=0;
f<a.Squarespace.OPEN_DIALOGS.length;
++f){a.Squarespace.OPEN_DIALOGS[f].cancel()
}}a.Squarespace.OPEN_DIALOGS.push(this);
a.one(document.body).addClass("dialog-open");
this.fire("loading");
this.state=a.Squarespace.DialogStates.LOADING;
var n=a.one(document).get("winWidth");
var d=a.one(document).get("winHeight");
this.titleEl=a.DB.DIV("title-block loading");
this.titlePrimaryTabEl=a.DB.DIV("icon-holder");
this.titleTextEl=a.DB.DIV("text-holder");
this.titleEl.append(this.titlePrimaryTabEl);
this.titleEl.append(this.titleTextEl);
this.tabsEl=a.DB.DIV("configuration-container-tabs");
var b=a.DB.DIV("icon",{style:"background-image: url("+this.params.tabs[0].icon+");",data:{index:0}});
this.params.tabs[0].tabObj=b;
this.titlePrimaryTabEl.append(b);
this.timers.push(a.later(100,this,function(){if(this.params.closeable){a.Squarespace.EscManager.addTarget(this)
}this.globalEvents.push(a.on("resize",this.onResize,a.one(window),this))
}));
if(!a.Lang.isNumber(this.currentTabIndex)){this.currentTabIndex=0
}this.titleEl.append(this.tabsEl);
this.updateTitle();
this.bodyEl=a.DB.DIV("body-block");
if(this.params.buttons.length!==0){this.controlsEl=a.DB.DIV("controls-block")
}else{this.bodyEl.addClass("bottom")
}this.mainEl=a.DB.DIV("main-container",this.titleEl,this.bodyEl,this.controlsEl);
this.el=a.DB.DIV("standard-dialog-wrapper squarespace-managed-ui "+(this.params.style)+" "+(this.params.colorScheme)+" buttons-"+this.params.buttonAlign+(this.params.name?" dialog-"+a.Squarespace.Utils.slugify(this.params.name):""),this.mainEl);
this.bodyEvents.push(this.el.on("click",function(h){this.cancelChildDialogs();
this.fire("click",h)
},this));
if(!this.params.zIndex){a.Squarespace.DIALOG_ZINDEX_BASE+=10;
this.zIndex=a.Squarespace.DIALOG_ZINDEX_BASE
}else{this.zIndex=this.params.zIndex
}this.el.setStyle("zIndex",this.zIndex);
if(this.params.draggable){this.enableDragging()
}if(this.params.hidable){var r=a.DB.DIV("dialog-close");
this.el.prepend(r);
r.on("click",function(){this.fire("user-close");
this.close()
},this)
}if(this.params.headerButton){var s=a.DB.DIV("header-button");
var o=a.DB.INPUT({type:"button",value:this.params.headerButton.title,data:{type:this.params.headerButton.type}});
a.on("click",this.params.headerButton.onclick,o,this);
this.el.append(s.append(o))
}this.buttonHolder=a.DB.DIV("button-holder");
this.autosaveEl=a.DB.DIV("autosave-state");
if(this.controlsEl){this.controlsEl.append(this.autosaveEl);
this.controlsEl.append(this.buttonHolder)
}var m,j;
if(this.anchorEl){this.el.setStyle("position",this.params.forcePosition||"absolute");
this.anchorEl.addClass("targeted");
if(this.params.flyoutPointerDirection==="left"||this.params.flyoutPointerDirection==="right"){this.el.setStyle("width",(this.params.width+this.NOTCH_HEIGHT)+"px");
this.mainEl.setStyle("width",this.params.width+"px");
this.el.addClass("flyout");
a.one(document.body).append(this.el)
}else{if(this.params.flyoutPointerDirection==="hidden"){this.el.setStyle("width",this.params.width+"px");
this.mainEl.setStyle("width",this.params.width+"px");
a.one(document.body).append(this.el)
}else{if(this.params.flyoutPointerDirection==="top"){this.notchEl=a.DB.DIV("flyout-notch-top",{html:"&nbsp;"});
this.el.insertBefore(this.notchEl,this.mainEl);
var p=this.anchorEl.get("offsetWidth");
var g=this.anchorEl.get("offsetHeight");
m=this.anchorEl.getX();
j=this.anchorEl.getY()+g;
if(this.params.width>p){m-=(this.params.width-p)/2
}this.currentXY=[m,j-3];
this.notchEl.setStyle("marginLeft",((this.params.width-30)/2)+"px");
var c=this.params.left||this.currentXY[0];
var q=this.params.top||this.currentXY[1];
this.el.setStyles({left:c+"px",top:q+"px",width:this.params.width+"px"});
this.mainEl.setStyle("width",this.params.width+"px");
a.one(document.body).append(this.el)
}else{if(this.params.flyoutPointerDirection==="bottom"){this.notchEl=a.DB.DIV("flyout-notch-top bottom",{html:"&nbsp;"});
this.el.append(this.notchEl);
var p=this.anchorEl.get("offsetWidth");
var g=this.anchorEl.get("offsetHeight");
m=this.anchorEl.getX();
j=this.anchorEl.getY()+g;
if(this.params.width>p){m-=(this.params.width-p)/2
}this.currentXY=[m,j-3];
this.notchEl.setStyle("marginLeft",((this.params.width-30)/2)+"px");
var c=this.params.left||this.currentXY[0];
var q=this.params.top||this.currentXY[1];
this.el.setStyles({left:c+"px",top:q+"px",width:this.params.width+"px"});
this.mainEl.setStyle("width",this.params.width+"px");
a.one(document.body).append(this.el)
}else{this.currentXY=[(this.anchorEl.getX()+(this.anchorEl.get("offsetWidth")/2)-(this.params.width/2)),(this.anchorEl.getY()+(this.anchorEl.get("offsetHeight")/2)-(this.params.height/2)-15)];
this.el.setStyles({left:this.currentXY[0]+"px",top:this.currentXY[1]+"px",width:this.params.width+"px"});
this.el.setStyle();
this.mainEl.setStyle("width",this.params.width+"px");
j=this.currentXY[1];
a.one(document.body).append(this.el)
}}}}}else{if(this.params.embedWithinEl){if(this.params.left||this.params.top){this.el.setStyle("position","absolute");
if(this.params.top){this.el.setStyle("top",this.params.top+"px")
}if(this.params.left){this.el.setStyle("left",this.params.left+"px")
}}this.el.setStyle("width",this.params.width+"px");
this.mainEl.setStyle("width",this.params.width+"px");
this.params.embedWithinEl.append(this.el)
}else{this.el.setStyle("position","fixed");
if(this.params.position=="right"){this.el.setStyles({right:this.params.edgeMargin+"px",top:"0px"});
if(this.params.edgeMargin===0){this.titleEl.setStyle("border-radius","0px");
this.controlsEl.setStyle("border-radius","0px")
}}else{if(typeof this.params.left!=="undefined"){this.currentXY=[this.params.left,this.params.top]
}else{this.currentXY=[((n/2)-(this.params.width/2)),this.params.top];
this.el.setStyle("position","fixed")
}}if(this.currentXY){this.el.setStyles({left:this.currentXY[0]+"px",top:this.currentXY[1]+"px"});
j=this.currentXY[1]
}this.el.setStyle("width",this.params.width+"px");
this.mainEl.setStyle("width",this.params.width+"px");
a.one(document.body).append(this.el)
}}if(this.params.loadingState){var k=this._anim({node:this.el,to:(j?{opacity:0.9,top:j}:{opacity:0.9}),duration:0.15,easing:a.Easing.easeOutStrong});
k.on("end",function(){this.fire("loading-ready")
},this);
k.run()
}else{this.dataReady()
}if(this.params.verticalHeight=="full"||this.params.verticalHeight=="fit"){this.el.setStyles({top:this.params.edgeMargin+"px",bottom:this.params.edgeMargin+"px"});
this.params.top=this.params.edgeMargin
}if(this.params.overlay){this.overlayEl=a.DB.DIV("dialog-screen-overlay");
this.overlayEl.setStyle("zIndex",(this.zIndex-1));
a.one(document.body).append(this.overlayEl);
var k=this._anim({node:this.overlayEl,to:{opacity:this.params.overlay},duration:0.1,easing:a.Easing.easeOutStrong});
k.run();
this.globalEvents.push(a.on("click",this.onOverlayClick,this.overlayEl,this))
}this.fire("shown",this);
this.moveIntoView()
},cancelChildDialogs:function(){for(var b=0;
b<this.childDialogs.length;
++b){this.childDialogs[b].cancel()
}this.childDialogs=[]
},isOpen:function(){return(this.state==a.Squarespace.DialogStates.LOADING||this.state==a.Squarespace.DialogStates.EDITING)
},disableBodyScroll:function(){this.oldBodyScroll=a.one("body").getStyle("overflow");
a.one("body").setStyle("overflow","hidden")
},restoreBodyScroll:function(){if(this.hasOwnProperty("oldBodyScroll")){if(this.oldBodyScroll){a.one("body").setStyle("overflow",this.oldBodyScroll)
}else{a.one("body").setStyle("overflow",null)
}}},getAnchorEl:function(){return this.anchorEl
},getAnchorData:function(){return this.anchorData
},getChildDialogs:function(){return this.childDialogs
},addChildDialog:function(b){if(this.childDialogs.indexOf(b)<0){this.cancelChildDialogs();
this._debug.log("addChildDialog",b);
this.childDialogs.push(b)
}b.params.parentDialog=this
},removeChildDialog:function(c){for(var b=0;
b<this.childDialogs.length;
++b){if(this.childDialogs[b]==c){this.childDialogs.splice(b,1);
return
}}},enableDragging:function(){this.titleEl.setStyle("cursor","move");
this.dd=new a.DD.Drag({node:this.el});
this.dd.on("drag:mouseDown",function(b){if(a.Squarespace.Help&&a.Squarespace.Help.active){b.halt()
}if(b.ev.target.ancestor(".body-block",true)){b.halt()
}},this);
this.dd.on("drag:start",function(b){this.cancelChildDialogs()
},this);
this.dd.on("drag:drag",function(b){this.fire("drag",b)
},this);
this.dd.on("drag:end",function(b){this.moveIntoView()
},this)
},temporaryHide:function(b){this.fire("hide");
for(var c=0;
c<this.childDialogs.length;
++c){this.childDialogs[c].temporaryHide()
}if(this.hideAnim){this.hideAnim.stop()
}if(this._hideAnimEvent){this._hideAnimEvent.detach()
}if(this.overlayHideAnim){this.overlayHideAnim.stop()
}if(this._overlayHideAnimEvent){this._overlayHideAnimEvent.detach()
}this.hideAnim=this._anim({node:this.el,to:{opacity:0},duration:0.35,easing:a.Easing.easeOutStrong});
if(this.overlayEl){this.overlayHideAnim=this._anim({node:this.overlayEl,to:{opacity:0},duration:0.35,easing:a.Easing.easeOutStrong});
this._overlayHideAnimEvent=this._subscribe(this.overlayHideAnim,"end",function(){this.overlayEl.setStyle("display","none")
})
}this._hideAnimEvent=this._subscribe(this.hideAnim,"end",function(){this.el.setStyle("display","none");
this.fire("hidden",this)
});
if(b){this.el.setStyle("display","none");
if(this.overlayEl){this.overlayEl.setStyle("display","none")
}this.fire("hidden",this)
}else{this.hideAnim.run();
if(this.overlayEl){this.overlayHideAnim.run()
}}},temporaryShow:function(c){this.fire("show",this);
if(c){if(c.data){this.data=c.data
}if(c.anchor){this.anchorEl=c.anchor
}if(c.anchorData){this.anchorData=c.anchorData
}}if(this.hideAnim){this.hideAnim.stop()
}if(this._hideAnimEvent){this._hideAnimEvent.detach()
}if(this.overlayHideAnim){this.overlayHideAnim.stop()
}if(this.overlayEl){this.overlayEl.setStyle("display","block");
this.overlayHideAnim=this._anim({node:this.overlayEl,to:{opacity:1},duration:0.35,easing:a.Easing.easeOutStrong});
this.overlayHideAnim.run()
}this.el.setStyle("display","block");
this.hideAnim=this._anim({node:this.el,to:{opacity:1},duration:0.35,easing:a.Easing.easeOutStrong});
this._hideAnimEvent=this._subscribeOnce(this.hideAnim,"end",function(){this.fire("shown",this)
});
this.hideAnim.run();
for(var b=0;
b<this.childDialogs.length;
++b){this.childDialogs[b].temporaryShow()
}this.moveIntoView()
},isVisible:function(){return this.state!==a.Squarespace.DialogStates.CLOSED
},_updatePosition:function(b){if(this.el){var c=this.el.get("offsetHeight");
if(this.anchorEl){if(this.params.flyoutPointerDirection==="top"){return
}if(this.params.flyoutPointerDirection==="bottom"){return
}if(this.params.flyoutPointerDirection==="centered"){this.position=new a.Squarespace.Position({x:(this.anchorEl.getX()+(this.anchorEl.get("offsetWidth")/2)-(this.params.width/2)),y:(this.anchorEl.getY()+(this.anchorEl.get("offsetHeight")/2)-(c/2)),w:(this.params.width),h:c});
this.position.nudgeFix()
}else{this.position=new a.Squarespace.Position({avoidElX:this.anchorEl,avoidElY:this.anchorEl,xdir:"right",ydir:"bottom",x:this.anchorEl.getX(),y:this.anchorEl.getY(),xo:2,yo:0,w:(this.params.width+this.NOTCH_HEIGHT),h:c});
this.position.reflectFix()
}if(this.params.flyoutPointerDirection!=="hidden"&&this.params.flyoutPointerDirection!=="centered"){if(!this.notchEl){this.notchEl=a.DB.DIV("flyout-notch-left",{html:"&nbsp;"})
}this.notchEl.set("className",(this.position.xdir==="right"?"flyout-notch-left":"flyout-notch-right"));
this.notchEl.remove();
if(this.position.xdir==="right"){this.el.insertBefore(this.notchEl,this.mainEl)
}else{this.el.append(this.notchEl)
}}if(b){this.el.setStyles({left:this.position.getX(),top:this.position.getY()});
this._alignNotch(this.anchorEl)
}}}},_alignNotch:function(i){if(!this.notchEl){return
}var h=this.el.get("offsetHeight");
var j=Math.max(h-36,220),f=12,g=11,b=f;
var e=this.el.get("region"),d=i.get("region"),c=d.top+d.height/2;
if(d.top>e.top){b=c-e.top;
b-=g
}if(b>j){b=j
}else{if(b<f){b=f
}}this.notchEl.setStyle("marginTop",b+"px")
},onDataChange:function(b){this.fire("render-anchor",this.getData());
this.setEdited();
this._debug.log("onDataChange");
this.fire("datachanged")
},onOverlayClick:function(b){b.halt();
this.fire("overlay-click");
if(this.params.disableOverlayCancel){return
}this.close()
},setEdited:function(){if(this.state==a.Squarespace.DialogStates.SAVING){return
}if(this.params.discardChangesConfirmation){var b=this;
window.onbeforeunload=function(){if(b.isVisible()){return"You have unsaved changes."
}}
}this.edited=true;
this.editedSinceLastSave=true
},clearEdited:function(){if(this.params.discardChangesConfirmation){window.onbeforeunload=null
}this.edited=false;
this.editedSinceLastSave=false
},getEditedSinceLastSave:function(){return this.editedSinceLastSave
},getNextTabIndex:function(){return this.lastTabIndex++
},getEdited:function(){return this.edited
},getState:function(){return this.state
},setInitialData:function(b){if(!this.params.initialDataByReference){this.params.initialData=a.clone(b)
}else{this.params.initialData=b
}if(this.fields){a.Object.each(this.fields,function(c,d){if(a.Squarespace.DialogField2&&c instanceof a.Squarespace.DialogField2&&c.get("name")&&!a.Lang.isUndefined(this.params.initialData[c.get("name")])){c.set("data",this.params.initialData[c.get("name")]);
c.setCurrentDataAsInitial()
}},this)
}},getBodyHeight:function(){if(this.params.height){return this.params.height
}else{var b=a.one(document).get("winHeight");
return b-this.params.edgeMargin*2-this.controlsHeight-this.titleEl.get("offsetHeight")
}},setActiveFlyout:function(b){if(this.activeFlyout){this.activeFlyout.field.closeFlyout()
}a.later(10,this,function(){this.activeFlyout=b
})
},clearActiveFlyout:function(){this.activeFlyout=null
},attachAnchorDataEditingHandlers:function(b){this.on("loading",function(){this.setInitialData(this.anchorData.getEditableParams());
this.autoSave=false
});
this.on("cancel",function(){if(this.anchorData.__saveHandler){this.anchorData.__saveHandler.detach();
this.anchorData.__saveHandler=null
}});
this.on("close",function(){if(this.anchorData.__saveHandler){this.anchorData.__saveHandler.detach();
this.anchorData.__saveHandler=null
}});
this.publish("send-requested",{emitFacade:true,defaultFn:function(){this.autoSave=false;
if(this.anchorData.setUnsaved){this.anchorData.setUnsaved(false)
}if(this.params.waitForServerOnClose){this.saveAnchorData()
}else{this.send()
}},preventedFn:function(){this.hideSaveOverlay()
},context:this});
this.on("sent",function(){if(!this.params.waitForServerOnClose){this.saveAnchorData()
}});
this.saveAnchorData=function(){if(!this.anchorData.__saveHandler){this.anchorData.__saveHandler=this.anchorData.on("save",function(c){this.hideSaveOverlay();
if(!this.autoSave){this.fire("data-saved",c);
this.autoSave=false;
if(this.params.waitForServerOnClose){this.send()
}}else{this.fire("auto-save")
}},this)
}this.anchorData.setEditableParams(this.getData());
this.anchorData.save(this.autoSave)
}
},onResize:function(d){if(this.params.embedWithinEl){return
}var c=a.one(document).get("winWidth");
var f=a.one(document).get("winHeight");
if(!this.anchorEl&&!this.params.draggable){var b={};
if(this.params.verticalHeight=="full"||this.params.verticalHeight=="fit"){this.bodyHeight=this.getBodyHeight();
if(this.params.verticalHeight=="fit"){if(this.bodyHeight>(this.observedHeight)){this.bodyHeight=this.observedHeight
}}this.bodyEl.setStyle("height",this.bodyHeight+"px");
this.bodyEl.all(".scrollable-body").each(function(e){e.setStyle("height",(this.bodyHeight-30)+"px");
e.setStyle("paddingBottom","30px")
},this);
this.resizeVerticalFields()
}if(this.params.position!="right"){this.hideErrors();
b.left=((c/2)-(this.params.width/2));
b.top=this.params.top;
if(this.params.left){b.left=this.params.left
}}this.currentXY=[b.left,b.top];
if(this.moveAnim){this.moveAnim.stop()
}this.moveAnim=this._anim({node:this.el,to:b,duration:0.15,easing:a.Easing.easeOutStrong});
this.moveAnim.run()
}this.moveIntoView()
},moveIntoView:function(k){if(!this.params.draggable){return
}if(k&&(!this.anchorEl&&!this.position)){k=false
}var h=this.el.get("docScrollX"),g=this.el.get("docScrollY"),i=this.el.get("winWidth")+h,f=this.el.get("winHeight"),c=f+g,d=this.el.getY(),e=this.el.getX(),b={},j=false;
if(d<g){b.top=g;
j=true
}if((d+this.el.get("offsetHeight"))>c){b.top=(c-this.el.get("offsetHeight"));
j=true
}if((e+this.el.get("offsetWidth"))>i){b.left=(i-this.el.get("offsetWidth"));
j=true
}if(this.el.getX()<h){b.left=h;
j=true
}if(k){b.top=(b.top)?Math.max(b.top,this.position.getY()):this.position.getY();
j=true
}if(j){this._anim({node:this.el,to:b,duration:0.3,easing:a.Easing.easeOutStrong}).run()
}if(this.preferredHeight+120>f){this.bodyHeight=f-120;
this.bodyEl.setHeight(this.bodyHeight)
}else{if(this.bodyHeight!=this.preferredHeight){this.bodyHeight=this.preferredHeight;
this.bodyEl.setHeight(this.preferredHeight)
}}},scrollIntoView:function(b){this.el.scrollIntoView(b)
},showErrors:function(d){this.fire("show-errors",d);
this.allowEditing();
this.currentErrors=d;
this.errorCount=0;
this.errorsByTab={};
for(var b in d){var c=this.getField(b);
if(!c){console.error("Server error returned for a dialog field that is not present: "+b)
}if(c.tab.tabNavigationObj){c.tab.tabNavigationObj.addClass("error")
}this.errorCount++;
if(!this.errorsByTab[c.tab.name]){this.errorsByTab[c.tab.name]=0
}this.errorsByTab[c.tab.name]++
}this.activateErrors()
},clearError:function(b){if(this.currentErrors&&this.currentErrors[b.getName()]){this.errorsByTab[b.tab.name]--;
delete this.currentErrors[b.getName()];
this.errorCount--;
if(b.tab.tabNavigationObj&&this.errorsByTab[b.tab.name]===0){b.tab.tabNavigationObj.removeClass("error")
}}},activateErrors:function(){if(this.errorCount){var b=this.currentTab.tabFields;
var d=null;
for(var c=0;
c<b.length;
++c){var e=b[c];
if(this.currentErrors[e.getName()]){e.showError(this.currentErrors[e.getName()]);
if(!d){d=e
}}}if(d&&d.focus){d.focus()
}}},hideErrors:function(){if(!this.currentTab){return
}var b=this.currentTab.tabFields||[];
a.Array.each(b,function(c){if(a.Lang.isFunction(c.hideError)){c.hideError()
}},this)
},updateTitle:function(d){var c=this.params.tabs[this.currentTabIndex];
if(c&&this.currentTab&&c.title!=this.currentTab.title){this.currentTab.title=c.title
}if(a.Lang.isUndefined(d)){d=this.state
}var b;
if(this.currentTab&&this.currentTab.title){b=this.currentTab.title
}else{b=this.params.title
}var e="";
if(this.params.subtext){e='<div class="title-subtext">'+this.params.subtext+"</div>"
}switch(d){case a.Squarespace.DialogStates.LOADING:if(this.params.loadingText){this.titleTextEl.set("innerHTML",'<div class="title-text">'+this.params.loadingText+"</div>"+e)
}break;
case a.Squarespace.DialogStates.EDITING:if(b){this.titleTextEl.set("innerHTML",'<div class="title-text">'+b+"</div>"+e)
}break;
case a.Squarespace.DialogStates.SAVING:if(this.params.savingText){this.titleTextEl.set("innerHTML",'<div class="title-text">'+this.params.savingText+"</div>"+e)
}break
}},setData:function(e){var b=this.currentTab.tabFields;
for(var c=0;
c<b.length;
++c){var d=b[c];
if(d.setValue){if(e[d.getName()]){d.setValue(e[d.getName()])
}else{d.setValue(null)
}this.fire("datachange",d)
}}},focusTab:function(){if(!this.currentTab){return
}this.fire("tab-focused:"+this.currentTab.name);
var b=this.currentTab.tabFields;
var d=null;
for(var c=0;
c<b.length;
++c){var e=b[c];
if(e.setValue&&e.focus){e.focus();
return
}}},_getFullHeight:function(){return a.one(document).get("winHeight")-this.params.edgeMargin*2-this.controlsHeight-this.titleEl.get("offsetHeight")
},dataReady:function(){this.clearEdited();
this.state=a.Squarespace.DialogStates.EDITING;
this.titleEl.removeClass("loading");
if(!this.params.initialData){this.params.initialData={}
}this.bodyHeight=this.params.height;
this.controlsHeight=(this.params.style=="standard"?65:60);
if(this.params.verticalHeight=="full"||this.params.verticalHeight=="fit"){this.bodyHeight=this._getFullHeight()
}this.preferredHeight=this.bodyHeight;
this.bodyEl.setStyle("width",this.params.width+"px");
if(this.params.overlay&&(!this.params.doNotDisableBodyScroll)){this.disableBodyScroll()
}if(this.moving){this.moving=false;
this.updateTitle();
if(this.definitionChanged){this.definitionChanged=false;
this.destroyBody();
this.destroyButtons();
this.render();
var b=this._anim({node:this.bodyEl,duration:0.25,easing:a.Easing.easeOutStrong,to:{height:this.bodyHeight}});
b.on("end",function(){this.fire("ready")
},this);
b.run()
}else{if(this.rendered){this.setData(this.params.initialData);
if(this.params.autoFocus){this.focusTab()
}}else{this.once("rendered",function(){this.setData(this.params.initialData);
if(this.params.autoFocus){this.focusTab()
}},this)
}this.fire("ready")
}this.clearEdited()
}else{this.currentTabIndex=0;
this.currentTab=this.params.tabs[0];
this.updateTitle();
if(this.params.loadingState){var b=this._anim({node:this.el,to:{opacity:1},duration:0.15,easing:a.Easing.easeOutStrong});
b.run();
if(this.controlsEl){b=this._anim({node:this.controlsEl,to:{height:this.controlsHeight},duration:0.15,easing:a.Easing.easeOutStrong});
b.run()
}b=this._anim({node:this.bodyEl,to:{height:this.bodyHeight},duration:0.25,easing:a.Easing.easeOutStrong});
b.on("end",function(){this.render();
this.fire("ready")
},this);
b.run()
}else{this.render();
var c=this;
var e=function(){if(c.el){c.el.setStyle("transform",null)
}};
switch(this.params.showAnim){case"custom":this.params.customShowAnim(this.el,function(){c.fire("ready")
});
break;
case"slideDownUp":this.el.setStyles({marginTop:-this.el.height()+"px"});
var d=this.el.anim({marginTop:0},{duration:0.3});
d.on("end",function(){c.fire("ready")
});
d.run();
break;
case"fade":this.el.transition({opacity:{duration:0.2,value:1},easing:"ease-out"},function(){c.fire("ready");
e()
});
break;
case"noshow":this.el.setStyles({display:"none"});
c.fire("ready");
break;
default:this.el.transition({opacity:{duration:0.4,value:1},easing:"ease-out"},function(){c.fire("ready");
e()
});
break
}}}this.currentData=this.params.initialData
},containsNode:function(b){return(this.bodyEl&&this.bodyEl.contains(b))
},activateTab:function(f,c){this.hideErrors();
var d=(c?c:a.DB.unpackData(f.target));
if(!this.currentTab){this.currentTab=d
}for(var b=0;
b<this.params.tabs.length;
b++){if(b==d.index){this.params.tabs[b].tabNavigationObj.addClass("active");
this._showPanelByIndex(d.index)
}else{this.params.tabs[b].tabNavigationObj.removeClass("active")
}}},_showField:function(b){if(b instanceof a.Squarespace.DialogField2){if(b.get("visible")){b.show(true)
}}else{if(!b.config.hidden){b.show(true)
}}},_showPanelByIndex:function(e){if(e==this.currentTabIndex){return
}var d=this.params.tabs[e];
var f=this.params.tabs[this.currentTabIndex];
if(!this.params.noTabAnim){if(d.tabPanelObj.a){d.tabPanelObj.a.stop(true)
}if(f.tabPanelObj.a){f.tabPanelObj.a.stop(true)
}}var b=f.tabFields;
if(!this.params.noTabAnim){d.tabPanelObj.setStyles({left:((d.index>f.index?1:-1)*this.params.width)+"px",opacity:1,zIndex:"300"});
f.tabPanelObj.setStyles({zIndex:"0"});
var c=this._anim({node:f.tabPanelObj,to:{left:((d.index<f.index?1:-1)*this.params.width)+"px",opacity:0},duration:0.25,easing:a.Easing.easeOutStrong});
c.on("end",function(){this.tab.addClass("hidden")
},{tab:f.tabPanelObj});
c.run();
f.tabPanelObj.a=c
}else{f.tabPanelObj.setStyles({opacity:1,zIndex:"300"});
f.tabPanelObj.addClass("hidden")
}this.currentTab=d;
this.currentTabIndex=e;
this.updateTitle();
d.tabPanelObj.removeClass("hidden");
if(!this.params.noTabAnim){var c=this._anim({node:d.tabPanelObj,to:{left:0},duration:0.25,easing:a.Easing.easeOutStrong});
c.on("end",function(){var g=this.currentTab.tabFields;
a.Array.forEach(g,function(h){this._showField(h)
},this);
this.focusTab();
this.activateErrors()
},this);
c.run();
d.tabPanelObj.a=c
}else{var b=this.currentTab.tabFields;
a.Array.forEach(b,function(g){this._showField(g)
},this);
this.focusTab();
this.activateErrors()
}if(this.currentTab.height){this.currentTab.tabPanelObj.setStyle("height",f.height-50);
this._anim({node:this.bodyEl,to:{height:this.currentTab.height},duration:0.25,easing:a.Easing.easeOutStrong}).run()
}if(this.currentTab.scroll){this.bodyEl.addClass("scrollable")
}else{this.bodyEl.removeClass("scrollable")
}},render:function(){if(this.rendered){return
}this.observedHeight=0;
this.tabs=[];
this.tabsEl.setContent("");
for(var b=this.params.tabs.length-1;
b>=0;
b--){var c=a.DB.A("configuration-container-tab "+(b==0?"active":""),{href:"javascript:noop();",data:{index:b},html:this.params.tabs[b].tabTitle});
if(this.params.tabs.length>1){if(this.params.tabs[b].noTabTitle){c.addClass("noTabTitle")
}this.bodyEvents.push(c.on("click",this.activateTab,this));
this.tabsEl.append(c)
}this.params.tabs[b].tabNavigationObj=c;
this.params.tabs[b].index=b;
this.renderTab(this.params.tabs[b],(b==0))
}this.renderButtons();
if(!this.bodyHeight){this.bodyHeight=this.observedHeight+14;
this.preferredHeight=this.bodyHeight
}if(this.params.verticalHeight=="fit"){if(this.bodyHeight>(this.observedHeight)){this.bodyHeight=this.observedHeight
}}this.fire("rendered");
this.rendered=true;
if((this.params.embedWithinEl&&this.params.height)||!this.params.embedWithinEl){this.bodyEl.setStyle("height",this.bodyHeight+"px")
}if(this.controlsEl){this.controlsEl.setStyle("height",this.controlsHeight+"px")
}this._updatePosition(true);
if(this.params.autoFocus){this.focusTab()
}if(this.params.name==="configure-collection"){this._scrollRepositionSub=a.one(window).on(["scroll","mousewheel"],a.bind(this._updatePosition,this))
}},getButtons:function(){return this.params.buttons
},setButtons:function(){var b=arguments;
if(arguments.length===1&&a.Lang.isArray(arguments[0])){b=arguments[0]
}this.params.buttons=[];
this.destroyButtons();
b.forEach(function(c){this.params.buttons.push(c)
},this);
if(this.isVisible()){this.renderButtons()
}},_removeButton:function(c){var f;
if(a.Lang.isString(c)){var d=this.getButtons();
for(var b=0;
b<d.length;
b++){if(d[b]!=null&&d[b].type==c){f=b
}}}else{f=this.getButtons().indexOf(c)
}if(f>=0){var e=this.getButtons();
e.removeAt(f);
this.setButtons(e)
}},renderButtons:function(){this.saveAndCloseButton=a.DB.INPUT("saveAndClose",{tabIndex:this.BUTTONS_BASE_IDX+this.lastTabIndex++,type:"button",value:"Save & Close"});
this.saveButton=a.DB.INPUT("save",{tabIndex:this.BUTTONS_BASE_IDX+this.lastTabIndex++,type:"button",value:"Save"});
this.cancelButton=a.DB.A("cancel",{tabIndex:this.BUTTONS_BASE_IDX+this.lastTabIndex++,href:"javascript:noop();",html:"Cancel"});
this.removeButton=a.DB.INPUT("remove",{tabIndex:this.BUTTONS_BASE_IDX+this.lastTabIndex++,type:"button",value:"Remove"});
this.buttonEvents.push(a.on("click",this.saveAndClose,this.saveAndCloseButton,this),a.on("click",this.save,this.saveButton,this),a.on("click",this.remove,this.removeButton,this),a.on("click",this.cancel,this.cancelButton,this));
for(var d=(this.params.buttons.length-1);
d>=0;
d--){var c=this.params.buttons[d];
if(!c){continue
}switch(c.type){case"cancel":this.cancelButton.set("innerHTML",c.title);
this.buttonHolder.append(a.DB.DIV("cancel-block",this.cancelButton));
break;
case"save":this.saveButton.set("value",c.title);
this.buttonHolder.append(a.DB.DIV("button-block",this.saveButton));
break;
case"remove":this.removeButton.set("value",c.title);
this.buttonHolder.append(a.DB.DIV("button-block",this.removeButton));
break;
case"saveAndClose":this.saveAndCloseButton.set("value",c.title);
this.buttonHolder.append(a.DB.DIV("button-block",this.saveAndCloseButton));
break;
default:var e;
if(c.style=="text"){e=a.DB.A({html:c.title,href:"javascript:noop();",data:{type:c.type}});
this.buttonHolder.append(a.DB.DIV("cancel-block",e))
}else{e=a.DB.INPUT((c.className?c.className:""),{type:"button",value:c.title,data:{type:c.type}});
this.buttonHolder.append(a.DB.DIV("button-block",e))
}this.buttonEvents.push(a.on("click",this.onCustomButtonPress,e,this))
}}},onCustomButtonPress:function(b){this.fire("button-"+b.target.data().type)
},showSaveOverlay:function(b){this.fire("show-save-overlay");
if(this.params.disableSaveOverlay){return
}if(this.saveOverlayAnimationManager&&this.saveOverlayAnimationManager.isRunning()){this.saveOverlayAnimationManager.stop(true)
}if(this.saveOverlay){this.saveOverlay.remove()
}this.saveOverlay=a.DB.DIV("save-overlay",{style:"height: "+(this.bodyEl.get("offsetHeight")+5)+"px; padding-top: "+(this.bodyEl.get("offsetHeight")/2-40)+"px; width: "+this.bodyEl.get("offsetWidth")+"px",html:"&nbsp;"});
this.bodyEl.append(this.saveOverlay);
if(b){this.titleEl.addClass("save-overlay-active")
}this.saveOverlayAnimationManager=new a.Squarespace.AnimationManager();
this.saveOverlayAnimationManager.push(this._anim({node:this.tabsEl,to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong}));
this.saveOverlayAnimationManager.push(this._anim({node:this.saveOverlay,to:{opacity:0.8},duration:0.25,easing:a.Easing.easeOutStrong}));
if(this.autosaveEl){this.saveOverlayAnimationManager.push(this._anim({node:this.autosaveEl,to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong}))
}if(this.params.style!="transparent"){this.saveOverlayAnimationManager.push(this._anim({node:this.titleEl,to:{opacity:1},duration:0.25,easing:a.Easing.easeOutStrong}));
if(this.controlsEl){this.saveOverlayAnimationManager.push(this._anim({node:this.controlsEl.get("firstChild"),to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong}))
}}this.saveOverlayAnimationManager.on("end",function(){this.fire("save-overlay-shown")
},this);
this.saveOverlayAnimationManager.run()
},hideSaveOverlay:function(){if(this.saveOverlay){this.fire("hide-save-overlay");
this.titleEl.removeClass("save-overlay-active");
if(this.saveOverlayAnimationManager&&this.saveOverlayAnimationManager.isRunning()){this.saveOverlayAnimationManager.stop(true)
}this.saveOverlayAnimationManager=new a.Squarespace.AnimationManager();
this.saveOverlayAnimationManager.push(this._anim({node:this.saveOverlay,to:{opacity:0},duration:0.25,easing:a.Easing.easeOutStrong}));
this.saveOverlayAnimationManager.push(this._anim({node:this.tabsEl,to:{opacity:1},duration:0.25,easing:a.Easing.easeOutStrong}));
this.saveOverlayAnimationManager.on("end",function(){this.saveOverlay.remove();
this.fire("save-overlay-hidden");
this.state=a.Squarespace.DialogStates.EDITING;
this.updateTitle()
},this);
this.saveOverlayAnimationManager.run()
}else{this.state=a.Squarespace.DialogStates.EDITING
}},allowEditing:function(){this.hideSaveOverlay();
this.clearEdited();
this.fire("editing-allowed");
this.state=a.Squarespace.DialogStates.EDITING
},save:function(){if(!this._showLocalErrors()){this._debug.log("save");
this.closeOnSend=false;
this._saveData()
}},_showLocalErrors:function(){var f=function(j){return j.inActiveFrame
};
var i=this.currentTab;
var c=function(j){return j.tab.name===i.name
};
var h=function(j){return{field:j,errors:j.getErrors()}
};
var b=a.Object.values(this.fields);
if(this.params.validateActiveTabOnly){b=b.filter(function(j){return f(j)&&c(j)
},this)
}else{b=b.filter(f,this)
}var e=a.Array.map(b,h);
var g=false;
var d={};
e.forEach(function(j){var k=j.field,m=j.errors;
var l=m[m.length-1];
if(l){d[j.field.getName()]=m[m.length-1];
g=true
}},this);
if(g){this.showErrors(d)
}return g
},saveAndShow:function(){if(!this._showLocalErrors()){this._debug.log("saveAndShow");
this.closeOnSend=false;
this._saveData();
this.show()
}},saveAndClose:function(){if(!this._showLocalErrors()){this.fire("preClose");
this._debug.log("saveAndClose");
if(this.params.closeable){this.closeOnSend=true
}this._saveData()
}},_saveData:function(){this._debug.log("_saveData");
if(this.state==a.Squarespace.DialogStates.SAVING){this._debug.log("_saveData","Exiting because dialog state is in SAVING");
return
}this.clearEdited();
this.hideErrors();
this.state=a.Squarespace.DialogStates.SAVING;
this.updateTitle();
this.showSaveOverlay();
this._debug.log("_saveData","fire","send-requested");
this.fire("send-requested")
},remove:function(b){if(b){b.halt()
}this.fire("remove-requested")
},canClose:function(b,d){var c=0;
if(this.childDialogs&&this.childDialogs.length>0){for(c=0;
c<this.childDialogs.length;
c++){if(!this.childDialogs[c].canClose(this.saveAndClose,this.cancel)){return false
}}}if((this.edited||this.editedSinceLastSave)&&this.params.discardChangesConfirmation){var g=false;
for(var f in this.fields){var e=this.fields[f];
if(e.didDataChange()){g=true
}else{}}if(g){new a.Squarespace.ConfirmationDialog({style:"confirmOrReject",confirmText:"Save",rejectText:"Discard",showScreenOverlay:true,showSaveOverlay:false,scope:this,onSuccess:function(){this.clearEdited();
this._debug.log("canClose","calling onSuccess()",b);
b.call(this)
},onReject:function(){this.clearEdited();
this._debug.log("canClose","calling onReject()",d);
d.call(this)
},onCancel:function(){a.Squarespace.EscManager.addTarget(this);
this._debug.log("canClose","onCancel");
this.fire("cancel-close")
}}).show("Review Changes","You have made changes. Do you want to save or discard them?");
this._debug.log("canClose",false,"Showing confirmation dialog");
return false
}}this._debug.log("canClose",true);
return true
},close:function(c,b){this._debug.log("close",c);
if(this.state!=a.Squarespace.DialogStates.EDITING&&this.state!=a.Squarespace.DialogStates.SAVING){this._debug.log("close","Exiting because state is in Editing or Saving.");
return
}if(!b){if(this.canClose(this.saveAndClose,this.cancel)===false){this._debug.log("close","Exiting because canClose came back false");
return
}}else{this._debug.log("canClose skipped due to force = true")
}this.fire("close");
if(this.getAnchorData()&&((this.getAnchorData()._name=="Item"&&this.getAnchorData().getUnsaved())||((this.getAnchorData().saved!==undefined)&&!this.getAnchorData().saved))&&!this.edited){this.cancel(c);
return
}this.dismiss(true)
},cancel:function(b){this._debug.log("cancel",b);
if(this.state!=a.Squarespace.DialogStates.EDITING&&this.state!=a.Squarespace.DialogStates.SAVING){return
}this.clearEdited();
this.fire("cancel");
this.dismiss(false)
},dismiss:function(e){this.fire("dismiss");
this.state=a.Squarespace.DialogStates.CLOSING;
this.updateTitle();
this.clearEdited();
this._preDestroy();
this.hideErrors();
if(this.params.overlay){this.restoreBodyScroll()
}switch(this.params.hideAnim){case"noHideAnimation":this._finishCancelation();
break;
case"custom":var d=this;
this.params.customHideAnim(this.el,function(){d._finishCancelation()
});
break;
case"slideDownUp":var b=this._anim({node:this.el,to:{marginTop:-this.el.height()+"px"},duration:0.3,easing:a.Easing.easeOut});
b.on("end",this._finishCancelation,this);
b.run();
break;
default:var b=this._anim({node:this.el,to:{opacity:0},duration:0.3,easing:a.Easing.easeOut});
b.on("end",this._finishCancelation,this);
b.run();
break
}if(this.params.overlay&&this.overlayEl){this.overlayEl.destroying=true;
var c=this._anim({node:this.overlayEl,to:{opacity:0},duration:0.2,easing:a.Easing.easeOutStrong});
c.on("end",function(){if(this.overlayEl){this.overlayEl.remove();
this.overlayEl=null
}},this);
c.run()
}},_finishCancelation:function(){this.fire("render-anchor",this.getInitialData());
this.destroy();
this.state=a.Squarespace.DialogStates.CLOSED;
this.fire("canceled")
},_preDestroy:function(){this._preDestroyCalled=true;
var b=a.Squarespace.OPEN_DIALOGS.indexOf(this);
if(b!=-1){a.Squarespace.OPEN_DIALOGS.splice(b,1)
}if(a.Squarespace.OPEN_DIALOGS.length===0){a.one(document.body).removeClass("dialog-open")
}for(var c=0;
c<this.childDialogs.length;
++c){this.childDialogs[c].close()
}for(var c=0;
c<this.timers.length;
++c){this.timers[c].cancel()
}this.timers=[];
if(a.Squarespace.EscManager){a.Squarespace.EscManager.removeTarget(this)
}if(this.activeFlyout){this.activeFlyout.field.closeFlyout()
}if(a.Squarespace.ToolTipManager&&this.params.disableTips){a.Squarespace.ToolTipManager.enableTooltips()
}if(this.firstShowEvent){this.firstShowEvent.detach();
this.firstShowEvent=null
}if(this.anchorEl&&this.anchorEl._node){this.anchorEl.removeClass("targeted")
}},send:function(){var g=0;
var d={};
for(var b in this.fields){var c=this.fields[b];
var e=false;
if(a.Squarespace.DialogField2&&c instanceof a.Squarespace.DialogField2){e=c.get("required")&&c.isEmpty()
}else{e=(c.config.required&&(c.getValue()===""||c.getValue()===0))
}if(e){d[c.getName()]="This is a required field.";
g++
}}if(g){this.showErrors(d);
this.fire("local-errors")
}else{if(this.closeOnSend){this.saved=true;
this.closeOnSend=false;
this.close()
}this.fire("sent")
}},updateAutoSave:function(d,b){if(!this.autosaveEl.inDoc()){this.editedSinceLastSave=false;
return
}this.autosaveEl.setStyle("display","block");
var c=this._anim({node:this.autosaveEl,from:{opacity:1},to:{opacity:0.5},duration:0.25,easing:a.Easing.easeOutStrong});
c.on("end",function(){if(d){this.autosaveEl.set("innerHTML",d)
}else{this.autosaveEl.set("innerHTML","Last saved <span class='time'></span>.");
this.autosaveEl.one(".time").plug(a.Squarespace.RelativeTimeDisplay)
}if(b){this.autosaveEl.addClass("error")
}else{this.autosaveEl.removeClass("error")
}if(this.autosaveEl.ancestor("body")){this._anim({node:this.autosaveEl,from:{opacity:0.5},to:{opacity:1},duration:0.25,easing:a.Easing.easeOutStrong}).run()
}},this);
c.run();
this.editedSinceLastSave=false
},_recordFieldData:function(d,g){for(var f in g.fields){f=g.fields[f];
if(a.Lang.isFunction(f.getValue)){var c=f.getValue();
if(c&&a.Lang.isObject(c)&&a.Object.isEmpty(c)){c=undefined
}d[f.getName()]=c;
if(f.getAssociatedVars!==undefined){var e=f.getAssociatedVars();
for(var b=0;
b<e.length;
b++){d[e[b].name]=e[b].value
}}if(((f.ctor&&f.ctor===a.Squarespace.DialogFileImage)||(f.constructor&&f.constructor==a.Squarespace.DialogFileImage))&&f.getMediaFocalPoint()){console.log("saving the mediaFocalPoint",f.getMediaFocalPoint());
d.mediaFocalPoint=f.getMediaFocalPoint()
}}if(f.fields){this._recordFieldData(d,f)
}}},getData:function(){var c={};
for(var b in this.params.initialData){c[b]=this.params.initialData[b]
}this._recordFieldData(c,this);
return c
},getField:function(b){var d=this.fields[b];
if(d){return d
}for(var c in this.fields){if(this.fields[c].getField){d=this.fields[c].getField(b);
if(d){break
}}}return d
},getSection:function(b){return this.sections[b]
},_renderFields:function(c,b,d,e){var f=30;
a.Array.each(b,function(l,o){var q;
if(!l){return
}var n;
var k;
var j;
var h;
if(!e&&!this.params.dontSetWidthOnFields){e=this.params.width-f*2
}if(e){this._debug.log("availableWidth: ",e);
this._debug.log("fieldConfig.width: ",l.width);
j=(l.ctor&&l.config?l.config.width:l.width)||1,h=(j<=1?Math.floor(j*e):j)
}if(l.type==="splitter"){n=a.DB.DIV("split-field clear "+(l.fields.length>1?"padding-adjust":""));
if(!l.width){l.width=1
}if(e){n.setStyle("width",(Math.round(l.width*e)+f)+"px");
k=e-(f*(l.fields.length-1))
}else{k=d.get("offsetWidth")-(f*(l.fields.length-1))-f*2
}d.append(n);
this._renderFields(c,l.fields,n,k);
if(l.countHeight){this._takenHeight+=n.get("offsetHeight")
}if(l.hidden){n.hide()
}}else{if(l.type==="multi-frame"){q=new a.Squarespace.DialogFieldGenerators[l.type](l,this.params.initialData,this);
q.type=l.type;
q.append(c,b,d,e);
if(q.getName()){this.fields[q.getName()]=q
}else{this._noNameFields.push(q)
}}else{if(l.ctor&&l.ctor==a.Squarespace.DialogFields.MultiFrame){var g=a.merge(l,l.config,{dialog:this,data:this.params.initialData[l.config.name],render:d});
q=new l.ctor(g);
if(e){q.get("boundingBox").setStyle("width",h+"px")
}var r=q.getName()||q.get("name");
if(r){this.fields[r]=q
}else{this._noNameFields.push(q)
}q.each(function(i){var w=i.getName()||i.get("name");
if(w){this.fields[w]=i
}else{this._noNameFields.push(i)
}c.tabFields.push(i);
i.tab=c
},this)
}else{if(l.type==="section"){var x=a.DB.DIV("section-inner clear");
sectionField=a.DB.DIV("section-field container-field-wrapper field-wrapper clear "+((l.style!==undefined)?l.style:""),x);
d.append(sectionField);
if(!l.width){l.width=1
}k=e;
sectionField.setStyle("width",(Math.round(l.width*k))+"px");
var t=Math.round(l.width*k);
this._renderFields(c,l.fields,x,t);
if(l.hidden){sectionField.hide()
}if(l.name){this.sections[l.name]=n
}}else{if(l.type==="stack"){n=a.DB.DIV("stack-field stack-field-wrapper clear");
d.append(n);
k=e;
if(!e){k=this.params.width-f*2
}if(!l.width){l.width=1
}if(l["float"]){n.setStyle("float",l["float"])
}n.setStyle("width",(Math.round(l.width*k))+"px");
if(o!=b.length-1){n.setStyle("paddingRight",f+"px")
}var t=Math.round(l.width*k);
this._renderFields(c,l.fields,n,t);
if(l.hidden){n.hide()
}if(l.name){this.sections[l.name]=n
}}else{var s;
var p=a.merge(l,l.config||{},{dialog:this,render:d});
var v=p.name||l.name;
if(a.Lang.isUndefined(p.data)&&this.params.initialData&&!a.Lang.isUndefined(v)){p.data=this.params.initialData[v];
p.panel=this
}if(l.ctor){s=new l.ctor(p)
}else{if(!l.type){console.error("dialog: field type was",l.type,", and constructor was",l.ctor);
console.error("dialog: config was",l);
throw"Could not find field constructor or field type."
}var u=this._convertToDialogField2Name(l.type),m=a.namespace("Squarespace.DialogFields")[u];
if(!m&&!a.Squarespace.DialogFieldGenerators[l.type]){throw"Unknown field type: "+l.type
}this._debug.log("Generating field type: ",l.type);
if(m){s=new m(p)
}else{s=new a.Squarespace.DialogFieldGenerators[l.type](l,this.params.initialData,this);
s.type=l.type;
s.append(d);
if(l.verticalSpan){this._verticalEl=s
}if(l.countHeight&&!l.verticalSpan){this._takenHeight+=s.getTakenHeight()
}}}if(e){if(a.Squarespace.DialogField2&&s instanceof a.Squarespace.DialogField2){this._debug.log("setting width",h);
s.get("boundingBox").setStyle("width",h+"px")
}else{if(s.html){this._debug.log("setting width",h);
s.html.setStyle("width",h+"px")
}}}if(s.resize){s.resize()
}if(l.hidden){s.temporaryHide(true)
}if(a.Squarespace.DialogField2&&s instanceof a.Squarespace.DialogField2){this.bodyEvents.push(s.on("dataStateChange",function(y){var w=y.newVal,i=s.getProperty("DATA_STATES");
this.fire("field-loading-change",{field:s,loading:w===w.LOADING})
},this))
}else{this.bodyEvents.push(s.on("loadingChange",function(i){this.fire("field-loading-change",{field:s,loading:i.newVal})
},this))
}if(s.getName()){this.fields[s.getName()]=s
}else{this._noNameFields.push(s)
}c.tabFields.push(s);
s.tab=c
}}}}}},this)
},resizeVerticalFields:function(){for(var b=0;
b<this.verticalFields.length;
++b){var c=this.verticalFields[b];
c.setHeight(this.getBodyHeight()-c._takenHeight)
}},renderTab:function(e,c){var d=a.DB.DIV("tab-wrapper");
d.setStyles({width:this.params.width+"px",left:(c?"0px":this.params.width+"px")});
this.bodyEl.append(d);
e.tabFields=[];
this._verticalEl=null;
this._takenHeight=0;
this._renderFields(e,e.fields||[],d);
if(!!e.noTabTitle){d.addClass("noTabTitle")
}if(this._verticalEl){var b=parseInt(d.getStyle("paddingTop"),10);
this._takenHeight+=b;
if(!this._verticalEl.setHeight){console.error("No setHeight for vertical el: ",this._verticalEl)
}this._verticalEl.setHeight(this.getBodyHeight()-this._takenHeight);
this._verticalEl._takenHeight=this._takenHeight;
this.verticalFields.push(this._verticalEl)
}e.tabPanelObj=d;
this.observedHeight+=d.get("offsetHeight");
if(c){if(e.tabFields){a.Array.forEach(e.tabFields,function(f){this._showField(f)
},this)
}}if(e.scroll){this.bodyEl.addClass("scrollable")
}else{this.bodyEl.removeClass("scrollable")
}if(!c){d.addClass("hidden")
}return d
},_convertToDialogField2Name:function(c){var d=a.Squarespace.Utils.slugify(c).split("-");
for(var b=d.length-1;
b>=0;
b--){if(d[b].capitalize){d[b]=d[b].capitalize()
}}return d.join("")+"Field"
},destroyBody:function(){this.rendered=false;
if(this.fields){for(var d in this.fields){var c=this.fields[d];
c.destroy()
}a.Array.each(this._noNameFields,function(e){if(e){e.destroy()
}},this);
this._noNameFields=[]
}this.fields={};
if(this.saveOverlayAnimationManager&&this.saveOverlayAnimationManager.isRunning()){this.saveOverlayAnimationManager.destroy(true)
}if(this.bodyEl&&this.bodyEl._node){this.bodyEl.empty()
}for(var b=0;
b<this.params.tabs.length;
++b){this.params.tabs[b].tabPanelObj=null;
this.params.tabs[b].tabNavigationObj=null;
this.params.tabs[b].tabFields=null
}for(var b=0;
b<this.bodyEvents.length;
b++){this.bodyEvents[b].detach()
}this.bodyEvents=[]
},destroyButtons:function(){for(var b=0;
b<this.buttonEvents.length;
b++){this.buttonEvents[b].detach()
}this.buttonEvents=[];
if(this.buttonHolder&&this.buttonHolder._node){this.buttonHolder.set("innerHTML","")
}},_destroy:function(){if(!this.preDestroyCalled){this._preDestroy()
}this.destroyTimer=null;
this.currentErrors=null;
this.bodyHeight=null;
this.destroyBody();
this.destroyButtons();
if(this.overlayEl&&!this.overlayEl.destroying){this.overlayEl.remove();
this.overlayEl=null
}for(var b=0;
b<this.globalEvents.length;
b++){this.globalEvents[b].detach()
}if(this.dd){this.dd.destroy();
this.dd=null
}this.globalEvents=[];
if(this.el){this.el.remove();
this.el=null;
this.bodyEl=null
}if(this.params.parentDialog){this.params.parentDialog.removeChildDialog(this);
this.params.parentDialog=null
}this.state=a.Squarespace.DialogStates.CLOSED;
this.position=null;
this.anchorEl=null;
this.anchorData=null
}});
a.augment(a.Squarespace.EditingDialog,a.EventTarget)
},"1.0",{requires:["node","datatype-date","node-focusmanager","anim","dd","attribute","json","node-event-simulate","transition","squarespace-animation-manager","squarespace-debugger","squarespace-dialog-fields","squarespace-dialog-field-2","squarespace-ui-base","squarespace-dombuilder","squarespace-dialog-css","squarespace-gizmo","squarespace-drag-selection"]});/* Host: nyc-webster4 Request Version: 02112013233624799 Local Version: 02112013233624799 Served from: LOCAL */ 
YUI.add("squarespace-signup",function(a){a.namespace("Squarespace");
a.Squarespace.Signup=Singleton.create({ready:function(){this.chromeEl=null;
this.params={type:"Website",cloneIdentifier:(Static.SQUARESPACE_CONTEXT.website?Static.SQUARESPACE_CONTEXT.website.identifier:null),page:"preview"}
},show:function(d){if(d){this.params=a.merge(this.params,d)
}if(!this.signupDialog){var e={loadingText:"Loading...",savingText:"Verifying...",closingText:"Success!...",name:"squarespace-signup",discardChangesConfirmation:false,disableOverlayCancel:true,style:"transparent",overlay:1,width:425,top:120,zIndex:200000,closeOthers:false,buttons:[{type:"cancel",title:"Cancel"},{type:"saveAndClose",title:"Finish & Create Site"}],tabs:[{title:"Squarespace Signup",icon:"/universal/images-v6/dialog/login-icon.png?4",fields:[{type:"description",className:"big-signup-title",text:"Create Your "+this.params.type},{type:"description",text:"<strong>Create an account.</strong>  Enter your email and password which you'll use when logging into your Squarespace website.",padding:[10,0]},{type:"splitter",fields:[{type:"text",width:0.5,required:true,name:"firstName",title:"First Name",style:"title",titleStyle:"inline",submitOnEnter:true},{type:"text",width:0.5,required:true,name:"lastName",title:"Last Name",style:"title",titleStyle:"inline",submitOnEnter:true}]},{type:"text",required:true,name:"email",title:"your@email.com",style:"title",titleStyle:"inline",submitOnEnter:true,mailcheck:true},{type:"text",required:true,name:"password",password:true,title:"Password",style:"title",titleStyle:"inline",submitOnEnter:true},{type:"description",className:"big-signup-footer",text:'By clicking below to sign up, you are agreeing to the Squarespace <a target="new" href="http://www.squarespace.com/terms">Terms of Service.</a>'},{type:"hidden",name:"SK1"}]}]};
var b={name:"squarespace-signup",style:"transparent",overlay:1,width:375,top:180,height:150,zIndex:200000,buttons:[{type:"cancel",title:"Cancel"}],tabs:[{title:"Squarespace Signup",icon:"/universal/images-v6/dialog/login-icon.png?4",fields:[{type:"description",className:"big-signup-title",text:"Create Your "+this.params.type},{type:"description",text:"You are not using a supported web browser. Squarespace's management interface and site creation currently supports the latest versions of Firefox, Safari and Google Chrome. Please update your browser to continue.",padding:[10,0]}]}]};
if(!a.Squarespace.Utils.advancedBrowserCheck()){this.signupDialog=new a.Squarespace.EditingDialog(b)
}else{this.signupDialog=new a.Squarespace.EditingDialog(e)
}this.signupDialog.on("loading",function(){if(a.Squarespace.Management){a.Squarespace.Management.hideChrome()
}a.all(".map-widget").each(function(c){c.setStyle("visibility","hidden")
});
a.Data.get({url:"/api/auth/SignupKey",success:function(c){this.signupDialog.getField("SK1").setValue(c.key)
}},this)
},this);
this.signupDialog.on("cancel",function(){if(a.Squarespace.Management){a.Squarespace.Management.showChrome()
}a.all(".map-widget").each(function(c){c.setStyle("visibility","visible")
})
},this);
this.signupDialog.on("datachange",function(){if(!this.getData().remember){a.Cookie.remove("email")
}this.hideErrors()
});
this.signupDialog.on("show-errors",function(f){for(var c in f){a.Squarespace.Analytics.trackInternal("marketplace_signup_rejected",{field:c,reason:f[c],identifier:a.Squarespace.Signup.params.cloneIdentifier});
break
}},this);
this.signupDialog.on("send-requested",function(){a.Squarespace.Analytics.trackInternal("marketplace_signup_attempt",{identifier:a.Squarespace.Signup.params.cloneIdentifier});
var c=this.getData();
a.Data.sendForm(this,{url:"/api/auth/Signup",secure:true,data:{cloneIdentifier:a.Squarespace.Signup.params.cloneIdentifier,page:a.Squarespace.Signup.params.page,confirmOnly:true,category:a.Squarespace.Signup.params.type,developer:a.Squarespace.Signup.params.developer},success:function(f){if(a.Squarespace.Signup.params.lifeCycleTrialEventFn){a.Squarespace.Signup.params.lifeCycleTrialEventFn(f)
}a.Squarespace.Transitions.getTransition({el:this.el,name:"scale",direction:"out",duration:0.3}).run();
this.LB=new a.Squarespace.Lightbox({content:'<div class="squarespace-signup-spinner">&nbsp;</div><div class="squarespace-signup-text">Please wait a moment while your Squarespace site is created...</div>',contentOnly:true,zIndex:200100,transition:"scale",margin:0,clickAnywhereToExit:false});
this.LB.show();
var g={cloneIdentifier:a.Squarespace.Signup.params.cloneIdentifier,page:a.Squarespace.Signup.params.page,category:a.Squarespace.Signup.params.type,developer:a.Squarespace.Signup.params.developer};
if(f.login){g.login=f.login
}if(a.Squarespace.TweakManager&&a.Squarespace.TweakManager.dialog){g.tweakSettings=a.Squarespace.TweakManager._getTweakSettings()
}a.Data.sendForm(this,{url:"/api/auth/Signup",secure:true,data:g,success:function(h){top.location.href="http://"+h.website+"."+Static.SQUARESPACE_CONTEXT.appDomain+"/config/?loginToken="+h.loginToken
},failure:function(h){this.LB.hide();
a.Squarespace.Transitions.getTransition({el:this.el,name:"scale",direction:"in",duration:0.3}).run()
}},this)
}},this)
})
}this.signupDialog.setInitialData({inviteCode:a.Cookie.get("invitationId")});
this.signupDialog.show();
a.one("body").setStyle("overflowY","visible");
a.one(".dialog-squarespace-signup").setStyle("position","absolute");
window.scrollTo(0,0);
a.Squarespace.Analytics.trackInternal("marketplace_signup_view",{identifier:a.Squarespace.Signup.params.cloneIdentifier})
},onSignupClick:function(b){if(b.target.ancestor(".squarespace-signup-tweak",true)){b.halt();
a.Squarespace.TweakManager.enable();
return
}if(b.target.ancestor(".sqsp-chrome-style-mode .sqsp-chrome-close-button",true)){b.halt();
a.Squarespace.TweakManager.disable();
return
}if(this.topOrigin){top.postMessage({installTemplate:a.Squarespace.Signup.params.cloneIdentifier},this.topOrigin)
}else{this.show({lifeCycleTrialEventData:{trial_start_origin:"template-direct"}})
}},updateSignupChrome:function(){if(Static.SQUARESPACE_CONTEXT.website.cloneable&&!a.UA.mobile&&!(window.SQUARESPACE_LOGIN&&window.SQUARESPACE_LOGIN.isLoggedIn())&&!this.chromeEl){a.Squarespace.Analytics.trackInternal("marketplace_site_view",{identifier:Static.SQUARESPACE_CONTEXT.website.identifier});
this.chromeEl=a.DB.DIV("sqsp-chrome",a.DB.DIV("sqsp-chrome-badge squarespace-signup-chrome squarespace-managed-ui",{data:{manager:this}},a.DB.DIV("squarespace-signup-avatar",{html:"&nbsp;"}),a.DB.DIV("sqsp-chrome-text squarespace-signup-about",a.DB.DIV("sqsp-chrome-text-primary squarespace-signup-username",{html:"Create a Site Like This"}),a.DB.DIV("sqsp-chrome-text-secondary squarespace-signup-description",{html:"Free trial.  Instant access."})),a.DB.DIV("sqsp-chrome-buttons",a.DB.DIV("sqs-chrome-button squarespace-signup-button squarespace-signup-create",{html:"&nbsp;"}))));
this.eventHandlers=[a.on("click",this.onSignupClick,this.chromeEl,this)];
var d=a.zen(".sqsp-chrome-style-mode.sqsp-chrome-badge");
var e=d.zen("> .sqsp-chrome-text");
e.zen("> .sqsp-chrome-text-primary").setContent("Style Mode");
e.zen("> .sqsp-chrome-text-secondary").setContent("Change fonts, colors and sizes.");
var c=d.zen("> .sqsp-chrome-buttons");
var b=c.zen("> .sqsp-chrome-button.sqsp-chrome-close-button");
this.chromeEl.append(d);
a.one(document.body).append(this.chromeEl)
}else{if(window.SQUARESPACE_LOGIN&&window.SQUARESPACE_LOGIN.isLoggedIn()){if(this.chromeEl){this.chromeEl.remove();
this.chromeEl=null
}}}}})
},"1.0",{requires:["node","squarespace-dialog","squarespace-dialog-hidden"]});